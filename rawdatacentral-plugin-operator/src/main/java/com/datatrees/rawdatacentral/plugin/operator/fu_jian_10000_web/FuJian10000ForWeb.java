package com.datatrees.rawdatacentral.plugin.operator.fu_jian_10000_web;

import javax.script.Invocable;
import java.io.InputStream;
import java.net.URLEncoder;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.List;
import java.util.Map;

import com.datatrees.common.util.PatternUtils;
import com.datatrees.crawler.core.util.xpath.XPathUtil;
import com.datatrees.rawdatacentral.common.http.TaskHttpClient;
import com.datatrees.rawdatacentral.common.http.TaskUtils;
import com.datatrees.rawdatacentral.common.utils.CheckUtils;
import com.datatrees.rawdatacentral.common.utils.RedisUtils;
import com.datatrees.rawdatacentral.common.utils.ScriptEngineUtil;
import com.datatrees.rawdatacentral.common.utils.TemplateUtils;
import com.datatrees.rawdatacentral.domain.constant.FormType;
import com.datatrees.rawdatacentral.domain.enums.ErrorCode;
import com.datatrees.rawdatacentral.domain.enums.RequestType;
import com.datatrees.rawdatacentral.domain.operator.OperatorParam;
import com.datatrees.rawdatacentral.domain.result.HttpResult;
import com.datatrees.rawdatacentral.domain.vo.Response;
import com.datatrees.rawdatacentral.service.OperatorPluginService;
import org.apache.commons.collections.CollectionUtils;
import org.apache.commons.lang3.StringUtils;
import org.apache.http.entity.ContentType;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

/**
 * 因web版个人信息不足，需从wap版查询 姓名、身份证、入网时间
 * Created by guimeichao on 17/9/19.
 */
public class FuJian10000ForWeb implements OperatorPluginService {

    private static final Logger logger         = LoggerFactory.getLogger(FuJian10000ForWeb.class);
    private static final String javaScript_wap
                                               = "CnZhciBiaVJhZGl4QmFzZSA9IDI7CnZhciBiaVJhZGl4Qml0cyA9IDE2Owp2YXIgYml0c1BlckRpZ2l0ID0gYmlSYWRpeEJpdHM7CnZhciBiaVJhZGl4ID0gMSA8PCAxNjsgLy8gPSAyXjE2ID0gNjU1MzYKdmFyIGJpSGFsZlJhZGl4ID0gYmlSYWRpeCA+Pj4gMTsKdmFyIGJpUmFkaXhTcXVhcmVkID0gYmlSYWRpeCAqIGJpUmFkaXg7CnZhciBtYXhEaWdpdFZhbCA9IGJpUmFkaXggLSAxOwp2YXIgbWF4SW50ZWdlciA9IDk5OTk5OTk5OTk5OTk5OTg7IAoKdmFyIG1heERpZ2l0czsKdmFyIFpFUk9fQVJSQVk7CnZhciBiaWdaZXJvLCBiaWdPbmU7CgpmdW5jdGlvbiBzZXRNYXhEaWdpdHModmFsdWUpCnsKCW1heERpZ2l0cyA9IHZhbHVlOwoJWkVST19BUlJBWSA9IG5ldyBBcnJheShtYXhEaWdpdHMpOwoJZm9yICh2YXIgaXphID0gMDsgaXphIDwgWkVST19BUlJBWS5sZW5ndGg7IGl6YSsrKSBaRVJPX0FSUkFZW2l6YV0gPSAwOwoJYmlnWmVybyA9IG5ldyBCaWdJbnQoKTsKCWJpZ09uZSA9IG5ldyBCaWdJbnQoKTsKCWJpZ09uZS5kaWdpdHNbMF0gPSAxOwp9CgpzZXRNYXhEaWdpdHMoMTI5KTsKCnZhciBkcGwxMCA9IDE1Owp2YXIgbHIxMCA9IGJpRnJvbU51bWJlcigxMDAwMDAwMDAwMDAwMDAwKTsKCmZ1bmN0aW9uIEJpZ0ludChmbGFnKQp7CglpZiAodHlwZW9mIGZsYWcgPT0gImJvb2xlYW4iICYmIGZsYWcgPT0gdHJ1ZSkgewoJCXRoaXMuZGlnaXRzID0gbnVsbDsKCX0KCWVsc2UgewoJCXRoaXMuZGlnaXRzID0gWkVST19BUlJBWS5zbGljZSgwKTsKCX0KCXRoaXMuaXNOZWcgPSBmYWxzZTsKfQoKZnVuY3Rpb24gYmlGcm9tRGVjaW1hbChzKQp7Cgl2YXIgaXNOZWcgPSBzLmNoYXJBdCgwKSA9PSAnLSc7Cgl2YXIgaSA9IGlzTmVnID8gMSA6IDA7Cgl2YXIgcmVzdWx0OwoJLy8gU2tpcCBsZWFkaW5nIHplcm9zLgoJd2hpbGUgKGkgPCBzLmxlbmd0aCAmJiBzLmNoYXJBdChpKSA9PSAnMCcpICsraTsKCWlmIChpID09IHMubGVuZ3RoKSB7CgkJcmVzdWx0ID0gbmV3IEJpZ0ludCgpOwoJfQoJZWxzZSB7CgkJdmFyIGRpZ2l0Q291bnQgPSBzLmxlbmd0aCAtIGk7CgkJdmFyIGZnbCA9IGRpZ2l0Q291bnQgJSBkcGwxMDsKCQlpZiAoZmdsID09IDApIGZnbCA9IGRwbDEwOwoJCXJlc3VsdCA9IGJpRnJvbU51bWJlcihOdW1iZXIocy5zdWJzdHIoaSwgZmdsKSkpOwoJCWkgKz0gZmdsOwoJCXdoaWxlIChpIDwgcy5sZW5ndGgpIHsKCQkJcmVzdWx0ID0gYmlBZGQoYmlNdWx0aXBseShyZXN1bHQsIGxyMTApLAoJCQkgICAgICAgICAgICAgICBiaUZyb21OdW1iZXIoTnVtYmVyKHMuc3Vic3RyKGksIGRwbDEwKSkpKTsKCQkJaSArPSBkcGwxMDsKCQl9CgkJcmVzdWx0LmlzTmVnID0gaXNOZWc7Cgl9CglyZXR1cm4gcmVzdWx0Owp9CgpmdW5jdGlvbiBiaUNvcHkoYmkpCnsKCXZhciByZXN1bHQgPSBuZXcgQmlnSW50KHRydWUpOwoJcmVzdWx0LmRpZ2l0cyA9IGJpLmRpZ2l0cy5zbGljZSgwKTsKCXJlc3VsdC5pc05lZyA9IGJpLmlzTmVnOwoJcmV0dXJuIHJlc3VsdDsKfQoKZnVuY3Rpb24gYmlGcm9tTnVtYmVyKGkpCnsKCXZhciByZXN1bHQgPSBuZXcgQmlnSW50KCk7CglyZXN1bHQuaXNOZWcgPSBpIDwgMDsKCWkgPSBNYXRoLmFicyhpKTsKCXZhciBqID0gMDsKCXdoaWxlIChpID4gMCkgewoJCXJlc3VsdC5kaWdpdHNbaisrXSA9IGkgJiBtYXhEaWdpdFZhbDsKCQlpID0gTWF0aC5mbG9vcihpIC8gYmlSYWRpeCk7Cgl9CglyZXR1cm4gcmVzdWx0Owp9CgpmdW5jdGlvbiByZXZlcnNlU3RyKHMpCnsKCXZhciByZXN1bHQgPSAiIjsKCWZvciAodmFyIGkgPSBzLmxlbmd0aCAtIDE7IGkgPiAtMTsgLS1pKSB7CgkJcmVzdWx0ICs9IHMuY2hhckF0KGkpOwoJfQoJcmV0dXJuIHJlc3VsdDsKfQoKdmFyIGhleGF0cmlnZXNpbWFsVG9DaGFyID0gbmV3IEFycmF5KAogJzAnLCAnMScsICcyJywgJzMnLCAnNCcsICc1JywgJzYnLCAnNycsICc4JywgJzknLAogJ2EnLCAnYicsICdjJywgJ2QnLCAnZScsICdmJywgJ2cnLCAnaCcsICdpJywgJ2onLAogJ2snLCAnbCcsICdtJywgJ24nLCAnbycsICdwJywgJ3EnLCAncicsICdzJywgJ3QnLAogJ3UnLCAndicsICd3JywgJ3gnLCAneScsICd6JwopOwoKZnVuY3Rpb24gYmlUb1N0cmluZyh4LCByYWRpeCkKCS8vIDIgPD0gcmFkaXggPD0gMzYKewoJdmFyIGIgPSBuZXcgQmlnSW50KCk7CgliLmRpZ2l0c1swXSA9IHJhZGl4OwoJdmFyIHFyID0gYmlEaXZpZGVNb2R1bG8oeCwgYik7Cgl2YXIgcmVzdWx0ID0gaGV4YXRyaWdlc2ltYWxUb0NoYXJbcXJbMV0uZGlnaXRzWzBdXTsKCXdoaWxlIChiaUNvbXBhcmUocXJbMF0sIGJpZ1plcm8pID09IDEpIHsKCQlxciA9IGJpRGl2aWRlTW9kdWxvKHFyWzBdLCBiKTsKCQlkaWdpdCA9IHFyWzFdLmRpZ2l0c1swXTsKCQlyZXN1bHQgKz0gaGV4YXRyaWdlc2ltYWxUb0NoYXJbcXJbMV0uZGlnaXRzWzBdXTsKCX0KCXJldHVybiAoeC5pc05lZyA/ICItIiA6ICIiKSArIHJldmVyc2VTdHIocmVzdWx0KTsKfQoKZnVuY3Rpb24gYmlUb0RlY2ltYWwoeCkKewoJdmFyIGIgPSBuZXcgQmlnSW50KCk7CgliLmRpZ2l0c1swXSA9IDEwOwoJdmFyIHFyID0gYmlEaXZpZGVNb2R1bG8oeCwgYik7Cgl2YXIgcmVzdWx0ID0gU3RyaW5nKHFyWzFdLmRpZ2l0c1swXSk7Cgl3aGlsZSAoYmlDb21wYXJlKHFyWzBdLCBiaWdaZXJvKSA9PSAxKSB7CgkJcXIgPSBiaURpdmlkZU1vZHVsbyhxclswXSwgYik7CgkJcmVzdWx0ICs9IFN0cmluZyhxclsxXS5kaWdpdHNbMF0pOwoJfQoJcmV0dXJuICh4LmlzTmVnID8gIi0iIDogIiIpICsgcmV2ZXJzZVN0cihyZXN1bHQpOwp9Cgp2YXIgaGV4VG9DaGFyID0gbmV3IEFycmF5KCcwJywgJzEnLCAnMicsICczJywgJzQnLCAnNScsICc2JywgJzcnLCAnOCcsICc5JywKICAgICAgICAgICAgICAgICAgICAgICAgICAnYScsICdiJywgJ2MnLCAnZCcsICdlJywgJ2YnKTsKCmZ1bmN0aW9uIGRpZ2l0VG9IZXgobikKewoJdmFyIG1hc2sgPSAweGY7Cgl2YXIgcmVzdWx0ID0gIiI7Cglmb3IgKGkgPSAwOyBpIDwgNDsgKytpKSB7CgkJcmVzdWx0ICs9IGhleFRvQ2hhcltuICYgbWFza107CgkJbiA+Pj49IDQ7Cgl9CglyZXR1cm4gcmV2ZXJzZVN0cihyZXN1bHQpOwp9CgpmdW5jdGlvbiBiaVRvSGV4KHgpCnsKCXZhciByZXN1bHQgPSAiIjsKCXZhciBuID0gYmlIaWdoSW5kZXgoeCk7Cglmb3IgKHZhciBpID0gYmlIaWdoSW5kZXgoeCk7IGkgPiAtMTsgLS1pKSB7CgkJcmVzdWx0ICs9IGRpZ2l0VG9IZXgoeC5kaWdpdHNbaV0pOwoJfQoJcmV0dXJuIHJlc3VsdDsKfQoKZnVuY3Rpb24gY2hhclRvSGV4KGMpCnsKCXZhciBaRVJPID0gNDg7Cgl2YXIgTklORSA9IFpFUk8gKyA5OwoJdmFyIGxpdHRsZUEgPSA5NzsKCXZhciBsaXR0bGVaID0gbGl0dGxlQSArIDI1OwoJdmFyIGJpZ0EgPSA2NTsKCXZhciBiaWdaID0gNjUgKyAyNTsKCXZhciByZXN1bHQ7CgoJaWYgKGMgPj0gWkVSTyAmJiBjIDw9IE5JTkUpIHsKCQlyZXN1bHQgPSBjIC0gWkVSTzsKCX0gZWxzZSBpZiAoYyA+PSBiaWdBICYmIGMgPD0gYmlnWikgewoJCXJlc3VsdCA9IDEwICsgYyAtIGJpZ0E7Cgl9IGVsc2UgaWYgKGMgPj0gbGl0dGxlQSAmJiBjIDw9IGxpdHRsZVopIHsKCQlyZXN1bHQgPSAxMCArIGMgLSBsaXR0bGVBOwoJfSBlbHNlIHsKCQlyZXN1bHQgPSAwOwoJfQoJcmV0dXJuIHJlc3VsdDsKfQoKZnVuY3Rpb24gaGV4VG9EaWdpdChzKQp7Cgl2YXIgcmVzdWx0ID0gMDsKCXZhciBzbCA9IE1hdGgubWluKHMubGVuZ3RoLCA0KTsKCWZvciAodmFyIGkgPSAwOyBpIDwgc2w7ICsraSkgewoJCXJlc3VsdCA8PD0gNDsKCQlyZXN1bHQgfD0gY2hhclRvSGV4KHMuY2hhckNvZGVBdChpKSkKCX0KCXJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uIGJpRnJvbUhleChzKQp7Cgl2YXIgcmVzdWx0ID0gbmV3IEJpZ0ludCgpOwoJdmFyIHNsID0gcy5sZW5ndGg7Cglmb3IgKHZhciBpID0gc2wsIGogPSAwOyBpID4gMDsgaSAtPSA0LCArK2opIHsKCQlyZXN1bHQuZGlnaXRzW2pdID0gaGV4VG9EaWdpdChzLnN1YnN0cihNYXRoLm1heChpIC0gNCwgMCksIE1hdGgubWluKGksIDQpKSk7Cgl9CglyZXR1cm4gcmVzdWx0Owp9CgpmdW5jdGlvbiBiaUZyb21TdHJpbmcocywgcmFkaXgpCnsKCXZhciBpc05lZyA9IHMuY2hhckF0KDApID09ICctJzsKCXZhciBpc3RvcCA9IGlzTmVnID8gMSA6IDA7Cgl2YXIgcmVzdWx0ID0gbmV3IEJpZ0ludCgpOwoJdmFyIHBsYWNlID0gbmV3IEJpZ0ludCgpOwoJcGxhY2UuZGlnaXRzWzBdID0gMTsgLy8gcmFkaXheMAoJZm9yICh2YXIgaSA9IHMubGVuZ3RoIC0gMTsgaSA+PSBpc3RvcDsgaS0tKSB7CgkJdmFyIGMgPSBzLmNoYXJDb2RlQXQoaSk7CgkJdmFyIGRpZ2l0ID0gY2hhclRvSGV4KGMpOwoJCXZhciBiaURpZ2l0ID0gYmlNdWx0aXBseURpZ2l0KHBsYWNlLCBkaWdpdCk7CgkJcmVzdWx0ID0gYmlBZGQocmVzdWx0LCBiaURpZ2l0KTsKCQlwbGFjZSA9IGJpTXVsdGlwbHlEaWdpdChwbGFjZSwgcmFkaXgpOwoJfQoJcmVzdWx0LmlzTmVnID0gaXNOZWc7CglyZXR1cm4gcmVzdWx0Owp9CgpmdW5jdGlvbiBiaUR1bXAoYikKewoJcmV0dXJuIChiLmlzTmVnID8gIi0iIDogIiIpICsgYi5kaWdpdHMuam9pbigiICIpOwp9CgpmdW5jdGlvbiBiaUFkZCh4LCB5KQp7Cgl2YXIgcmVzdWx0OwoKCWlmICh4LmlzTmVnICE9IHkuaXNOZWcpIHsKCQl5LmlzTmVnID0gIXkuaXNOZWc7CgkJcmVzdWx0ID0gYmlTdWJ0cmFjdCh4LCB5KTsKCQl5LmlzTmVnID0gIXkuaXNOZWc7Cgl9CgllbHNlIHsKCQlyZXN1bHQgPSBuZXcgQmlnSW50KCk7CgkJdmFyIGMgPSAwOwoJCXZhciBuOwoJCWZvciAodmFyIGkgPSAwOyBpIDwgeC5kaWdpdHMubGVuZ3RoOyArK2kpIHsKCQkJbiA9IHguZGlnaXRzW2ldICsgeS5kaWdpdHNbaV0gKyBjOwoJCQlyZXN1bHQuZGlnaXRzW2ldID0gbiAlIGJpUmFkaXg7CgkJCWMgPSBOdW1iZXIobiA+PSBiaVJhZGl4KTsKCQl9CgkJcmVzdWx0LmlzTmVnID0geC5pc05lZzsKCX0KCXJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uIGJpU3VidHJhY3QoeCwgeSkKewoJdmFyIHJlc3VsdDsKCWlmICh4LmlzTmVnICE9IHkuaXNOZWcpIHsKCQl5LmlzTmVnID0gIXkuaXNOZWc7CgkJcmVzdWx0ID0gYmlBZGQoeCwgeSk7CgkJeS5pc05lZyA9ICF5LmlzTmVnOwoJfSBlbHNlIHsKCQlyZXN1bHQgPSBuZXcgQmlnSW50KCk7CgkJdmFyIG4sIGM7CgkJYyA9IDA7CgkJZm9yICh2YXIgaSA9IDA7IGkgPCB4LmRpZ2l0cy5sZW5ndGg7ICsraSkgewoJCQluID0geC5kaWdpdHNbaV0gLSB5LmRpZ2l0c1tpXSArIGM7CgkJCXJlc3VsdC5kaWdpdHNbaV0gPSBuICUgYmlSYWRpeDsKCQkJaWYgKHJlc3VsdC5kaWdpdHNbaV0gPCAwKSByZXN1bHQuZGlnaXRzW2ldICs9IGJpUmFkaXg7CgkJCWMgPSAwIC0gTnVtYmVyKG4gPCAwKTsKCQl9CgkJaWYgKGMgPT0gLTEpIHsKCQkJYyA9IDA7CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgeC5kaWdpdHMubGVuZ3RoOyArK2kpIHsKCQkJCW4gPSAwIC0gcmVzdWx0LmRpZ2l0c1tpXSArIGM7CgkJCQlyZXN1bHQuZGlnaXRzW2ldID0gbiAlIGJpUmFkaXg7CgkJCQlpZiAocmVzdWx0LmRpZ2l0c1tpXSA8IDApIHJlc3VsdC5kaWdpdHNbaV0gKz0gYmlSYWRpeDsKCQkJCWMgPSAwIC0gTnVtYmVyKG4gPCAwKTsKCQkJfQoJCQlyZXN1bHQuaXNOZWcgPSAheC5pc05lZzsKCQl9IGVsc2UgewoJCQlyZXN1bHQuaXNOZWcgPSB4LmlzTmVnOwoJCX0KCX0KCXJldHVybiByZXN1bHQ7Cn0KCgpmdW5jdGlvbiBiaUhpZ2hJbmRleCh4KQp7Cgl2YXIgcmVzdWx0ID0geC5kaWdpdHMubGVuZ3RoIC0gMTsKCXdoaWxlIChyZXN1bHQgPiAwICYmIHguZGlnaXRzW3Jlc3VsdF0gPT0gMCkgLS1yZXN1bHQ7CglyZXR1cm4gcmVzdWx0Owp9CgpmdW5jdGlvbiBiaU51bUJpdHMoeCkKewoJdmFyIG4gPSBiaUhpZ2hJbmRleCh4KTsKCXZhciBkID0geC5kaWdpdHNbbl07Cgl2YXIgbSA9IChuICsgMSkgKiBiaXRzUGVyRGlnaXQ7Cgl2YXIgcmVzdWx0OwoJZm9yIChyZXN1bHQgPSBtOyByZXN1bHQgPiBtIC0gYml0c1BlckRpZ2l0OyAtLXJlc3VsdCkgewoJCWlmICgoZCAmIDB4ODAwMCkgIT0gMCkgYnJlYWs7CgkJZCA8PD0gMTsKCX0KCXJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uIGJpTXVsdGlwbHkoeCwgeSkKewoJdmFyIHJlc3VsdCA9IG5ldyBCaWdJbnQoKTsKCXZhciBjOwoJdmFyIG4gPSBiaUhpZ2hJbmRleCh4KTsKCXZhciB0ID0gYmlIaWdoSW5kZXgoeSk7Cgl2YXIgdSwgdXYsIGs7CgoJZm9yICh2YXIgaSA9IDA7IGkgPD0gdDsgKytpKSB7CgkJYyA9IDA7CgkJayA9IGk7CgkJZm9yIChqID0gMDsgaiA8PSBuOyArK2osICsraykgewoJCQl1diA9IHJlc3VsdC5kaWdpdHNba10gKyB4LmRpZ2l0c1tqXSAqIHkuZGlnaXRzW2ldICsgYzsKCQkJcmVzdWx0LmRpZ2l0c1trXSA9IHV2ICYgbWF4RGlnaXRWYWw7CgkJCWMgPSB1diA+Pj4gYmlSYWRpeEJpdHM7CgkJfQoJCXJlc3VsdC5kaWdpdHNbaSArIG4gKyAxXSA9IGM7Cgl9CglyZXN1bHQuaXNOZWcgPSB4LmlzTmVnICE9IHkuaXNOZWc7CglyZXR1cm4gcmVzdWx0Owp9CgpmdW5jdGlvbiBiaU11bHRpcGx5RGlnaXQoeCwgeSkKewoJdmFyIG4sIGMsIHV2OwoKCXJlc3VsdCA9IG5ldyBCaWdJbnQoKTsKCW4gPSBiaUhpZ2hJbmRleCh4KTsKCWMgPSAwOwoJZm9yICh2YXIgaiA9IDA7IGogPD0gbjsgKytqKSB7CgkJdXYgPSByZXN1bHQuZGlnaXRzW2pdICsgeC5kaWdpdHNbal0gKiB5ICsgYzsKCQlyZXN1bHQuZGlnaXRzW2pdID0gdXYgJiBtYXhEaWdpdFZhbDsKCQljID0gdXYgPj4+IGJpUmFkaXhCaXRzOwoJCS8vYyA9IE1hdGguZmxvb3IodXYgLyBiaVJhZGl4KTsKCX0KCXJlc3VsdC5kaWdpdHNbMSArIG5dID0gYzsKCXJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uIGFycmF5Q29weShzcmMsIHNyY1N0YXJ0LCBkZXN0LCBkZXN0U3RhcnQsIG4pCnsKCXZhciBtID0gTWF0aC5taW4oc3JjU3RhcnQgKyBuLCBzcmMubGVuZ3RoKTsKCWZvciAodmFyIGkgPSBzcmNTdGFydCwgaiA9IGRlc3RTdGFydDsgaSA8IG07ICsraSwgKytqKSB7CgkJZGVzdFtqXSA9IHNyY1tpXTsKCX0KfQoKdmFyIGhpZ2hCaXRNYXNrcyA9IG5ldyBBcnJheSgweDAwMDAsIDB4ODAwMCwgMHhDMDAwLCAweEUwMDAsIDB4RjAwMCwgMHhGODAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIDB4RkMwMCwgMHhGRTAwLCAweEZGMDAsIDB4RkY4MCwgMHhGRkMwLCAweEZGRTAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMHhGRkYwLCAweEZGRjgsIDB4RkZGQywgMHhGRkZFLCAweEZGRkYpOwoKZnVuY3Rpb24gYmlTaGlmdExlZnQoeCwgbikKewoJdmFyIGRpZ2l0Q291bnQgPSBNYXRoLmZsb29yKG4gLyBiaXRzUGVyRGlnaXQpOwoJdmFyIHJlc3VsdCA9IG5ldyBCaWdJbnQoKTsKCWFycmF5Q29weSh4LmRpZ2l0cywgMCwgcmVzdWx0LmRpZ2l0cywgZGlnaXRDb3VudCwKCSAgICAgICAgICByZXN1bHQuZGlnaXRzLmxlbmd0aCAtIGRpZ2l0Q291bnQpOwoJdmFyIGJpdHMgPSBuICUgYml0c1BlckRpZ2l0OwoJdmFyIHJpZ2h0Qml0cyA9IGJpdHNQZXJEaWdpdCAtIGJpdHM7Cglmb3IgKHZhciBpID0gcmVzdWx0LmRpZ2l0cy5sZW5ndGggLSAxLCBpMSA9IGkgLSAxOyBpID4gMDsgLS1pLCAtLWkxKSB7CgkJcmVzdWx0LmRpZ2l0c1tpXSA9ICgocmVzdWx0LmRpZ2l0c1tpXSA8PCBiaXRzKSAmIG1heERpZ2l0VmFsKSB8CgkJICAgICAgICAgICAgICAgICAgICgocmVzdWx0LmRpZ2l0c1tpMV0gJiBoaWdoQml0TWFza3NbYml0c10pID4+PgoJCSAgICAgICAgICAgICAgICAgICAgKHJpZ2h0Qml0cykpOwoJfQoJcmVzdWx0LmRpZ2l0c1swXSA9ICgocmVzdWx0LmRpZ2l0c1tpXSA8PCBiaXRzKSAmIG1heERpZ2l0VmFsKTsKCXJlc3VsdC5pc05lZyA9IHguaXNOZWc7CglyZXR1cm4gcmVzdWx0Owp9Cgp2YXIgbG93Qml0TWFza3MgPSBuZXcgQXJyYXkoMHgwMDAwLCAweDAwMDEsIDB4MDAwMywgMHgwMDA3LCAweDAwMEYsIDB4MDAxRiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDB4MDAzRiwgMHgwMDdGLCAweDAwRkYsIDB4MDFGRiwgMHgwM0ZGLCAweDA3RkYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAweDBGRkYsIDB4MUZGRiwgMHgzRkZGLCAweDdGRkYsIDB4RkZGRik7CgpmdW5jdGlvbiBiaVNoaWZ0UmlnaHQoeCwgbikKewoJdmFyIGRpZ2l0Q291bnQgPSBNYXRoLmZsb29yKG4gLyBiaXRzUGVyRGlnaXQpOwoJdmFyIHJlc3VsdCA9IG5ldyBCaWdJbnQoKTsKCWFycmF5Q29weSh4LmRpZ2l0cywgZGlnaXRDb3VudCwgcmVzdWx0LmRpZ2l0cywgMCwKCSAgICAgICAgICB4LmRpZ2l0cy5sZW5ndGggLSBkaWdpdENvdW50KTsKCXZhciBiaXRzID0gbiAlIGJpdHNQZXJEaWdpdDsKCXZhciBsZWZ0Qml0cyA9IGJpdHNQZXJEaWdpdCAtIGJpdHM7Cglmb3IgKHZhciBpID0gMCwgaTEgPSBpICsgMTsgaSA8IHJlc3VsdC5kaWdpdHMubGVuZ3RoIC0gMTsgKytpLCArK2kxKSB7CgkJcmVzdWx0LmRpZ2l0c1tpXSA9IChyZXN1bHQuZGlnaXRzW2ldID4+PiBiaXRzKSB8CgkJICAgICAgICAgICAgICAgICAgICgocmVzdWx0LmRpZ2l0c1tpMV0gJiBsb3dCaXRNYXNrc1tiaXRzXSkgPDwgbGVmdEJpdHMpOwoJfQoJcmVzdWx0LmRpZ2l0c1tyZXN1bHQuZGlnaXRzLmxlbmd0aCAtIDFdID4+Pj0gYml0czsKCXJlc3VsdC5pc05lZyA9IHguaXNOZWc7CglyZXR1cm4gcmVzdWx0Owp9CgpmdW5jdGlvbiBiaU11bHRpcGx5QnlSYWRpeFBvd2VyKHgsIG4pCnsKCXZhciByZXN1bHQgPSBuZXcgQmlnSW50KCk7CglhcnJheUNvcHkoeC5kaWdpdHMsIDAsIHJlc3VsdC5kaWdpdHMsIG4sIHJlc3VsdC5kaWdpdHMubGVuZ3RoIC0gbik7CglyZXR1cm4gcmVzdWx0Owp9CgpmdW5jdGlvbiBiaURpdmlkZUJ5UmFkaXhQb3dlcih4LCBuKQp7Cgl2YXIgcmVzdWx0ID0gbmV3IEJpZ0ludCgpOwoJYXJyYXlDb3B5KHguZGlnaXRzLCBuLCByZXN1bHQuZGlnaXRzLCAwLCByZXN1bHQuZGlnaXRzLmxlbmd0aCAtIG4pOwoJcmV0dXJuIHJlc3VsdDsKfQoKZnVuY3Rpb24gYmlNb2R1bG9CeVJhZGl4UG93ZXIoeCwgbikKewoJdmFyIHJlc3VsdCA9IG5ldyBCaWdJbnQoKTsKCWFycmF5Q29weSh4LmRpZ2l0cywgMCwgcmVzdWx0LmRpZ2l0cywgMCwgbik7CglyZXR1cm4gcmVzdWx0Owp9CgpmdW5jdGlvbiBiaUNvbXBhcmUoeCwgeSkKewoJaWYgKHguaXNOZWcgIT0geS5pc05lZykgewoJCXJldHVybiAxIC0gMiAqIE51bWJlcih4LmlzTmVnKTsKCX0KCWZvciAodmFyIGkgPSB4LmRpZ2l0cy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkgewoJCWlmICh4LmRpZ2l0c1tpXSAhPSB5LmRpZ2l0c1tpXSkgewoJCQlpZiAoeC5pc05lZykgewoJCQkJcmV0dXJuIDEgLSAyICogTnVtYmVyKHguZGlnaXRzW2ldID4geS5kaWdpdHNbaV0pOwoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIDEgLSAyICogTnVtYmVyKHguZGlnaXRzW2ldIDwgeS5kaWdpdHNbaV0pOwoJCQl9CgkJfQoJfQoJcmV0dXJuIDA7Cn0KCmZ1bmN0aW9uIGJpRGl2aWRlTW9kdWxvKHgsIHkpCnsKCXZhciBuYiA9IGJpTnVtQml0cyh4KTsKCXZhciB0YiA9IGJpTnVtQml0cyh5KTsKCXZhciBvcmlnWUlzTmVnID0geS5pc05lZzsKCXZhciBxLCByOwoJaWYgKG5iIDwgdGIpIHsKCQkvLyB8eHwgPCB8eXwKCQlpZiAoeC5pc05lZykgewoJCQlxID0gYmlDb3B5KGJpZ09uZSk7CgkJCXEuaXNOZWcgPSAheS5pc05lZzsKCQkJeC5pc05lZyA9IGZhbHNlOwoJCQl5LmlzTmVnID0gZmFsc2U7CgkJCXIgPSBiaVN1YnRyYWN0KHksIHgpOwoJCQkvLyBSZXN0b3JlIHNpZ25zLCAnY2F1c2UgdGhleSdyZSByZWZlcmVuY2VzLgoJCQl4LmlzTmVnID0gdHJ1ZTsKCQkJeS5pc05lZyA9IG9yaWdZSXNOZWc7CgkJfSBlbHNlIHsKCQkJcSA9IG5ldyBCaWdJbnQoKTsKCQkJciA9IGJpQ29weSh4KTsKCQl9CgkJcmV0dXJuIG5ldyBBcnJheShxLCByKTsKCX0KCglxID0gbmV3IEJpZ0ludCgpOwoJciA9IHg7CgoJdmFyIHQgPSBNYXRoLmNlaWwodGIgLyBiaXRzUGVyRGlnaXQpIC0gMTsKCXZhciBsYW1iZGEgPSAwOwoJd2hpbGUgKHkuZGlnaXRzW3RdIDwgYmlIYWxmUmFkaXgpIHsKCQl5ID0gYmlTaGlmdExlZnQoeSwgMSk7CgkJKytsYW1iZGE7CgkJKyt0YjsKCQl0ID0gTWF0aC5jZWlsKHRiIC8gYml0c1BlckRpZ2l0KSAtIDE7Cgl9CglyID0gYmlTaGlmdExlZnQociwgbGFtYmRhKTsKCW5iICs9IGxhbWJkYTsgLy8gVXBkYXRlIHRoZSBiaXQgY291bnQgZm9yIHguCgl2YXIgbiA9IE1hdGguY2VpbChuYiAvIGJpdHNQZXJEaWdpdCkgLSAxOwoKCXZhciBiID0gYmlNdWx0aXBseUJ5UmFkaXhQb3dlcih5LCBuIC0gdCk7Cgl3aGlsZSAoYmlDb21wYXJlKHIsIGIpICE9IC0xKSB7CgkJKytxLmRpZ2l0c1tuIC0gdF07CgkJciA9IGJpU3VidHJhY3QociwgYik7Cgl9Cglmb3IgKHZhciBpID0gbjsgaSA+IHQ7IC0taSkgewogICAgdmFyIHJpID0gKGkgPj0gci5kaWdpdHMubGVuZ3RoKSA/IDAgOiByLmRpZ2l0c1tpXTsKICAgIHZhciByaTEgPSAoaSAtIDEgPj0gci5kaWdpdHMubGVuZ3RoKSA/IDAgOiByLmRpZ2l0c1tpIC0gMV07CiAgICB2YXIgcmkyID0gKGkgLSAyID49IHIuZGlnaXRzLmxlbmd0aCkgPyAwIDogci5kaWdpdHNbaSAtIDJdOwogICAgdmFyIHl0ID0gKHQgPj0geS5kaWdpdHMubGVuZ3RoKSA/IDAgOiB5LmRpZ2l0c1t0XTsKICAgIHZhciB5dDEgPSAodCAtIDEgPj0geS5kaWdpdHMubGVuZ3RoKSA/IDAgOiB5LmRpZ2l0c1t0IC0gMV07CgkJaWYgKHJpID09IHl0KSB7CgkJCXEuZGlnaXRzW2kgLSB0IC0gMV0gPSBtYXhEaWdpdFZhbDsKCQl9IGVsc2UgewoJCQlxLmRpZ2l0c1tpIC0gdCAtIDFdID0gTWF0aC5mbG9vcigocmkgKiBiaVJhZGl4ICsgcmkxKSAvIHl0KTsKCQl9CgoJCXZhciBjMSA9IHEuZGlnaXRzW2kgLSB0IC0gMV0gKiAoKHl0ICogYmlSYWRpeCkgKyB5dDEpOwoJCXZhciBjMiA9IChyaSAqIGJpUmFkaXhTcXVhcmVkKSArICgocmkxICogYmlSYWRpeCkgKyByaTIpOwoJCXdoaWxlIChjMSA+IGMyKSB7CgkJCS0tcS5kaWdpdHNbaSAtIHQgLSAxXTsKCQkJYzEgPSBxLmRpZ2l0c1tpIC0gdCAtIDFdICogKCh5dCAqIGJpUmFkaXgpIHwgeXQxKTsKCQkJYzIgPSAocmkgKiBiaVJhZGl4ICogYmlSYWRpeCkgKyAoKHJpMSAqIGJpUmFkaXgpICsgcmkyKTsKCQl9CgoJCWIgPSBiaU11bHRpcGx5QnlSYWRpeFBvd2VyKHksIGkgLSB0IC0gMSk7CgkJciA9IGJpU3VidHJhY3QociwgYmlNdWx0aXBseURpZ2l0KGIsIHEuZGlnaXRzW2kgLSB0IC0gMV0pKTsKCQlpZiAoci5pc05lZykgewoJCQlyID0gYmlBZGQociwgYik7CgkJCS0tcS5kaWdpdHNbaSAtIHQgLSAxXTsKCQl9Cgl9CglyID0gYmlTaGlmdFJpZ2h0KHIsIGxhbWJkYSk7CgkvLyBGaWRkbGUgd2l0aCB0aGUgc2lnbnMgYW5kIHN0dWZmIHRvIG1ha2Ugc3VyZSB0aGF0IDAgPD0gciA8IHkuCglxLmlzTmVnID0geC5pc05lZyAhPSBvcmlnWUlzTmVnOwoJaWYgKHguaXNOZWcpIHsKCQlpZiAob3JpZ1lJc05lZykgewoJCQlxID0gYmlBZGQocSwgYmlnT25lKTsKCQl9IGVsc2UgewoJCQlxID0gYmlTdWJ0cmFjdChxLCBiaWdPbmUpOwoJCX0KCQl5ID0gYmlTaGlmdFJpZ2h0KHksIGxhbWJkYSk7CgkJciA9IGJpU3VidHJhY3QoeSwgcik7Cgl9CgkvLyBDaGVjayBmb3IgdGhlIHVuYmVsaWV2YWJseSBzdHVwaWQgZGVnZW5lcmF0ZSBjYXNlIG9mIHIgPT0gLTAuCglpZiAoci5kaWdpdHNbMF0gPT0gMCAmJiBiaUhpZ2hJbmRleChyKSA9PSAwKSByLmlzTmVnID0gZmFsc2U7CgoJcmV0dXJuIG5ldyBBcnJheShxLCByKTsKfQoKZnVuY3Rpb24gYmlEaXZpZGUoeCwgeSkKewoJcmV0dXJuIGJpRGl2aWRlTW9kdWxvKHgsIHkpWzBdOwp9CgpmdW5jdGlvbiBiaU1vZHVsbyh4LCB5KQp7CglyZXR1cm4gYmlEaXZpZGVNb2R1bG8oeCwgeSlbMV07Cn0KCmZ1bmN0aW9uIGJpTXVsdGlwbHlNb2QoeCwgeSwgbSkKewoJcmV0dXJuIGJpTW9kdWxvKGJpTXVsdGlwbHkoeCwgeSksIG0pOwp9CgpmdW5jdGlvbiBiaVBvdyh4LCB5KQp7Cgl2YXIgcmVzdWx0ID0gYmlnT25lOwoJdmFyIGEgPSB4OwoJd2hpbGUgKHRydWUpIHsKCQlpZiAoKHkgJiAxKSAhPSAwKSByZXN1bHQgPSBiaU11bHRpcGx5KHJlc3VsdCwgYSk7CgkJeSA+Pj0gMTsKCQlpZiAoeSA9PSAwKSBicmVhazsKCQlhID0gYmlNdWx0aXBseShhLCBhKTsKCX0KCXJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uIGJpUG93TW9kKHgsIHksIG0pCnsKCXZhciByZXN1bHQgPSBiaWdPbmU7Cgl2YXIgYSA9IHg7Cgl2YXIgayA9IHk7Cgl3aGlsZSAodHJ1ZSkgewoJCWlmICgoay5kaWdpdHNbMF0gJiAxKSAhPSAwKSByZXN1bHQgPSBiaU11bHRpcGx5TW9kKHJlc3VsdCwgYSwgbSk7CgkJayA9IGJpU2hpZnRSaWdodChrLCAxKTsKCQlpZiAoay5kaWdpdHNbMF0gPT0gMCAmJiBiaUhpZ2hJbmRleChrKSA9PSAwKSBicmVhazsKCQlhID0gYmlNdWx0aXBseU1vZChhLCBhLCBtKTsKCX0KCXJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uIEJhcnJldHRNdShtKQp7Cgl0aGlzLm1vZHVsdXMgPSBiaUNvcHkobSk7Cgl0aGlzLmsgPSBiaUhpZ2hJbmRleCh0aGlzLm1vZHVsdXMpICsgMTsKCXZhciBiMmsgPSBuZXcgQmlnSW50KCk7CgliMmsuZGlnaXRzWzIgKiB0aGlzLmtdID0gMTsgLy8gYjJrID0gYl4oMmspCgl0aGlzLm11ID0gYmlEaXZpZGUoYjJrLCB0aGlzLm1vZHVsdXMpOwoJdGhpcy5ia3BsdXMxID0gbmV3IEJpZ0ludCgpOwoJdGhpcy5ia3BsdXMxLmRpZ2l0c1t0aGlzLmsgKyAxXSA9IDE7IC8vIGJrcGx1czEgPSBiXihrKzEpCgl0aGlzLm1vZHVsbyA9IEJhcnJldHRNdV9tb2R1bG87Cgl0aGlzLm11bHRpcGx5TW9kID0gQmFycmV0dE11X211bHRpcGx5TW9kOwoJdGhpcy5wb3dNb2QgPSBCYXJyZXR0TXVfcG93TW9kOwp9CgpmdW5jdGlvbiBCYXJyZXR0TXVfbW9kdWxvKHgpCnsKCXZhciBxMSA9IGJpRGl2aWRlQnlSYWRpeFBvd2VyKHgsIHRoaXMuayAtIDEpOwoJdmFyIHEyID0gYmlNdWx0aXBseShxMSwgdGhpcy5tdSk7Cgl2YXIgcTMgPSBiaURpdmlkZUJ5UmFkaXhQb3dlcihxMiwgdGhpcy5rICsgMSk7Cgl2YXIgcjEgPSBiaU1vZHVsb0J5UmFkaXhQb3dlcih4LCB0aGlzLmsgKyAxKTsKCXZhciByMnRlcm0gPSBiaU11bHRpcGx5KHEzLCB0aGlzLm1vZHVsdXMpOwoJdmFyIHIyID0gYmlNb2R1bG9CeVJhZGl4UG93ZXIocjJ0ZXJtLCB0aGlzLmsgKyAxKTsKCXZhciByID0gYmlTdWJ0cmFjdChyMSwgcjIpOwoJaWYgKHIuaXNOZWcpIHsKCQlyID0gYmlBZGQociwgdGhpcy5ia3BsdXMxKTsKCX0KCXZhciByZ3RlbSA9IGJpQ29tcGFyZShyLCB0aGlzLm1vZHVsdXMpID49IDA7Cgl3aGlsZSAocmd0ZW0pIHsKCQlyID0gYmlTdWJ0cmFjdChyLCB0aGlzLm1vZHVsdXMpOwoJCXJndGVtID0gYmlDb21wYXJlKHIsIHRoaXMubW9kdWx1cykgPj0gMDsKCX0KCXJldHVybiByOwp9CgpmdW5jdGlvbiBCYXJyZXR0TXVfbXVsdGlwbHlNb2QoeCwgeSkKewoJdmFyIHh5ID0gYmlNdWx0aXBseSh4LCB5KTsKCXJldHVybiB0aGlzLm1vZHVsbyh4eSk7Cn0KCmZ1bmN0aW9uIEJhcnJldHRNdV9wb3dNb2QoeCwgeSkKewoJdmFyIHJlc3VsdCA9IG5ldyBCaWdJbnQoKTsKCXJlc3VsdC5kaWdpdHNbMF0gPSAxOwoJdmFyIGEgPSB4OwoJdmFyIGsgPSB5OwoJd2hpbGUgKHRydWUpIHsKCQlpZiAoKGsuZGlnaXRzWzBdICYgMSkgIT0gMCkgcmVzdWx0ID0gdGhpcy5tdWx0aXBseU1vZChyZXN1bHQsIGEpOwoJCWsgPSBiaVNoaWZ0UmlnaHQoaywgMSk7CgkJaWYgKGsuZGlnaXRzWzBdID09IDAgJiYgYmlIaWdoSW5kZXgoaykgPT0gMCkgYnJlYWs7CgkJYSA9IHRoaXMubXVsdGlwbHlNb2QoYSwgYSk7Cgl9CglyZXR1cm4gcmVzdWx0Owp9CgpmdW5jdGlvbiBSU0FLZXlQYWlyKGVuY3J5cHRpb25FeHBvbmVudCwgZGVjcnlwdGlvbkV4cG9uZW50LCBtb2R1bHVzKQp7Cgl0aGlzLmUgPSBiaUZyb21IZXgoZW5jcnlwdGlvbkV4cG9uZW50KTsKCXRoaXMuZCA9IGJpRnJvbUhleChkZWNyeXB0aW9uRXhwb25lbnQpOwoJdGhpcy5tID0gYmlGcm9tSGV4KG1vZHVsdXMpOwoJdGhpcy5jaHVua1NpemUgPSAyICogYmlIaWdoSW5kZXgodGhpcy5tKTsKCXRoaXMucmFkaXggPSAxNjsKCXRoaXMuYmFycmV0dCA9IG5ldyBCYXJyZXR0TXUodGhpcy5tKTsKfQoKZnVuY3Rpb24gdHdvRGlnaXQobikKewoJcmV0dXJuIChuIDwgMTAgPyAiMCIgOiAiIikgKyBTdHJpbmcobik7Cn0KCmZ1bmN0aW9uIGJvZHlSU0EoKSAgIAp7ICAgCgkgICAgc2V0TWF4RGlnaXRzKDEzMCk7ICAgCgkgICAgcmV0dXJuIG5ldyBSU0FLZXlQYWlyKCIxMDAwMSIsIiIsImE1YWViOGM2MzZlZjFmZGE1YTdhMTdhMjgxOWU1MWUxZWE2ZTBjY2ViMjRiOTU1NzRhZTAyNjUzNjI0MzUyNGYzMjI4MDdkZjI1MzFhNDIxMzkzODk2NzQ1NDVmNGM1OTZkYjE2MmY2ZTZiYmIyNjQ5OGJhYWIwNzRjMDM2Nzc3Iik7Cn0KCmZ1bmN0aW9uIGVuY3J5cHRlZFN0cmluZyhtb2R1bHVzLHMpCnsKICAgIHZhciBrZXkgPSAgbmV3IFJTQUtleVBhaXIoIjAxMDAwMSIsIiIsbW9kdWx1cyk7IAoKCXZhciBhID0gbmV3IEFycmF5KCk7Cgl2YXIgc2wgPSBzLmxlbmd0aDsKCXZhciBpID0gMDsKCXdoaWxlIChpIDwgc2wpIHsKCQlhW2ldID0gcy5jaGFyQ29kZUF0KGkpOwoJCWkrKzsKCX0KCgl3aGlsZSAoYS5sZW5ndGggJSBrZXkuY2h1bmtTaXplICE9IDApIHsKCQlhW2krK10gPSAwOwoJfQoKCXZhciBhbCA9IGEubGVuZ3RoOwoJdmFyIHJlc3VsdCA9ICIiOwoJdmFyIGosIGssIGJsb2NrOwoJZm9yIChpID0gMDsgaSA8IGFsOyBpICs9IGtleS5jaHVua1NpemUpIHsKCQlibG9jayA9IG5ldyBCaWdJbnQoKTsKCQlqID0gMDsKCQlmb3IgKGsgPSBpOyBrIDwgaSArIGtleS5jaHVua1NpemU7ICsraikgewoJCQlibG9jay5kaWdpdHNbal0gPSBhW2srK107CgkJCWJsb2NrLmRpZ2l0c1tqXSArPSBhW2srK10gPDwgODsKCQl9CgkJdmFyIGNyeXB0ID0ga2V5LmJhcnJldHQucG93TW9kKGJsb2NrLCBrZXkuZSk7CgkJdmFyIHRleHQgPSBrZXkucmFkaXggPT0gMTYgPyBiaVRvSGV4KGNyeXB0KSA6IGJpVG9TdHJpbmcoY3J5cHQsIGtleS5yYWRpeCk7CgkJcmVzdWx0ICs9IHRleHQgKyAiICI7Cgl9CglyZXR1cm4gcmVzdWx0LnN1YnN0cmluZygwLCByZXN1bHQubGVuZ3RoIC0gMSk7IC8vIFJlbW92ZSBsYXN0IHNwYWNlLgp9CgpmdW5jdGlvbiBkZWNyeXB0ZWRTdHJpbmcocykKewoJZnVuY3Rpb24gYm9keVJTQSgpICAgCgl7ICAgCgkgICAgc2V0TWF4RGlnaXRzKDEzMCk7ICAgCgkgICAgcmV0dXJuIG5ldyBSU0FLZXlQYWlyKCIxMDAwMSIsIiIsImE1YWViOGM2MzZlZjFmZGE1YTdhMTdhMjgxOWU1MWUxZWE2ZTBjY2ViMjRiOTU1NzRhZTAyNjUzNjI0MzUyNGYzMjI4MDdkZjI1MzFhNDIxMzkzODk2NzQ1NDVmNGM1OTZkYjE2MmY2ZTZiYmIyNjQ5OGJhYWIwNzRjMDM2Nzc3Iik7ICAgIAoJfQoJdmFyIGtleSA9ICBib2R5UlNBKCk7IAoJdmFyIGJsb2NrcyA9IHMuc3BsaXQoIiAiKTsKCXZhciByZXN1bHQgPSAiIjsKCXZhciBpLCBqLCBibG9jazsKCWZvciAoaSA9IDA7IGkgPCBibG9ja3MubGVuZ3RoOyArK2kpIHsKCQl2YXIgYmk7CgkJaWYgKGtleS5yYWRpeCA9PSAxNikgewoJCQliaSA9IGJpRnJvbUhleChibG9ja3NbaV0pOwoJCX0KCQllbHNlIHsKCQkJYmkgPSBiaUZyb21TdHJpbmcoYmxvY2tzW2ldLCBrZXkucmFkaXgpOwoJCX0KCQlibG9jayA9IGtleS5iYXJyZXR0LnBvd01vZChiaSwga2V5LmQpOwoJCWZvciAoaiA9IDA7IGogPD0gYmlIaWdoSW5kZXgoYmxvY2spOyArK2opIHsKCQkJcmVzdWx0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYmxvY2suZGlnaXRzW2pdICYgMjU1LAoJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9jay5kaWdpdHNbal0gPj4gOCk7CgkJfQoJfQoJLy8gUmVtb3ZlIHRyYWlsaW5nIG51bGwsIGlmIGFueS4KCWlmIChyZXN1bHQuY2hhckNvZGVBdChyZXN1bHQubGVuZ3RoIC0gMSkgPT0gMCkgewoJCXJlc3VsdCA9IHJlc3VsdC5zdWJzdHJpbmcoMCwgcmVzdWx0Lmxlbmd0aCAtIDEpOwoJfQoJcmV0dXJuIHJlc3VsdDsKfQo=";
    private static final String javaScript_web
                                               = "dmFyIENyeXB0b0pTID0gQ3J5cHRvSlMgfHwKZnVuY3Rpb24obiwgdCkgewogICAgdmFyIHUgPSB7fSwKICAgIGYgPSB1LmxpYiA9IHt9LAogICAgbyA9IGZ1bmN0aW9uKCkge30sCiAgICBpID0gZi5CYXNlID0gewogICAgICAgIGV4dGVuZDogZnVuY3Rpb24obikgewogICAgICAgICAgICBvLnByb3RvdHlwZSA9IHRoaXM7CiAgICAgICAgICAgIHZhciB0ID0gbmV3IG87CiAgICAgICAgICAgIHJldHVybiBuICYmIHQubWl4SW4obiksCiAgICAgICAgICAgIHQuaGFzT3duUHJvcGVydHkoImluaXQiKSB8fCAodC5pbml0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB0LiRzdXBlci5pbml0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIHQuaW5pdC5wcm90b3R5cGUgPSB0LAogICAgICAgICAgICB0LiRzdXBlciA9IHRoaXMsCiAgICAgICAgICAgIHQKICAgICAgICB9LAogICAgICAgIGNyZWF0ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBuID0gdGhpcy5leHRlbmQoKTsKICAgICAgICAgICAgcmV0dXJuIG4uaW5pdC5hcHBseShuLCBhcmd1bWVudHMpLAogICAgICAgICAgICBuCiAgICAgICAgfSwKICAgICAgICBpbml0OiBmdW5jdGlvbigpIHt9LAogICAgICAgIG1peEluOiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIGZvciAodmFyIHQgaW4gbikgbi5oYXNPd25Qcm9wZXJ0eSh0KSAmJiAodGhpc1t0XSA9IG5bdF0pOwogICAgICAgICAgICBuLmhhc093blByb3BlcnR5KCJ0b1N0cmluZyIpICYmICh0aGlzLnRvU3RyaW5nID0gbi50b1N0cmluZykKICAgICAgICB9LAogICAgICAgIGNsb25lOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5pdC5wcm90b3R5cGUuZXh0ZW5kKHRoaXMpCiAgICAgICAgfQogICAgfSwKICAgIHIgPSBmLldvcmRBcnJheSA9IGkuZXh0ZW5kKHsKICAgICAgICBpbml0OiBmdW5jdGlvbihuLCBpKSB7CiAgICAgICAgICAgIG4gPSB0aGlzLndvcmRzID0gbiB8fCBbXTsKICAgICAgICAgICAgdGhpcy5zaWdCeXRlcyA9IGkgIT0gdCA/IGk6IDQgKiBuLmxlbmd0aAogICAgICAgIH0sCiAgICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uKG4pIHsKICAgICAgICAgICAgcmV0dXJuIChuIHx8IGwpLnN0cmluZ2lmeSh0aGlzKQogICAgICAgIH0sCiAgICAgICAgY29uY2F0OiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIHZhciBpID0gdGhpcy53b3JkcywKICAgICAgICAgICAgciA9IG4ud29yZHMsCiAgICAgICAgICAgIHUgPSB0aGlzLnNpZ0J5dGVzLAogICAgICAgICAgICB0OwogICAgICAgICAgICBpZiAobiA9IG4uc2lnQnl0ZXMsIHRoaXMuY2xhbXAoKSwgdSAlIDQpIGZvciAodCA9IDA7IHQgPCBuOyB0KyspIGlbdSArIHQgPj4+IDJdIHw9IChyW3QgPj4+IDJdID4+PiAyNCAtIDggKiAodCAlIDQpICYgMjU1KSA8PCAyNCAtIDggKiAoKHUgKyB0KSAlIDQpOwogICAgICAgICAgICBlbHNlIGlmICg2NTUzNSA8IHIubGVuZ3RoKSBmb3IgKHQgPSAwOyB0IDwgbjsgdCArPSA0KSBpW3UgKyB0ID4+PiAyXSA9IHJbdCA+Pj4gMl07CiAgICAgICAgICAgIGVsc2UgaS5wdXNoLmFwcGx5KGksIHIpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5zaWdCeXRlcyArPSBuLAogICAgICAgICAgICB0aGlzCiAgICAgICAgfSwKICAgICAgICBjbGFtcDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBpID0gdGhpcy53b3JkcywKICAgICAgICAgICAgdCA9IHRoaXMuc2lnQnl0ZXM7CiAgICAgICAgICAgIGlbdCA+Pj4gMl0gJj0gNDI5NDk2NzI5NSA8PCAzMiAtIDggKiAodCAlIDQpOwogICAgICAgICAgICBpLmxlbmd0aCA9IG4uY2VpbCh0IC8gNCkKICAgICAgICB9LAogICAgICAgIGNsb25lOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIG4gPSBpLmNsb25lLmNhbGwodGhpcyk7CiAgICAgICAgICAgIHJldHVybiBuLndvcmRzID0gdGhpcy53b3Jkcy5zbGljZSgwKSwKICAgICAgICAgICAgbgogICAgICAgIH0sCiAgICAgICAgcmFuZG9tOiBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSBbXSwgdSA9IDA7IHUgPCB0OyB1ICs9IDQpIGkucHVzaCg0Mjk0OTY3Mjk2ICogbi5yYW5kb20oKSB8IDApOwogICAgICAgICAgICByZXR1cm4gbmV3IHIuaW5pdChpLCB0KQogICAgICAgIH0KICAgIH0pLAogICAgZSA9IHUuZW5jID0ge30sCiAgICBsID0gZS5IZXggPSB7CiAgICAgICAgc3RyaW5naWZ5OiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIHZhciB1ID0gbi53b3JkcywKICAgICAgICAgICAgaSwgdCwgcjsKICAgICAgICAgICAgZm9yIChuID0gbi5zaWdCeXRlcywgaSA9IFtdLCB0ID0gMDsgdCA8IG47IHQrKykgciA9IHVbdCA+Pj4gMl0gPj4+IDI0IC0gOCAqICh0ICUgNCkgJiAyNTUsCiAgICAgICAgICAgIGkucHVzaCgociA+Pj4gNCkudG9TdHJpbmcoMTYpKSwKICAgICAgICAgICAgaS5wdXNoKChyICYgMTUpLnRvU3RyaW5nKDE2KSk7CiAgICAgICAgICAgIHJldHVybiBpLmpvaW4oIiIpCiAgICAgICAgfSwKICAgICAgICBwYXJzZTogZnVuY3Rpb24obikgewogICAgICAgICAgICBmb3IgKHZhciBpID0gbi5sZW5ndGgsCiAgICAgICAgICAgIHUgPSBbXSwgdCA9IDA7IHQgPCBpOyB0ICs9IDIpIHVbdCA+Pj4gM10gfD0gcGFyc2VJbnQobi5zdWJzdHIodCwgMiksIDE2KSA8PCAyNCAtIDQgKiAodCAlIDgpOwogICAgICAgICAgICByZXR1cm4gbmV3IHIuaW5pdCh1LCBpIC8gMikKICAgICAgICB9CiAgICB9LAogICAgcyA9IGUuTGF0aW4xID0gewogICAgICAgIHN0cmluZ2lmeTogZnVuY3Rpb24obikgewogICAgICAgICAgICB2YXIgciA9IG4ud29yZHMsCiAgICAgICAgICAgIGksIHQ7CiAgICAgICAgICAgIGZvciAobiA9IG4uc2lnQnl0ZXMsIGkgPSBbXSwgdCA9IDA7IHQgPCBuOyB0KyspIGkucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKHJbdCA+Pj4gMl0gPj4+IDI0IC0gOCAqICh0ICUgNCkgJiAyNTUpKTsKICAgICAgICAgICAgcmV0dXJuIGkuam9pbigiIikKICAgICAgICB9LAogICAgICAgIHBhcnNlOiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSBuLmxlbmd0aCwKICAgICAgICAgICAgdSA9IFtdLCB0ID0gMDsgdCA8IGk7IHQrKykgdVt0ID4+PiAyXSB8PSAobi5jaGFyQ29kZUF0KHQpICYgMjU1KSA8PCAyNCAtIDggKiAodCAlIDQpOwogICAgICAgICAgICByZXR1cm4gbmV3IHIuaW5pdCh1LCBpKQogICAgICAgIH0KICAgIH0sCiAgICBhID0gZS5VdGY4ID0gewogICAgICAgIHN0cmluZ2lmeTogZnVuY3Rpb24obikgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChlc2NhcGUocy5zdHJpbmdpZnkobikpKQogICAgICAgICAgICB9IGNhdGNoKHQpIHsKICAgICAgICAgICAgICAgIHRocm93IEVycm9yKCJNYWxmb3JtZWQgVVRGLTggZGF0YSIpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBwYXJzZTogZnVuY3Rpb24obikgewogICAgICAgICAgICByZXR1cm4gcy5wYXJzZSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQobikpKQogICAgICAgIH0KICAgIH0sCiAgICBoID0gZi5CdWZmZXJlZEJsb2NrQWxnb3JpdGhtID0gaS5leHRlbmQoewogICAgICAgIHJlc2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdGhpcy5fZGF0YSA9IG5ldyByLmluaXQ7CiAgICAgICAgICAgIHRoaXMuX25EYXRhQnl0ZXMgPSAwCiAgICAgICAgfSwKICAgICAgICBfYXBwZW5kOiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgICJzdHJpbmciID09IHR5cGVvZiBuICYmIChuID0gYS5wYXJzZShuKSk7CiAgICAgICAgICAgIHRoaXMuX2RhdGEuY29uY2F0KG4pOwogICAgICAgICAgICB0aGlzLl9uRGF0YUJ5dGVzICs9IG4uc2lnQnl0ZXMKICAgICAgICB9LAogICAgICAgIF9wcm9jZXNzOiBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgIHZhciBmID0gdGhpcy5fZGF0YSwKICAgICAgICAgICAgcyA9IGYud29yZHMsCiAgICAgICAgICAgIHUgPSBmLnNpZ0J5dGVzLAogICAgICAgICAgICBlID0gdGhpcy5ibG9ja1NpemUsCiAgICAgICAgICAgIG8gPSB1IC8gKDQgKiBlKSwKICAgICAgICAgICAgbyA9IHQgPyBuLmNlaWwobykgOiBuLm1heCgobyB8IDApIC0gdGhpcy5fbWluQnVmZmVyU2l6ZSwgMCksCiAgICAgICAgICAgIGk7CiAgICAgICAgICAgIGlmICh0ID0gbyAqIGUsIHUgPSBuLm1pbig0ICogdCwgdSksIHQpIHsKICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB0OyBpICs9IGUpIHRoaXMuX2RvUHJvY2Vzc0Jsb2NrKHMsIGkpOwogICAgICAgICAgICAgICAgaSA9IHMuc3BsaWNlKDAsIHQpOwogICAgICAgICAgICAgICAgZi5zaWdCeXRlcyAtPSB1CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG5ldyByLmluaXQoaSwgdSkKICAgICAgICB9LAogICAgICAgIGNsb25lOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIG4gPSBpLmNsb25lLmNhbGwodGhpcyk7CiAgICAgICAgICAgIHJldHVybiBuLl9kYXRhID0gdGhpcy5fZGF0YS5jbG9uZSgpLAogICAgICAgICAgICBuCiAgICAgICAgfSwKICAgICAgICBfbWluQnVmZmVyU2l6ZTogMAogICAgfSksCiAgICBjOwogICAgcmV0dXJuIGYuSGFzaGVyID0gaC5leHRlbmQoewogICAgICAgIGNmZzogaS5leHRlbmQoKSwKICAgICAgICBpbml0OiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIHRoaXMuY2ZnID0gdGhpcy5jZmcuZXh0ZW5kKG4pOwogICAgICAgICAgICB0aGlzLnJlc2V0KCkKICAgICAgICB9LAogICAgICAgIHJlc2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaC5yZXNldC5jYWxsKHRoaXMpOwogICAgICAgICAgICB0aGlzLl9kb1Jlc2V0KCkKICAgICAgICB9LAogICAgICAgIHVwZGF0ZTogZnVuY3Rpb24obikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYXBwZW5kKG4pLAogICAgICAgICAgICB0aGlzLl9wcm9jZXNzKCksCiAgICAgICAgICAgIHRoaXMKICAgICAgICB9LAogICAgICAgIGZpbmFsaXplOiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIHJldHVybiBuICYmIHRoaXMuX2FwcGVuZChuKSwKICAgICAgICAgICAgdGhpcy5fZG9GaW5hbGl6ZSgpCiAgICAgICAgfSwKICAgICAgICBibG9ja1NpemU6IDE2LAogICAgICAgIF9jcmVhdGVIZWxwZXI6IGZ1bmN0aW9uKG4pIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQsIGkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgbi5pbml0KGkpLmZpbmFsaXplKHQpCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIF9jcmVhdGVIbWFjSGVscGVyOiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbih0LCBpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGMuSE1BQy5pbml0KG4sIGkpLmZpbmFsaXplKHQpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KSwKICAgIGMgPSB1LmFsZ28gPSB7fSwKICAgIHUKfSAoTWF0aCk7IChmdW5jdGlvbigpIHsKICAgIHZhciBuID0gQ3J5cHRvSlMsCiAgICB0ID0gbi5saWIuV29yZEFycmF5OwogICAgbi5lbmMuQmFzZTY0ID0gewogICAgICAgIHN0cmluZ2lmeTogZnVuY3Rpb24obikgewogICAgICAgICAgICB2YXIgaSA9IG4ud29yZHMsCiAgICAgICAgICAgIHUgPSBuLnNpZ0J5dGVzLAogICAgICAgICAgICBmID0gdGhpcy5fbWFwLAogICAgICAgICAgICB0LCBlLCByOwogICAgICAgICAgICBmb3IgKG4uY2xhbXAoKSwgbiA9IFtdLCB0ID0gMDsgdCA8IHU7IHQgKz0gMykgZm9yIChlID0gKGlbdCA+Pj4gMl0gPj4+IDI0IC0gOCAqICh0ICUgNCkgJiAyNTUpIDw8IDE2IHwgKGlbdCArIDEgPj4+IDJdID4+PiAyNCAtIDggKiAoKHQgKyAxKSAlIDQpICYgMjU1KSA8PCA4IHwgaVt0ICsgMiA+Pj4gMl0gPj4+IDI0IC0gOCAqICgodCArIDIpICUgNCkgJiAyNTUsIHIgPSAwOyA0ID4gciAmJiB0ICsgLjc1ICogciA8IHU7IHIrKykgbi5wdXNoKGYuY2hhckF0KGUgPj4+IDYgKiAoMyAtIHIpICYgNjMpKTsKICAgICAgICAgICAgaWYgKGkgPSBmLmNoYXJBdCg2NCkpIGZvciAoOyBuLmxlbmd0aCAlIDQ7KSBuLnB1c2goaSk7CiAgICAgICAgICAgIHJldHVybiBuLmpvaW4oIiIpCiAgICAgICAgfSwKICAgICAgICBwYXJzZTogZnVuY3Rpb24obikgewogICAgICAgICAgICB2YXIgZSA9IG4ubGVuZ3RoLAogICAgICAgICAgICBmID0gdGhpcy5fbWFwLAogICAgICAgICAgICBpID0gZi5jaGFyQXQoNjQpLAogICAgICAgICAgICBvLAogICAgICAgICAgICBzOwogICAgICAgICAgICBpICYmIChpID0gbi5pbmRleE9mKGkpLCAtMSAhPSBpICYmIChlID0gaSkpOwogICAgICAgICAgICBmb3IgKHZhciBpID0gW10sIHUgPSAwLCByID0gMDsgciA8IGU7IHIrKykgciAlIDQgJiYgKG8gPSBmLmluZGV4T2Yobi5jaGFyQXQociAtIDEpKSA8PCAyICogKHIgJSA0KSwgcyA9IGYuaW5kZXhPZihuLmNoYXJBdChyKSkgPj4+IDYgLSAyICogKHIgJSA0KSwgaVt1ID4+PiAyXSB8PSAobyB8IHMpIDw8IDI0IC0gOCAqICh1ICUgNCksIHUrKyk7CiAgICAgICAgICAgIHJldHVybiB0LmNyZWF0ZShpLCB1KQogICAgICAgIH0sCiAgICAgICAgX21hcDogIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky89IgogICAgfQp9KSgpLApmdW5jdGlvbihuKSB7CiAgICBmdW5jdGlvbiBpKG4sIHQsIGksIHIsIHUsIGYsIGUpIHsKICAgICAgICByZXR1cm4gbiA9IG4gKyAodCAmIGkgfCB+dCAmIHIpICsgdSArIGUsCiAgICAgICAgKG4gPDwgZiB8IG4gPj4+IDMyIC0gZikgKyB0CiAgICB9CiAgICBmdW5jdGlvbiByKG4sIHQsIGksIHIsIHUsIGYsIGUpIHsKICAgICAgICByZXR1cm4gbiA9IG4gKyAodCAmIHIgfCBpICYgfnIpICsgdSArIGUsCiAgICAgICAgKG4gPDwgZiB8IG4gPj4+IDMyIC0gZikgKyB0CiAgICB9CiAgICBmdW5jdGlvbiB1KG4sIHQsIGksIHIsIHUsIGYsIGUpIHsKICAgICAgICByZXR1cm4gbiA9IG4gKyAodCBeIGkgXiByKSArIHUgKyBlLAogICAgICAgIChuIDw8IGYgfCBuID4+PiAzMiAtIGYpICsgdAogICAgfQogICAgZnVuY3Rpb24gZihuLCB0LCBpLCByLCB1LCBmLCBlKSB7CiAgICAgICAgcmV0dXJuIG4gPSBuICsgKGkgXiAodCB8IH5yKSkgKyB1ICsgZSwKICAgICAgICAobiA8PCBmIHwgbiA+Pj4gMzIgLSBmKSArIHQKICAgIH0KICAgIGZvciAodmFyIG8gPSBDcnlwdG9KUywKICAgIGUgPSBvLmxpYiwKICAgIGMgPSBlLldvcmRBcnJheSwKICAgIHMgPSBlLkhhc2hlciwKICAgIGUgPSBvLmFsZ28sCiAgICB0ID0gW10sIGggPSAwOyA2NCA+IGg7IGgrKykgdFtoXSA9IDQyOTQ5NjcyOTYgKiBuLmFicyhuLnNpbihoICsgMSkpIHwgMDsKICAgIGUgPSBlLk1ENSA9IHMuZXh0ZW5kKHsKICAgICAgICBfZG9SZXNldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHRoaXMuX2hhc2ggPSBuZXcgYy5pbml0KFsxNzMyNTg0MTkzLCA0MDIzMjMzNDE3LCAyNTYyMzgzMTAyLCAyNzE3MzM4NzhdKQogICAgICAgIH0sCiAgICAgICAgX2RvUHJvY2Vzc0Jsb2NrOiBmdW5jdGlvbihuLCBlKSB7CiAgICAgICAgICAgIGZvciAodmFyIHYsIGEsIGwgPSAwOyAxNiA+IGw7IGwrKykgdiA9IGUgKyBsLAogICAgICAgICAgICBhID0gblt2XSwKICAgICAgICAgICAgblt2XSA9IChhIDw8IDggfCBhID4+PiAyNCkgJiAxNjcxMTkzNSB8IChhIDw8IDI0IHwgYSA+Pj4gOCkgJiA0Mjc4MjU1MzYwOwogICAgICAgICAgICB2YXIgbCA9IHRoaXMuX2hhc2gud29yZHMsCiAgICAgICAgICAgIHYgPSBuW2UgKyAwXSwKICAgICAgICAgICAgYSA9IG5bZSArIDFdLAogICAgICAgICAgICB5ID0gbltlICsgMl0sCiAgICAgICAgICAgIHAgPSBuW2UgKyAzXSwKICAgICAgICAgICAgdyA9IG5bZSArIDRdLAogICAgICAgICAgICBiID0gbltlICsgNV0sCiAgICAgICAgICAgIGsgPSBuW2UgKyA2XSwKICAgICAgICAgICAgZCA9IG5bZSArIDddLAogICAgICAgICAgICBnID0gbltlICsgOF0sCiAgICAgICAgICAgIG50ID0gbltlICsgOV0sCiAgICAgICAgICAgIHR0ID0gbltlICsgMTBdLAogICAgICAgICAgICBpdCA9IG5bZSArIDExXSwKICAgICAgICAgICAgcnQgPSBuW2UgKyAxMl0sCiAgICAgICAgICAgIHV0ID0gbltlICsgMTNdLAogICAgICAgICAgICBmdCA9IG5bZSArIDE0XSwKICAgICAgICAgICAgZXQgPSBuW2UgKyAxNV0sCiAgICAgICAgICAgIG8gPSBsWzBdLAogICAgICAgICAgICBzID0gbFsxXSwKICAgICAgICAgICAgaCA9IGxbMl0sCiAgICAgICAgICAgIGMgPSBsWzNdLAogICAgICAgICAgICBvID0gaShvLCBzLCBoLCBjLCB2LCA3LCB0WzBdKSwKICAgICAgICAgICAgYyA9IGkoYywgbywgcywgaCwgYSwgMTIsIHRbMV0pLAogICAgICAgICAgICBoID0gaShoLCBjLCBvLCBzLCB5LCAxNywgdFsyXSksCiAgICAgICAgICAgIHMgPSBpKHMsIGgsIGMsIG8sIHAsIDIyLCB0WzNdKSwKICAgICAgICAgICAgbyA9IGkobywgcywgaCwgYywgdywgNywgdFs0XSksCiAgICAgICAgICAgIGMgPSBpKGMsIG8sIHMsIGgsIGIsIDEyLCB0WzVdKSwKICAgICAgICAgICAgaCA9IGkoaCwgYywgbywgcywgaywgMTcsIHRbNl0pLAogICAgICAgICAgICBzID0gaShzLCBoLCBjLCBvLCBkLCAyMiwgdFs3XSksCiAgICAgICAgICAgIG8gPSBpKG8sIHMsIGgsIGMsIGcsIDcsIHRbOF0pLAogICAgICAgICAgICBjID0gaShjLCBvLCBzLCBoLCBudCwgMTIsIHRbOV0pLAogICAgICAgICAgICBoID0gaShoLCBjLCBvLCBzLCB0dCwgMTcsIHRbMTBdKSwKICAgICAgICAgICAgcyA9IGkocywgaCwgYywgbywgaXQsIDIyLCB0WzExXSksCiAgICAgICAgICAgIG8gPSBpKG8sIHMsIGgsIGMsIHJ0LCA3LCB0WzEyXSksCiAgICAgICAgICAgIGMgPSBpKGMsIG8sIHMsIGgsIHV0LCAxMiwgdFsxM10pLAogICAgICAgICAgICBoID0gaShoLCBjLCBvLCBzLCBmdCwgMTcsIHRbMTRdKSwKICAgICAgICAgICAgcyA9IGkocywgaCwgYywgbywgZXQsIDIyLCB0WzE1XSksCiAgICAgICAgICAgIG8gPSByKG8sIHMsIGgsIGMsIGEsIDUsIHRbMTZdKSwKICAgICAgICAgICAgYyA9IHIoYywgbywgcywgaCwgaywgOSwgdFsxN10pLAogICAgICAgICAgICBoID0gcihoLCBjLCBvLCBzLCBpdCwgMTQsIHRbMThdKSwKICAgICAgICAgICAgcyA9IHIocywgaCwgYywgbywgdiwgMjAsIHRbMTldKSwKICAgICAgICAgICAgbyA9IHIobywgcywgaCwgYywgYiwgNSwgdFsyMF0pLAogICAgICAgICAgICBjID0gcihjLCBvLCBzLCBoLCB0dCwgOSwgdFsyMV0pLAogICAgICAgICAgICBoID0gcihoLCBjLCBvLCBzLCBldCwgMTQsIHRbMjJdKSwKICAgICAgICAgICAgcyA9IHIocywgaCwgYywgbywgdywgMjAsIHRbMjNdKSwKICAgICAgICAgICAgbyA9IHIobywgcywgaCwgYywgbnQsIDUsIHRbMjRdKSwKICAgICAgICAgICAgYyA9IHIoYywgbywgcywgaCwgZnQsIDksIHRbMjVdKSwKICAgICAgICAgICAgaCA9IHIoaCwgYywgbywgcywgcCwgMTQsIHRbMjZdKSwKICAgICAgICAgICAgcyA9IHIocywgaCwgYywgbywgZywgMjAsIHRbMjddKSwKICAgICAgICAgICAgbyA9IHIobywgcywgaCwgYywgdXQsIDUsIHRbMjhdKSwKICAgICAgICAgICAgYyA9IHIoYywgbywgcywgaCwgeSwgOSwgdFsyOV0pLAogICAgICAgICAgICBoID0gcihoLCBjLCBvLCBzLCBkLCAxNCwgdFszMF0pLAogICAgICAgICAgICBzID0gcihzLCBoLCBjLCBvLCBydCwgMjAsIHRbMzFdKSwKICAgICAgICAgICAgbyA9IHUobywgcywgaCwgYywgYiwgNCwgdFszMl0pLAogICAgICAgICAgICBjID0gdShjLCBvLCBzLCBoLCBnLCAxMSwgdFszM10pLAogICAgICAgICAgICBoID0gdShoLCBjLCBvLCBzLCBpdCwgMTYsIHRbMzRdKSwKICAgICAgICAgICAgcyA9IHUocywgaCwgYywgbywgZnQsIDIzLCB0WzM1XSksCiAgICAgICAgICAgIG8gPSB1KG8sIHMsIGgsIGMsIGEsIDQsIHRbMzZdKSwKICAgICAgICAgICAgYyA9IHUoYywgbywgcywgaCwgdywgMTEsIHRbMzddKSwKICAgICAgICAgICAgaCA9IHUoaCwgYywgbywgcywgZCwgMTYsIHRbMzhdKSwKICAgICAgICAgICAgcyA9IHUocywgaCwgYywgbywgdHQsIDIzLCB0WzM5XSksCiAgICAgICAgICAgIG8gPSB1KG8sIHMsIGgsIGMsIHV0LCA0LCB0WzQwXSksCiAgICAgICAgICAgIGMgPSB1KGMsIG8sIHMsIGgsIHYsIDExLCB0WzQxXSksCiAgICAgICAgICAgIGggPSB1KGgsIGMsIG8sIHMsIHAsIDE2LCB0WzQyXSksCiAgICAgICAgICAgIHMgPSB1KHMsIGgsIGMsIG8sIGssIDIzLCB0WzQzXSksCiAgICAgICAgICAgIG8gPSB1KG8sIHMsIGgsIGMsIG50LCA0LCB0WzQ0XSksCiAgICAgICAgICAgIGMgPSB1KGMsIG8sIHMsIGgsIHJ0LCAxMSwgdFs0NV0pLAogICAgICAgICAgICBoID0gdShoLCBjLCBvLCBzLCBldCwgMTYsIHRbNDZdKSwKICAgICAgICAgICAgcyA9IHUocywgaCwgYywgbywgeSwgMjMsIHRbNDddKSwKICAgICAgICAgICAgbyA9IGYobywgcywgaCwgYywgdiwgNiwgdFs0OF0pLAogICAgICAgICAgICBjID0gZihjLCBvLCBzLCBoLCBkLCAxMCwgdFs0OV0pLAogICAgICAgICAgICBoID0gZihoLCBjLCBvLCBzLCBmdCwgMTUsIHRbNTBdKSwKICAgICAgICAgICAgcyA9IGYocywgaCwgYywgbywgYiwgMjEsIHRbNTFdKSwKICAgICAgICAgICAgbyA9IGYobywgcywgaCwgYywgcnQsIDYsIHRbNTJdKSwKICAgICAgICAgICAgYyA9IGYoYywgbywgcywgaCwgcCwgMTAsIHRbNTNdKSwKICAgICAgICAgICAgaCA9IGYoaCwgYywgbywgcywgdHQsIDE1LCB0WzU0XSksCiAgICAgICAgICAgIHMgPSBmKHMsIGgsIGMsIG8sIGEsIDIxLCB0WzU1XSksCiAgICAgICAgICAgIG8gPSBmKG8sIHMsIGgsIGMsIGcsIDYsIHRbNTZdKSwKICAgICAgICAgICAgYyA9IGYoYywgbywgcywgaCwgZXQsIDEwLCB0WzU3XSksCiAgICAgICAgICAgIGggPSBmKGgsIGMsIG8sIHMsIGssIDE1LCB0WzU4XSksCiAgICAgICAgICAgIHMgPSBmKHMsIGgsIGMsIG8sIHV0LCAyMSwgdFs1OV0pLAogICAgICAgICAgICBvID0gZihvLCBzLCBoLCBjLCB3LCA2LCB0WzYwXSksCiAgICAgICAgICAgIGMgPSBmKGMsIG8sIHMsIGgsIGl0LCAxMCwgdFs2MV0pLAogICAgICAgICAgICBoID0gZihoLCBjLCBvLCBzLCB5LCAxNSwgdFs2Ml0pLAogICAgICAgICAgICBzID0gZihzLCBoLCBjLCBvLCBudCwgMjEsIHRbNjNdKTsKICAgICAgICAgICAgbFswXSA9IGxbMF0gKyBvIHwgMDsKICAgICAgICAgICAgbFsxXSA9IGxbMV0gKyBzIHwgMDsKICAgICAgICAgICAgbFsyXSA9IGxbMl0gKyBoIHwgMDsKICAgICAgICAgICAgbFszXSA9IGxbM10gKyBjIHwgMAogICAgICAgIH0sCiAgICAgICAgX2RvRmluYWxpemU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgdSA9IHRoaXMuX2RhdGEsCiAgICAgICAgICAgIHIgPSB1LndvcmRzLAogICAgICAgICAgICB0ID0gOCAqIHRoaXMuX25EYXRhQnl0ZXMsCiAgICAgICAgICAgIGkgPSA4ICogdS5zaWdCeXRlcywKICAgICAgICAgICAgZjsKICAgICAgICAgICAgZm9yIChyW2kgPj4+IDVdIHw9IDEyOCA8PCAyNCAtIGkgJSAzMiwgZiA9IG4uZmxvb3IodCAvIDQyOTQ5NjcyOTYpLCByWyhpICsgNjQgPj4+IDkgPDwgNCkgKyAxNV0gPSAoZiA8PCA4IHwgZiA+Pj4gMjQpICYgMTY3MTE5MzUgfCAoZiA8PCAyNCB8IGYgPj4+IDgpICYgNDI3ODI1NTM2MCwgclsoaSArIDY0ID4+PiA5IDw8IDQpICsgMTRdID0gKHQgPDwgOCB8IHQgPj4+IDI0KSAmIDE2NzExOTM1IHwgKHQgPDwgMjQgfCB0ID4+PiA4KSAmIDQyNzgyNTUzNjAsIHUuc2lnQnl0ZXMgPSA0ICogKHIubGVuZ3RoICsgMSksIHRoaXMuX3Byb2Nlc3MoKSwgdSA9IHRoaXMuX2hhc2gsIHIgPSB1LndvcmRzLCB0ID0gMDsgNCA+IHQ7IHQrKykgaSA9IHJbdF0sCiAgICAgICAgICAgIHJbdF0gPSAoaSA8PCA4IHwgaSA+Pj4gMjQpICYgMTY3MTE5MzUgfCAoaSA8PCAyNCB8IGkgPj4+IDgpICYgNDI3ODI1NTM2MDsKICAgICAgICAgICAgcmV0dXJuIHUKICAgICAgICB9LAogICAgICAgIGNsb25lOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIG4gPSBzLmNsb25lLmNhbGwodGhpcyk7CiAgICAgICAgICAgIHJldHVybiBuLl9oYXNoID0gdGhpcy5faGFzaC5jbG9uZSgpLAogICAgICAgICAgICBuCiAgICAgICAgfQogICAgfSk7CiAgICBvLk1ENSA9IHMuX2NyZWF0ZUhlbHBlcihlKTsKICAgIG8uSG1hY01ENSA9IHMuX2NyZWF0ZUhtYWNIZWxwZXIoZSkKfSAoTWF0aCksCmZ1bmN0aW9uKCkgewogICAgdmFyIHQgPSBDcnlwdG9KUywKICAgIG4gPSB0LmxpYiwKICAgIGkgPSBuLkJhc2UsCiAgICByID0gbi5Xb3JkQXJyYXksCiAgICBuID0gdC5hbGdvLAogICAgdSA9IG4uRXZwS0RGID0gaS5leHRlbmQoewogICAgICAgIGNmZzogaS5leHRlbmQoewogICAgICAgICAgICBrZXlTaXplOiA0LAogICAgICAgICAgICBoYXNoZXI6IG4uTUQ1LAogICAgICAgICAgICBpdGVyYXRpb25zOiAxCiAgICAgICAgfSksCiAgICAgICAgaW5pdDogZnVuY3Rpb24obikgewogICAgICAgICAgICB0aGlzLmNmZyA9IHRoaXMuY2ZnLmV4dGVuZChuKQogICAgICAgIH0sCiAgICAgICAgY29tcHV0ZTogZnVuY3Rpb24obiwgdCkgewogICAgICAgICAgICBmb3IgKHZhciBpLCBvLCBmID0gdGhpcy5jZmcsCiAgICAgICAgICAgIHUgPSBmLmhhc2hlci5jcmVhdGUoKSwgZSA9IHIuY3JlYXRlKCksIGggPSBlLndvcmRzLCBzID0gZi5rZXlTaXplLCBmID0gZi5pdGVyYXRpb25zOyBoLmxlbmd0aCA8IHM7KSB7CiAgICAgICAgICAgICAgICBmb3IgKGkgJiYgdS51cGRhdGUoaSksIGkgPSB1LnVwZGF0ZShuKS5maW5hbGl6ZSh0KSwgdS5yZXNldCgpLCBvID0gMTsgbyA8IGY7IG8rKykgaSA9IHUuZmluYWxpemUoaSksCiAgICAgICAgICAgICAgICB1LnJlc2V0KCk7CiAgICAgICAgICAgICAgICBlLmNvbmNhdChpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBlLnNpZ0J5dGVzID0gNCAqIHMsCiAgICAgICAgICAgIGUKICAgICAgICB9CiAgICB9KTsKICAgIHQuRXZwS0RGID0gZnVuY3Rpb24obiwgdCwgaSkgewogICAgICAgIHJldHVybiB1LmNyZWF0ZShpKS5jb21wdXRlKG4sIHQpCiAgICB9Cn0gKCk7CkNyeXB0b0pTLmxpYi5DaXBoZXIgfHwKZnVuY3Rpb24obikgewogICAgdmFyIGkgPSBDcnlwdG9KUywKICAgIHQgPSBpLmxpYiwKICAgIGYgPSB0LkJhc2UsCiAgICBlID0gdC5Xb3JkQXJyYXksCiAgICBjID0gdC5CdWZmZXJlZEJsb2NrQWxnb3JpdGhtLAogICAgbCA9IGkuZW5jLkJhc2U2NCwKICAgIHkgPSBpLmFsZ28uRXZwS0RGLAogICAgbyA9IHQuQ2lwaGVyID0gYy5leHRlbmQoewogICAgICAgIGNmZzogZi5leHRlbmQoKSwKICAgICAgICBjcmVhdGVFbmNyeXB0b3I6IGZ1bmN0aW9uKG4sIHQpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlKHRoaXMuX0VOQ19YRk9STV9NT0RFLCBuLCB0KQogICAgICAgIH0sCiAgICAgICAgY3JlYXRlRGVjcnlwdG9yOiBmdW5jdGlvbihuLCB0KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZSh0aGlzLl9ERUNfWEZPUk1fTU9ERSwgbiwgdCkKICAgICAgICB9LAogICAgICAgIGluaXQ6IGZ1bmN0aW9uKG4sIHQsIGkpIHsKICAgICAgICAgICAgdGhpcy5jZmcgPSB0aGlzLmNmZy5leHRlbmQoaSk7CiAgICAgICAgICAgIHRoaXMuX3hmb3JtTW9kZSA9IG47CiAgICAgICAgICAgIHRoaXMuX2tleSA9IHQ7CiAgICAgICAgICAgIHRoaXMucmVzZXQoKQogICAgICAgIH0sCiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBjLnJlc2V0LmNhbGwodGhpcyk7CiAgICAgICAgICAgIHRoaXMuX2RvUmVzZXQoKQogICAgICAgIH0sCiAgICAgICAgcHJvY2VzczogZnVuY3Rpb24obikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYXBwZW5kKG4pLAogICAgICAgICAgICB0aGlzLl9wcm9jZXNzKCkKICAgICAgICB9LAogICAgICAgIGZpbmFsaXplOiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIHJldHVybiBuICYmIHRoaXMuX2FwcGVuZChuKSwKICAgICAgICAgICAgdGhpcy5fZG9GaW5hbGl6ZSgpCiAgICAgICAgfSwKICAgICAgICBrZXlTaXplOiA0LAogICAgICAgIGl2U2l6ZTogNCwKICAgICAgICBfRU5DX1hGT1JNX01PREU6IDEsCiAgICAgICAgX0RFQ19YRk9STV9NT0RFOiAyLAogICAgICAgIF9jcmVhdGVIZWxwZXI6IGZ1bmN0aW9uKG4pIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGVuY3J5cHQ6IGZ1bmN0aW9uKHQsIGksIHIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKCJzdHJpbmciID09IHR5cGVvZiBpID8gdjogdSkuZW5jcnlwdChuLCB0LCBpLCByKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRlY3J5cHQ6IGZ1bmN0aW9uKHQsIGksIHIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKCJzdHJpbmciID09IHR5cGVvZiBpID8gdjogdSkuZGVjcnlwdChuLCB0LCBpLCByKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7CiAgICB0LlN0cmVhbUNpcGhlciA9IG8uZXh0ZW5kKHsKICAgICAgICBfZG9GaW5hbGl6ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcm9jZXNzKCEwKQogICAgICAgIH0sCiAgICAgICAgYmxvY2tTaXplOiAxCiAgICB9KTsKICAgIHZhciBzID0gaS5tb2RlID0ge30sCiAgICBhID0gZnVuY3Rpb24odCwgaSwgcikgewogICAgICAgIHZhciBmID0gdGhpcy5faXYsCiAgICAgICAgdTsKICAgICAgICBmb3IgKGYgPyB0aGlzLl9pdiA9IG46IGYgPSB0aGlzLl9wcmV2QmxvY2ssIHUgPSAwOyB1IDwgcjsgdSsrKSB0W2kgKyB1XSBePSBmW3VdCiAgICB9LAogICAgciA9ICh0LkJsb2NrQ2lwaGVyTW9kZSA9IGYuZXh0ZW5kKHsKICAgICAgICBjcmVhdGVFbmNyeXB0b3I6IGZ1bmN0aW9uKG4sIHQpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuRW5jcnlwdG9yLmNyZWF0ZShuLCB0KQogICAgICAgIH0sCiAgICAgICAgY3JlYXRlRGVjcnlwdG9yOiBmdW5jdGlvbihuLCB0KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkRlY3J5cHRvci5jcmVhdGUobiwgdCkKICAgICAgICB9LAogICAgICAgIGluaXQ6IGZ1bmN0aW9uKG4sIHQpIHsKICAgICAgICAgICAgdGhpcy5fY2lwaGVyID0gbjsKICAgICAgICAgICAgdGhpcy5faXYgPSB0CiAgICAgICAgfQogICAgfSkpLmV4dGVuZCgpOwogICAgci5FbmNyeXB0b3IgPSByLmV4dGVuZCh7CiAgICAgICAgcHJvY2Vzc0Jsb2NrOiBmdW5jdGlvbihuLCB0KSB7CiAgICAgICAgICAgIHZhciBpID0gdGhpcy5fY2lwaGVyLAogICAgICAgICAgICByID0gaS5ibG9ja1NpemU7CiAgICAgICAgICAgIGEuY2FsbCh0aGlzLCBuLCB0LCByKTsKICAgICAgICAgICAgaS5lbmNyeXB0QmxvY2sobiwgdCk7CiAgICAgICAgICAgIHRoaXMuX3ByZXZCbG9jayA9IG4uc2xpY2UodCwgdCArIHIpCiAgICAgICAgfQogICAgfSk7CiAgICByLkRlY3J5cHRvciA9IHIuZXh0ZW5kKHsKICAgICAgICBwcm9jZXNzQmxvY2s6IGZ1bmN0aW9uKG4sIHQpIHsKICAgICAgICAgICAgdmFyIGkgPSB0aGlzLl9jaXBoZXIsCiAgICAgICAgICAgIHIgPSBpLmJsb2NrU2l6ZSwKICAgICAgICAgICAgdSA9IG4uc2xpY2UodCwgdCArIHIpOwogICAgICAgICAgICBpLmRlY3J5cHRCbG9jayhuLCB0KTsKICAgICAgICAgICAgYS5jYWxsKHRoaXMsIG4sIHQsIHIpOwogICAgICAgICAgICB0aGlzLl9wcmV2QmxvY2sgPSB1CiAgICAgICAgfQogICAgfSk7CiAgICBzID0gcy5DQkMgPSByOwogICAgciA9IChpLnBhZCA9IHt9KS5Qa2NzNyA9IHsKICAgICAgICBwYWQ6IGZ1bmN0aW9uKG4sIHQpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDQgKiB0LAogICAgICAgICAgICBpID0gaSAtIG4uc2lnQnl0ZXMgJSBpLAogICAgICAgICAgICBmID0gaSA8PCAyNCB8IGkgPDwgMTYgfCBpIDw8IDggfCBpLAogICAgICAgICAgICByID0gW10sIHUgPSAwOyB1IDwgaTsgdSArPSA0KSByLnB1c2goZik7CiAgICAgICAgICAgIGkgPSBlLmNyZWF0ZShyLCBpKTsKICAgICAgICAgICAgbi5jb25jYXQoaSkKICAgICAgICB9LAogICAgICAgIHVucGFkOiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIG4uc2lnQnl0ZXMgLT0gbi53b3Jkc1tuLnNpZ0J5dGVzIC0gMSA+Pj4gMl0gJiAyNTUKICAgICAgICB9CiAgICB9OwogICAgdC5CbG9ja0NpcGhlciA9IG8uZXh0ZW5kKHsKICAgICAgICBjZmc6IG8uY2ZnLmV4dGVuZCh7CiAgICAgICAgICAgIG1vZGU6IHMsCiAgICAgICAgICAgIHBhZGRpbmc6IHIKICAgICAgICB9KSwKICAgICAgICByZXNldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciB0OwogICAgICAgICAgICBvLnJlc2V0LmNhbGwodGhpcyk7CiAgICAgICAgICAgIHZhciBuID0gdGhpcy5jZmcsCiAgICAgICAgICAgIGkgPSBuLml2LAogICAgICAgICAgICBuID0gbi5tb2RlOwogICAgICAgICAgICB0aGlzLl94Zm9ybU1vZGUgPT0gdGhpcy5fRU5DX1hGT1JNX01PREUgPyB0ID0gbi5jcmVhdGVFbmNyeXB0b3I6ICh0ID0gbi5jcmVhdGVEZWNyeXB0b3IsIHRoaXMuX21pbkJ1ZmZlclNpemUgPSAxKTsKICAgICAgICAgICAgdGhpcy5fbW9kZSA9IHQuY2FsbChuLCB0aGlzLCBpICYmIGkud29yZHMpCiAgICAgICAgfSwKICAgICAgICBfZG9Qcm9jZXNzQmxvY2s6IGZ1bmN0aW9uKG4sIHQpIHsKICAgICAgICAgICAgdGhpcy5fbW9kZS5wcm9jZXNzQmxvY2sobiwgdCkKICAgICAgICB9LAogICAgICAgIF9kb0ZpbmFsaXplOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLmNmZy5wYWRkaW5nLAogICAgICAgICAgICBuOwogICAgICAgICAgICByZXR1cm4gdGhpcy5feGZvcm1Nb2RlID09IHRoaXMuX0VOQ19YRk9STV9NT0RFID8gKHQucGFkKHRoaXMuX2RhdGEsIHRoaXMuYmxvY2tTaXplKSwgbiA9IHRoaXMuX3Byb2Nlc3MoITApKSA6IChuID0gdGhpcy5fcHJvY2VzcyghMCksIHQudW5wYWQobikpLAogICAgICAgICAgICBuCiAgICAgICAgfSwKICAgICAgICBibG9ja1NpemU6IDQKICAgIH0pOwogICAgdmFyIGggPSB0LkNpcGhlclBhcmFtcyA9IGYuZXh0ZW5kKHsKICAgICAgICBpbml0OiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIHRoaXMubWl4SW4obikKICAgICAgICB9LAogICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIHJldHVybiAobiB8fCB0aGlzLmZvcm1hdHRlcikuc3RyaW5naWZ5KHRoaXMpCiAgICAgICAgfQogICAgfSksCiAgICBzID0gKGkuZm9ybWF0ID0ge30pLk9wZW5TU0wgPSB7CiAgICAgICAgc3RyaW5naWZ5OiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIHZhciB0ID0gbi5jaXBoZXJ0ZXh0OwogICAgICAgICAgICByZXR1cm4gbiA9IG4uc2FsdCwKICAgICAgICAgICAgKG4gPyBlLmNyZWF0ZShbMTM5ODg5MzY4NCwgMTcwMTA3NjgzMV0pLmNvbmNhdChuKS5jb25jYXQodCkgOiB0KS50b1N0cmluZyhsKQogICAgICAgIH0sCiAgICAgICAgcGFyc2U6IGZ1bmN0aW9uKG4pIHsKICAgICAgICAgICAgdmFyIHQsIGk7CiAgICAgICAgICAgIHJldHVybiBuID0gbC5wYXJzZShuKSwKICAgICAgICAgICAgdCA9IG4ud29yZHMsCiAgICAgICAgICAgIDEzOTg4OTM2ODQgPT0gdFswXSAmJiAxNzAxMDc2ODMxID09IHRbMV0gJiYgKGkgPSBlLmNyZWF0ZSh0LnNsaWNlKDIsIDQpKSwgdC5zcGxpY2UoMCwgNCksIG4uc2lnQnl0ZXMgLT0gMTYpLAogICAgICAgICAgICBoLmNyZWF0ZSh7CiAgICAgICAgICAgICAgICBjaXBoZXJ0ZXh0OiBuLAogICAgICAgICAgICAgICAgc2FsdDogaQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgIH0sCiAgICB1ID0gdC5TZXJpYWxpemFibGVDaXBoZXIgPSBmLmV4dGVuZCh7CiAgICAgICAgY2ZnOiBmLmV4dGVuZCh7CiAgICAgICAgICAgIGZvcm1hdDogcwogICAgICAgIH0pLAogICAgICAgIGVuY3J5cHQ6IGZ1bmN0aW9uKG4sIHQsIGksIHIpIHsKICAgICAgICAgICAgciA9IHRoaXMuY2ZnLmV4dGVuZChyKTsKICAgICAgICAgICAgdmFyIHUgPSBuLmNyZWF0ZUVuY3J5cHRvcihpLCByKTsKICAgICAgICAgICAgcmV0dXJuIHQgPSB1LmZpbmFsaXplKHQpLAogICAgICAgICAgICB1ID0gdS5jZmcsCiAgICAgICAgICAgIGguY3JlYXRlKHsKICAgICAgICAgICAgICAgIGNpcGhlcnRleHQ6IHQsCiAgICAgICAgICAgICAgICBrZXk6IGksCiAgICAgICAgICAgICAgICBpdjogdS5pdiwKICAgICAgICAgICAgICAgIGFsZ29yaXRobTogbiwKICAgICAgICAgICAgICAgIG1vZGU6IHUubW9kZSwKICAgICAgICAgICAgICAgIHBhZGRpbmc6IHUucGFkZGluZywKICAgICAgICAgICAgICAgIGJsb2NrU2l6ZTogbi5ibG9ja1NpemUsCiAgICAgICAgICAgICAgICBmb3JtYXR0ZXI6IHIuZm9ybWF0CiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBkZWNyeXB0OiBmdW5jdGlvbihuLCB0LCBpLCByKSB7CiAgICAgICAgICAgIHJldHVybiByID0gdGhpcy5jZmcuZXh0ZW5kKHIpLAogICAgICAgICAgICB0ID0gdGhpcy5fcGFyc2UodCwgci5mb3JtYXQpLAogICAgICAgICAgICBuLmNyZWF0ZURlY3J5cHRvcihpLCByKS5maW5hbGl6ZSh0LmNpcGhlcnRleHQpCiAgICAgICAgfSwKICAgICAgICBfcGFyc2U6IGZ1bmN0aW9uKG4sIHQpIHsKICAgICAgICAgICAgcmV0dXJuICJzdHJpbmciID09IHR5cGVvZiBuID8gdC5wYXJzZShuLCB0aGlzKSA6IG4KICAgICAgICB9CiAgICB9KSwKICAgIGkgPSAoaS5rZGYgPSB7fSkuT3BlblNTTCA9IHsKICAgICAgICBleGVjdXRlOiBmdW5jdGlvbihuLCB0LCBpLCByKSB7CiAgICAgICAgICAgIHJldHVybiByIHx8IChyID0gZS5yYW5kb20oOCkpLAogICAgICAgICAgICBuID0geS5jcmVhdGUoewogICAgICAgICAgICAgICAga2V5U2l6ZTogdCArIGkKICAgICAgICAgICAgfSkuY29tcHV0ZShuLCByKSwKICAgICAgICAgICAgaSA9IGUuY3JlYXRlKG4ud29yZHMuc2xpY2UodCksIDQgKiBpKSwKICAgICAgICAgICAgbi5zaWdCeXRlcyA9IDQgKiB0LAogICAgICAgICAgICBoLmNyZWF0ZSh7CiAgICAgICAgICAgICAgICBrZXk6IG4sCiAgICAgICAgICAgICAgICBpdjogaSwKICAgICAgICAgICAgICAgIHNhbHQ6IHIKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICB9LAogICAgdiA9IHQuUGFzc3dvcmRCYXNlZENpcGhlciA9IHUuZXh0ZW5kKHsKICAgICAgICBjZmc6IHUuY2ZnLmV4dGVuZCh7CiAgICAgICAgICAgIGtkZjogaQogICAgICAgIH0pLAogICAgICAgIGVuY3J5cHQ6IGZ1bmN0aW9uKG4sIHQsIGksIHIpIHsKICAgICAgICAgICAgcmV0dXJuIHIgPSB0aGlzLmNmZy5leHRlbmQociksCiAgICAgICAgICAgIGkgPSByLmtkZi5leGVjdXRlKGksIG4ua2V5U2l6ZSwgbi5pdlNpemUpLAogICAgICAgICAgICByLml2ID0gaS5pdiwKICAgICAgICAgICAgbiA9IHUuZW5jcnlwdC5jYWxsKHRoaXMsIG4sIHQsIGkua2V5LCByKSwKICAgICAgICAgICAgbi5taXhJbihpKSwKICAgICAgICAgICAgbgogICAgICAgIH0sCiAgICAgICAgZGVjcnlwdDogZnVuY3Rpb24obiwgdCwgaSwgcikgewogICAgICAgICAgICByZXR1cm4gciA9IHRoaXMuY2ZnLmV4dGVuZChyKSwKICAgICAgICAgICAgdCA9IHRoaXMuX3BhcnNlKHQsIHIuZm9ybWF0KSwKICAgICAgICAgICAgaSA9IHIua2RmLmV4ZWN1dGUoaSwgbi5rZXlTaXplLCBuLml2U2l6ZSwgdC5zYWx0KSwKICAgICAgICAgICAgci5pdiA9IGkuaXYsCiAgICAgICAgICAgIHUuZGVjcnlwdC5jYWxsKHRoaXMsIG4sIHQsIGkua2V5LCByKQogICAgICAgIH0KICAgIH0pCn0gKCksCmZ1bmN0aW9uKCkgewogICAgZm9yICh2YXIgaSwgdHQsIHMgPSBDcnlwdG9KUywKICAgIHkgPSBzLmxpYi5CbG9ja0NpcGhlciwKICAgIGggPSBzLmFsZ28sCiAgICB0ID0gW10sIHAgPSBbXSwgdyA9IFtdLCBiID0gW10sIGsgPSBbXSwgZCA9IFtdLCBjID0gW10sIGwgPSBbXSwgYSA9IFtdLCB2ID0gW10sIHUgPSBbXSwgZiA9IDA7IDI1NiA+IGY7IGYrKykgdVtmXSA9IDEyOCA+IGYgPyBmIDw8IDEgOiBmIDw8IDEgXiAyODM7CiAgICBmb3IgKHZhciByID0gMCwKICAgIGUgPSAwLAogICAgZiA9IDA7IDI1NiA+IGY7IGYrKykgewogICAgICAgIGkgPSBlIF4gZSA8PCAxIF4gZSA8PCAyIF4gZSA8PCAzIF4gZSA8PCA0OwogICAgICAgIGkgPSBpID4+PiA4IF4gaSAmIDI1NSBeIDk5OwogICAgICAgIHRbcl0gPSBpOwogICAgICAgIHBbaV0gPSByOwogICAgICAgIHZhciBvID0gdVtyXSwKICAgICAgICBnID0gdVtvXSwKICAgICAgICBudCA9IHVbZ10sCiAgICAgICAgbiA9IDI1NyAqIHVbaV0gXiAxNjg0MzAwOCAqIGk7CiAgICAgICAgd1tyXSA9IG4gPDwgMjQgfCBuID4+PiA4OwogICAgICAgIGJbcl0gPSBuIDw8IDE2IHwgbiA+Pj4gMTY7CiAgICAgICAga1tyXSA9IG4gPDwgOCB8IG4gPj4+IDI0OwogICAgICAgIGRbcl0gPSBuOwogICAgICAgIG4gPSAxNjg0MzAwOSAqIG50IF4gNjU1MzcgKiBnIF4gMjU3ICogbyBeIDE2ODQzMDA4ICogcjsKICAgICAgICBjW2ldID0gbiA8PCAyNCB8IG4gPj4+IDg7CiAgICAgICAgbFtpXSA9IG4gPDwgMTYgfCBuID4+PiAxNjsKICAgICAgICBhW2ldID0gbiA8PCA4IHwgbiA+Pj4gMjQ7CiAgICAgICAgdltpXSA9IG47CiAgICAgICAgciA/IChyID0gbyBeIHVbdVt1W250IF4gb11dXSwgZSBePSB1W3VbZV1dKSA6IHIgPSBlID0gMQogICAgfQogICAgdHQgPSBbMCwgMSwgMiwgNCwgOCwgMTYsIDMyLCA2NCwgMTI4LCAyNywgNTRdOwogICAgaCA9IGguQUVTID0geS5leHRlbmQoewogICAgICAgIF9kb1Jlc2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZm9yICh2YXIgbiwgZiA9IHRoaXMuX2tleSwKICAgICAgICAgICAgZSA9IGYud29yZHMsCiAgICAgICAgICAgIHIgPSBmLnNpZ0J5dGVzIC8gNCwKICAgICAgICAgICAgZiA9IDQgKiAoKHRoaXMuX25Sb3VuZHMgPSByICsgNikgKyAxKSwgdSA9IHRoaXMuX2tleVNjaGVkdWxlID0gW10sIGkgPSAwOyBpIDwgZjsgaSsrKSBpIDwgciA/IHVbaV0gPSBlW2ldIDogKG4gPSB1W2kgLSAxXSwgaSAlIHIgPyA2IDwgciAmJiA0ID09IGkgJSByICYmIChuID0gdFtuID4+PiAyNF0gPDwgMjQgfCB0W24gPj4+IDE2ICYgMjU1XSA8PCAxNiB8IHRbbiA+Pj4gOCAmIDI1NV0gPDwgOCB8IHRbbiAmIDI1NV0pIDogKG4gPSBuIDw8IDggfCBuID4+PiAyNCwgbiA9IHRbbiA+Pj4gMjRdIDw8IDI0IHwgdFtuID4+PiAxNiAmIDI1NV0gPDwgMTYgfCB0W24gPj4+IDggJiAyNTVdIDw8IDggfCB0W24gJiAyNTVdLCBuIF49IHR0W2kgLyByIHwgMF0gPDwgMjQpLCB1W2ldID0gdVtpIC0gcl0gXiBuKTsKICAgICAgICAgICAgZm9yIChlID0gdGhpcy5faW52S2V5U2NoZWR1bGUgPSBbXSwgciA9IDA7IHIgPCBmOyByKyspIGkgPSBmIC0gciwKICAgICAgICAgICAgbiA9IHIgJSA0ID8gdVtpXSA6IHVbaSAtIDRdLAogICAgICAgICAgICBlW3JdID0gNCA+IHIgfHwgNCA+PSBpID8gbjogY1t0W24gPj4+IDI0XV0gXiBsW3RbbiA+Pj4gMTYgJiAyNTVdXSBeIGFbdFtuID4+PiA4ICYgMjU1XV0gXiB2W3RbbiAmIDI1NV1dCiAgICAgICAgfSwKICAgICAgICBlbmNyeXB0QmxvY2s6IGZ1bmN0aW9uKG4sIGkpIHsKICAgICAgICAgICAgdGhpcy5fZG9DcnlwdEJsb2NrKG4sIGksIHRoaXMuX2tleVNjaGVkdWxlLCB3LCBiLCBrLCBkLCB0KQogICAgICAgIH0sCiAgICAgICAgZGVjcnlwdEJsb2NrOiBmdW5jdGlvbihuLCB0KSB7CiAgICAgICAgICAgIHZhciBpID0gblt0ICsgMV07CiAgICAgICAgICAgIG5bdCArIDFdID0gblt0ICsgM107CiAgICAgICAgICAgIG5bdCArIDNdID0gaTsKICAgICAgICAgICAgdGhpcy5fZG9DcnlwdEJsb2NrKG4sIHQsIHRoaXMuX2ludktleVNjaGVkdWxlLCBjLCBsLCBhLCB2LCBwKTsKICAgICAgICAgICAgaSA9IG5bdCArIDFdOwogICAgICAgICAgICBuW3QgKyAxXSA9IG5bdCArIDNdOwogICAgICAgICAgICBuW3QgKyAzXSA9IGkKICAgICAgICB9LAogICAgICAgIF9kb0NyeXB0QmxvY2s6IGZ1bmN0aW9uKG4sIHQsIGksIHIsIHUsIGYsIGUsIG8pIHsKICAgICAgICAgICAgZm9yICh2YXIgYiA9IHRoaXMuX25Sb3VuZHMsCiAgICAgICAgICAgIGggPSBuW3RdIF4gaVswXSwgYyA9IG5bdCArIDFdIF4gaVsxXSwgbCA9IG5bdCArIDJdIF4gaVsyXSwgcyA9IG5bdCArIDNdIF4gaVszXSwgYSA9IDQsIHcgPSAxOyB3IDwgYjsgdysrKSB2YXIgdiA9IHJbaCA+Pj4gMjRdIF4gdVtjID4+PiAxNiAmIDI1NV0gXiBmW2wgPj4+IDggJiAyNTVdIF4gZVtzICYgMjU1XSBeIGlbYSsrXSwKICAgICAgICAgICAgeSA9IHJbYyA+Pj4gMjRdIF4gdVtsID4+PiAxNiAmIDI1NV0gXiBmW3MgPj4+IDggJiAyNTVdIF4gZVtoICYgMjU1XSBeIGlbYSsrXSwKICAgICAgICAgICAgcCA9IHJbbCA+Pj4gMjRdIF4gdVtzID4+PiAxNiAmIDI1NV0gXiBmW2ggPj4+IDggJiAyNTVdIF4gZVtjICYgMjU1XSBeIGlbYSsrXSwKICAgICAgICAgICAgcyA9IHJbcyA+Pj4gMjRdIF4gdVtoID4+PiAxNiAmIDI1NV0gXiBmW2MgPj4+IDggJiAyNTVdIF4gZVtsICYgMjU1XSBeIGlbYSsrXSwKICAgICAgICAgICAgaCA9IHYsCiAgICAgICAgICAgIGMgPSB5LAogICAgICAgICAgICBsID0gcDsKICAgICAgICAgICAgdiA9IChvW2ggPj4+IDI0XSA8PCAyNCB8IG9bYyA+Pj4gMTYgJiAyNTVdIDw8IDE2IHwgb1tsID4+PiA4ICYgMjU1XSA8PCA4IHwgb1tzICYgMjU1XSkgXiBpW2ErK107CiAgICAgICAgICAgIHkgPSAob1tjID4+PiAyNF0gPDwgMjQgfCBvW2wgPj4+IDE2ICYgMjU1XSA8PCAxNiB8IG9bcyA+Pj4gOCAmIDI1NV0gPDwgOCB8IG9baCAmIDI1NV0pIF4gaVthKytdOwogICAgICAgICAgICBwID0gKG9bbCA+Pj4gMjRdIDw8IDI0IHwgb1tzID4+PiAxNiAmIDI1NV0gPDwgMTYgfCBvW2ggPj4+IDggJiAyNTVdIDw8IDggfCBvW2MgJiAyNTVdKSBeIGlbYSsrXTsKICAgICAgICAgICAgcyA9IChvW3MgPj4+IDI0XSA8PCAyNCB8IG9baCA+Pj4gMTYgJiAyNTVdIDw8IDE2IHwgb1tjID4+PiA4ICYgMjU1XSA8PCA4IHwgb1tsICYgMjU1XSkgXiBpW2ErK107CiAgICAgICAgICAgIG5bdF0gPSB2OwogICAgICAgICAgICBuW3QgKyAxXSA9IHk7CiAgICAgICAgICAgIG5bdCArIDJdID0gcDsKICAgICAgICAgICAgblt0ICsgM10gPSBzCiAgICAgICAgfSwKICAgICAgICBrZXlTaXplOiA4CiAgICB9KTsKICAgIHMuQUVTID0geS5fY3JlYXRlSGVscGVyKGgpCn0gKCk7CmZ1bmN0aW9uIHZhbEFlc0VuY3J5cHRTZXQoaSkgewogICAgdmFyIG4sdCxyOwogICAgdHJ5IHsKICAgICAgICBuID0gYWVzRGVjcnlwdChpKTsKICAgICAgICBuICE9ICIiICYmICh0ID0gYWVzRW5jcnlwdChuKSwgdCAhPSBpICYmIChuID0gIiIpKQogICAgfSBjYXRjaChyKSB7CiAgICAgICAgbiA9ICIiCiAgICB9CiAgICByZXR1cm4gbiA9PSAiIiAmJiAodCA9IGFlc0VuY3J5cHQoaSkpOwp9OwpmdW5jdGlvbiBhZXNEZWNyeXB0KG4pIHsKICAgIHZhciB0ID0gQ3J5cHRvSlMuTUQ1KCJsb2dpbi4xODkuY24iKSwKICAgIGkgPSBDcnlwdG9KUy5lbmMuVXRmOC5wYXJzZSh0KSwKICAgIHIgPSBDcnlwdG9KUy5lbmMuVXRmOC5wYXJzZSgiMTIzNDU2NzgxMjM0NTY3OCIpOwogICAgcmV0dXJuIENyeXB0b0pTLkFFUy5kZWNyeXB0KG4sIGksIHsKICAgICAgICBpdjogcgogICAgfSkudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLlV0ZjgpCn07CmZ1bmN0aW9uIGFlc0VuY3J5cHQobikgewogICAgdmFyIHQgPSBDcnlwdG9KUy5NRDUoImxvZ2luLjE4OS5jbiIpLAogICAgaSA9IENyeXB0b0pTLmVuYy5VdGY4LnBhcnNlKHQpLAogICAgciA9IENyeXB0b0pTLmVuYy5VdGY4LnBhcnNlKCIxMjM0NTY3ODEyMzQ1Njc4IiksCiAgICB1ID0gQ3J5cHRvSlMuQUVTLmVuY3J5cHQobiwgaSwgewogICAgICAgIGl2OiByCiAgICB9KTsKICAgIHJldHVybiB1ICsgIiIKfTs=";

    @Override
    public HttpResult<Map<String, Object>> init(OperatorParam param) {
        HttpResult<Map<String, Object>> result = new HttpResult<>();
        Response response = null;
        try {
            //String templateUrl = "http://wapfj.189.cn/";
            //response = TaskHttpClient.create(param, RequestType.GET, "fu_jian_10000_web_001").setFullUrl(templateUrl).invoke();

            String templateUrl = "http://wapfj.189.cn/login/otherlogin.shtml";
            response = TaskHttpClient.create(param, RequestType.GET, "fu_jian_10000_web_002").setFullUrl(templateUrl).invoke();
            String pageContent = response.getPageContent();
            if (StringUtils.isBlank(pageContent)) {
                logger.error("登录-->初始化失败,param={},response={}", param, response);
                return result.failure(ErrorCode.TASK_INIT_ERROR);
            }
            String servType = "50";
            String modulus
                    = "9417c1a4cfb44407cf42c3b7edf50260c89a7a2bc9fdef0c66da925c86bd5bc8787f02f91528cab222ba8b5d34eafd0bd4bd7a5f1dc49a828635a8a0add8d67b";
            String loginType = "2";
            String empoent = "10001";
            String barkUrl = StringUtils.EMPTY;
            List<String> servTypeList = XPathUtil.getXpath("//input[@name='wapInfo.servType']/@value", pageContent);
            if (!CollectionUtils.isEmpty(servTypeList)) {
                servType = servTypeList.get(0);
            }
            List<String> loginTypeList = XPathUtil.getXpath("//input[@name='wapInfo.loginType']/@value", pageContent);
            if (!CollectionUtils.isEmpty(loginTypeList)) {
                loginType = loginTypeList.get(0);
            }
            List<String> moduleList = XPathUtil.getXpath("//input[@name='module']/@value", pageContent);
            if (!CollectionUtils.isEmpty(moduleList)) {
                modulus = moduleList.get(0);
            }
            List<String> empoentList = XPathUtil.getXpath("//input[@name='empoent']/@value", pageContent);
            if (!CollectionUtils.isEmpty(empoentList)) {
                empoent = empoentList.get(0);
            }
            List<String> backURLList = XPathUtil.getXpath("//input[@name='backURL']/@value", pageContent);
            if (!CollectionUtils.isEmpty(backURLList)) {
                barkUrl = backURLList.get(0);
            }
            TaskUtils.addTaskShare(param.getTaskId(), "servType", servType);
            TaskUtils.addTaskShare(param.getTaskId(), "modulus", modulus);
            TaskUtils.addTaskShare(param.getTaskId(), "loginType", loginType);
            TaskUtils.addTaskShare(param.getTaskId(), "empoent", empoent);
            TaskUtils.addTaskShare(param.getTaskId(), "barkUrl", barkUrl);
            return result.success();
        } catch (Exception e) {
            logger.error("登录-->初始化失败,param={},response={}", param, response, e);
            return result.failure(ErrorCode.TASK_INIT_ERROR);
        }
    }

    @Override
    public HttpResult<String> refeshPicCode(OperatorParam param) {
        switch (param.getFormType()) {
            case FormType.LOGIN:
                return refeshPicCodeForLogin(param);
            default:
                return new HttpResult<String>().failure(ErrorCode.NOT_SUPORT_METHOD);
        }
    }

    @Override
    public HttpResult<Map<String, Object>> refeshSmsCode(OperatorParam param) {
        switch (param.getFormType()) {
            case FormType.VALIDATE_BILL_DETAIL:
                return refeshSmsCodeForBillDetail(param);
            default:
                return new HttpResult<Map<String, Object>>().failure(ErrorCode.NOT_SUPORT_METHOD);
        }
    }

    @Override
    public HttpResult<Map<String, Object>> submit(OperatorParam param) {
        switch (param.getFormType()) {
            case FormType.LOGIN:
                return submitForLogin(param);
            case FormType.VALIDATE_BILL_DETAIL:
                return submitForBillDetail(param);
            default:
                return new HttpResult<Map<String, Object>>().failure(ErrorCode.NOT_SUPORT_METHOD);
        }
    }

    @Override
    public HttpResult<Map<String, Object>> validatePicCode(OperatorParam param) {
        return new HttpResult<Map<String, Object>>().failure(ErrorCode.NOT_SUPORT_METHOD);
    }

    @Override
    public HttpResult<Object> defineProcess(OperatorParam param) {
        return new HttpResult<Object>().failure(ErrorCode.NOT_SUPORT_METHOD);
    }

    private HttpResult<String> refeshPicCodeForLogin(OperatorParam param) {
        HttpResult<String> result = new HttpResult<>();
        Response response = null;
        try {
            String referer = "http://wapfj.189.cn/login/otherlogin.shtml";
            String templateUrl = "http://wapfj.189.cn/wapimagecode";
            response = TaskHttpClient.create(param.getTaskId(), param.getWebsiteName(), RequestType.GET, "fu_jian_10000_web_003")
                    .setFullUrl(templateUrl).setReferer(referer).invoke();
            logger.info("登录-->图片验证码-->刷新成功,param={}", param);
            return result.success(response.getPageContentForBase64());
        } catch (Exception e) {
            logger.error("登录-->图片验证码-->刷新失败,param={},response={}", param, response, e);
            return result.failure(ErrorCode.REFESH_PIC_CODE_ERROR);
        }
    }

    private HttpResult<Map<String, Object>> submitForLogin(OperatorParam param) {
        CheckUtils.checkNotBlank(param.getPassword(), ErrorCode.EMPTY_PASSWORD);
        CheckUtils.checkNotBlank(param.getPicCode(), ErrorCode.EMPTY_PIC_CODE);
        HttpResult<Map<String, Object>> result = new HttpResult<>();
        Response response = null;
        try {
            /**
             * 通过登录wap版获取 姓名、身份证、入网时间
             */
            String servType = TaskUtils.getTaskShare(param.getTaskId(), "servType");
            String loginType = TaskUtils.getTaskShare(param.getTaskId(), "loginType");
            String modulus = TaskUtils.getTaskShare(param.getTaskId(), "modulus");
            String empoent = TaskUtils.getTaskShare(param.getTaskId(), "empoent");
            String barkUrl = TaskUtils.getTaskShare(param.getTaskId(), "barkUrl");

            Invocable invocable = ScriptEngineUtil.createInvocableFromBase64(javaScript_wap);
            String encryptMobile = invocable.invokeFunction("encryptedString", modulus, param.getMobile().toString()).toString();
            String encryptPassword = invocable.invokeFunction("encryptedString", modulus, param.getPassword()).toString();

            String referer = "http://wapfj.189.cn/login/otherlogin.shtml";
            String templateUrl = "http://wapfj.189.cn/login/changenbrlogin.shtml";
            String templateData = "unGet=&wapInfo.servType={}&wapInfo.loginType={}&module={}&empoent={}&backURL={}&accnbr={}&mm={}&wapInfo" +
                    ".validationCode={}";
            String data = TemplateUtils
                    .format(templateData, servType, loginType, modulus, empoent, barkUrl, encryptMobile, encryptPassword, param.getPicCode());
            response = TaskHttpClient.create(param, RequestType.POST, "fu_jian_10000_web_004").setFullUrl(templateUrl).setReferer(referer)
                    .setRequestBody(data).invoke();
            referer = "http://wapfj.189.cn/";
            templateUrl = "http://wapfj.189.cn/service/queryWapInfo.shtml";
            response = TaskHttpClient.create(param, RequestType.GET, "fu_jian_10000_web_005").setFullUrl(templateUrl).setReferer(referer).invoke();
            String pageContent = response.getPageContent();
            if (StringUtils.contains(pageContent, param.getMobile().toString())) {
                String customerName = PatternUtils.group(pageContent, "客户姓名：</strong>([^：]+)<br/", 1);
                TaskUtils.addTaskShare(param.getTaskId(), "customerName", customerName);
                String idCardNo = PatternUtils.group(pageContent, "证件号码：</strong>([^：]+)<br/", 1);
                TaskUtils.addTaskShare(param.getTaskId(), "idCardNo", idCardNo);
                String joinDate = PatternUtils.group(pageContent, "开通时间：</strong>([^：]+)<br/", 1);
                TaskUtils.addTaskShare(param.getTaskId(), "joinDate", joinDate);
            } else {
                logger.error("登陆失败,wap版登陆失败,param={},response={}", param, response);
                //return result.failure(ErrorCode.LOGIN_UNEXPECTED_RESULT);
            }

            RedisUtils.del("task.cookie." + param.getTaskId());
            /**
             * 登录web版
             */

            invocable = ScriptEngineUtil.createInvocableFromBase64(javaScript_web);
            encryptPassword = invocable.invokeFunction("aesEncrypt", param.getPassword()).toString();

            referer = "http://login.189.cn/login";
            templateUrl = "http://login.189.cn/login";
            templateData = "Account={}&UType=201&ProvinceID=14&AreaCode=&CityNo=&RandomFlag=0&Password={}&Captcha=";
            data = TemplateUtils.format(templateData, param.getMobile(), URLEncoder.encode(encryptPassword, "UTF-8"));
            response = TaskHttpClient.create(param, RequestType.POST, "fu_jian_10000_web_006").setFullUrl(templateUrl).setReferer(referer)
                    .setRequestBody(data).invoke();
            pageContent = response.getPageContent();
            if (StringUtils.isBlank(pageContent)) {
                logger.error("登陆失败,param={},response={}", param, response);
                return result.failure(ErrorCode.LOGIN_UNEXPECTED_RESULT);
            }
            String resultCode = PatternUtils.group(pageContent, "data-resultcode=\"(\\d+)\"", 1);
            if (resultCode != null) {
                if (resultCode.equals("9103") || resultCode.equals("9999")) {
                    logger.error("登陆失败,账户名与密码不匹配,param={},response={}", param, response);
                    return result.failure(ErrorCode.VALIDATE_PASSWORD_FAIL);
                } else if (resultCode.equals("8105")) {
                    logger.error("登陆失败,密码过于简单,请重置,param={},response={}", param, response);
                    return result.failure(ErrorCode.VALIDATE_PASSWORD_FAIL);
                } else if (resultCode.equals("9111")) {
                    logger.error("登陆失败,登录失败过多，帐号已被锁定,param={},response={}", param, response);
                    return result.failure(ErrorCode.VALIDATE_PASSWORD_FAIL);
                } else if (resultCode.equals("9100")) {
                    logger.error("登陆失败,该账户不存在,param={},response={}", param, response);
                    return result.failure(ErrorCode.VALIDATE_PHONE_FAIL);
                } else if (resultCode.equals("6113")) {
                    logger.error("登陆失败,系统繁忙，稍后重试,param={},response={}", param, response);
                    return result.failure(ErrorCode.LOGIN_UNEXPECTED_RESULT);
                } else if (StringUtils.isNotBlank(resultCode)) {
                    logger.error("登陆失败,param={},response={}", param, response);
                    return result.failure(ErrorCode.LOGIN_UNEXPECTED_RESULT);
                }
            }

            referer = "http://www.189.cn/fj/";
            templateUrl = "http://www.189.cn/dqmh/my189/initMy189home.do?fastcode=01420648";
            response = TaskHttpClient.create(param, RequestType.GET, "fu_jian_10000_web_007").setFullUrl(templateUrl).setReferer(referer).invoke();

            referer = "http://www.189.cn/dqmh/my189/initMy189home.do?fastcode=01420648";
            templateUrl = "http://www.189.cn/login/sso/ecs.do?method=linkTo&platNo=10014&toStUrl=http://fj.189.cn/newcmsweb/commonIframe" +
                    ".jsp?URLPATH=/service/bill/realtime.jsp&fastcode=01420648&cityCode=fj";
            response = TaskHttpClient.create(param, RequestType.GET, "fu_jian_10000_web_008").setFullUrl(templateUrl).setReferer(referer).invoke();

            referer = "http://fj.189.cn/service/bill/realtime.jsp";
            templateUrl = "http://fj.189.cn/BillAjaxServlet.do?method=realtime&PRODNO={}&PRODTYPE=50";
            response = TaskHttpClient.create(param, RequestType.GET, "fu_jian_10000_web_009").setFullUrl(templateUrl, param.getMobile())
                    .setReferer(referer).invoke();
            pageContent = response.getPageContent();

            if (StringUtils.contains(pageContent, "获取话费成功") || StringUtils.contains(pageContent, "暂不提供数据")) {
                logger.info("登陆成功,param={}", param);
                return result.success();
            } else {
                logger.error("登陆失败,param={},pageContent={}", param, pageContent);
                return result.failure(ErrorCode.LOGIN_UNEXPECTED_RESULT);
            }
        } catch (Exception e) {
            logger.error("登陆失败,param={},response={}", param, response, e);
            return result.failure(ErrorCode.LOGIN_ERROR);
        }
    }

    private HttpResult<Map<String, Object>> refeshSmsCodeForBillDetail(OperatorParam param) {
        HttpResult<Map<String, Object>> result = new HttpResult<>();
        Response response = null;
        try {
            String cityCode = TaskUtils.getTaskContext(param.getTaskId(), "cityCode");
            String templateUrl = "http://fj.189.cn/service/bill/detail.jsp";
            String referer = "http://fj.189.cn/service/smdj/checkSmdj.jsp";
            response = TaskHttpClient.create(param, RequestType.GET, "fu_jian_10000_web_010").setFullUrl(templateUrl).setReferer(referer).invoke();

            SimpleDateFormat sf = new SimpleDateFormat("yyyyMM");
            Calendar c = Calendar.getInstance();
            c.add(Calendar.MONTH, -1);
            String billMonth = sf.format(c.getTime());

            referer = "http://fj.189.cn/service/bill/detail.jsp";
            templateUrl = "http://fj.189.cn/service/bill/tanChu.jsp?PRODNO={}&PRODTYPE=50&CITYCODE={}&MONTH={}&SELTYPE=1";
            response = TaskHttpClient.create(param, RequestType.GET, "fu_jian_10000_web_011")
                    .setFullUrl(templateUrl, param.getMobile(), cityCode, billMonth).setReferer(referer).invoke();
            String pageContent = response.getPageContent();

            if (StringUtils.isNotBlank(pageContent)) {
                cityCode = PatternUtils.group(pageContent, "id=\"CITYCODE\" value=\"([^\"]+)\"", 1);
            } else {
                cityCode = "0" + cityCode;
            }

            TaskUtils.addTaskShare(param.getTaskId(), "fullcityCode", cityCode);

            referer = templateUrl;
            templateUrl = "http://fj.189.cn/BUFFALO/buffalo/QueryAllAjax";
            String templateData = "<buffalo-call><method>getCDMASmsCode</method><map><type>java.util" +
                    ".HashMap</type><string>PHONENUM</string><string>{}</string><string>PRODUCTID</string><string>50</string><string>CITYCODE" +
                    "</string><string>{}</string><string>I_ISLIMIT</string><string>1</string><string>QUERYTYPE</string><string>BILL</string></map" +
                    "></buffalo-call>";
            String data = TemplateUtils.format(templateData, param.getMobile(), cityCode);
            response = TaskHttpClient.create(param, RequestType.POST, "fu_jian_10000_web_012").setFullUrl(templateUrl)
                    .setRequestBody(data, ContentType.TEXT_XML).setReferer(referer).invoke();
            pageContent = response.getPageContent();
            if (StringUtils.contains(pageContent, "短信随机密码已经发到您的手机")) {
                logger.info("详单-->短信验证码-->刷新成功,param={}", param);
                return result.success();
            } else {
                logger.error("详单-->短信验证码-->刷新失败,param={},pateContent={}", param, response.getPageContent());
                return result.failure(ErrorCode.REFESH_SMS_UNEXPECTED_RESULT);
            }
        } catch (Exception e) {
            logger.error("详单-->短信验证码-->刷新失败,param={},response={}", param, response, e);
            return result.failure(ErrorCode.REFESH_SMS_ERROR);
        }
    }

    private HttpResult<Map<String, Object>> submitForBillDetail(OperatorParam param) {
        HttpResult<Map<String, Object>> result = new HttpResult<>();
        Response response = null;
        try {
            SimpleDateFormat sf = new SimpleDateFormat("yyyyMM");
            Calendar c = Calendar.getInstance();
            String billMonth = sf.format(c.getTime());

            String fullcityCode = TaskUtils.getTaskShare(param.getTaskId(), "fullcityCode");
            String puridID = "0";
            String emailEmpoent = "10001";
            String emailModule
                    = "863581c5892cdfe8a67b95c7abb47ead8b102e9620994ae95637f637fa22acac173b91015574507362816b30a884632d8562bf20de621d31d745291aaec7ca6f";
            InputStream inputStream = this.getClass().getClassLoader().getResourceAsStream("fu_jian_10000_web/des_wap.js");
            Invocable invocable = ScriptEngineUtil.createInvocableFromBase64(javaScript_wap);
            String encryptPassword = invocable.invokeFunction("encryptedString", emailModule, param.getPassword()).toString();

            String templateUrl = "http://fj.189.cn/service/bill/trans.jsp";
            String templateData = "PRODNO={}&PRODTYPE=50&CITYCODE={}&SELTYPE=1&MONTH={}&PURID={}&email_empoent={}&email_module={}&serPwd50" +
                    "={}&randomPwd={}";
            String data = TemplateUtils
                    .format(templateData, param.getMobile(), fullcityCode, billMonth, puridID, emailEmpoent, emailModule, encryptPassword,
                            param.getSmsCode());
            response = TaskHttpClient.create(param, RequestType.POST, "fu_jian_10000_web_013").setFullUrl(templateUrl).setRequestBody(data).invoke();
            String pageContent = response.getPageContent();
            if (StringUtils.contains(pageContent, "暂无您所查询的数据清单") || StringUtils.contains(pageContent, "客户姓名")) {
                String encryptMobile = PatternUtils.group(pageContent, "PRODNO=([^\"=]+)=", 1);
                TaskUtils.addTaskShare(param.getTaskId(), "encryptMobile", encryptMobile);
                logger.info("详单-->校验成功,param={}", param);
                return result.success();
            } else {
                logger.error("详单-->校验失败,param={},pageContent={}", param, response.getPageContent());
                return result.failure(ErrorCode.VALIDATE_UNEXPECTED_RESULT);
            }
        } catch (Exception e) {
            logger.error("详单-->校验失败,param={},response={}", param, response, e);
            return result.failure(ErrorCode.VALIDATE_ERROR);
        }
    }
}
