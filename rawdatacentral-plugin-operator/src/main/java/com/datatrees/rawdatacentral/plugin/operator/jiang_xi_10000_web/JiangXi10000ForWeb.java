package com.datatrees.rawdatacentral.plugin.operator.jiang_xi_10000_web;

import javax.script.Invocable;
import java.net.URLEncoder;
import java.util.Date;
import java.util.Map;

import com.datatrees.common.util.PatternUtils;
import com.datatrees.crawler.core.processor.common.ProcessorContextUtil;
import com.datatrees.crawler.core.processor.plugin.PluginConstants;
import com.datatrees.crawler.core.processor.plugin.PluginFactory;
import com.datatrees.rawdatacentral.common.http.TaskHttpClient;
import com.datatrees.rawdatacentral.common.http.TaskUtils;
import com.datatrees.rawdatacentral.common.utils.CheckUtils;
import com.datatrees.rawdatacentral.common.utils.ScriptEngineUtil;
import com.datatrees.rawdatacentral.domain.constant.FormType;
import com.datatrees.rawdatacentral.domain.enums.ErrorCode;
import com.datatrees.rawdatacentral.domain.enums.RequestType;
import com.datatrees.rawdatacentral.domain.operator.OperatorParam;
import com.datatrees.rawdatacentral.domain.result.HttpResult;
import com.datatrees.rawdatacentral.domain.vo.Response;
import com.datatrees.rawdatacentral.service.OperatorPluginService;
import com.ibm.icu.text.SimpleDateFormat;
import org.apache.commons.lang.StringUtils;
import org.apache.http.entity.ContentType;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

/**
 * 江西电信web端
 * 登录 手机号，服务密码，短信验证码，图片验证码
 * 详单查询 短信验证码
 * User: yand
 * Date: 2017/9/28
 */
public class JiangXi10000ForWeb implements OperatorPluginService {

    private static       Logger logger          = LoggerFactory.getLogger(JiangXi10000ForWeb.class);
    private              String randomNum       = getRandomNumber();
    private              String scriptSessionId = StringUtils.EMPTY;
    private              String modulus         = StringUtils.EMPTY;
    private static final String javaScript1     = "dmFyIENyeXB0b0pTID0gQ3J5cHRvSlMgfHwKZnVuY3Rpb24obiwgdCkgewogICAgdmFyIHUgPSB7fSwKICAgIGYgPSB1LmxpYiA9IHt9LAogICAgbyA9IGZ1bmN0aW9uKCkge30sCiAgICBpID0gZi5CYXNlID0gewogICAgICAgIGV4dGVuZDogZnVuY3Rpb24obikgewogICAgICAgICAgICBvLnByb3RvdHlwZSA9IHRoaXM7CiAgICAgICAgICAgIHZhciB0ID0gbmV3IG87CiAgICAgICAgICAgIHJldHVybiBuICYmIHQubWl4SW4obiksCiAgICAgICAgICAgIHQuaGFzT3duUHJvcGVydHkoImluaXQiKSB8fCAodC5pbml0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB0LiRzdXBlci5pbml0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIHQuaW5pdC5wcm90b3R5cGUgPSB0LAogICAgICAgICAgICB0LiRzdXBlciA9IHRoaXMsCiAgICAgICAgICAgIHQKICAgICAgICB9LAogICAgICAgIGNyZWF0ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBuID0gdGhpcy5leHRlbmQoKTsKICAgICAgICAgICAgcmV0dXJuIG4uaW5pdC5hcHBseShuLCBhcmd1bWVudHMpLAogICAgICAgICAgICBuCiAgICAgICAgfSwKICAgICAgICBpbml0OiBmdW5jdGlvbigpIHt9LAogICAgICAgIG1peEluOiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIGZvciAodmFyIHQgaW4gbikgbi5oYXNPd25Qcm9wZXJ0eSh0KSAmJiAodGhpc1t0XSA9IG5bdF0pOwogICAgICAgICAgICBuLmhhc093blByb3BlcnR5KCJ0b1N0cmluZyIpICYmICh0aGlzLnRvU3RyaW5nID0gbi50b1N0cmluZykKICAgICAgICB9LAogICAgICAgIGNsb25lOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5pdC5wcm90b3R5cGUuZXh0ZW5kKHRoaXMpCiAgICAgICAgfQogICAgfSwKICAgIHIgPSBmLldvcmRBcnJheSA9IGkuZXh0ZW5kKHsKICAgICAgICBpbml0OiBmdW5jdGlvbihuLCBpKSB7CiAgICAgICAgICAgIG4gPSB0aGlzLndvcmRzID0gbiB8fCBbXTsKICAgICAgICAgICAgdGhpcy5zaWdCeXRlcyA9IGkgIT0gdCA/IGk6IDQgKiBuLmxlbmd0aAogICAgICAgIH0sCiAgICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uKG4pIHsKICAgICAgICAgICAgcmV0dXJuIChuIHx8IGwpLnN0cmluZ2lmeSh0aGlzKQogICAgICAgIH0sCiAgICAgICAgY29uY2F0OiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIHZhciBpID0gdGhpcy53b3JkcywKICAgICAgICAgICAgciA9IG4ud29yZHMsCiAgICAgICAgICAgIHUgPSB0aGlzLnNpZ0J5dGVzLAogICAgICAgICAgICB0OwogICAgICAgICAgICBpZiAobiA9IG4uc2lnQnl0ZXMsIHRoaXMuY2xhbXAoKSwgdSAlIDQpIGZvciAodCA9IDA7IHQgPCBuOyB0KyspIGlbdSArIHQgPj4+IDJdIHw9IChyW3QgPj4+IDJdID4+PiAyNCAtIDggKiAodCAlIDQpICYgMjU1KSA8PCAyNCAtIDggKiAoKHUgKyB0KSAlIDQpOwogICAgICAgICAgICBlbHNlIGlmICg2NTUzNSA8IHIubGVuZ3RoKSBmb3IgKHQgPSAwOyB0IDwgbjsgdCArPSA0KSBpW3UgKyB0ID4+PiAyXSA9IHJbdCA+Pj4gMl07CiAgICAgICAgICAgIGVsc2UgaS5wdXNoLmFwcGx5KGksIHIpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5zaWdCeXRlcyArPSBuLAogICAgICAgICAgICB0aGlzCiAgICAgICAgfSwKICAgICAgICBjbGFtcDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBpID0gdGhpcy53b3JkcywKICAgICAgICAgICAgdCA9IHRoaXMuc2lnQnl0ZXM7CiAgICAgICAgICAgIGlbdCA+Pj4gMl0gJj0gNDI5NDk2NzI5NSA8PCAzMiAtIDggKiAodCAlIDQpOwogICAgICAgICAgICBpLmxlbmd0aCA9IG4uY2VpbCh0IC8gNCkKICAgICAgICB9LAogICAgICAgIGNsb25lOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIG4gPSBpLmNsb25lLmNhbGwodGhpcyk7CiAgICAgICAgICAgIHJldHVybiBuLndvcmRzID0gdGhpcy53b3Jkcy5zbGljZSgwKSwKICAgICAgICAgICAgbgogICAgICAgIH0sCiAgICAgICAgcmFuZG9tOiBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSBbXSwgdSA9IDA7IHUgPCB0OyB1ICs9IDQpIGkucHVzaCg0Mjk0OTY3Mjk2ICogbi5yYW5kb20oKSB8IDApOwogICAgICAgICAgICByZXR1cm4gbmV3IHIuaW5pdChpLCB0KQogICAgICAgIH0KICAgIH0pLAogICAgZSA9IHUuZW5jID0ge30sCiAgICBsID0gZS5IZXggPSB7CiAgICAgICAgc3RyaW5naWZ5OiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIHZhciB1ID0gbi53b3JkcywKICAgICAgICAgICAgaSwgdCwgcjsKICAgICAgICAgICAgZm9yIChuID0gbi5zaWdCeXRlcywgaSA9IFtdLCB0ID0gMDsgdCA8IG47IHQrKykgciA9IHVbdCA+Pj4gMl0gPj4+IDI0IC0gOCAqICh0ICUgNCkgJiAyNTUsCiAgICAgICAgICAgIGkucHVzaCgociA+Pj4gNCkudG9TdHJpbmcoMTYpKSwKICAgICAgICAgICAgaS5wdXNoKChyICYgMTUpLnRvU3RyaW5nKDE2KSk7CiAgICAgICAgICAgIHJldHVybiBpLmpvaW4oIiIpCiAgICAgICAgfSwKICAgICAgICBwYXJzZTogZnVuY3Rpb24obikgewogICAgICAgICAgICBmb3IgKHZhciBpID0gbi5sZW5ndGgsCiAgICAgICAgICAgIHUgPSBbXSwgdCA9IDA7IHQgPCBpOyB0ICs9IDIpIHVbdCA+Pj4gM10gfD0gcGFyc2VJbnQobi5zdWJzdHIodCwgMiksIDE2KSA8PCAyNCAtIDQgKiAodCAlIDgpOwogICAgICAgICAgICByZXR1cm4gbmV3IHIuaW5pdCh1LCBpIC8gMikKICAgICAgICB9CiAgICB9LAogICAgcyA9IGUuTGF0aW4xID0gewogICAgICAgIHN0cmluZ2lmeTogZnVuY3Rpb24obikgewogICAgICAgICAgICB2YXIgciA9IG4ud29yZHMsCiAgICAgICAgICAgIGksIHQ7CiAgICAgICAgICAgIGZvciAobiA9IG4uc2lnQnl0ZXMsIGkgPSBbXSwgdCA9IDA7IHQgPCBuOyB0KyspIGkucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKHJbdCA+Pj4gMl0gPj4+IDI0IC0gOCAqICh0ICUgNCkgJiAyNTUpKTsKICAgICAgICAgICAgcmV0dXJuIGkuam9pbigiIikKICAgICAgICB9LAogICAgICAgIHBhcnNlOiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSBuLmxlbmd0aCwKICAgICAgICAgICAgdSA9IFtdLCB0ID0gMDsgdCA8IGk7IHQrKykgdVt0ID4+PiAyXSB8PSAobi5jaGFyQ29kZUF0KHQpICYgMjU1KSA8PCAyNCAtIDggKiAodCAlIDQpOwogICAgICAgICAgICByZXR1cm4gbmV3IHIuaW5pdCh1LCBpKQogICAgICAgIH0KICAgIH0sCiAgICBhID0gZS5VdGY4ID0gewogICAgICAgIHN0cmluZ2lmeTogZnVuY3Rpb24obikgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChlc2NhcGUocy5zdHJpbmdpZnkobikpKQogICAgICAgICAgICB9IGNhdGNoKHQpIHsKICAgICAgICAgICAgICAgIHRocm93IEVycm9yKCJNYWxmb3JtZWQgVVRGLTggZGF0YSIpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBwYXJzZTogZnVuY3Rpb24obikgewogICAgICAgICAgICByZXR1cm4gcy5wYXJzZSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQobikpKQogICAgICAgIH0KICAgIH0sCiAgICBoID0gZi5CdWZmZXJlZEJsb2NrQWxnb3JpdGhtID0gaS5leHRlbmQoewogICAgICAgIHJlc2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdGhpcy5fZGF0YSA9IG5ldyByLmluaXQ7CiAgICAgICAgICAgIHRoaXMuX25EYXRhQnl0ZXMgPSAwCiAgICAgICAgfSwKICAgICAgICBfYXBwZW5kOiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgICJzdHJpbmciID09IHR5cGVvZiBuICYmIChuID0gYS5wYXJzZShuKSk7CiAgICAgICAgICAgIHRoaXMuX2RhdGEuY29uY2F0KG4pOwogICAgICAgICAgICB0aGlzLl9uRGF0YUJ5dGVzICs9IG4uc2lnQnl0ZXMKICAgICAgICB9LAogICAgICAgIF9wcm9jZXNzOiBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgIHZhciBmID0gdGhpcy5fZGF0YSwKICAgICAgICAgICAgcyA9IGYud29yZHMsCiAgICAgICAgICAgIHUgPSBmLnNpZ0J5dGVzLAogICAgICAgICAgICBlID0gdGhpcy5ibG9ja1NpemUsCiAgICAgICAgICAgIG8gPSB1IC8gKDQgKiBlKSwKICAgICAgICAgICAgbyA9IHQgPyBuLmNlaWwobykgOiBuLm1heCgobyB8IDApIC0gdGhpcy5fbWluQnVmZmVyU2l6ZSwgMCksCiAgICAgICAgICAgIGk7CiAgICAgICAgICAgIGlmICh0ID0gbyAqIGUsIHUgPSBuLm1pbig0ICogdCwgdSksIHQpIHsKICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB0OyBpICs9IGUpIHRoaXMuX2RvUHJvY2Vzc0Jsb2NrKHMsIGkpOwogICAgICAgICAgICAgICAgaSA9IHMuc3BsaWNlKDAsIHQpOwogICAgICAgICAgICAgICAgZi5zaWdCeXRlcyAtPSB1CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG5ldyByLmluaXQoaSwgdSkKICAgICAgICB9LAogICAgICAgIGNsb25lOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIG4gPSBpLmNsb25lLmNhbGwodGhpcyk7CiAgICAgICAgICAgIHJldHVybiBuLl9kYXRhID0gdGhpcy5fZGF0YS5jbG9uZSgpLAogICAgICAgICAgICBuCiAgICAgICAgfSwKICAgICAgICBfbWluQnVmZmVyU2l6ZTogMAogICAgfSksCiAgICBjOwogICAgcmV0dXJuIGYuSGFzaGVyID0gaC5leHRlbmQoewogICAgICAgIGNmZzogaS5leHRlbmQoKSwKICAgICAgICBpbml0OiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIHRoaXMuY2ZnID0gdGhpcy5jZmcuZXh0ZW5kKG4pOwogICAgICAgICAgICB0aGlzLnJlc2V0KCkKICAgICAgICB9LAogICAgICAgIHJlc2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaC5yZXNldC5jYWxsKHRoaXMpOwogICAgICAgICAgICB0aGlzLl9kb1Jlc2V0KCkKICAgICAgICB9LAogICAgICAgIHVwZGF0ZTogZnVuY3Rpb24obikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYXBwZW5kKG4pLAogICAgICAgICAgICB0aGlzLl9wcm9jZXNzKCksCiAgICAgICAgICAgIHRoaXMKICAgICAgICB9LAogICAgICAgIGZpbmFsaXplOiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIHJldHVybiBuICYmIHRoaXMuX2FwcGVuZChuKSwKICAgICAgICAgICAgdGhpcy5fZG9GaW5hbGl6ZSgpCiAgICAgICAgfSwKICAgICAgICBibG9ja1NpemU6IDE2LAogICAgICAgIF9jcmVhdGVIZWxwZXI6IGZ1bmN0aW9uKG4pIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQsIGkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgbi5pbml0KGkpLmZpbmFsaXplKHQpCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIF9jcmVhdGVIbWFjSGVscGVyOiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbih0LCBpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGMuSE1BQy5pbml0KG4sIGkpLmZpbmFsaXplKHQpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KSwKICAgIGMgPSB1LmFsZ28gPSB7fSwKICAgIHUKfSAoTWF0aCk7IChmdW5jdGlvbigpIHsKICAgIHZhciBuID0gQ3J5cHRvSlMsCiAgICB0ID0gbi5saWIuV29yZEFycmF5OwogICAgbi5lbmMuQmFzZTY0ID0gewogICAgICAgIHN0cmluZ2lmeTogZnVuY3Rpb24obikgewogICAgICAgICAgICB2YXIgaSA9IG4ud29yZHMsCiAgICAgICAgICAgIHUgPSBuLnNpZ0J5dGVzLAogICAgICAgICAgICBmID0gdGhpcy5fbWFwLAogICAgICAgICAgICB0LCBlLCByOwogICAgICAgICAgICBmb3IgKG4uY2xhbXAoKSwgbiA9IFtdLCB0ID0gMDsgdCA8IHU7IHQgKz0gMykgZm9yIChlID0gKGlbdCA+Pj4gMl0gPj4+IDI0IC0gOCAqICh0ICUgNCkgJiAyNTUpIDw8IDE2IHwgKGlbdCArIDEgPj4+IDJdID4+PiAyNCAtIDggKiAoKHQgKyAxKSAlIDQpICYgMjU1KSA8PCA4IHwgaVt0ICsgMiA+Pj4gMl0gPj4+IDI0IC0gOCAqICgodCArIDIpICUgNCkgJiAyNTUsIHIgPSAwOyA0ID4gciAmJiB0ICsgLjc1ICogciA8IHU7IHIrKykgbi5wdXNoKGYuY2hhckF0KGUgPj4+IDYgKiAoMyAtIHIpICYgNjMpKTsKICAgICAgICAgICAgaWYgKGkgPSBmLmNoYXJBdCg2NCkpIGZvciAoOyBuLmxlbmd0aCAlIDQ7KSBuLnB1c2goaSk7CiAgICAgICAgICAgIHJldHVybiBuLmpvaW4oIiIpCiAgICAgICAgfSwKICAgICAgICBwYXJzZTogZnVuY3Rpb24obikgewogICAgICAgICAgICB2YXIgZSA9IG4ubGVuZ3RoLAogICAgICAgICAgICBmID0gdGhpcy5fbWFwLAogICAgICAgICAgICBpID0gZi5jaGFyQXQoNjQpLAogICAgICAgICAgICBvLAogICAgICAgICAgICBzOwogICAgICAgICAgICBpICYmIChpID0gbi5pbmRleE9mKGkpLCAtMSAhPSBpICYmIChlID0gaSkpOwogICAgICAgICAgICBmb3IgKHZhciBpID0gW10sIHUgPSAwLCByID0gMDsgciA8IGU7IHIrKykgciAlIDQgJiYgKG8gPSBmLmluZGV4T2Yobi5jaGFyQXQociAtIDEpKSA8PCAyICogKHIgJSA0KSwgcyA9IGYuaW5kZXhPZihuLmNoYXJBdChyKSkgPj4+IDYgLSAyICogKHIgJSA0KSwgaVt1ID4+PiAyXSB8PSAobyB8IHMpIDw8IDI0IC0gOCAqICh1ICUgNCksIHUrKyk7CiAgICAgICAgICAgIHJldHVybiB0LmNyZWF0ZShpLCB1KQogICAgICAgIH0sCiAgICAgICAgX21hcDogIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky89IgogICAgfQp9KSgpLApmdW5jdGlvbihuKSB7CiAgICBmdW5jdGlvbiBpKG4sIHQsIGksIHIsIHUsIGYsIGUpIHsKICAgICAgICByZXR1cm4gbiA9IG4gKyAodCAmIGkgfCB+dCAmIHIpICsgdSArIGUsCiAgICAgICAgKG4gPDwgZiB8IG4gPj4+IDMyIC0gZikgKyB0CiAgICB9CiAgICBmdW5jdGlvbiByKG4sIHQsIGksIHIsIHUsIGYsIGUpIHsKICAgICAgICByZXR1cm4gbiA9IG4gKyAodCAmIHIgfCBpICYgfnIpICsgdSArIGUsCiAgICAgICAgKG4gPDwgZiB8IG4gPj4+IDMyIC0gZikgKyB0CiAgICB9CiAgICBmdW5jdGlvbiB1KG4sIHQsIGksIHIsIHUsIGYsIGUpIHsKICAgICAgICByZXR1cm4gbiA9IG4gKyAodCBeIGkgXiByKSArIHUgKyBlLAogICAgICAgIChuIDw8IGYgfCBuID4+PiAzMiAtIGYpICsgdAogICAgfQogICAgZnVuY3Rpb24gZihuLCB0LCBpLCByLCB1LCBmLCBlKSB7CiAgICAgICAgcmV0dXJuIG4gPSBuICsgKGkgXiAodCB8IH5yKSkgKyB1ICsgZSwKICAgICAgICAobiA8PCBmIHwgbiA+Pj4gMzIgLSBmKSArIHQKICAgIH0KICAgIGZvciAodmFyIG8gPSBDcnlwdG9KUywKICAgIGUgPSBvLmxpYiwKICAgIGMgPSBlLldvcmRBcnJheSwKICAgIHMgPSBlLkhhc2hlciwKICAgIGUgPSBvLmFsZ28sCiAgICB0ID0gW10sIGggPSAwOyA2NCA+IGg7IGgrKykgdFtoXSA9IDQyOTQ5NjcyOTYgKiBuLmFicyhuLnNpbihoICsgMSkpIHwgMDsKICAgIGUgPSBlLk1ENSA9IHMuZXh0ZW5kKHsKICAgICAgICBfZG9SZXNldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHRoaXMuX2hhc2ggPSBuZXcgYy5pbml0KFsxNzMyNTg0MTkzLCA0MDIzMjMzNDE3LCAyNTYyMzgzMTAyLCAyNzE3MzM4NzhdKQogICAgICAgIH0sCiAgICAgICAgX2RvUHJvY2Vzc0Jsb2NrOiBmdW5jdGlvbihuLCBlKSB7CiAgICAgICAgICAgIGZvciAodmFyIHYsIGEsIGwgPSAwOyAxNiA+IGw7IGwrKykgdiA9IGUgKyBsLAogICAgICAgICAgICBhID0gblt2XSwKICAgICAgICAgICAgblt2XSA9IChhIDw8IDggfCBhID4+PiAyNCkgJiAxNjcxMTkzNSB8IChhIDw8IDI0IHwgYSA+Pj4gOCkgJiA0Mjc4MjU1MzYwOwogICAgICAgICAgICB2YXIgbCA9IHRoaXMuX2hhc2gud29yZHMsCiAgICAgICAgICAgIHYgPSBuW2UgKyAwXSwKICAgICAgICAgICAgYSA9IG5bZSArIDFdLAogICAgICAgICAgICB5ID0gbltlICsgMl0sCiAgICAgICAgICAgIHAgPSBuW2UgKyAzXSwKICAgICAgICAgICAgdyA9IG5bZSArIDRdLAogICAgICAgICAgICBiID0gbltlICsgNV0sCiAgICAgICAgICAgIGsgPSBuW2UgKyA2XSwKICAgICAgICAgICAgZCA9IG5bZSArIDddLAogICAgICAgICAgICBnID0gbltlICsgOF0sCiAgICAgICAgICAgIG50ID0gbltlICsgOV0sCiAgICAgICAgICAgIHR0ID0gbltlICsgMTBdLAogICAgICAgICAgICBpdCA9IG5bZSArIDExXSwKICAgICAgICAgICAgcnQgPSBuW2UgKyAxMl0sCiAgICAgICAgICAgIHV0ID0gbltlICsgMTNdLAogICAgICAgICAgICBmdCA9IG5bZSArIDE0XSwKICAgICAgICAgICAgZXQgPSBuW2UgKyAxNV0sCiAgICAgICAgICAgIG8gPSBsWzBdLAogICAgICAgICAgICBzID0gbFsxXSwKICAgICAgICAgICAgaCA9IGxbMl0sCiAgICAgICAgICAgIGMgPSBsWzNdLAogICAgICAgICAgICBvID0gaShvLCBzLCBoLCBjLCB2LCA3LCB0WzBdKSwKICAgICAgICAgICAgYyA9IGkoYywgbywgcywgaCwgYSwgMTIsIHRbMV0pLAogICAgICAgICAgICBoID0gaShoLCBjLCBvLCBzLCB5LCAxNywgdFsyXSksCiAgICAgICAgICAgIHMgPSBpKHMsIGgsIGMsIG8sIHAsIDIyLCB0WzNdKSwKICAgICAgICAgICAgbyA9IGkobywgcywgaCwgYywgdywgNywgdFs0XSksCiAgICAgICAgICAgIGMgPSBpKGMsIG8sIHMsIGgsIGIsIDEyLCB0WzVdKSwKICAgICAgICAgICAgaCA9IGkoaCwgYywgbywgcywgaywgMTcsIHRbNl0pLAogICAgICAgICAgICBzID0gaShzLCBoLCBjLCBvLCBkLCAyMiwgdFs3XSksCiAgICAgICAgICAgIG8gPSBpKG8sIHMsIGgsIGMsIGcsIDcsIHRbOF0pLAogICAgICAgICAgICBjID0gaShjLCBvLCBzLCBoLCBudCwgMTIsIHRbOV0pLAogICAgICAgICAgICBoID0gaShoLCBjLCBvLCBzLCB0dCwgMTcsIHRbMTBdKSwKICAgICAgICAgICAgcyA9IGkocywgaCwgYywgbywgaXQsIDIyLCB0WzExXSksCiAgICAgICAgICAgIG8gPSBpKG8sIHMsIGgsIGMsIHJ0LCA3LCB0WzEyXSksCiAgICAgICAgICAgIGMgPSBpKGMsIG8sIHMsIGgsIHV0LCAxMiwgdFsxM10pLAogICAgICAgICAgICBoID0gaShoLCBjLCBvLCBzLCBmdCwgMTcsIHRbMTRdKSwKICAgICAgICAgICAgcyA9IGkocywgaCwgYywgbywgZXQsIDIyLCB0WzE1XSksCiAgICAgICAgICAgIG8gPSByKG8sIHMsIGgsIGMsIGEsIDUsIHRbMTZdKSwKICAgICAgICAgICAgYyA9IHIoYywgbywgcywgaCwgaywgOSwgdFsxN10pLAogICAgICAgICAgICBoID0gcihoLCBjLCBvLCBzLCBpdCwgMTQsIHRbMThdKSwKICAgICAgICAgICAgcyA9IHIocywgaCwgYywgbywgdiwgMjAsIHRbMTldKSwKICAgICAgICAgICAgbyA9IHIobywgcywgaCwgYywgYiwgNSwgdFsyMF0pLAogICAgICAgICAgICBjID0gcihjLCBvLCBzLCBoLCB0dCwgOSwgdFsyMV0pLAogICAgICAgICAgICBoID0gcihoLCBjLCBvLCBzLCBldCwgMTQsIHRbMjJdKSwKICAgICAgICAgICAgcyA9IHIocywgaCwgYywgbywgdywgMjAsIHRbMjNdKSwKICAgICAgICAgICAgbyA9IHIobywgcywgaCwgYywgbnQsIDUsIHRbMjRdKSwKICAgICAgICAgICAgYyA9IHIoYywgbywgcywgaCwgZnQsIDksIHRbMjVdKSwKICAgICAgICAgICAgaCA9IHIoaCwgYywgbywgcywgcCwgMTQsIHRbMjZdKSwKICAgICAgICAgICAgcyA9IHIocywgaCwgYywgbywgZywgMjAsIHRbMjddKSwKICAgICAgICAgICAgbyA9IHIobywgcywgaCwgYywgdXQsIDUsIHRbMjhdKSwKICAgICAgICAgICAgYyA9IHIoYywgbywgcywgaCwgeSwgOSwgdFsyOV0pLAogICAgICAgICAgICBoID0gcihoLCBjLCBvLCBzLCBkLCAxNCwgdFszMF0pLAogICAgICAgICAgICBzID0gcihzLCBoLCBjLCBvLCBydCwgMjAsIHRbMzFdKSwKICAgICAgICAgICAgbyA9IHUobywgcywgaCwgYywgYiwgNCwgdFszMl0pLAogICAgICAgICAgICBjID0gdShjLCBvLCBzLCBoLCBnLCAxMSwgdFszM10pLAogICAgICAgICAgICBoID0gdShoLCBjLCBvLCBzLCBpdCwgMTYsIHRbMzRdKSwKICAgICAgICAgICAgcyA9IHUocywgaCwgYywgbywgZnQsIDIzLCB0WzM1XSksCiAgICAgICAgICAgIG8gPSB1KG8sIHMsIGgsIGMsIGEsIDQsIHRbMzZdKSwKICAgICAgICAgICAgYyA9IHUoYywgbywgcywgaCwgdywgMTEsIHRbMzddKSwKICAgICAgICAgICAgaCA9IHUoaCwgYywgbywgcywgZCwgMTYsIHRbMzhdKSwKICAgICAgICAgICAgcyA9IHUocywgaCwgYywgbywgdHQsIDIzLCB0WzM5XSksCiAgICAgICAgICAgIG8gPSB1KG8sIHMsIGgsIGMsIHV0LCA0LCB0WzQwXSksCiAgICAgICAgICAgIGMgPSB1KGMsIG8sIHMsIGgsIHYsIDExLCB0WzQxXSksCiAgICAgICAgICAgIGggPSB1KGgsIGMsIG8sIHMsIHAsIDE2LCB0WzQyXSksCiAgICAgICAgICAgIHMgPSB1KHMsIGgsIGMsIG8sIGssIDIzLCB0WzQzXSksCiAgICAgICAgICAgIG8gPSB1KG8sIHMsIGgsIGMsIG50LCA0LCB0WzQ0XSksCiAgICAgICAgICAgIGMgPSB1KGMsIG8sIHMsIGgsIHJ0LCAxMSwgdFs0NV0pLAogICAgICAgICAgICBoID0gdShoLCBjLCBvLCBzLCBldCwgMTYsIHRbNDZdKSwKICAgICAgICAgICAgcyA9IHUocywgaCwgYywgbywgeSwgMjMsIHRbNDddKSwKICAgICAgICAgICAgbyA9IGYobywgcywgaCwgYywgdiwgNiwgdFs0OF0pLAogICAgICAgICAgICBjID0gZihjLCBvLCBzLCBoLCBkLCAxMCwgdFs0OV0pLAogICAgICAgICAgICBoID0gZihoLCBjLCBvLCBzLCBmdCwgMTUsIHRbNTBdKSwKICAgICAgICAgICAgcyA9IGYocywgaCwgYywgbywgYiwgMjEsIHRbNTFdKSwKICAgICAgICAgICAgbyA9IGYobywgcywgaCwgYywgcnQsIDYsIHRbNTJdKSwKICAgICAgICAgICAgYyA9IGYoYywgbywgcywgaCwgcCwgMTAsIHRbNTNdKSwKICAgICAgICAgICAgaCA9IGYoaCwgYywgbywgcywgdHQsIDE1LCB0WzU0XSksCiAgICAgICAgICAgIHMgPSBmKHMsIGgsIGMsIG8sIGEsIDIxLCB0WzU1XSksCiAgICAgICAgICAgIG8gPSBmKG8sIHMsIGgsIGMsIGcsIDYsIHRbNTZdKSwKICAgICAgICAgICAgYyA9IGYoYywgbywgcywgaCwgZXQsIDEwLCB0WzU3XSksCiAgICAgICAgICAgIGggPSBmKGgsIGMsIG8sIHMsIGssIDE1LCB0WzU4XSksCiAgICAgICAgICAgIHMgPSBmKHMsIGgsIGMsIG8sIHV0LCAyMSwgdFs1OV0pLAogICAgICAgICAgICBvID0gZihvLCBzLCBoLCBjLCB3LCA2LCB0WzYwXSksCiAgICAgICAgICAgIGMgPSBmKGMsIG8sIHMsIGgsIGl0LCAxMCwgdFs2MV0pLAogICAgICAgICAgICBoID0gZihoLCBjLCBvLCBzLCB5LCAxNSwgdFs2Ml0pLAogICAgICAgICAgICBzID0gZihzLCBoLCBjLCBvLCBudCwgMjEsIHRbNjNdKTsKICAgICAgICAgICAgbFswXSA9IGxbMF0gKyBvIHwgMDsKICAgICAgICAgICAgbFsxXSA9IGxbMV0gKyBzIHwgMDsKICAgICAgICAgICAgbFsyXSA9IGxbMl0gKyBoIHwgMDsKICAgICAgICAgICAgbFszXSA9IGxbM10gKyBjIHwgMAogICAgICAgIH0sCiAgICAgICAgX2RvRmluYWxpemU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgdSA9IHRoaXMuX2RhdGEsCiAgICAgICAgICAgIHIgPSB1LndvcmRzLAogICAgICAgICAgICB0ID0gOCAqIHRoaXMuX25EYXRhQnl0ZXMsCiAgICAgICAgICAgIGkgPSA4ICogdS5zaWdCeXRlcywKICAgICAgICAgICAgZjsKICAgICAgICAgICAgZm9yIChyW2kgPj4+IDVdIHw9IDEyOCA8PCAyNCAtIGkgJSAzMiwgZiA9IG4uZmxvb3IodCAvIDQyOTQ5NjcyOTYpLCByWyhpICsgNjQgPj4+IDkgPDwgNCkgKyAxNV0gPSAoZiA8PCA4IHwgZiA+Pj4gMjQpICYgMTY3MTE5MzUgfCAoZiA8PCAyNCB8IGYgPj4+IDgpICYgNDI3ODI1NTM2MCwgclsoaSArIDY0ID4+PiA5IDw8IDQpICsgMTRdID0gKHQgPDwgOCB8IHQgPj4+IDI0KSAmIDE2NzExOTM1IHwgKHQgPDwgMjQgfCB0ID4+PiA4KSAmIDQyNzgyNTUzNjAsIHUuc2lnQnl0ZXMgPSA0ICogKHIubGVuZ3RoICsgMSksIHRoaXMuX3Byb2Nlc3MoKSwgdSA9IHRoaXMuX2hhc2gsIHIgPSB1LndvcmRzLCB0ID0gMDsgNCA+IHQ7IHQrKykgaSA9IHJbdF0sCiAgICAgICAgICAgIHJbdF0gPSAoaSA8PCA4IHwgaSA+Pj4gMjQpICYgMTY3MTE5MzUgfCAoaSA8PCAyNCB8IGkgPj4+IDgpICYgNDI3ODI1NTM2MDsKICAgICAgICAgICAgcmV0dXJuIHUKICAgICAgICB9LAogICAgICAgIGNsb25lOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIG4gPSBzLmNsb25lLmNhbGwodGhpcyk7CiAgICAgICAgICAgIHJldHVybiBuLl9oYXNoID0gdGhpcy5faGFzaC5jbG9uZSgpLAogICAgICAgICAgICBuCiAgICAgICAgfQogICAgfSk7CiAgICBvLk1ENSA9IHMuX2NyZWF0ZUhlbHBlcihlKTsKICAgIG8uSG1hY01ENSA9IHMuX2NyZWF0ZUhtYWNIZWxwZXIoZSkKfSAoTWF0aCksCmZ1bmN0aW9uKCkgewogICAgdmFyIHQgPSBDcnlwdG9KUywKICAgIG4gPSB0LmxpYiwKICAgIGkgPSBuLkJhc2UsCiAgICByID0gbi5Xb3JkQXJyYXksCiAgICBuID0gdC5hbGdvLAogICAgdSA9IG4uRXZwS0RGID0gaS5leHRlbmQoewogICAgICAgIGNmZzogaS5leHRlbmQoewogICAgICAgICAgICBrZXlTaXplOiA0LAogICAgICAgICAgICBoYXNoZXI6IG4uTUQ1LAogICAgICAgICAgICBpdGVyYXRpb25zOiAxCiAgICAgICAgfSksCiAgICAgICAgaW5pdDogZnVuY3Rpb24obikgewogICAgICAgICAgICB0aGlzLmNmZyA9IHRoaXMuY2ZnLmV4dGVuZChuKQogICAgICAgIH0sCiAgICAgICAgY29tcHV0ZTogZnVuY3Rpb24obiwgdCkgewogICAgICAgICAgICBmb3IgKHZhciBpLCBvLCBmID0gdGhpcy5jZmcsCiAgICAgICAgICAgIHUgPSBmLmhhc2hlci5jcmVhdGUoKSwgZSA9IHIuY3JlYXRlKCksIGggPSBlLndvcmRzLCBzID0gZi5rZXlTaXplLCBmID0gZi5pdGVyYXRpb25zOyBoLmxlbmd0aCA8IHM7KSB7CiAgICAgICAgICAgICAgICBmb3IgKGkgJiYgdS51cGRhdGUoaSksIGkgPSB1LnVwZGF0ZShuKS5maW5hbGl6ZSh0KSwgdS5yZXNldCgpLCBvID0gMTsgbyA8IGY7IG8rKykgaSA9IHUuZmluYWxpemUoaSksCiAgICAgICAgICAgICAgICB1LnJlc2V0KCk7CiAgICAgICAgICAgICAgICBlLmNvbmNhdChpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBlLnNpZ0J5dGVzID0gNCAqIHMsCiAgICAgICAgICAgIGUKICAgICAgICB9CiAgICB9KTsKICAgIHQuRXZwS0RGID0gZnVuY3Rpb24obiwgdCwgaSkgewogICAgICAgIHJldHVybiB1LmNyZWF0ZShpKS5jb21wdXRlKG4sIHQpCiAgICB9Cn0gKCk7CkNyeXB0b0pTLmxpYi5DaXBoZXIgfHwKZnVuY3Rpb24obikgewogICAgdmFyIGkgPSBDcnlwdG9KUywKICAgIHQgPSBpLmxpYiwKICAgIGYgPSB0LkJhc2UsCiAgICBlID0gdC5Xb3JkQXJyYXksCiAgICBjID0gdC5CdWZmZXJlZEJsb2NrQWxnb3JpdGhtLAogICAgbCA9IGkuZW5jLkJhc2U2NCwKICAgIHkgPSBpLmFsZ28uRXZwS0RGLAogICAgbyA9IHQuQ2lwaGVyID0gYy5leHRlbmQoewogICAgICAgIGNmZzogZi5leHRlbmQoKSwKICAgICAgICBjcmVhdGVFbmNyeXB0b3I6IGZ1bmN0aW9uKG4sIHQpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlKHRoaXMuX0VOQ19YRk9STV9NT0RFLCBuLCB0KQogICAgICAgIH0sCiAgICAgICAgY3JlYXRlRGVjcnlwdG9yOiBmdW5jdGlvbihuLCB0KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZSh0aGlzLl9ERUNfWEZPUk1fTU9ERSwgbiwgdCkKICAgICAgICB9LAogICAgICAgIGluaXQ6IGZ1bmN0aW9uKG4sIHQsIGkpIHsKICAgICAgICAgICAgdGhpcy5jZmcgPSB0aGlzLmNmZy5leHRlbmQoaSk7CiAgICAgICAgICAgIHRoaXMuX3hmb3JtTW9kZSA9IG47CiAgICAgICAgICAgIHRoaXMuX2tleSA9IHQ7CiAgICAgICAgICAgIHRoaXMucmVzZXQoKQogICAgICAgIH0sCiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBjLnJlc2V0LmNhbGwodGhpcyk7CiAgICAgICAgICAgIHRoaXMuX2RvUmVzZXQoKQogICAgICAgIH0sCiAgICAgICAgcHJvY2VzczogZnVuY3Rpb24obikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYXBwZW5kKG4pLAogICAgICAgICAgICB0aGlzLl9wcm9jZXNzKCkKICAgICAgICB9LAogICAgICAgIGZpbmFsaXplOiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIHJldHVybiBuICYmIHRoaXMuX2FwcGVuZChuKSwKICAgICAgICAgICAgdGhpcy5fZG9GaW5hbGl6ZSgpCiAgICAgICAgfSwKICAgICAgICBrZXlTaXplOiA0LAogICAgICAgIGl2U2l6ZTogNCwKICAgICAgICBfRU5DX1hGT1JNX01PREU6IDEsCiAgICAgICAgX0RFQ19YRk9STV9NT0RFOiAyLAogICAgICAgIF9jcmVhdGVIZWxwZXI6IGZ1bmN0aW9uKG4pIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGVuY3J5cHQ6IGZ1bmN0aW9uKHQsIGksIHIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKCJzdHJpbmciID09IHR5cGVvZiBpID8gdjogdSkuZW5jcnlwdChuLCB0LCBpLCByKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRlY3J5cHQ6IGZ1bmN0aW9uKHQsIGksIHIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKCJzdHJpbmciID09IHR5cGVvZiBpID8gdjogdSkuZGVjcnlwdChuLCB0LCBpLCByKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7CiAgICB0LlN0cmVhbUNpcGhlciA9IG8uZXh0ZW5kKHsKICAgICAgICBfZG9GaW5hbGl6ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcm9jZXNzKCEwKQogICAgICAgIH0sCiAgICAgICAgYmxvY2tTaXplOiAxCiAgICB9KTsKICAgIHZhciBzID0gaS5tb2RlID0ge30sCiAgICBhID0gZnVuY3Rpb24odCwgaSwgcikgewogICAgICAgIHZhciBmID0gdGhpcy5faXYsCiAgICAgICAgdTsKICAgICAgICBmb3IgKGYgPyB0aGlzLl9pdiA9IG46IGYgPSB0aGlzLl9wcmV2QmxvY2ssIHUgPSAwOyB1IDwgcjsgdSsrKSB0W2kgKyB1XSBePSBmW3VdCiAgICB9LAogICAgciA9ICh0LkJsb2NrQ2lwaGVyTW9kZSA9IGYuZXh0ZW5kKHsKICAgICAgICBjcmVhdGVFbmNyeXB0b3I6IGZ1bmN0aW9uKG4sIHQpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuRW5jcnlwdG9yLmNyZWF0ZShuLCB0KQogICAgICAgIH0sCiAgICAgICAgY3JlYXRlRGVjcnlwdG9yOiBmdW5jdGlvbihuLCB0KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkRlY3J5cHRvci5jcmVhdGUobiwgdCkKICAgICAgICB9LAogICAgICAgIGluaXQ6IGZ1bmN0aW9uKG4sIHQpIHsKICAgICAgICAgICAgdGhpcy5fY2lwaGVyID0gbjsKICAgICAgICAgICAgdGhpcy5faXYgPSB0CiAgICAgICAgfQogICAgfSkpLmV4dGVuZCgpOwogICAgci5FbmNyeXB0b3IgPSByLmV4dGVuZCh7CiAgICAgICAgcHJvY2Vzc0Jsb2NrOiBmdW5jdGlvbihuLCB0KSB7CiAgICAgICAgICAgIHZhciBpID0gdGhpcy5fY2lwaGVyLAogICAgICAgICAgICByID0gaS5ibG9ja1NpemU7CiAgICAgICAgICAgIGEuY2FsbCh0aGlzLCBuLCB0LCByKTsKICAgICAgICAgICAgaS5lbmNyeXB0QmxvY2sobiwgdCk7CiAgICAgICAgICAgIHRoaXMuX3ByZXZCbG9jayA9IG4uc2xpY2UodCwgdCArIHIpCiAgICAgICAgfQogICAgfSk7CiAgICByLkRlY3J5cHRvciA9IHIuZXh0ZW5kKHsKICAgICAgICBwcm9jZXNzQmxvY2s6IGZ1bmN0aW9uKG4sIHQpIHsKICAgICAgICAgICAgdmFyIGkgPSB0aGlzLl9jaXBoZXIsCiAgICAgICAgICAgIHIgPSBpLmJsb2NrU2l6ZSwKICAgICAgICAgICAgdSA9IG4uc2xpY2UodCwgdCArIHIpOwogICAgICAgICAgICBpLmRlY3J5cHRCbG9jayhuLCB0KTsKICAgICAgICAgICAgYS5jYWxsKHRoaXMsIG4sIHQsIHIpOwogICAgICAgICAgICB0aGlzLl9wcmV2QmxvY2sgPSB1CiAgICAgICAgfQogICAgfSk7CiAgICBzID0gcy5DQkMgPSByOwogICAgciA9IChpLnBhZCA9IHt9KS5Qa2NzNyA9IHsKICAgICAgICBwYWQ6IGZ1bmN0aW9uKG4sIHQpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDQgKiB0LAogICAgICAgICAgICBpID0gaSAtIG4uc2lnQnl0ZXMgJSBpLAogICAgICAgICAgICBmID0gaSA8PCAyNCB8IGkgPDwgMTYgfCBpIDw8IDggfCBpLAogICAgICAgICAgICByID0gW10sIHUgPSAwOyB1IDwgaTsgdSArPSA0KSByLnB1c2goZik7CiAgICAgICAgICAgIGkgPSBlLmNyZWF0ZShyLCBpKTsKICAgICAgICAgICAgbi5jb25jYXQoaSkKICAgICAgICB9LAogICAgICAgIHVucGFkOiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIG4uc2lnQnl0ZXMgLT0gbi53b3Jkc1tuLnNpZ0J5dGVzIC0gMSA+Pj4gMl0gJiAyNTUKICAgICAgICB9CiAgICB9OwogICAgdC5CbG9ja0NpcGhlciA9IG8uZXh0ZW5kKHsKICAgICAgICBjZmc6IG8uY2ZnLmV4dGVuZCh7CiAgICAgICAgICAgIG1vZGU6IHMsCiAgICAgICAgICAgIHBhZGRpbmc6IHIKICAgICAgICB9KSwKICAgICAgICByZXNldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciB0OwogICAgICAgICAgICBvLnJlc2V0LmNhbGwodGhpcyk7CiAgICAgICAgICAgIHZhciBuID0gdGhpcy5jZmcsCiAgICAgICAgICAgIGkgPSBuLml2LAogICAgICAgICAgICBuID0gbi5tb2RlOwogICAgICAgICAgICB0aGlzLl94Zm9ybU1vZGUgPT0gdGhpcy5fRU5DX1hGT1JNX01PREUgPyB0ID0gbi5jcmVhdGVFbmNyeXB0b3I6ICh0ID0gbi5jcmVhdGVEZWNyeXB0b3IsIHRoaXMuX21pbkJ1ZmZlclNpemUgPSAxKTsKICAgICAgICAgICAgdGhpcy5fbW9kZSA9IHQuY2FsbChuLCB0aGlzLCBpICYmIGkud29yZHMpCiAgICAgICAgfSwKICAgICAgICBfZG9Qcm9jZXNzQmxvY2s6IGZ1bmN0aW9uKG4sIHQpIHsKICAgICAgICAgICAgdGhpcy5fbW9kZS5wcm9jZXNzQmxvY2sobiwgdCkKICAgICAgICB9LAogICAgICAgIF9kb0ZpbmFsaXplOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLmNmZy5wYWRkaW5nLAogICAgICAgICAgICBuOwogICAgICAgICAgICByZXR1cm4gdGhpcy5feGZvcm1Nb2RlID09IHRoaXMuX0VOQ19YRk9STV9NT0RFID8gKHQucGFkKHRoaXMuX2RhdGEsIHRoaXMuYmxvY2tTaXplKSwgbiA9IHRoaXMuX3Byb2Nlc3MoITApKSA6IChuID0gdGhpcy5fcHJvY2VzcyghMCksIHQudW5wYWQobikpLAogICAgICAgICAgICBuCiAgICAgICAgfSwKICAgICAgICBibG9ja1NpemU6IDQKICAgIH0pOwogICAgdmFyIGggPSB0LkNpcGhlclBhcmFtcyA9IGYuZXh0ZW5kKHsKICAgICAgICBpbml0OiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIHRoaXMubWl4SW4obikKICAgICAgICB9LAogICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIHJldHVybiAobiB8fCB0aGlzLmZvcm1hdHRlcikuc3RyaW5naWZ5KHRoaXMpCiAgICAgICAgfQogICAgfSksCiAgICBzID0gKGkuZm9ybWF0ID0ge30pLk9wZW5TU0wgPSB7CiAgICAgICAgc3RyaW5naWZ5OiBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIHZhciB0ID0gbi5jaXBoZXJ0ZXh0OwogICAgICAgICAgICByZXR1cm4gbiA9IG4uc2FsdCwKICAgICAgICAgICAgKG4gPyBlLmNyZWF0ZShbMTM5ODg5MzY4NCwgMTcwMTA3NjgzMV0pLmNvbmNhdChuKS5jb25jYXQodCkgOiB0KS50b1N0cmluZyhsKQogICAgICAgIH0sCiAgICAgICAgcGFyc2U6IGZ1bmN0aW9uKG4pIHsKICAgICAgICAgICAgdmFyIHQsIGk7CiAgICAgICAgICAgIHJldHVybiBuID0gbC5wYXJzZShuKSwKICAgICAgICAgICAgdCA9IG4ud29yZHMsCiAgICAgICAgICAgIDEzOTg4OTM2ODQgPT0gdFswXSAmJiAxNzAxMDc2ODMxID09IHRbMV0gJiYgKGkgPSBlLmNyZWF0ZSh0LnNsaWNlKDIsIDQpKSwgdC5zcGxpY2UoMCwgNCksIG4uc2lnQnl0ZXMgLT0gMTYpLAogICAgICAgICAgICBoLmNyZWF0ZSh7CiAgICAgICAgICAgICAgICBjaXBoZXJ0ZXh0OiBuLAogICAgICAgICAgICAgICAgc2FsdDogaQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgIH0sCiAgICB1ID0gdC5TZXJpYWxpemFibGVDaXBoZXIgPSBmLmV4dGVuZCh7CiAgICAgICAgY2ZnOiBmLmV4dGVuZCh7CiAgICAgICAgICAgIGZvcm1hdDogcwogICAgICAgIH0pLAogICAgICAgIGVuY3J5cHQ6IGZ1bmN0aW9uKG4sIHQsIGksIHIpIHsKICAgICAgICAgICAgciA9IHRoaXMuY2ZnLmV4dGVuZChyKTsKICAgICAgICAgICAgdmFyIHUgPSBuLmNyZWF0ZUVuY3J5cHRvcihpLCByKTsKICAgICAgICAgICAgcmV0dXJuIHQgPSB1LmZpbmFsaXplKHQpLAogICAgICAgICAgICB1ID0gdS5jZmcsCiAgICAgICAgICAgIGguY3JlYXRlKHsKICAgICAgICAgICAgICAgIGNpcGhlcnRleHQ6IHQsCiAgICAgICAgICAgICAgICBrZXk6IGksCiAgICAgICAgICAgICAgICBpdjogdS5pdiwKICAgICAgICAgICAgICAgIGFsZ29yaXRobTogbiwKICAgICAgICAgICAgICAgIG1vZGU6IHUubW9kZSwKICAgICAgICAgICAgICAgIHBhZGRpbmc6IHUucGFkZGluZywKICAgICAgICAgICAgICAgIGJsb2NrU2l6ZTogbi5ibG9ja1NpemUsCiAgICAgICAgICAgICAgICBmb3JtYXR0ZXI6IHIuZm9ybWF0CiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBkZWNyeXB0OiBmdW5jdGlvbihuLCB0LCBpLCByKSB7CiAgICAgICAgICAgIHJldHVybiByID0gdGhpcy5jZmcuZXh0ZW5kKHIpLAogICAgICAgICAgICB0ID0gdGhpcy5fcGFyc2UodCwgci5mb3JtYXQpLAogICAgICAgICAgICBuLmNyZWF0ZURlY3J5cHRvcihpLCByKS5maW5hbGl6ZSh0LmNpcGhlcnRleHQpCiAgICAgICAgfSwKICAgICAgICBfcGFyc2U6IGZ1bmN0aW9uKG4sIHQpIHsKICAgICAgICAgICAgcmV0dXJuICJzdHJpbmciID09IHR5cGVvZiBuID8gdC5wYXJzZShuLCB0aGlzKSA6IG4KICAgICAgICB9CiAgICB9KSwKICAgIGkgPSAoaS5rZGYgPSB7fSkuT3BlblNTTCA9IHsKICAgICAgICBleGVjdXRlOiBmdW5jdGlvbihuLCB0LCBpLCByKSB7CiAgICAgICAgICAgIHJldHVybiByIHx8IChyID0gZS5yYW5kb20oOCkpLAogICAgICAgICAgICBuID0geS5jcmVhdGUoewogICAgICAgICAgICAgICAga2V5U2l6ZTogdCArIGkKICAgICAgICAgICAgfSkuY29tcHV0ZShuLCByKSwKICAgICAgICAgICAgaSA9IGUuY3JlYXRlKG4ud29yZHMuc2xpY2UodCksIDQgKiBpKSwKICAgICAgICAgICAgbi5zaWdCeXRlcyA9IDQgKiB0LAogICAgICAgICAgICBoLmNyZWF0ZSh7CiAgICAgICAgICAgICAgICBrZXk6IG4sCiAgICAgICAgICAgICAgICBpdjogaSwKICAgICAgICAgICAgICAgIHNhbHQ6IHIKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICB9LAogICAgdiA9IHQuUGFzc3dvcmRCYXNlZENpcGhlciA9IHUuZXh0ZW5kKHsKICAgICAgICBjZmc6IHUuY2ZnLmV4dGVuZCh7CiAgICAgICAgICAgIGtkZjogaQogICAgICAgIH0pLAogICAgICAgIGVuY3J5cHQ6IGZ1bmN0aW9uKG4sIHQsIGksIHIpIHsKICAgICAgICAgICAgcmV0dXJuIHIgPSB0aGlzLmNmZy5leHRlbmQociksCiAgICAgICAgICAgIGkgPSByLmtkZi5leGVjdXRlKGksIG4ua2V5U2l6ZSwgbi5pdlNpemUpLAogICAgICAgICAgICByLml2ID0gaS5pdiwKICAgICAgICAgICAgbiA9IHUuZW5jcnlwdC5jYWxsKHRoaXMsIG4sIHQsIGkua2V5LCByKSwKICAgICAgICAgICAgbi5taXhJbihpKSwKICAgICAgICAgICAgbgogICAgICAgIH0sCiAgICAgICAgZGVjcnlwdDogZnVuY3Rpb24obiwgdCwgaSwgcikgewogICAgICAgICAgICByZXR1cm4gciA9IHRoaXMuY2ZnLmV4dGVuZChyKSwKICAgICAgICAgICAgdCA9IHRoaXMuX3BhcnNlKHQsIHIuZm9ybWF0KSwKICAgICAgICAgICAgaSA9IHIua2RmLmV4ZWN1dGUoaSwgbi5rZXlTaXplLCBuLml2U2l6ZSwgdC5zYWx0KSwKICAgICAgICAgICAgci5pdiA9IGkuaXYsCiAgICAgICAgICAgIHUuZGVjcnlwdC5jYWxsKHRoaXMsIG4sIHQsIGkua2V5LCByKQogICAgICAgIH0KICAgIH0pCn0gKCksCmZ1bmN0aW9uKCkgewogICAgZm9yICh2YXIgaSwgdHQsIHMgPSBDcnlwdG9KUywKICAgIHkgPSBzLmxpYi5CbG9ja0NpcGhlciwKICAgIGggPSBzLmFsZ28sCiAgICB0ID0gW10sIHAgPSBbXSwgdyA9IFtdLCBiID0gW10sIGsgPSBbXSwgZCA9IFtdLCBjID0gW10sIGwgPSBbXSwgYSA9IFtdLCB2ID0gW10sIHUgPSBbXSwgZiA9IDA7IDI1NiA+IGY7IGYrKykgdVtmXSA9IDEyOCA+IGYgPyBmIDw8IDEgOiBmIDw8IDEgXiAyODM7CiAgICBmb3IgKHZhciByID0gMCwKICAgIGUgPSAwLAogICAgZiA9IDA7IDI1NiA+IGY7IGYrKykgewogICAgICAgIGkgPSBlIF4gZSA8PCAxIF4gZSA8PCAyIF4gZSA8PCAzIF4gZSA8PCA0OwogICAgICAgIGkgPSBpID4+PiA4IF4gaSAmIDI1NSBeIDk5OwogICAgICAgIHRbcl0gPSBpOwogICAgICAgIHBbaV0gPSByOwogICAgICAgIHZhciBvID0gdVtyXSwKICAgICAgICBnID0gdVtvXSwKICAgICAgICBudCA9IHVbZ10sCiAgICAgICAgbiA9IDI1NyAqIHVbaV0gXiAxNjg0MzAwOCAqIGk7CiAgICAgICAgd1tyXSA9IG4gPDwgMjQgfCBuID4+PiA4OwogICAgICAgIGJbcl0gPSBuIDw8IDE2IHwgbiA+Pj4gMTY7CiAgICAgICAga1tyXSA9IG4gPDwgOCB8IG4gPj4+IDI0OwogICAgICAgIGRbcl0gPSBuOwogICAgICAgIG4gPSAxNjg0MzAwOSAqIG50IF4gNjU1MzcgKiBnIF4gMjU3ICogbyBeIDE2ODQzMDA4ICogcjsKICAgICAgICBjW2ldID0gbiA8PCAyNCB8IG4gPj4+IDg7CiAgICAgICAgbFtpXSA9IG4gPDwgMTYgfCBuID4+PiAxNjsKICAgICAgICBhW2ldID0gbiA8PCA4IHwgbiA+Pj4gMjQ7CiAgICAgICAgdltpXSA9IG47CiAgICAgICAgciA/IChyID0gbyBeIHVbdVt1W250IF4gb11dXSwgZSBePSB1W3VbZV1dKSA6IHIgPSBlID0gMQogICAgfQogICAgdHQgPSBbMCwgMSwgMiwgNCwgOCwgMTYsIDMyLCA2NCwgMTI4LCAyNywgNTRdOwogICAgaCA9IGguQUVTID0geS5leHRlbmQoewogICAgICAgIF9kb1Jlc2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZm9yICh2YXIgbiwgZiA9IHRoaXMuX2tleSwKICAgICAgICAgICAgZSA9IGYud29yZHMsCiAgICAgICAgICAgIHIgPSBmLnNpZ0J5dGVzIC8gNCwKICAgICAgICAgICAgZiA9IDQgKiAoKHRoaXMuX25Sb3VuZHMgPSByICsgNikgKyAxKSwgdSA9IHRoaXMuX2tleVNjaGVkdWxlID0gW10sIGkgPSAwOyBpIDwgZjsgaSsrKSBpIDwgciA/IHVbaV0gPSBlW2ldIDogKG4gPSB1W2kgLSAxXSwgaSAlIHIgPyA2IDwgciAmJiA0ID09IGkgJSByICYmIChuID0gdFtuID4+PiAyNF0gPDwgMjQgfCB0W24gPj4+IDE2ICYgMjU1XSA8PCAxNiB8IHRbbiA+Pj4gOCAmIDI1NV0gPDwgOCB8IHRbbiAmIDI1NV0pIDogKG4gPSBuIDw8IDggfCBuID4+PiAyNCwgbiA9IHRbbiA+Pj4gMjRdIDw8IDI0IHwgdFtuID4+PiAxNiAmIDI1NV0gPDwgMTYgfCB0W24gPj4+IDggJiAyNTVdIDw8IDggfCB0W24gJiAyNTVdLCBuIF49IHR0W2kgLyByIHwgMF0gPDwgMjQpLCB1W2ldID0gdVtpIC0gcl0gXiBuKTsKICAgICAgICAgICAgZm9yIChlID0gdGhpcy5faW52S2V5U2NoZWR1bGUgPSBbXSwgciA9IDA7IHIgPCBmOyByKyspIGkgPSBmIC0gciwKICAgICAgICAgICAgbiA9IHIgJSA0ID8gdVtpXSA6IHVbaSAtIDRdLAogICAgICAgICAgICBlW3JdID0gNCA+IHIgfHwgNCA+PSBpID8gbjogY1t0W24gPj4+IDI0XV0gXiBsW3RbbiA+Pj4gMTYgJiAyNTVdXSBeIGFbdFtuID4+PiA4ICYgMjU1XV0gXiB2W3RbbiAmIDI1NV1dCiAgICAgICAgfSwKICAgICAgICBlbmNyeXB0QmxvY2s6IGZ1bmN0aW9uKG4sIGkpIHsKICAgICAgICAgICAgdGhpcy5fZG9DcnlwdEJsb2NrKG4sIGksIHRoaXMuX2tleVNjaGVkdWxlLCB3LCBiLCBrLCBkLCB0KQogICAgICAgIH0sCiAgICAgICAgZGVjcnlwdEJsb2NrOiBmdW5jdGlvbihuLCB0KSB7CiAgICAgICAgICAgIHZhciBpID0gblt0ICsgMV07CiAgICAgICAgICAgIG5bdCArIDFdID0gblt0ICsgM107CiAgICAgICAgICAgIG5bdCArIDNdID0gaTsKICAgICAgICAgICAgdGhpcy5fZG9DcnlwdEJsb2NrKG4sIHQsIHRoaXMuX2ludktleVNjaGVkdWxlLCBjLCBsLCBhLCB2LCBwKTsKICAgICAgICAgICAgaSA9IG5bdCArIDFdOwogICAgICAgICAgICBuW3QgKyAxXSA9IG5bdCArIDNdOwogICAgICAgICAgICBuW3QgKyAzXSA9IGkKICAgICAgICB9LAogICAgICAgIF9kb0NyeXB0QmxvY2s6IGZ1bmN0aW9uKG4sIHQsIGksIHIsIHUsIGYsIGUsIG8pIHsKICAgICAgICAgICAgZm9yICh2YXIgYiA9IHRoaXMuX25Sb3VuZHMsCiAgICAgICAgICAgIGggPSBuW3RdIF4gaVswXSwgYyA9IG5bdCArIDFdIF4gaVsxXSwgbCA9IG5bdCArIDJdIF4gaVsyXSwgcyA9IG5bdCArIDNdIF4gaVszXSwgYSA9IDQsIHcgPSAxOyB3IDwgYjsgdysrKSB2YXIgdiA9IHJbaCA+Pj4gMjRdIF4gdVtjID4+PiAxNiAmIDI1NV0gXiBmW2wgPj4+IDggJiAyNTVdIF4gZVtzICYgMjU1XSBeIGlbYSsrXSwKICAgICAgICAgICAgeSA9IHJbYyA+Pj4gMjRdIF4gdVtsID4+PiAxNiAmIDI1NV0gXiBmW3MgPj4+IDggJiAyNTVdIF4gZVtoICYgMjU1XSBeIGlbYSsrXSwKICAgICAgICAgICAgcCA9IHJbbCA+Pj4gMjRdIF4gdVtzID4+PiAxNiAmIDI1NV0gXiBmW2ggPj4+IDggJiAyNTVdIF4gZVtjICYgMjU1XSBeIGlbYSsrXSwKICAgICAgICAgICAgcyA9IHJbcyA+Pj4gMjRdIF4gdVtoID4+PiAxNiAmIDI1NV0gXiBmW2MgPj4+IDggJiAyNTVdIF4gZVtsICYgMjU1XSBeIGlbYSsrXSwKICAgICAgICAgICAgaCA9IHYsCiAgICAgICAgICAgIGMgPSB5LAogICAgICAgICAgICBsID0gcDsKICAgICAgICAgICAgdiA9IChvW2ggPj4+IDI0XSA8PCAyNCB8IG9bYyA+Pj4gMTYgJiAyNTVdIDw8IDE2IHwgb1tsID4+PiA4ICYgMjU1XSA8PCA4IHwgb1tzICYgMjU1XSkgXiBpW2ErK107CiAgICAgICAgICAgIHkgPSAob1tjID4+PiAyNF0gPDwgMjQgfCBvW2wgPj4+IDE2ICYgMjU1XSA8PCAxNiB8IG9bcyA+Pj4gOCAmIDI1NV0gPDwgOCB8IG9baCAmIDI1NV0pIF4gaVthKytdOwogICAgICAgICAgICBwID0gKG9bbCA+Pj4gMjRdIDw8IDI0IHwgb1tzID4+PiAxNiAmIDI1NV0gPDwgMTYgfCBvW2ggPj4+IDggJiAyNTVdIDw8IDggfCBvW2MgJiAyNTVdKSBeIGlbYSsrXTsKICAgICAgICAgICAgcyA9IChvW3MgPj4+IDI0XSA8PCAyNCB8IG9baCA+Pj4gMTYgJiAyNTVdIDw8IDE2IHwgb1tjID4+PiA4ICYgMjU1XSA8PCA4IHwgb1tsICYgMjU1XSkgXiBpW2ErK107CiAgICAgICAgICAgIG5bdF0gPSB2OwogICAgICAgICAgICBuW3QgKyAxXSA9IHk7CiAgICAgICAgICAgIG5bdCArIDJdID0gcDsKICAgICAgICAgICAgblt0ICsgM10gPSBzCiAgICAgICAgfSwKICAgICAgICBrZXlTaXplOiA4CiAgICB9KTsKICAgIHMuQUVTID0geS5fY3JlYXRlSGVscGVyKGgpCn0gKCk7CmZ1bmN0aW9uIHZhbEFlc0VuY3J5cHRTZXQoaSkgewogICAgdmFyIG4sdCxyOwogICAgdHJ5IHsKICAgICAgICBuID0gYWVzRGVjcnlwdChpKTsKICAgICAgICBuICE9ICIiICYmICh0ID0gYWVzRW5jcnlwdChuKSwgdCAhPSBpICYmIChuID0gIiIpKQogICAgfSBjYXRjaChyKSB7CiAgICAgICAgbiA9ICIiCiAgICB9CiAgICByZXR1cm4gbiA9PSAiIiAmJiAodCA9IGFlc0VuY3J5cHQoaSkpOwp9OwpmdW5jdGlvbiBhZXNEZWNyeXB0KG4pIHsKICAgIHZhciB0ID0gQ3J5cHRvSlMuTUQ1KCJsb2dpbi4xODkuY24iKSwKICAgIGkgPSBDcnlwdG9KUy5lbmMuVXRmOC5wYXJzZSh0KSwKICAgIHIgPSBDcnlwdG9KUy5lbmMuVXRmOC5wYXJzZSgiMTIzNDU2NzgxMjM0NTY3OCIpOwogICAgcmV0dXJuIENyeXB0b0pTLkFFUy5kZWNyeXB0KG4sIGksIHsKICAgICAgICBpdjogcgogICAgfSkudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLlV0ZjgpCn07CmZ1bmN0aW9uIGFlc0VuY3J5cHQobikgewogICAgdmFyIHQgPSBDcnlwdG9KUy5NRDUoImxvZ2luLjE4OS5jbiIpLAogICAgaSA9IENyeXB0b0pTLmVuYy5VdGY4LnBhcnNlKHQpLAogICAgciA9IENyeXB0b0pTLmVuYy5VdGY4LnBhcnNlKCIxMjM0NTY3ODEyMzQ1Njc4IiksCiAgICB1ID0gQ3J5cHRvSlMuQUVTLmVuY3J5cHQobiwgaSwgewogICAgICAgIGl2OiByCiAgICB9KTsKICAgIHJldHVybiB1ICsgIiIKfTs=";
    private static final String javaScript2     = "Ly8gQmlnSW50LCBhIHN1aXRlIG9mIHJvdXRpbmVzIGZvciBwZXJmb3JtaW5nIG11bHRpcGxlLXByZWNpc2lvbiBhcml0aG1ldGljIGluDQovLyBKYXZhU2NyaXB0Lg0KLy8NCi8vIENvcHlyaWdodCAxOTk4LTIwMDUgRGF2aWQgU2hhcGlyby4NCi8vDQovLyBZb3UgbWF5IHVzZSwgcmUtdXNlLCBhYnVzZSwNCi8vIGNvcHksIGFuZCBtb2RpZnkgdGhpcyBjb2RlIHRvIHlvdXIgbGlraW5nLCBidXQgcGxlYXNlIGtlZXAgdGhpcyBoZWFkZXIuDQovLyBUaGFua3MhDQovLw0KLy8gRGF2ZSBTaGFwaXJvDQovLyBkYXZlQG9oZGF2ZS5jb20NCg0KLy8gSU1QT1JUQU5UIFRISU5HOiBCZSBzdXJlIHRvIHNldCBtYXhEaWdpdHMgYWNjb3JkaW5nIHRvIHlvdXIgcHJlY2lzaW9uDQovLyBuZWVkcy4gVXNlIHRoZSBzZXRNYXhEaWdpdHMoKSBmdW5jdGlvbiB0byBkbyB0aGlzLiBTZWUgY29tbWVudHMgYmVsb3cuDQovLw0KLy8gVHdlYWtlZCBieSBJYW4gQnVubmluZw0KLy8gQWx0ZXJhdGlvbnM6DQovLyBGaXggYnVnIGluIGZ1bmN0aW9uIGJpRnJvbUhleChzKSB0byBhbGxvdw0KLy8gcGFyc2luZyBvZiBzdHJpbmdzIG9mIGxlbmd0aCAhPSAwIChtb2QgNCkNCg0KLy8gQ2hhbmdlcyBtYWRlIGJ5IERhdmUgU2hhcGlybyBhcyBvZiAxMi8zMC8yMDA0Og0KLy8NCi8vIFRoZSBCaWdJbnQoKSBjb25zdHJ1Y3RvciBkb2Vzbid0IHRha2UgYSBzdHJpbmcgYW55bW9yZS4gSWYgeW91IHdhbnQgdG8NCi8vIGNyZWF0ZSBhIEJpZ0ludCBmcm9tIGEgc3RyaW5nLCB1c2UgYmlGcm9tRGVjaW1hbCgpIGZvciBiYXNlLTEwDQovLyByZXByZXNlbnRhdGlvbnMsIGJpRnJvbUhleCgpIGZvciBiYXNlLTE2IHJlcHJlc2VudGF0aW9ucywgb3INCi8vIGJpRnJvbVN0cmluZygpIGZvciBiYXNlLTItdG8tMzYgcmVwcmVzZW50YXRpb25zLg0KLy8NCi8vIGJpRnJvbUFycmF5KCkgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIGJpQ29weSgpIGluc3RlYWQsIHBhc3NpbmcgYSBCaWdJbnQNCi8vIGluc3RlYWQgb2YgYW4gYXJyYXkuDQovLw0KLy8gVGhlIEJpZ0ludCgpIGNvbnN0cnVjdG9yIG5vdyBvbmx5IGNvbnN0cnVjdHMgYSB6ZXJvZWQtb3V0IGFycmF5Lg0KLy8gQWx0ZXJuYXRpdmVseSwgaWYgeW91IHBhc3MgPHRydWU+LCBpdCB3b24ndCBjb25zdHJ1Y3QgYW55IGFycmF5LiBTZWUgdGhlDQovLyBiaUNvcHkoKSBtZXRob2QgZm9yIGFuIGV4YW1wbGUgb2YgdGhpcy4NCi8vDQovLyBCZSBzdXJlIHRvIHNldCBtYXhEaWdpdHMgZGVwZW5kaW5nIG9uIHlvdXIgcHJlY2lzaW9uIG5lZWRzLiBUaGUgZGVmYXVsdA0KLy8gemVyb2VkLW91dCBhcnJheSBaRVJPX0FSUkFZIGlzIGNvbnN0cnVjdGVkIGluc2lkZSB0aGUgc2V0TWF4RGlnaXRzKCkNCi8vIGZ1bmN0aW9uLiBTbyB1c2UgdGhpcyBmdW5jdGlvbiB0byBzZXQgdGhlIHZhcmlhYmxlLiBET04nVCBKVVNUIFNFVCBUSEUNCi8vIFZBTFVFLiBVU0UgVEhFIEZVTkNUSU9OLg0KLy8NCi8vIFpFUk9fQVJSQVkgZXhpc3RzIHRvIGhvcGVmdWxseSBzcGVlZCB1cCBjb25zdHJ1Y3Rpb24gb2YgQmlnSW50cygpLiBCeQ0KLy8gcHJlY2FsY3VsYXRpbmcgdGhlIHplcm8gYXJyYXksIHdlIGNhbiBqdXN0IHVzZSBzbGljZSgwKSB0byBtYWtlIGNvcGllcyBvZg0KLy8gaXQuIFByZXN1bWFibHkgdGhpcyBjYWxscyBmYXN0ZXIgbmF0aXZlIGNvZGUsIGFzIG9wcG9zZWQgdG8gc2V0dGluZyB0aGUNCi8vIGVsZW1lbnRzIG9uZSBhdCBhIHRpbWUuIEkgaGF2ZSBub3QgZG9uZSBhbnkgdGltaW5nIHRlc3RzIHRvIHZlcmlmeSB0aGlzDQovLyBjbGFpbS4NCg0KLy8gTWF4IG51bWJlciA9IDEwXjE2IC0gMiA9IDk5OTk5OTk5OTk5OTk5OTg7DQovLyAgICAgICAgICAgICAgIDJeNTMgICAgID0gOTAwNzE5OTI1NDc0MDk5MjsNCg0KdmFyIGJpUmFkaXhCYXNlID0gMjsNCnZhciBiaVJhZGl4Qml0cyA9IDE2Ow0KdmFyIGJpdHNQZXJEaWdpdCA9IGJpUmFkaXhCaXRzOw0KdmFyIGJpUmFkaXggPSAxIDw8IDE2OyAvLyA9IDJeMTYgPSA2NTUzNg0KdmFyIGJpSGFsZlJhZGl4ID0gYmlSYWRpeCA+Pj4gMTsNCnZhciBiaVJhZGl4U3F1YXJlZCA9IGJpUmFkaXggKiBiaVJhZGl4Ow0KdmFyIG1heERpZ2l0VmFsID0gYmlSYWRpeCAtIDE7DQp2YXIgbWF4SW50ZWdlciA9IDk5OTk5OTk5OTk5OTk5OTg7IA0KDQovLyBtYXhEaWdpdHM6DQovLyBDaGFuZ2UgdGhpcyB0byBhY2NvbW1vZGF0ZSB5b3VyIGxhcmdlc3QgbnVtYmVyIHNpemUuIFVzZSBzZXRNYXhEaWdpdHMoKQ0KLy8gdG8gY2hhbmdlIGl0IQ0KLy8NCi8vIEluIGdlbmVyYWwsIGlmIHlvdSdyZSB3b3JraW5nIHdpdGggbnVtYmVycyBvZiBzaXplIE4gYml0cywgeW91J2xsIG5lZWQgMipODQovLyBiaXRzIG9mIHN0b3JhZ2UuIEVhY2ggZGlnaXQgaG9sZHMgMTYgYml0cy4gU28sIGEgMTAyNC1iaXQga2V5IHdpbGwgbmVlZA0KLy8NCi8vIDEwMjQgKiAyIC8gMTYgPSAxMjggZGlnaXRzIG9mIHN0b3JhZ2UuDQovLw0KDQp2YXIgbWF4RGlnaXRzOw0KdmFyIFpFUk9fQVJSQVk7DQp2YXIgYmlnWmVybywgYmlnT25lOw0KDQpmdW5jdGlvbiBzZXRNYXhEaWdpdHModmFsdWUpDQp7DQoJbWF4RGlnaXRzID0gdmFsdWU7DQoJWkVST19BUlJBWSA9IG5ldyBBcnJheShtYXhEaWdpdHMpOw0KCWZvciAodmFyIGl6YSA9IDA7IGl6YSA8IFpFUk9fQVJSQVkubGVuZ3RoOyBpemErKykgWkVST19BUlJBWVtpemFdID0gMDsNCgliaWdaZXJvID0gbmV3IEJpZ0ludCgpOw0KCWJpZ09uZSA9IG5ldyBCaWdJbnQoKTsNCgliaWdPbmUuZGlnaXRzWzBdID0gMTsNCn0NCg0Kc2V0TWF4RGlnaXRzKDEyOSk7DQoNCi8vIFRoZSBtYXhpbXVtIG51bWJlciBvZiBkaWdpdHMgaW4gYmFzZSAxMCB5b3UgY2FuIGNvbnZlcnQgdG8gYW4NCi8vIGludGVnZXIgd2l0aG91dCBKYXZhU2NyaXB0IHRocm93aW5nIHVwIG9uIHlvdS4NCnZhciBkcGwxMCA9IDE1Ow0KLy8gbHIxMCA9IDEwIF4gZHBsMTANCnZhciBscjEwID0gYmlGcm9tTnVtYmVyKDEwMDAwMDAwMDAwMDAwMDApOw0KDQpmdW5jdGlvbiBCaWdJbnQoZmxhZykNCnsNCglpZiAodHlwZW9mIGZsYWcgPT0gImJvb2xlYW4iICYmIGZsYWcgPT0gdHJ1ZSkgew0KCQl0aGlzLmRpZ2l0cyA9IG51bGw7DQoJfQ0KCWVsc2Ugew0KCQl0aGlzLmRpZ2l0cyA9IFpFUk9fQVJSQVkuc2xpY2UoMCk7DQoJfQ0KCXRoaXMuaXNOZWcgPSBmYWxzZTsNCn0NCg0KZnVuY3Rpb24gYmlGcm9tRGVjaW1hbChzKQ0Kew0KCXZhciBpc05lZyA9IHMuY2hhckF0KDApID09ICctJzsNCgl2YXIgaSA9IGlzTmVnID8gMSA6IDA7DQoJdmFyIHJlc3VsdDsNCgkvLyBTa2lwIGxlYWRpbmcgemVyb3MuDQoJd2hpbGUgKGkgPCBzLmxlbmd0aCAmJiBzLmNoYXJBdChpKSA9PSAnMCcpICsraTsNCglpZiAoaSA9PSBzLmxlbmd0aCkgew0KCQlyZXN1bHQgPSBuZXcgQmlnSW50KCk7DQoJfQ0KCWVsc2Ugew0KCQl2YXIgZGlnaXRDb3VudCA9IHMubGVuZ3RoIC0gaTsNCgkJdmFyIGZnbCA9IGRpZ2l0Q291bnQgJSBkcGwxMDsNCgkJaWYgKGZnbCA9PSAwKSBmZ2wgPSBkcGwxMDsNCgkJcmVzdWx0ID0gYmlGcm9tTnVtYmVyKE51bWJlcihzLnN1YnN0cihpLCBmZ2wpKSk7DQoJCWkgKz0gZmdsOw0KCQl3aGlsZSAoaSA8IHMubGVuZ3RoKSB7DQoJCQlyZXN1bHQgPSBiaUFkZChiaU11bHRpcGx5KHJlc3VsdCwgbHIxMCksDQoJCQkgICAgICAgICAgICAgICBiaUZyb21OdW1iZXIoTnVtYmVyKHMuc3Vic3RyKGksIGRwbDEwKSkpKTsNCgkJCWkgKz0gZHBsMTA7DQoJCX0NCgkJcmVzdWx0LmlzTmVnID0gaXNOZWc7DQoJfQ0KCXJldHVybiByZXN1bHQ7DQp9DQoNCmZ1bmN0aW9uIGJpQ29weShiaSkNCnsNCgl2YXIgcmVzdWx0ID0gbmV3IEJpZ0ludCh0cnVlKTsNCglyZXN1bHQuZGlnaXRzID0gYmkuZGlnaXRzLnNsaWNlKDApOw0KCXJlc3VsdC5pc05lZyA9IGJpLmlzTmVnOw0KCXJldHVybiByZXN1bHQ7DQp9DQoNCmZ1bmN0aW9uIGJpRnJvbU51bWJlcihpKQ0Kew0KCXZhciByZXN1bHQgPSBuZXcgQmlnSW50KCk7DQoJcmVzdWx0LmlzTmVnID0gaSA8IDA7DQoJaSA9IE1hdGguYWJzKGkpOw0KCXZhciBqID0gMDsNCgl3aGlsZSAoaSA+IDApIHsNCgkJcmVzdWx0LmRpZ2l0c1tqKytdID0gaSAmIG1heERpZ2l0VmFsOw0KCQlpID0gTWF0aC5mbG9vcihpIC8gYmlSYWRpeCk7DQoJfQ0KCXJldHVybiByZXN1bHQ7DQp9DQoNCmZ1bmN0aW9uIHJldmVyc2VTdHIocykNCnsNCgl2YXIgcmVzdWx0ID0gIiI7DQoJZm9yICh2YXIgaSA9IHMubGVuZ3RoIC0gMTsgaSA+IC0xOyAtLWkpIHsNCgkJcmVzdWx0ICs9IHMuY2hhckF0KGkpOw0KCX0NCglyZXR1cm4gcmVzdWx0Ow0KfQ0KDQp2YXIgaGV4YXRyaWdlc2ltYWxUb0NoYXIgPSBuZXcgQXJyYXkoDQogJzAnLCAnMScsICcyJywgJzMnLCAnNCcsICc1JywgJzYnLCAnNycsICc4JywgJzknLA0KICdhJywgJ2InLCAnYycsICdkJywgJ2UnLCAnZicsICdnJywgJ2gnLCAnaScsICdqJywNCiAnaycsICdsJywgJ20nLCAnbicsICdvJywgJ3AnLCAncScsICdyJywgJ3MnLCAndCcsDQogJ3UnLCAndicsICd3JywgJ3gnLCAneScsICd6Jw0KKTsNCg0KZnVuY3Rpb24gYmlUb1N0cmluZyh4LCByYWRpeCkNCgkvLyAyIDw9IHJhZGl4IDw9IDM2DQp7DQoJdmFyIGIgPSBuZXcgQmlnSW50KCk7DQoJYi5kaWdpdHNbMF0gPSByYWRpeDsNCgl2YXIgcXIgPSBiaURpdmlkZU1vZHVsbyh4LCBiKTsNCgl2YXIgcmVzdWx0ID0gaGV4YXRyaWdlc2ltYWxUb0NoYXJbcXJbMV0uZGlnaXRzWzBdXTsNCgl3aGlsZSAoYmlDb21wYXJlKHFyWzBdLCBiaWdaZXJvKSA9PSAxKSB7DQoJCXFyID0gYmlEaXZpZGVNb2R1bG8ocXJbMF0sIGIpOw0KCQlkaWdpdCA9IHFyWzFdLmRpZ2l0c1swXTsNCgkJcmVzdWx0ICs9IGhleGF0cmlnZXNpbWFsVG9DaGFyW3FyWzFdLmRpZ2l0c1swXV07DQoJfQ0KCXJldHVybiAoeC5pc05lZyA/ICItIiA6ICIiKSArIHJldmVyc2VTdHIocmVzdWx0KTsNCn0NCg0KZnVuY3Rpb24gYmlUb0RlY2ltYWwoeCkNCnsNCgl2YXIgYiA9IG5ldyBCaWdJbnQoKTsNCgliLmRpZ2l0c1swXSA9IDEwOw0KCXZhciBxciA9IGJpRGl2aWRlTW9kdWxvKHgsIGIpOw0KCXZhciByZXN1bHQgPSBTdHJpbmcocXJbMV0uZGlnaXRzWzBdKTsNCgl3aGlsZSAoYmlDb21wYXJlKHFyWzBdLCBiaWdaZXJvKSA9PSAxKSB7DQoJCXFyID0gYmlEaXZpZGVNb2R1bG8ocXJbMF0sIGIpOw0KCQlyZXN1bHQgKz0gU3RyaW5nKHFyWzFdLmRpZ2l0c1swXSk7DQoJfQ0KCXJldHVybiAoeC5pc05lZyA/ICItIiA6ICIiKSArIHJldmVyc2VTdHIocmVzdWx0KTsNCn0NCg0KdmFyIGhleFRvQ2hhciA9IG5ldyBBcnJheSgnMCcsICcxJywgJzInLCAnMycsICc0JywgJzUnLCAnNicsICc3JywgJzgnLCAnOScsDQogICAgICAgICAgICAgICAgICAgICAgICAgICdhJywgJ2InLCAnYycsICdkJywgJ2UnLCAnZicpOw0KDQpmdW5jdGlvbiBkaWdpdFRvSGV4KG4pDQp7DQoJdmFyIG1hc2sgPSAweGY7DQoJdmFyIHJlc3VsdCA9ICIiOw0KCWZvciAoaSA9IDA7IGkgPCA0OyArK2kpIHsNCgkJcmVzdWx0ICs9IGhleFRvQ2hhcltuICYgbWFza107DQoJCW4gPj4+PSA0Ow0KCX0NCglyZXR1cm4gcmV2ZXJzZVN0cihyZXN1bHQpOw0KfQ0KDQpmdW5jdGlvbiBiaVRvSGV4KHgpDQp7DQoJdmFyIHJlc3VsdCA9ICIiOw0KCXZhciBuID0gYmlIaWdoSW5kZXgoeCk7DQoJZm9yICh2YXIgaSA9IGJpSGlnaEluZGV4KHgpOyBpID4gLTE7IC0taSkgew0KCQlyZXN1bHQgKz0gZGlnaXRUb0hleCh4LmRpZ2l0c1tpXSk7DQoJfQ0KCXJldHVybiByZXN1bHQ7DQp9DQoNCmZ1bmN0aW9uIGNoYXJUb0hleChjKQ0Kew0KCXZhciBaRVJPID0gNDg7DQoJdmFyIE5JTkUgPSBaRVJPICsgOTsNCgl2YXIgbGl0dGxlQSA9IDk3Ow0KCXZhciBsaXR0bGVaID0gbGl0dGxlQSArIDI1Ow0KCXZhciBiaWdBID0gNjU7DQoJdmFyIGJpZ1ogPSA2NSArIDI1Ow0KCXZhciByZXN1bHQ7DQoNCglpZiAoYyA+PSBaRVJPICYmIGMgPD0gTklORSkgew0KCQlyZXN1bHQgPSBjIC0gWkVSTzsNCgl9IGVsc2UgaWYgKGMgPj0gYmlnQSAmJiBjIDw9IGJpZ1opIHsNCgkJcmVzdWx0ID0gMTAgKyBjIC0gYmlnQTsNCgl9IGVsc2UgaWYgKGMgPj0gbGl0dGxlQSAmJiBjIDw9IGxpdHRsZVopIHsNCgkJcmVzdWx0ID0gMTAgKyBjIC0gbGl0dGxlQTsNCgl9IGVsc2Ugew0KCQlyZXN1bHQgPSAwOw0KCX0NCglyZXR1cm4gcmVzdWx0Ow0KfQ0KDQpmdW5jdGlvbiBoZXhUb0RpZ2l0KHMpDQp7DQoJdmFyIHJlc3VsdCA9IDA7DQoJdmFyIHNsID0gTWF0aC5taW4ocy5sZW5ndGgsIDQpOw0KCWZvciAodmFyIGkgPSAwOyBpIDwgc2w7ICsraSkgew0KCQlyZXN1bHQgPDw9IDQ7DQoJCXJlc3VsdCB8PSBjaGFyVG9IZXgocy5jaGFyQ29kZUF0KGkpKQ0KCX0NCglyZXR1cm4gcmVzdWx0Ow0KfQ0KDQpmdW5jdGlvbiBiaUZyb21IZXgocykNCnsNCgl2YXIgcmVzdWx0ID0gbmV3IEJpZ0ludCgpOw0KCXZhciBzbCA9IHMubGVuZ3RoOw0KCWZvciAodmFyIGkgPSBzbCwgaiA9IDA7IGkgPiAwOyBpIC09IDQsICsraikgew0KCQlyZXN1bHQuZGlnaXRzW2pdID0gaGV4VG9EaWdpdChzLnN1YnN0cihNYXRoLm1heChpIC0gNCwgMCksIE1hdGgubWluKGksIDQpKSk7DQoJfQ0KCXJldHVybiByZXN1bHQ7DQp9DQoNCmZ1bmN0aW9uIGJpRnJvbVN0cmluZyhzLCByYWRpeCkNCnsNCgl2YXIgaXNOZWcgPSBzLmNoYXJBdCgwKSA9PSAnLSc7DQoJdmFyIGlzdG9wID0gaXNOZWcgPyAxIDogMDsNCgl2YXIgcmVzdWx0ID0gbmV3IEJpZ0ludCgpOw0KCXZhciBwbGFjZSA9IG5ldyBCaWdJbnQoKTsNCglwbGFjZS5kaWdpdHNbMF0gPSAxOyAvLyByYWRpeF4wDQoJZm9yICh2YXIgaSA9IHMubGVuZ3RoIC0gMTsgaSA+PSBpc3RvcDsgaS0tKSB7DQoJCXZhciBjID0gcy5jaGFyQ29kZUF0KGkpOw0KCQl2YXIgZGlnaXQgPSBjaGFyVG9IZXgoYyk7DQoJCXZhciBiaURpZ2l0ID0gYmlNdWx0aXBseURpZ2l0KHBsYWNlLCBkaWdpdCk7DQoJCXJlc3VsdCA9IGJpQWRkKHJlc3VsdCwgYmlEaWdpdCk7DQoJCXBsYWNlID0gYmlNdWx0aXBseURpZ2l0KHBsYWNlLCByYWRpeCk7DQoJfQ0KCXJlc3VsdC5pc05lZyA9IGlzTmVnOw0KCXJldHVybiByZXN1bHQ7DQp9DQoNCmZ1bmN0aW9uIGJpRHVtcChiKQ0Kew0KCXJldHVybiAoYi5pc05lZyA/ICItIiA6ICIiKSArIGIuZGlnaXRzLmpvaW4oIiAiKTsNCn0NCg0KZnVuY3Rpb24gYmlBZGQoeCwgeSkNCnsNCgl2YXIgcmVzdWx0Ow0KDQoJaWYgKHguaXNOZWcgIT0geS5pc05lZykgew0KCQl5LmlzTmVnID0gIXkuaXNOZWc7DQoJCXJlc3VsdCA9IGJpU3VidHJhY3QoeCwgeSk7DQoJCXkuaXNOZWcgPSAheS5pc05lZzsNCgl9DQoJZWxzZSB7DQoJCXJlc3VsdCA9IG5ldyBCaWdJbnQoKTsNCgkJdmFyIGMgPSAwOw0KCQl2YXIgbjsNCgkJZm9yICh2YXIgaSA9IDA7IGkgPCB4LmRpZ2l0cy5sZW5ndGg7ICsraSkgew0KCQkJbiA9IHguZGlnaXRzW2ldICsgeS5kaWdpdHNbaV0gKyBjOw0KCQkJcmVzdWx0LmRpZ2l0c1tpXSA9IG4gJSBiaVJhZGl4Ow0KCQkJYyA9IE51bWJlcihuID49IGJpUmFkaXgpOw0KCQl9DQoJCXJlc3VsdC5pc05lZyA9IHguaXNOZWc7DQoJfQ0KCXJldHVybiByZXN1bHQ7DQp9DQoNCmZ1bmN0aW9uIGJpU3VidHJhY3QoeCwgeSkNCnsNCgl2YXIgcmVzdWx0Ow0KCWlmICh4LmlzTmVnICE9IHkuaXNOZWcpIHsNCgkJeS5pc05lZyA9ICF5LmlzTmVnOw0KCQlyZXN1bHQgPSBiaUFkZCh4LCB5KTsNCgkJeS5pc05lZyA9ICF5LmlzTmVnOw0KCX0gZWxzZSB7DQoJCXJlc3VsdCA9IG5ldyBCaWdJbnQoKTsNCgkJdmFyIG4sIGM7DQoJCWMgPSAwOw0KCQlmb3IgKHZhciBpID0gMDsgaSA8IHguZGlnaXRzLmxlbmd0aDsgKytpKSB7DQoJCQluID0geC5kaWdpdHNbaV0gLSB5LmRpZ2l0c1tpXSArIGM7DQoJCQlyZXN1bHQuZGlnaXRzW2ldID0gbiAlIGJpUmFkaXg7DQoJCQkvLyBTdHVwaWQgbm9uLWNvbmZvcm1pbmcgbW9kdWx1cyBvcGVyYXRpb24uDQoJCQlpZiAocmVzdWx0LmRpZ2l0c1tpXSA8IDApIHJlc3VsdC5kaWdpdHNbaV0gKz0gYmlSYWRpeDsNCgkJCWMgPSAwIC0gTnVtYmVyKG4gPCAwKTsNCgkJfQ0KCQkvLyBGaXggdXAgdGhlIG5lZ2F0aXZlIHNpZ24sIGlmIGFueS4NCgkJaWYgKGMgPT0gLTEpIHsNCgkJCWMgPSAwOw0KCQkJZm9yICh2YXIgaSA9IDA7IGkgPCB4LmRpZ2l0cy5sZW5ndGg7ICsraSkgew0KCQkJCW4gPSAwIC0gcmVzdWx0LmRpZ2l0c1tpXSArIGM7DQoJCQkJcmVzdWx0LmRpZ2l0c1tpXSA9IG4gJSBiaVJhZGl4Ow0KCQkJCS8vIFN0dXBpZCBub24tY29uZm9ybWluZyBtb2R1bHVzIG9wZXJhdGlvbi4NCgkJCQlpZiAocmVzdWx0LmRpZ2l0c1tpXSA8IDApIHJlc3VsdC5kaWdpdHNbaV0gKz0gYmlSYWRpeDsNCgkJCQljID0gMCAtIE51bWJlcihuIDwgMCk7DQoJCQl9DQoJCQkvLyBSZXN1bHQgaXMgb3Bwb3NpdGUgc2lnbiBvZiBhcmd1bWVudHMuDQoJCQlyZXN1bHQuaXNOZWcgPSAheC5pc05lZzsNCgkJfSBlbHNlIHsNCgkJCS8vIFJlc3VsdCBpcyBzYW1lIHNpZ24uDQoJCQlyZXN1bHQuaXNOZWcgPSB4LmlzTmVnOw0KCQl9DQoJfQ0KCXJldHVybiByZXN1bHQ7DQp9DQoNCg0KZnVuY3Rpb24gYmlIaWdoSW5kZXgoeCkNCnsNCgl2YXIgcmVzdWx0ID0geC5kaWdpdHMubGVuZ3RoIC0gMTsNCgl3aGlsZSAocmVzdWx0ID4gMCAmJiB4LmRpZ2l0c1tyZXN1bHRdID09IDApIC0tcmVzdWx0Ow0KCXJldHVybiByZXN1bHQ7DQp9DQoNCmZ1bmN0aW9uIGJpTnVtQml0cyh4KQ0Kew0KCXZhciBuID0gYmlIaWdoSW5kZXgoeCk7DQoJdmFyIGQgPSB4LmRpZ2l0c1tuXTsNCgl2YXIgbSA9IChuICsgMSkgKiBiaXRzUGVyRGlnaXQ7DQoJdmFyIHJlc3VsdDsNCglmb3IgKHJlc3VsdCA9IG07IHJlc3VsdCA+IG0gLSBiaXRzUGVyRGlnaXQ7IC0tcmVzdWx0KSB7DQoJCWlmICgoZCAmIDB4ODAwMCkgIT0gMCkgYnJlYWs7DQoJCWQgPDw9IDE7DQoJfQ0KCXJldHVybiByZXN1bHQ7DQp9DQoNCmZ1bmN0aW9uIGJpTXVsdGlwbHkoeCwgeSkNCnsNCgl2YXIgcmVzdWx0ID0gbmV3IEJpZ0ludCgpOw0KCXZhciBjOw0KCXZhciBuID0gYmlIaWdoSW5kZXgoeCk7DQoJdmFyIHQgPSBiaUhpZ2hJbmRleCh5KTsNCgl2YXIgdSwgdXYsIGs7DQoNCglmb3IgKHZhciBpID0gMDsgaSA8PSB0OyArK2kpIHsNCgkJYyA9IDA7DQoJCWsgPSBpOw0KCQlmb3IgKGogPSAwOyBqIDw9IG47ICsraiwgKytrKSB7DQoJCQl1diA9IHJlc3VsdC5kaWdpdHNba10gKyB4LmRpZ2l0c1tqXSAqIHkuZGlnaXRzW2ldICsgYzsNCgkJCXJlc3VsdC5kaWdpdHNba10gPSB1diAmIG1heERpZ2l0VmFsOw0KCQkJYyA9IHV2ID4+PiBiaVJhZGl4Qml0czsNCgkJCS8vYyA9IE1hdGguZmxvb3IodXYgLyBiaVJhZGl4KTsNCgkJfQ0KCQlyZXN1bHQuZGlnaXRzW2kgKyBuICsgMV0gPSBjOw0KCX0NCgkvLyBTb21lb25lIGdpdmUgbWUgYSBsb2dpY2FsIHhvciwgcGxlYXNlLg0KCXJlc3VsdC5pc05lZyA9IHguaXNOZWcgIT0geS5pc05lZzsNCglyZXR1cm4gcmVzdWx0Ow0KfQ0KDQpmdW5jdGlvbiBiaU11bHRpcGx5RGlnaXQoeCwgeSkNCnsNCgl2YXIgbiwgYywgdXY7DQoNCglyZXN1bHQgPSBuZXcgQmlnSW50KCk7DQoJbiA9IGJpSGlnaEluZGV4KHgpOw0KCWMgPSAwOw0KCWZvciAodmFyIGogPSAwOyBqIDw9IG47ICsraikgew0KCQl1diA9IHJlc3VsdC5kaWdpdHNbal0gKyB4LmRpZ2l0c1tqXSAqIHkgKyBjOw0KCQlyZXN1bHQuZGlnaXRzW2pdID0gdXYgJiBtYXhEaWdpdFZhbDsNCgkJYyA9IHV2ID4+PiBiaVJhZGl4Qml0czsNCgkJLy9jID0gTWF0aC5mbG9vcih1diAvIGJpUmFkaXgpOw0KCX0NCglyZXN1bHQuZGlnaXRzWzEgKyBuXSA9IGM7DQoJcmV0dXJuIHJlc3VsdDsNCn0NCg0KZnVuY3Rpb24gYXJyYXlDb3B5KHNyYywgc3JjU3RhcnQsIGRlc3QsIGRlc3RTdGFydCwgbikNCnsNCgl2YXIgbSA9IE1hdGgubWluKHNyY1N0YXJ0ICsgbiwgc3JjLmxlbmd0aCk7DQoJZm9yICh2YXIgaSA9IHNyY1N0YXJ0LCBqID0gZGVzdFN0YXJ0OyBpIDwgbTsgKytpLCArK2opIHsNCgkJZGVzdFtqXSA9IHNyY1tpXTsNCgl9DQp9DQoNCnZhciBoaWdoQml0TWFza3MgPSBuZXcgQXJyYXkoMHgwMDAwLCAweDgwMDAsIDB4QzAwMCwgMHhFMDAwLCAweEYwMDAsIDB4RjgwMCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMHhGQzAwLCAweEZFMDAsIDB4RkYwMCwgMHhGRjgwLCAweEZGQzAsIDB4RkZFMCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMHhGRkYwLCAweEZGRjgsIDB4RkZGQywgMHhGRkZFLCAweEZGRkYpOw0KDQpmdW5jdGlvbiBiaVNoaWZ0TGVmdCh4LCBuKQ0Kew0KCXZhciBkaWdpdENvdW50ID0gTWF0aC5mbG9vcihuIC8gYml0c1BlckRpZ2l0KTsNCgl2YXIgcmVzdWx0ID0gbmV3IEJpZ0ludCgpOw0KCWFycmF5Q29weSh4LmRpZ2l0cywgMCwgcmVzdWx0LmRpZ2l0cywgZGlnaXRDb3VudCwNCgkgICAgICAgICAgcmVzdWx0LmRpZ2l0cy5sZW5ndGggLSBkaWdpdENvdW50KTsNCgl2YXIgYml0cyA9IG4gJSBiaXRzUGVyRGlnaXQ7DQoJdmFyIHJpZ2h0Qml0cyA9IGJpdHNQZXJEaWdpdCAtIGJpdHM7DQoJZm9yICh2YXIgaSA9IHJlc3VsdC5kaWdpdHMubGVuZ3RoIC0gMSwgaTEgPSBpIC0gMTsgaSA+IDA7IC0taSwgLS1pMSkgew0KCQlyZXN1bHQuZGlnaXRzW2ldID0gKChyZXN1bHQuZGlnaXRzW2ldIDw8IGJpdHMpICYgbWF4RGlnaXRWYWwpIHwNCgkJICAgICAgICAgICAgICAgICAgICgocmVzdWx0LmRpZ2l0c1tpMV0gJiBoaWdoQml0TWFza3NbYml0c10pID4+Pg0KCQkgICAgICAgICAgICAgICAgICAgIChyaWdodEJpdHMpKTsNCgl9DQoJcmVzdWx0LmRpZ2l0c1swXSA9ICgocmVzdWx0LmRpZ2l0c1tpXSA8PCBiaXRzKSAmIG1heERpZ2l0VmFsKTsNCglyZXN1bHQuaXNOZWcgPSB4LmlzTmVnOw0KCXJldHVybiByZXN1bHQ7DQp9DQoNCnZhciBsb3dCaXRNYXNrcyA9IG5ldyBBcnJheSgweDAwMDAsIDB4MDAwMSwgMHgwMDAzLCAweDAwMDcsIDB4MDAwRiwgMHgwMDFGLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDB4MDAzRiwgMHgwMDdGLCAweDAwRkYsIDB4MDFGRiwgMHgwM0ZGLCAweDA3RkYsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgMHgwRkZGLCAweDFGRkYsIDB4M0ZGRiwgMHg3RkZGLCAweEZGRkYpOw0KDQpmdW5jdGlvbiBiaVNoaWZ0UmlnaHQoeCwgbikNCnsNCgl2YXIgZGlnaXRDb3VudCA9IE1hdGguZmxvb3IobiAvIGJpdHNQZXJEaWdpdCk7DQoJdmFyIHJlc3VsdCA9IG5ldyBCaWdJbnQoKTsNCglhcnJheUNvcHkoeC5kaWdpdHMsIGRpZ2l0Q291bnQsIHJlc3VsdC5kaWdpdHMsIDAsDQoJICAgICAgICAgIHguZGlnaXRzLmxlbmd0aCAtIGRpZ2l0Q291bnQpOw0KCXZhciBiaXRzID0gbiAlIGJpdHNQZXJEaWdpdDsNCgl2YXIgbGVmdEJpdHMgPSBiaXRzUGVyRGlnaXQgLSBiaXRzOw0KCWZvciAodmFyIGkgPSAwLCBpMSA9IGkgKyAxOyBpIDwgcmVzdWx0LmRpZ2l0cy5sZW5ndGggLSAxOyArK2ksICsraTEpIHsNCgkJcmVzdWx0LmRpZ2l0c1tpXSA9IChyZXN1bHQuZGlnaXRzW2ldID4+PiBiaXRzKSB8DQoJCSAgICAgICAgICAgICAgICAgICAoKHJlc3VsdC5kaWdpdHNbaTFdICYgbG93Qml0TWFza3NbYml0c10pIDw8IGxlZnRCaXRzKTsNCgl9DQoJcmVzdWx0LmRpZ2l0c1tyZXN1bHQuZGlnaXRzLmxlbmd0aCAtIDFdID4+Pj0gYml0czsNCglyZXN1bHQuaXNOZWcgPSB4LmlzTmVnOw0KCXJldHVybiByZXN1bHQ7DQp9DQoNCmZ1bmN0aW9uIGJpTXVsdGlwbHlCeVJhZGl4UG93ZXIoeCwgbikNCnsNCgl2YXIgcmVzdWx0ID0gbmV3IEJpZ0ludCgpOw0KCWFycmF5Q29weSh4LmRpZ2l0cywgMCwgcmVzdWx0LmRpZ2l0cywgbiwgcmVzdWx0LmRpZ2l0cy5sZW5ndGggLSBuKTsNCglyZXR1cm4gcmVzdWx0Ow0KfQ0KDQpmdW5jdGlvbiBiaURpdmlkZUJ5UmFkaXhQb3dlcih4LCBuKQ0Kew0KCXZhciByZXN1bHQgPSBuZXcgQmlnSW50KCk7DQoJYXJyYXlDb3B5KHguZGlnaXRzLCBuLCByZXN1bHQuZGlnaXRzLCAwLCByZXN1bHQuZGlnaXRzLmxlbmd0aCAtIG4pOw0KCXJldHVybiByZXN1bHQ7DQp9DQoNCmZ1bmN0aW9uIGJpTW9kdWxvQnlSYWRpeFBvd2VyKHgsIG4pDQp7DQoJdmFyIHJlc3VsdCA9IG5ldyBCaWdJbnQoKTsNCglhcnJheUNvcHkoeC5kaWdpdHMsIDAsIHJlc3VsdC5kaWdpdHMsIDAsIG4pOw0KCXJldHVybiByZXN1bHQ7DQp9DQoNCmZ1bmN0aW9uIGJpQ29tcGFyZSh4LCB5KQ0Kew0KCWlmICh4LmlzTmVnICE9IHkuaXNOZWcpIHsNCgkJcmV0dXJuIDEgLSAyICogTnVtYmVyKHguaXNOZWcpOw0KCX0NCglmb3IgKHZhciBpID0geC5kaWdpdHMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHsNCgkJaWYgKHguZGlnaXRzW2ldICE9IHkuZGlnaXRzW2ldKSB7DQoJCQlpZiAoeC5pc05lZykgew0KCQkJCXJldHVybiAxIC0gMiAqIE51bWJlcih4LmRpZ2l0c1tpXSA+IHkuZGlnaXRzW2ldKTsNCgkJCX0gZWxzZSB7DQoJCQkJcmV0dXJuIDEgLSAyICogTnVtYmVyKHguZGlnaXRzW2ldIDwgeS5kaWdpdHNbaV0pOw0KCQkJfQ0KCQl9DQoJfQ0KCXJldHVybiAwOw0KfQ0KDQpmdW5jdGlvbiBiaURpdmlkZU1vZHVsbyh4LCB5KQ0Kew0KCXZhciBuYiA9IGJpTnVtQml0cyh4KTsNCgl2YXIgdGIgPSBiaU51bUJpdHMoeSk7DQoJdmFyIG9yaWdZSXNOZWcgPSB5LmlzTmVnOw0KCXZhciBxLCByOw0KCWlmIChuYiA8IHRiKSB7DQoJCS8vIHx4fCA8IHx5fA0KCQlpZiAoeC5pc05lZykgew0KCQkJcSA9IGJpQ29weShiaWdPbmUpOw0KCQkJcS5pc05lZyA9ICF5LmlzTmVnOw0KCQkJeC5pc05lZyA9IGZhbHNlOw0KCQkJeS5pc05lZyA9IGZhbHNlOw0KCQkJciA9IGJpU3VidHJhY3QoeSwgeCk7DQoJCQkvLyBSZXN0b3JlIHNpZ25zLCAnY2F1c2UgdGhleSdyZSByZWZlcmVuY2VzLg0KCQkJeC5pc05lZyA9IHRydWU7DQoJCQl5LmlzTmVnID0gb3JpZ1lJc05lZzsNCgkJfSBlbHNlIHsNCgkJCXEgPSBuZXcgQmlnSW50KCk7DQoJCQlyID0gYmlDb3B5KHgpOw0KCQl9DQoJCXJldHVybiBuZXcgQXJyYXkocSwgcik7DQoJfQ0KDQoJcSA9IG5ldyBCaWdJbnQoKTsNCglyID0geDsNCg0KCS8vIE5vcm1hbGl6ZSBZLg0KCXZhciB0ID0gTWF0aC5jZWlsKHRiIC8gYml0c1BlckRpZ2l0KSAtIDE7DQoJdmFyIGxhbWJkYSA9IDA7DQoJd2hpbGUgKHkuZGlnaXRzW3RdIDwgYmlIYWxmUmFkaXgpIHsNCgkJeSA9IGJpU2hpZnRMZWZ0KHksIDEpOw0KCQkrK2xhbWJkYTsNCgkJKyt0YjsNCgkJdCA9IE1hdGguY2VpbCh0YiAvIGJpdHNQZXJEaWdpdCkgLSAxOw0KCX0NCgkvLyBTaGlmdCByIG92ZXIgdG8ga2VlcCB0aGUgcXVvdGllbnQgY29uc3RhbnQuIFdlJ2xsIHNoaWZ0IHRoZQ0KCS8vIHJlbWFpbmRlciBiYWNrIGF0IHRoZSBlbmQuDQoJciA9IGJpU2hpZnRMZWZ0KHIsIGxhbWJkYSk7DQoJbmIgKz0gbGFtYmRhOyAvLyBVcGRhdGUgdGhlIGJpdCBjb3VudCBmb3IgeC4NCgl2YXIgbiA9IE1hdGguY2VpbChuYiAvIGJpdHNQZXJEaWdpdCkgLSAxOw0KDQoJdmFyIGIgPSBiaU11bHRpcGx5QnlSYWRpeFBvd2VyKHksIG4gLSB0KTsNCgl3aGlsZSAoYmlDb21wYXJlKHIsIGIpICE9IC0xKSB7DQoJCSsrcS5kaWdpdHNbbiAtIHRdOw0KCQlyID0gYmlTdWJ0cmFjdChyLCBiKTsNCgl9DQoJZm9yICh2YXIgaSA9IG47IGkgPiB0OyAtLWkpIHsNCiAgICB2YXIgcmkgPSAoaSA+PSByLmRpZ2l0cy5sZW5ndGgpID8gMCA6IHIuZGlnaXRzW2ldOw0KICAgIHZhciByaTEgPSAoaSAtIDEgPj0gci5kaWdpdHMubGVuZ3RoKSA/IDAgOiByLmRpZ2l0c1tpIC0gMV07DQogICAgdmFyIHJpMiA9IChpIC0gMiA+PSByLmRpZ2l0cy5sZW5ndGgpID8gMCA6IHIuZGlnaXRzW2kgLSAyXTsNCiAgICB2YXIgeXQgPSAodCA+PSB5LmRpZ2l0cy5sZW5ndGgpID8gMCA6IHkuZGlnaXRzW3RdOw0KICAgIHZhciB5dDEgPSAodCAtIDEgPj0geS5kaWdpdHMubGVuZ3RoKSA/IDAgOiB5LmRpZ2l0c1t0IC0gMV07DQoJCWlmIChyaSA9PSB5dCkgew0KCQkJcS5kaWdpdHNbaSAtIHQgLSAxXSA9IG1heERpZ2l0VmFsOw0KCQl9IGVsc2Ugew0KCQkJcS5kaWdpdHNbaSAtIHQgLSAxXSA9IE1hdGguZmxvb3IoKHJpICogYmlSYWRpeCArIHJpMSkgLyB5dCk7DQoJCX0NCg0KCQl2YXIgYzEgPSBxLmRpZ2l0c1tpIC0gdCAtIDFdICogKCh5dCAqIGJpUmFkaXgpICsgeXQxKTsNCgkJdmFyIGMyID0gKHJpICogYmlSYWRpeFNxdWFyZWQpICsgKChyaTEgKiBiaVJhZGl4KSArIHJpMik7DQoJCXdoaWxlIChjMSA+IGMyKSB7DQoJCQktLXEuZGlnaXRzW2kgLSB0IC0gMV07DQoJCQljMSA9IHEuZGlnaXRzW2kgLSB0IC0gMV0gKiAoKHl0ICogYmlSYWRpeCkgfCB5dDEpOw0KCQkJYzIgPSAocmkgKiBiaVJhZGl4ICogYmlSYWRpeCkgKyAoKHJpMSAqIGJpUmFkaXgpICsgcmkyKTsNCgkJfQ0KDQoJCWIgPSBiaU11bHRpcGx5QnlSYWRpeFBvd2VyKHksIGkgLSB0IC0gMSk7DQoJCXIgPSBiaVN1YnRyYWN0KHIsIGJpTXVsdGlwbHlEaWdpdChiLCBxLmRpZ2l0c1tpIC0gdCAtIDFdKSk7DQoJCWlmIChyLmlzTmVnKSB7DQoJCQlyID0gYmlBZGQociwgYik7DQoJCQktLXEuZGlnaXRzW2kgLSB0IC0gMV07DQoJCX0NCgl9DQoJciA9IGJpU2hpZnRSaWdodChyLCBsYW1iZGEpOw0KCS8vIEZpZGRsZSB3aXRoIHRoZSBzaWducyBhbmQgc3R1ZmYgdG8gbWFrZSBzdXJlIHRoYXQgMCA8PSByIDwgeS4NCglxLmlzTmVnID0geC5pc05lZyAhPSBvcmlnWUlzTmVnOw0KCWlmICh4LmlzTmVnKSB7DQoJCWlmIChvcmlnWUlzTmVnKSB7DQoJCQlxID0gYmlBZGQocSwgYmlnT25lKTsNCgkJfSBlbHNlIHsNCgkJCXEgPSBiaVN1YnRyYWN0KHEsIGJpZ09uZSk7DQoJCX0NCgkJeSA9IGJpU2hpZnRSaWdodCh5LCBsYW1iZGEpOw0KCQlyID0gYmlTdWJ0cmFjdCh5LCByKTsNCgl9DQoJLy8gQ2hlY2sgZm9yIHRoZSB1bmJlbGlldmFibHkgc3R1cGlkIGRlZ2VuZXJhdGUgY2FzZSBvZiByID09IC0wLg0KCWlmIChyLmRpZ2l0c1swXSA9PSAwICYmIGJpSGlnaEluZGV4KHIpID09IDApIHIuaXNOZWcgPSBmYWxzZTsNCg0KCXJldHVybiBuZXcgQXJyYXkocSwgcik7DQp9DQoNCmZ1bmN0aW9uIGJpRGl2aWRlKHgsIHkpDQp7DQoJcmV0dXJuIGJpRGl2aWRlTW9kdWxvKHgsIHkpWzBdOw0KfQ0KDQpmdW5jdGlvbiBiaU1vZHVsbyh4LCB5KQ0Kew0KCXJldHVybiBiaURpdmlkZU1vZHVsbyh4LCB5KVsxXTsNCn0NCg0KZnVuY3Rpb24gYmlNdWx0aXBseU1vZCh4LCB5LCBtKQ0Kew0KCXJldHVybiBiaU1vZHVsbyhiaU11bHRpcGx5KHgsIHkpLCBtKTsNCn0NCg0KZnVuY3Rpb24gYmlQb3coeCwgeSkNCnsNCgl2YXIgcmVzdWx0ID0gYmlnT25lOw0KCXZhciBhID0geDsNCgl3aGlsZSAodHJ1ZSkgew0KCQlpZiAoKHkgJiAxKSAhPSAwKSByZXN1bHQgPSBiaU11bHRpcGx5KHJlc3VsdCwgYSk7DQoJCXkgPj49IDE7DQoJCWlmICh5ID09IDApIGJyZWFrOw0KCQlhID0gYmlNdWx0aXBseShhLCBhKTsNCgl9DQoJcmV0dXJuIHJlc3VsdDsNCn0NCg0KZnVuY3Rpb24gYmlQb3dNb2QoeCwgeSwgbSkNCnsNCgl2YXIgcmVzdWx0ID0gYmlnT25lOw0KCXZhciBhID0geDsNCgl2YXIgayA9IHk7DQoJd2hpbGUgKHRydWUpIHsNCgkJaWYgKChrLmRpZ2l0c1swXSAmIDEpICE9IDApIHJlc3VsdCA9IGJpTXVsdGlwbHlNb2QocmVzdWx0LCBhLCBtKTsNCgkJayA9IGJpU2hpZnRSaWdodChrLCAxKTsNCgkJaWYgKGsuZGlnaXRzWzBdID09IDAgJiYgYmlIaWdoSW5kZXgoaykgPT0gMCkgYnJlYWs7DQoJCWEgPSBiaU11bHRpcGx5TW9kKGEsIGEsIG0pOw0KCX0NCglyZXR1cm4gcmVzdWx0Ow0KfQ0KDQovLyBCYXJyZXR0TXUsIGEgY2xhc3MgZm9yIHBlcmZvcm1pbmcgQmFycmV0dCBtb2R1bGFyIHJlZHVjdGlvbiBjb21wdXRhdGlvbnMgaW4NCi8vIEphdmFTY3JpcHQuDQovLw0KLy8gUmVxdWlyZXMgQmlnSW50LmpzLg0KLy8NCi8vIENvcHlyaWdodCAyMDA0LTIwMDUgRGF2aWQgU2hhcGlyby4NCi8vDQovLyBZb3UgbWF5IHVzZSwgcmUtdXNlLCBhYnVzZSwgY29weSwgYW5kIG1vZGlmeSB0aGlzIGNvZGUgdG8geW91ciBsaWtpbmcsIGJ1dA0KLy8gcGxlYXNlIGtlZXAgdGhpcyBoZWFkZXIuDQovLw0KLy8gVGhhbmtzIQ0KLy8gDQovLyBEYXZlIFNoYXBpcm8NCi8vIGRhdmVAb2hkYXZlLmNvbSANCg0KZnVuY3Rpb24gQmFycmV0dE11KG0pDQp7DQoJdGhpcy5tb2R1bHVzID0gYmlDb3B5KG0pOw0KCXRoaXMuayA9IGJpSGlnaEluZGV4KHRoaXMubW9kdWx1cykgKyAxOw0KCXZhciBiMmsgPSBuZXcgQmlnSW50KCk7DQoJYjJrLmRpZ2l0c1syICogdGhpcy5rXSA9IDE7IC8vIGIyayA9IGJeKDJrKQ0KCXRoaXMubXUgPSBiaURpdmlkZShiMmssIHRoaXMubW9kdWx1cyk7DQoJdGhpcy5ia3BsdXMxID0gbmV3IEJpZ0ludCgpOw0KCXRoaXMuYmtwbHVzMS5kaWdpdHNbdGhpcy5rICsgMV0gPSAxOyAvLyBia3BsdXMxID0gYl4oaysxKQ0KCXRoaXMubW9kdWxvID0gQmFycmV0dE11X21vZHVsbzsNCgl0aGlzLm11bHRpcGx5TW9kID0gQmFycmV0dE11X211bHRpcGx5TW9kOw0KCXRoaXMucG93TW9kID0gQmFycmV0dE11X3Bvd01vZDsNCn0NCg0KZnVuY3Rpb24gQmFycmV0dE11X21vZHVsbyh4KQ0Kew0KCXZhciBxMSA9IGJpRGl2aWRlQnlSYWRpeFBvd2VyKHgsIHRoaXMuayAtIDEpOw0KCXZhciBxMiA9IGJpTXVsdGlwbHkocTEsIHRoaXMubXUpOw0KCXZhciBxMyA9IGJpRGl2aWRlQnlSYWRpeFBvd2VyKHEyLCB0aGlzLmsgKyAxKTsNCgl2YXIgcjEgPSBiaU1vZHVsb0J5UmFkaXhQb3dlcih4LCB0aGlzLmsgKyAxKTsNCgl2YXIgcjJ0ZXJtID0gYmlNdWx0aXBseShxMywgdGhpcy5tb2R1bHVzKTsNCgl2YXIgcjIgPSBiaU1vZHVsb0J5UmFkaXhQb3dlcihyMnRlcm0sIHRoaXMuayArIDEpOw0KCXZhciByID0gYmlTdWJ0cmFjdChyMSwgcjIpOw0KCWlmIChyLmlzTmVnKSB7DQoJCXIgPSBiaUFkZChyLCB0aGlzLmJrcGx1czEpOw0KCX0NCgl2YXIgcmd0ZW0gPSBiaUNvbXBhcmUociwgdGhpcy5tb2R1bHVzKSA+PSAwOw0KCXdoaWxlIChyZ3RlbSkgew0KCQlyID0gYmlTdWJ0cmFjdChyLCB0aGlzLm1vZHVsdXMpOw0KCQlyZ3RlbSA9IGJpQ29tcGFyZShyLCB0aGlzLm1vZHVsdXMpID49IDA7DQoJfQ0KCXJldHVybiByOw0KfQ0KDQpmdW5jdGlvbiBCYXJyZXR0TXVfbXVsdGlwbHlNb2QoeCwgeSkNCnsNCgkvKg0KCXggPSB0aGlzLm1vZHVsbyh4KTsNCgl5ID0gdGhpcy5tb2R1bG8oeSk7DQoJKi8NCgl2YXIgeHkgPSBiaU11bHRpcGx5KHgsIHkpOw0KCXJldHVybiB0aGlzLm1vZHVsbyh4eSk7DQp9DQoNCmZ1bmN0aW9uIEJhcnJldHRNdV9wb3dNb2QoeCwgeSkNCnsNCgl2YXIgcmVzdWx0ID0gbmV3IEJpZ0ludCgpOw0KCXJlc3VsdC5kaWdpdHNbMF0gPSAxOw0KCXZhciBhID0geDsNCgl2YXIgayA9IHk7DQoJd2hpbGUgKHRydWUpIHsNCgkJaWYgKChrLmRpZ2l0c1swXSAmIDEpICE9IDApIHJlc3VsdCA9IHRoaXMubXVsdGlwbHlNb2QocmVzdWx0LCBhKTsNCgkJayA9IGJpU2hpZnRSaWdodChrLCAxKTsNCgkJaWYgKGsuZGlnaXRzWzBdID09IDAgJiYgYmlIaWdoSW5kZXgoaykgPT0gMCkgYnJlYWs7DQoJCWEgPSB0aGlzLm11bHRpcGx5TW9kKGEsIGEpOw0KCX0NCglyZXR1cm4gcmVzdWx0Ow0KfQ0KDQoNCi8vIFJTQSwgYSBzdWl0ZSBvZiByb3V0aW5lcyBmb3IgcGVyZm9ybWluZyBSU0EgcHVibGljLWtleSBjb21wdXRhdGlvbnMgaW4NCi8vIEphdmFTY3JpcHQuDQovLw0KLy8gUmVxdWlyZXMgQmlnSW50LmpzIGFuZCBCYXJyZXR0LmpzLg0KLy8NCi8vIENvcHlyaWdodCAxOTk4LTIwMDUgRGF2aWQgU2hhcGlyby4NCi8vDQovLyBZb3UgbWF5IHVzZSwgcmUtdXNlLCBhYnVzZSwgY29weSwgYW5kIG1vZGlmeSB0aGlzIGNvZGUgdG8geW91ciBsaWtpbmcsIGJ1dA0KLy8gcGxlYXNlIGtlZXAgdGhpcyBoZWFkZXIuDQovLw0KLy8gVGhhbmtzIQ0KLy8gDQovLyBEYXZlIFNoYXBpcm8NCi8vIGRhdmVAb2hkYXZlLmNvbSANCg0KZnVuY3Rpb24gUlNBS2V5UGFpcihlbmNyeXB0aW9uRXhwb25lbnQsIGRlY3J5cHRpb25FeHBvbmVudCwgbW9kdWx1cykNCnsNCgl0aGlzLmUgPSBiaUZyb21IZXgoZW5jcnlwdGlvbkV4cG9uZW50KTsNCgl0aGlzLmQgPSBiaUZyb21IZXgoZGVjcnlwdGlvbkV4cG9uZW50KTsNCgl0aGlzLm0gPSBiaUZyb21IZXgobW9kdWx1cyk7DQoJLy8gV2UgY2FuIGRvIHR3byBieXRlcyBwZXIgZGlnaXQsIHNvDQoJLy8gY2h1bmtTaXplID0gMiAqIChudW1iZXIgb2YgZGlnaXRzIGluIG1vZHVsdXMgLSAxKS4NCgkvLyBTaW5jZSBiaUhpZ2hJbmRleCByZXR1cm5zIHRoZSBoaWdoIGluZGV4LCBub3QgdGhlIG51bWJlciBvZiBkaWdpdHMsIDEgaGFzDQoJLy8gYWxyZWFkeSBiZWVuIHN1YnRyYWN0ZWQuDQoJdGhpcy5jaHVua1NpemUgPSAyICogYmlIaWdoSW5kZXgodGhpcy5tKTsNCgl0aGlzLnJhZGl4ID0gMTY7DQoJdGhpcy5iYXJyZXR0ID0gbmV3IEJhcnJldHRNdSh0aGlzLm0pOw0KfQ0KDQpmdW5jdGlvbiB0d29EaWdpdChuKQ0Kew0KCXJldHVybiAobiA8IDEwID8gIjAiIDogIiIpICsgU3RyaW5nKG4pOw0KfQ0KDQpmdW5jdGlvbiBib2R5UlNBKCkgICANCnsgICANCgkgICAgc2V0TWF4RGlnaXRzKDEzMCk7ICAgDQoJICAgIHJldHVybiBuZXcgUlNBS2V5UGFpcigiMTAwMDEiLCIiLCJhNWFlYjhjNjM2ZWYxZmRhNWE3YTE3YTI4MTllNTFlMWVhNmUwY2NlYjI0Yjk1NTc0YWUwMjY1MzYyNDM1MjRmMzIyODA3ZGYyNTMxYTQyMTM5Mzg5Njc0NTQ1ZjRjNTk2ZGIxNjJmNmU2YmJiMjY0OThiYWFiMDc0YzAzNjc3NyIpOw0KCSAgICAvL3JldHVybiBuZXcgUlNBS2V5UGFpcigiMTAwMDEiLCIiLCJmZHNzZmRzZmRzZmRzZmRzIik7ICAgIA0KfQ0KDQpmdW5jdGlvbiBlbmNyeXB0ZWRTdHJpbmcobW9kdWx1cyxzKQ0KCS8vIEFsdGVyZWQgYnkgUm9iIFNhdW5kZXJzIChyb2JAcm9ic2F1bmRlcnMubmV0KS4gTmV3IHJvdXRpbmUgcGFkcyB0aGUNCgkvLyBzdHJpbmcgYWZ0ZXIgaXQgaGFzIGJlZW4gY29udmVydGVkIHRvIGFuIGFycmF5LiBUaGlzIGZpeGVzIGFuDQoJLy8gaW5jb21wYXRpYmlsaXR5IHdpdGggRmxhc2ggTVgncyBBY3Rpb25TY3JpcHQuDQp7DQogICAgdmFyIGtleSA9ICBuZXcgUlNBS2V5UGFpcigiMDEwMDAxIiwiIixtb2R1bHVzKTsgDQoNCgl2YXIgYSA9IG5ldyBBcnJheSgpOw0KCXZhciBzbCA9IHMubGVuZ3RoOw0KCXZhciBpID0gMDsNCgl3aGlsZSAoaSA8IHNsKSB7DQoJCWFbaV0gPSBzLmNoYXJDb2RlQXQoaSk7DQoJCWkrKzsNCgl9DQoNCgl3aGlsZSAoYS5sZW5ndGggJSBrZXkuY2h1bmtTaXplICE9IDApIHsNCgkJYVtpKytdID0gMDsNCgl9DQoNCgl2YXIgYWwgPSBhLmxlbmd0aDsNCgl2YXIgcmVzdWx0ID0gIiI7DQoJdmFyIGosIGssIGJsb2NrOw0KCWZvciAoaSA9IDA7IGkgPCBhbDsgaSArPSBrZXkuY2h1bmtTaXplKSB7DQoJCWJsb2NrID0gbmV3IEJpZ0ludCgpOw0KCQlqID0gMDsNCgkJZm9yIChrID0gaTsgayA8IGkgKyBrZXkuY2h1bmtTaXplOyArK2opIHsNCgkJCWJsb2NrLmRpZ2l0c1tqXSA9IGFbaysrXTsNCgkJCWJsb2NrLmRpZ2l0c1tqXSArPSBhW2srK10gPDwgODsNCgkJfQ0KCQl2YXIgY3J5cHQgPSBrZXkuYmFycmV0dC5wb3dNb2QoYmxvY2ssIGtleS5lKTsNCgkJdmFyIHRleHQgPSBrZXkucmFkaXggPT0gMTYgPyBiaVRvSGV4KGNyeXB0KSA6IGJpVG9TdHJpbmcoY3J5cHQsIGtleS5yYWRpeCk7DQoJCXJlc3VsdCArPSB0ZXh0ICsgIiAiOw0KCX0NCglyZXR1cm4gcmVzdWx0LnN1YnN0cmluZygwLCByZXN1bHQubGVuZ3RoIC0gMSk7IC8vIFJlbW92ZSBsYXN0IHNwYWNlLg0KfQ0KDQpmdW5jdGlvbiBkZWNyeXB0ZWRTdHJpbmcocykNCnsNCglmdW5jdGlvbiBib2R5UlNBKCkgICANCgl7ICAgDQoJICAgIHNldE1heERpZ2l0cygxMzApOyAgIA0KCSAgICByZXR1cm4gbmV3IFJTQUtleVBhaXIoIjEwMDAxIiwiIiwiYTVhZWI4YzYzNmVmMWZkYTVhN2ExN2EyODE5ZTUxZTFlYTZlMGNjZWIyNGI5NTU3NGFlMDI2NTM2MjQzNTI0ZjMyMjgwN2RmMjUzMWE0MjEzOTM4OTY3NDU0NWY0YzU5NmRiMTYyZjZlNmJiYjI2NDk4YmFhYjA3NGMwMzY3NzciKTsgICAgDQoJfQ0KCXZhciBrZXkgPSAgYm9keVJTQSgpOyANCgl2YXIgYmxvY2tzID0gcy5zcGxpdCgiICIpOw0KCXZhciByZXN1bHQgPSAiIjsNCgl2YXIgaSwgaiwgYmxvY2s7DQoJZm9yIChpID0gMDsgaSA8IGJsb2Nrcy5sZW5ndGg7ICsraSkgew0KCQl2YXIgYmk7DQoJCWlmIChrZXkucmFkaXggPT0gMTYpIHsNCgkJCWJpID0gYmlGcm9tSGV4KGJsb2Nrc1tpXSk7DQoJCX0NCgkJZWxzZSB7DQoJCQliaSA9IGJpRnJvbVN0cmluZyhibG9ja3NbaV0sIGtleS5yYWRpeCk7DQoJCX0NCgkJYmxvY2sgPSBrZXkuYmFycmV0dC5wb3dNb2QoYmksIGtleS5kKTsNCgkJZm9yIChqID0gMDsgaiA8PSBiaUhpZ2hJbmRleChibG9jayk7ICsraikgew0KCQkJcmVzdWx0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYmxvY2suZGlnaXRzW2pdICYgMjU1LA0KCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2suZGlnaXRzW2pdID4+IDgpOw0KCQl9DQoJfQ0KCS8vIFJlbW92ZSB0cmFpbGluZyBudWxsLCBpZiBhbnkuDQoJaWYgKHJlc3VsdC5jaGFyQ29kZUF0KHJlc3VsdC5sZW5ndGggLSAxKSA9PSAwKSB7DQoJCXJlc3VsdCA9IHJlc3VsdC5zdWJzdHJpbmcoMCwgcmVzdWx0Lmxlbmd0aCAtIDEpOw0KCX0NCglyZXR1cm4gcmVzdWx0Ow0KfQ==";

    @Override
    public HttpResult<Map<String, Object>> init(OperatorParam param) {
        HttpResult<Map<String, Object>> result = new HttpResult<>();
        Response response = null;
        try {
            String templateUrl = "http://jx.189.cn/service/account/seeInfo.jsp";
            response = TaskHttpClient.create(param, RequestType.GET, "jiang_xi_10000_web_001").setFullUrl(templateUrl).invoke();
            String pageContent = response.getPageContent();
            modulus = PatternUtils.group(pageContent, "var modulus = \"([^\"]+)\"", 1);
            if (StringUtils.isNotBlank(modulus)) {
                return result.success();
            } else {
                logger.error("get encrypt param:modulus error!");
                return result.failure(ErrorCode.TASK_INIT_ERROR);
            }
        } catch (Exception e) {
            logger.error("登录-->初始化失败,param={}", param, e);
            return result.failure(ErrorCode.TASK_INIT_ERROR);
        }
    }

    @Override
    public HttpResult<String> refeshPicCode(OperatorParam param) {
        switch (param.getFormType()) {
            case FormType.LOGIN:
                return refeshPicCodeForLogin(param);
            default:
                return new HttpResult<String>().failure(ErrorCode.NOT_SUPORT_METHOD);
        }
    }

    @Override
    public HttpResult<Map<String, Object>> validatePicCode(OperatorParam param) {
        return new HttpResult<Map<String, Object>>().failure(ErrorCode.NOT_SUPORT_METHOD);
    }

    @Override
    public HttpResult<Map<String, Object>> refeshSmsCode(OperatorParam param) {
        switch (param.getFormType()) {
            case FormType.LOGIN:
                return refeshSmsCodeForLogin(param);
            case FormType.VALIDATE_BILL_DETAIL:
                return refeshSmsCodeForBillDetail(param);
            default:
                return new HttpResult<Map<String, Object>>().failure(ErrorCode.NOT_SUPORT_METHOD);
        }
    }

    @Override
    public HttpResult<Map<String, Object>> submit(OperatorParam param) {
        switch (param.getFormType()) {
            case FormType.LOGIN:
                return submitForLogin(param);
            case FormType.VALIDATE_BILL_DETAIL:
                return submitForBillDetail(param);
            default:
                return new HttpResult<Map<String, Object>>().failure(ErrorCode.NOT_SUPORT_METHOD);
        }
    }

    @Override
    public HttpResult<Object> defineProcess(OperatorParam param) {
        return new HttpResult<Object>().failure(ErrorCode.NOT_SUPORT_METHOD);
    }

    private HttpResult<String> refeshPicCodeForLogin(OperatorParam param) {
        HttpResult<String> result = new HttpResult<>();
        Response response = null;
        try {
            String templateUrl = "http://jx.189.cn/public/v4/common/control/page/image.jsp?date=" + URLEncoder.encode("" + new Date(), "UTF-8");
            String referer = "http://jx.189.cn/public/v4/logon/loginPop.jsp?from_sc=service_login&ret_url=";
            response = TaskHttpClient.create(param, RequestType.GET, "jiang_xi_10000_web_002").setFullUrl(templateUrl).setReferer(referer).invoke();
            logger.info("登录-->图片验证码-->刷新成功,param={}", param);
            return result.success(response.getPageContentForBase64());
        } catch (Exception e) {
            logger.error("登录-->图片验证码-->刷新失败,param={},response={}", param, response, e);
            return result.failure(ErrorCode.REFESH_PIC_CODE_ERROR);
        }
    }

    private HttpResult<Map<String, Object>> refeshSmsCodeForLogin(OperatorParam param) {
        HttpResult<Map<String, Object>> result = new HttpResult<>();
        Response response = null;
        try {
            String templateUrl = "http://jx.189.cn/public/common/control/dwr/engine.js";
            response = TaskHttpClient.create(param, RequestType.GET, "jiang_xi_10000_web_003").setFullUrl(templateUrl).invoke();
            String pageContent = response.getPageContent();
            if (StringUtils.isBlank(pageContent)) {
                logger.error("获取scriptSessionId页面失败");
                return result.failure(ErrorCode.NOT_EMPTY_ERROR_CODE);
            }
            String sessionId = PatternUtils.group(pageContent, "dwr.engine._origScriptSessionId = \"([^\"]+)\";", 1);
            if (StringUtils.isBlank(sessionId)) {
                logger.error("获取scriptSessionId失败");
                return result.failure(ErrorCode.NOT_EMPTY_ERROR_CODE);
            }
            scriptSessionId = sessionId + randomNum;
            logger.info(scriptSessionId);
            TaskUtils.addTaskShare(param.getTaskId(), "scriptSessionId", scriptSessionId);

            templateUrl = "http://jx.189.cn/dwr/call/plaincall/Service.excute.dwr";
            String templateData = "callCount=1" + "&page=/public/v4/logon/loginPop.jsp?from_sc=service_login&ret_url=" + "&httpSessionId=" + "&scriptSessionId=" + scriptSessionId + "&c0-scriptName=Service" + "&c0-methodName=excute" + "&c0-id=0" + "&c0-param0=string:SEND_LOGIN_RANDOM_PWD" + "&c0-param1=boolean:false" + "&c0-e1=string:" + param.getMobile() + "&c0-e2=string:CR0" + "&c0-e3=string:001" + "&c0-e4=string:no" + "&c0-param2=Object_Object:{RECV_NUM:reference:c0-e1, SMS_OPERTYPE:reference:c0-e2, RAND_TYPE:reference:c0-e3, need_val:reference:c0-e4}" + "&batchId=2";
            String referer = "http://jx.189.cn/public/v4/logon/loginPop.jsp?from_sc=service_login&ret_url=";

            response = TaskHttpClient.create(param, RequestType.POST, "jiang_xi_10000_web_004").setFullUrl(templateUrl).setReferer(referer).setRequestBody(templateData, ContentType.TEXT_PLAIN).invoke();
            pageContent = response.getPageContent();
            String cookieRandom = TaskUtils.getCookieString(param.getTaskId());
            TaskUtils.addTaskShare(param.getTaskId(), "cookieRandom", cookieRandom);
            if (StringUtils.contains(pageContent, "flag:\"0\"")) {
                logger.info("登录-->短信验证码-->发送成功,param={}", param);
                return result.success();
            } else {
                logger.error("登录-->短信验证码-->发送失败,param={},pageContent={}", param, response.getPageContent());
                return result.failure(ErrorCode.REFESH_SMS_UNEXPECTED_RESULT);
            }
        } catch (Exception e) {
            logger.error("登录-->短信验证码-->发送失败,param={},response={}", param, response, e);
            return result.failure(ErrorCode.REFESH_SMS_ERROR);
        }
    }

    private HttpResult<Map<String, Object>> submitForLogin(OperatorParam param) {
        CheckUtils.checkNotBlank(param.getPassword(), ErrorCode.EMPTY_PASSWORD);
        CheckUtils.checkNotBlank(param.getPicCode(), ErrorCode.EMPTY_PIC_CODE);
        CheckUtils.checkNotBlank(param.getSmsCode(), ErrorCode.EMPTY_SMS_CODE);
        HttpResult<Map<String, Object>> result = new HttpResult<>();
        Response response = null;

        try {
            scriptSessionId = TaskUtils.getTaskShare(param.getTaskId(), "scriptSessionId");
            if (StringUtils.isBlank(scriptSessionId)) {
                logger.info("scriptSessionId is null");
                return result.failure(ErrorCode.NOT_EMPTY_ERROR_CODE);
            }
            //用户类型
            String templateUrl = "http://jx.189.cn/dwr/call/plaincall/Service.excute.dwr";
            String templateData = "callCount=1" + "&page=/public/v4/logon/loginPop.jsp?from_sc=service_login&ret_url=" + "&httpSessionId=" + "&scriptSessionId=" + scriptSessionId + "&c0-scriptName=Service" + "&c0-methodName=excute" + "&c0-id=0" + "&c0-param0=string:GET_USER_TYPE" + "&c0-param1=boolean:false" + "&c0-e1=string:" + param.getMobile() + "&c0-param2=Object_Object:{user_no:reference:c0-e1}" + "&batchId=0";
            String referer = "http://jx.189.cn/public/v4/logon/loginPop.jsp?from_sc=service_login&ret_url=";
            response = TaskHttpClient.create(param, RequestType.POST, "jiang_xi_10000_web_005").setFullUrl(templateUrl).setReferer(referer).setRequestBody(templateData,ContentType.TEXT_PLAIN).invoke();
            String pageContent = response.getPageContent();
            if (StringUtils.containsNone(pageContent, "flag:\"0\"")) {
                logger.error("jx189 login request is error! errormessage: get user type failed");
                return result.failure(ErrorCode.NOT_EMPTY_ERROR_CODE);
            }

            String areaCode = PatternUtils.group(pageContent, "s\\d+\\['area_code'\\]=\"(\\d+)\"", 1);
            if (StringUtils.isBlank(areaCode)) {
                logger.error("jx189 login request is error! errormessage: get area code failed");
                return result.failure(ErrorCode.NOT_EMPTY_ERROR_CODE);
            }
            TaskUtils.addTaskShare(param.getTaskId(), "areaCode", areaCode);

            //验证图片验证码
            templateUrl = "http://jx.189.cn/dwr/call/plaincall/Service.excute.dwr";
            templateData = "callCount=1" + "&page=/public/v4/logon/loginPop.jsp?from_sc=service_login&ret_url=" + "&httpSessionId=" + "&scriptSessionId=" + scriptSessionId + "&c0-scriptName=Service" + "&c0-methodName=excute" + "&c0-id=0" + "&c0-param0=string:WB_TEST_VALIDCODE" + "&c0-param1=boolean:false" + "&c0-e1=string:" + param.getPicCode() + "&c0-param2=Object_Object:{valid_code_input:reference:c0-e1}" + "&batchId=3";
            referer = "http://jx.189.cn/public/v4/logon/loginPop.jsp?from_sc=service_login&ret_url=";
            response = TaskHttpClient.create(param, RequestType.POST, "jiang_xi_10000_web_006").setFullUrl(templateUrl).setReferer(referer).setRequestBody(templateData,ContentType.TEXT_PLAIN).invoke();
            pageContent = response.getPageContent();
            if (StringUtils.containsNone(pageContent, "\"OK\"")) {
                logger.error("jx189 login request is error! errormessage: 图形验证码错误");
                return result.failure(ErrorCode.NOT_EMPTY_ERROR_CODE);
            }

            //登录
            Invocable invocable = ScriptEngineUtil.createInvocableFromBase64(javaScript2);
            String encryptSmsCode = invocable.invokeFunction("encryptedString", new Object[] {modulus,param.getSmsCode()}).toString();
            String encryptMobile = invocable.invokeFunction("encryptedString", new Object[] {modulus,param.getMobile().toString()}).toString();
            templateUrl = "http://jx.189.cn/dwr/call/plaincall/Service.excute.dwr";
            templateData = "callCount=1" + "&page=/public/v4/logon/loginPop.jsp?from_sc=service_login&ret_url=" + "&httpSessionId=" + "&scriptSessionId=" + scriptSessionId + "&c0-scriptName=Service" + "&c0-methodName=excute" + "&c0-id=0" + "&c0-param0=string:MWB_WT_USERLOGIN" + "&c0-param1=boolean:false" + "&c0-e1=string:22" + "&c0-e2=string:80000045" + "&c0-e3=string:" + encryptSmsCode + "&c0-e4=string:" + encryptMobile + "&c0-e5=string:" + areaCode + "&c0-e6=string:1" + "&c0-param2=Object_Object:{LOGIN_TYPE:reference:c0-e1, LOGIN_PRODUCT_ID:reference:c0-e2, LOGIN_PASSWD:reference:c0-e3, LOGIN_NAME:reference:c0-e4, AREA_CODE:reference:c0-e5, MY_CHECK_FLAG:reference:c0-e6}" + "&batchId=5";
            referer = "http://jx.189.cn/public/v4/logon/loginPop.jsp?from_sc=service_login&ret_url=";
            response = TaskHttpClient.create(param, RequestType.POST, "jiang_xi_10000_web_007").setFullUrl(templateUrl).setReferer(referer).setRequestBody(templateData,ContentType.TEXT_PLAIN).invoke();
            pageContent = response.getPageContent();
            if (StringUtils.isNotBlank(pageContent) && StringUtils.contains(pageContent, String.valueOf(param.getMobile())) && StringUtils.contains(pageContent, "IS_SUCCESS':\"1")) {
                logger.info("mobile login success!,set cookie string: " + TaskUtils.getCookieString(param.getTaskId()));
                String cookieStr = TaskUtils.getCookieString(param.getTaskId());

                templateUrl = "http://login.189.cn/";
                referer = "http://www.189.cn/html/login/index.html";
                response = TaskHttpClient.create(param, RequestType.GET, "jiang_xi_10000_web_008").setFullUrl(templateUrl).setReferer(referer).invoke();
                if (StringUtils.isBlank(response.getPageContent())) {
                    logger.error("jx189 login request is error! errormessage: pre login failed");
                    return result.failure(ErrorCode.NOT_EMPTY_ERROR_CODE);
                }

                invocable = ScriptEngineUtil.createInvocableFromBase64(javaScript1);
                String encryptPassWord = invocable.invokeFunction("aesEncrypt", param.getPassword()).toString();
                templateUrl = "http://login.189.cn/login";
                templateData = "Account=" + param.getMobile() + "&UType=201&ProvinceID=15&AreaCode=&CityNo=&RandomFlag=0&Password=" + URLEncoder.encode(encryptPassWord, "UTF-8") + "&Captcha=";
                referer = "http://login.189.cn/login";
                response = TaskHttpClient.create(param, RequestType.POST, "jiang_xi_10000_web_009").setFullUrl(templateUrl).setReferer(referer).setRequestBody(templateData).invoke();
                if (StringUtils.isBlank(response.getPageContent())) {
                    logger.error("jx189 login request loginre.189.cn error");
                    return result.failure(ErrorCode.NOT_EMPTY_ERROR_CODE);
                }

                templateUrl = "http://www.189.cn/login/index.do";
                referer = "http://www.189.cn/html/login/index.html";
                response = TaskHttpClient.create(param, RequestType.GET, "jiang_xi_10000_web_010").setFullUrl(templateUrl).setReferer(referer).invoke();
                pageContent = response.getPageContent();
                if (StringUtils.containsNone(pageContent, "code\":\"0")) {
                    logger.error("jx189 login check password failed");
                    return result.failure(ErrorCode.NOT_EMPTY_ERROR_CODE);
                }
                TaskUtils.addTaskShare(param.getTaskId(), PluginConstants.COOKIE, cookieStr);
                logger.info("登陆成功,param={}", param);
                return result.success();
            } else {
                logger.error("登陆失败,param={},pageContent={}", param, pageContent);
                return result.failure(ErrorCode.LOGIN_UNEXPECTED_RESULT);
            }
        } catch (Exception e) {
            logger.error("登陆失败,param={},response={}", param, response, e);
            return result.failure(ErrorCode.LOGIN_ERROR);
        }
    }

    private HttpResult<Map<String, Object>> refeshSmsCodeForBillDetail(OperatorParam param) {
        HttpResult<Map<String, Object>> result = new HttpResult<>();
        Response response = null;
        try {
            String templateUrl = "http://jx.189.cn/dwr/call/plaincall/Service.excute.dwr";
            String templateData = "callCount=1&page=/2017/details.jsp&httpSessionId=&scriptSessionId=" + scriptSessionId + "c0-scriptName=Service&c0-methodName=excute&" + "c0-id=0&" + "c0-param0=string:DETAILS_SERVICE&" + "c0-param1=boolean:false&" + "c0-e1=string:SEND_SMS_CODE&" + "c0-param2=Object_Object:{method:reference:c0-e1}&" + "batchId=1";
            String referer = "http://jx.189.cn/2017/details.jsp";
            response = TaskHttpClient.create(param, RequestType.POST, "jiang_xi_10000_web_011").setFullUrl(templateUrl).setRequestBody(templateData).setReferer(referer,ContentType.TEXT_PLAIN).invoke();
            String pageContent = response.getPageContent();
            if (StringUtils.contains(pageContent, "CODE:\"1\"")) {
                logger.info("详单-->短信验证码-->刷新成功,param={}", param);
                return result.success();
            } else {
                logger.error("详单-->短信验证码-->刷新失败,param={},pateContent={}", param, response.getPageContent());
                return result.failure(ErrorCode.REFESH_SMS_UNEXPECTED_RESULT);
            }
        } catch (Exception e) {
            logger.error("详单-->短信验证码-->刷新失败,param={},response={}", param, response, e);
            return result.failure(ErrorCode.REFESH_SMS_ERROR);
        }
    }

    private HttpResult<Map<String, Object>> submitForBillDetail(OperatorParam param) {
        HttpResult<Map<String, Object>> result = new HttpResult<>();
        Response response = null;
        try {
            SimpleDateFormat format = new SimpleDateFormat("yyyyMM");
            String queryMonth = format.format(new Date());
            String templateUrl = "http://jx.189.cn/dwr/call/plaincall/Service.excute.dwr";
            String templateData = "callCount=1&page=/2017/details.jsp&httpSessionId=&scriptSessionId=" + scriptSessionId + "&c0-scriptName=Service&c0-methodName=excute&c0-id=0&c0-param0=string:DETAILS_SERVICE&c0-param1=boolean:false&c0-e1=string:" + queryMonth + "&c0-e2=string:7&c0-e3=string:${smsCode}&c0-e4=string:QRY_DETAILS_BY_LOGIN_NBR&c0-param2=Object_Object:{month:reference:c0-e1, query_type:reference:c0-e2, valid_code:reference:c0-e3, method:reference:c0-e4}&batchId=2";
            String referer = "http://jx.189.cn/2017/details.jsp";
            response = TaskHttpClient.create(param, RequestType.POST, "jiang_xi_10000_web_012").setFullUrl(templateUrl).setRequestBody(templateData,ContentType.TEXT_PLAIN).setReferer(referer).invoke();
            String pageContent = response.getPageContent();
            TaskUtils.addTaskShare(param.getTaskId(), "scriptSessionId", scriptSessionId);
            if (StringUtils.contains(pageContent, "CODE:\"1\"")) {
                logger.info("详单-->校验成功,param={}", param);
                return result.success();
            } else {
                logger.error("详单-->校验失败,param={},pageContent={}", param, response.getPageContent());
                return result.failure(ErrorCode.VALIDATE_UNEXPECTED_RESULT);
            }

        } catch (Exception e) {
            logger.error("详单-->校验失败,param={},response={}", param, response, e);
            return result.failure(ErrorCode.VALIDATE_ERROR);
        }
    }

    private String getRandomNumber() {
        int number = 0;
        while (true) {
            number = (int) (Math.random() * 1000);
            if (number >= 100 && number < 1000) {
                break;
            }
        }
        return String.valueOf(number);

    }
}