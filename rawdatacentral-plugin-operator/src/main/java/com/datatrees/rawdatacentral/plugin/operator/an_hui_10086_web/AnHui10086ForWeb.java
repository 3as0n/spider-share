package com.datatrees.rawdatacentral.plugin.operator.an_hui_10086_web;

import javax.script.Invocable;
import java.io.InputStream;
import java.math.BigDecimal;
import java.net.URLEncoder;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONObject;
import com.alibaba.fastjson.JSONPath;
import com.datatrees.common.util.PatternUtils;
import com.datatrees.crawler.core.util.xpath.XPathUtil;
import com.datatrees.rawdatacentral.common.http.TaskHttpClient;
import com.datatrees.rawdatacentral.common.http.TaskUtils;
import com.datatrees.rawdatacentral.common.utils.CheckUtils;
import com.datatrees.rawdatacentral.common.utils.ScriptEngineUtil;
import com.datatrees.rawdatacentral.common.utils.TemplateUtils;
import com.datatrees.rawdatacentral.domain.constant.FormType;
import com.datatrees.rawdatacentral.domain.enums.ErrorCode;
import com.datatrees.rawdatacentral.domain.enums.RequestType;
import com.datatrees.rawdatacentral.domain.operator.OperatorParam;
import com.datatrees.rawdatacentral.domain.result.HttpResult;
import com.datatrees.rawdatacentral.domain.vo.Response;
import com.datatrees.rawdatacentral.service.OperatorPluginService;
import org.apache.commons.collections.CollectionUtils;
import org.apache.commons.lang3.StringUtils;
import org.apache.http.entity.ContentType;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

/**
 * Created by guimeichao on 17/9/12.
 */
public class AnHui10086ForWeb implements OperatorPluginService {

    private static final Logger logger                = LoggerFactory.getLogger(AnHui10086ForWeb.class);
    private static final String javaScript
                                                      = "ZnVuY3Rpb24gZW5TdHJpbmcoZGF0YSl7CnZhciBrZXkxID0gIllIWFdXTEtKWVhHUyI7CnZhciBrZXkyID0gIlpGQ0hIWVhGTDEwQyI7CnZhciBrZXkzID0gIkRFUyI7CiB2YXIgZW5jaGV4ID0gc3RyRW5jKGRhdGEsa2V5MSxrZXkyLGtleTMpOwogcmV0dXJuIGVuY2hleDsKfQovKioKUlNB5YqgL+ino+WvhgoqKi8KZnVuY3Rpb24gRW5jcnlTdHJpbmcoZW5TdHJpbmcpCiAgICB7CiAgICAgICAgaWYod2luZG93LkFjdGl2ZVhPYmplY3QpIC8vIElF5rWP6KeI5ZmoCiAgICAgICAgewogICAgICAgICAgICB4bWxIdHRwUmVxdWVzdCA9IG5ldyBBY3RpdmVYT2JqZWN0KCJNaWNyb3NvZnQuWE1MSFRUUCIpOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmKHdpbmRvdy5YTUxIdHRwUmVxdWVzdCkgLy8g6ZmkSUXku6XlpJbnmoTlhbbku5bmtY/op4jlmagKICAgICAgICB7CiAgICAgICAgICAgIHhtbEh0dHBSZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICAgfQogICAgICAgIGlmKG51bGwgIT0geG1sSHR0cFJlcXVlc3QpCiAgICAgICAgewogICAgICAgICAgIAogICAgICAgICAgICB4bWxIdHRwUmVxdWVzdC5vcGVuKCJQT1NUIiwgImh0dHA6Ly8xMjcuMC4wLjE6ODA4MS9zc282cXRuL0VuY3J5cHRTZXJ2bGV0IiwgZmFsc2UpOwogICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIOW9k+WPkeeUn+eKtuaAgeWPmOWMluaXtuWwseiwg+eUqOi/meS4quWbnuiwg+WHveaVsAogICAgICAgICAgICAvL3htbEh0dHBSZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGFqYXhDYWxsQmFjazsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIOS9v+eUqHBvc3Tmj5DkuqTml7blv4XpobvliqDkuIrkuIvpnaLov5nooYzku6PnoIEKICAgICAgICAgICAgeG1sSHR0cFJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcigiQ29udGVudC1UeXBlIiwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIik7ICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIOWQkeacjeWKoeWZqOWPkeWHuuS4gOS4quivt+axggogICAgICAgICAgICB4bWxIdHRwUmVxdWVzdC5zZW5kKCJlblN0cmluZz0iK2VuU3RyaW5nKTsKICAgICAgICAgICAgcmV0dXJuIHhtbEh0dHBSZXF1ZXN0LnJlc3BvbnNlVGV4dDsKICAgICAgICAgICAgICAKICAgICAgICB9CiAgICB9CmZ1bmN0aW9uIGFqYXhDYWxsQmFjaygpCnsKICAgICAgICBpZih4bWxIdHRwUmVxdWVzdC5yZWFkeVN0YXRlID09IDQpCiAgICAgICAgewogICAgICAgICAgICBpZih4bWxIdHRwUmVxdWVzdC5zdGF0dXMgPT0gMjAwKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB2YXIgY29udGVudCA9IHhtbEh0dHBSZXF1ZXN0LnJlc3BvbnNlVGV4dDsgIAogICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgfQp9CgovKioKKiBERVPliqDlr4Yv6Kej5a+GCiogQENvcHlyaWdodCBDb3B5cmlnaHQgKGMpIDIwMDkKKiBAYXV0aG9yIGxpbnNpCiovCgovKgoqIGVuY3J5cHQgdGhlIHN0cmluZyB0byBzdHJpbmcgbWFkZSB1cCBvZiBoZXgKKiByZXR1cm4gdGhlIGVuY3J5cHRlZCBzdHJpbmcKKi8KZnVuY3Rpb24gc3RyRW5jKGRhdGEsZmlyc3RLZXksc2Vjb25kS2V5LHRoaXJkS2V5KXsKCiB2YXIgbGVuZyA9IGRhdGEubGVuZ3RoOwogdmFyIGVuY0RhdGEgPSAiIjsKIHZhciBmaXJzdEtleUJ0LHNlY29uZEtleUJ0LHRoaXJkS2V5QnQsZmlyc3RMZW5ndGgsc2Vjb25kTGVuZ3RoLHRoaXJkTGVuZ3RoOwogaWYoZmlyc3RLZXkgIT0gbnVsbCAmJiBmaXJzdEtleSAhPSAiIil7ICAgIAogICBmaXJzdEtleUJ0ID0gZ2V0S2V5Qnl0ZXMoZmlyc3RLZXkpOwogICBmaXJzdExlbmd0aCA9IGZpcnN0S2V5QnQubGVuZ3RoOwogfQogaWYoc2Vjb25kS2V5ICE9IG51bGwgJiYgc2Vjb25kS2V5ICE9ICIiKXsKICAgc2Vjb25kS2V5QnQgPSBnZXRLZXlCeXRlcyhzZWNvbmRLZXkpOwogICBzZWNvbmRMZW5ndGggPSBzZWNvbmRLZXlCdC5sZW5ndGg7CiB9CiBpZih0aGlyZEtleSAhPSBudWxsICYmIHRoaXJkS2V5ICE9ICIiKXsKICAgdGhpcmRLZXlCdCA9IGdldEtleUJ5dGVzKHRoaXJkS2V5KTsKICAgdGhpcmRMZW5ndGggPSB0aGlyZEtleUJ0Lmxlbmd0aDsKIH0gIAogCiBpZihsZW5nID4gMCl7CiAgIGlmKGxlbmcgPCA0KXsKICAgICB2YXIgYnQgPSBzdHJUb0J0KGRhdGEpOyAgICAgIAogICAgIHZhciBlbmNCeXRlIDsKICAgICBpZihmaXJzdEtleSAhPSBudWxsICYmIGZpcnN0S2V5ICE9IiIgJiYgc2Vjb25kS2V5ICE9IG51bGwgJiYgc2Vjb25kS2V5ICE9ICIiICYmIHRoaXJkS2V5ICE9IG51bGwgJiYgdGhpcmRLZXkgIT0gIiIpewogICAgICAgdmFyIHRlbXBCdDsKICAgICAgIHZhciB4LHksejsKICAgICAgIHRlbXBCdCA9IGJ0OyAgICAgICAgCiAgICAgICBmb3IoeCA9IDA7eCA8IGZpcnN0TGVuZ3RoIDt4ICsrKXsKICAgICAgICAgdGVtcEJ0ID0gZW5jKHRlbXBCdCxmaXJzdEtleUJ0W3hdKTsKICAgICAgIH0KICAgICAgIGZvcih5ID0gMDt5IDwgc2Vjb25kTGVuZ3RoIDt5ICsrKXsKICAgICAgICAgdGVtcEJ0ID0gZW5jKHRlbXBCdCxzZWNvbmRLZXlCdFt5XSk7CiAgICAgICB9CiAgICAgICBmb3IoeiA9IDA7eiA8IHRoaXJkTGVuZ3RoIDt6ICsrKXsKICAgICAgICAgdGVtcEJ0ID0gZW5jKHRlbXBCdCx0aGlyZEtleUJ0W3pdKTsKICAgICAgIH0gICAgICAgIAogICAgICAgZW5jQnl0ZSA9IHRlbXBCdDsgICAgICAgIAogICAgIH1lbHNlewogICAgICAgaWYoZmlyc3RLZXkgIT0gbnVsbCAmJiBmaXJzdEtleSAhPSIiICYmIHNlY29uZEtleSAhPSBudWxsICYmIHNlY29uZEtleSAhPSAiIil7CiAgICAgICAgIHZhciB0ZW1wQnQ7CiAgICAgICAgIHZhciB4LHk7CiAgICAgICAgIHRlbXBCdCA9IGJ0OwogICAgICAgICBmb3IoeCA9IDA7eCA8IGZpcnN0TGVuZ3RoIDt4ICsrKXsKICAgICAgICAgICB0ZW1wQnQgPSBlbmModGVtcEJ0LGZpcnN0S2V5QnRbeF0pOwogICAgICAgICB9CiAgICAgICAgIGZvcih5ID0gMDt5IDwgc2Vjb25kTGVuZ3RoIDt5ICsrKXsKICAgICAgICAgICB0ZW1wQnQgPSBlbmModGVtcEJ0LHNlY29uZEtleUJ0W3ldKTsKICAgICAgICAgfQogICAgICAgICBlbmNCeXRlID0gdGVtcEJ0OwogICAgICAgfWVsc2V7CiAgICAgICAgIGlmKGZpcnN0S2V5ICE9IG51bGwgJiYgZmlyc3RLZXkgIT0iIil7ICAgICAgICAgICAgCiAgICAgICAgICAgdmFyIHRlbXBCdDsKICAgICAgICAgICB2YXIgeCA9IDA7CiAgICAgICAgICAgdGVtcEJ0ID0gYnQ7ICAgICAgICAgICAgCiAgICAgICAgICAgZm9yKHggPSAwO3ggPCBmaXJzdExlbmd0aCA7eCArKyl7CiAgICAgICAgICAgICB0ZW1wQnQgPSBlbmModGVtcEJ0LGZpcnN0S2V5QnRbeF0pOwogICAgICAgICAgIH0KICAgICAgICAgICBlbmNCeXRlID0gdGVtcEJ0OwogICAgICAgICB9CiAgICAgICB9ICAgICAgICAKICAgICB9CiAgICAgZW5jRGF0YSA9IGJ0NjRUb0hleChlbmNCeXRlKTsKICAgfWVsc2V7CiAgICAgdmFyIGl0ZXJhdG9yID0gcGFyc2VJbnQobGVuZy80KTsKICAgICB2YXIgcmVtYWluZGVyID0gbGVuZyU0OwogICAgIHZhciBpPTA7ICAgICAgCiAgICAgZm9yKGkgPSAwO2kgPCBpdGVyYXRvcjtpKyspewogICAgICAgdmFyIHRlbXBEYXRhID0gZGF0YS5zdWJzdHJpbmcoaSo0KzAsaSo0KzQpOwogICAgICAgdmFyIHRlbXBCeXRlID0gc3RyVG9CdCh0ZW1wRGF0YSk7CiAgICAgICB2YXIgZW5jQnl0ZSA7CiAgICAgICBpZihmaXJzdEtleSAhPSBudWxsICYmIGZpcnN0S2V5ICE9IiIgJiYgc2Vjb25kS2V5ICE9IG51bGwgJiYgc2Vjb25kS2V5ICE9ICIiICYmIHRoaXJkS2V5ICE9IG51bGwgJiYgdGhpcmRLZXkgIT0gIiIpewogICAgICAgICB2YXIgdGVtcEJ0OwogICAgICAgICB2YXIgeCx5LHo7CiAgICAgICAgIHRlbXBCdCA9IHRlbXBCeXRlOwogICAgICAgICBmb3IoeCA9IDA7eCA8IGZpcnN0TGVuZ3RoIDt4ICsrKXsKICAgICAgICAgICB0ZW1wQnQgPSBlbmModGVtcEJ0LGZpcnN0S2V5QnRbeF0pOwogICAgICAgICB9CiAgICAgICAgIGZvcih5ID0gMDt5IDwgc2Vjb25kTGVuZ3RoIDt5ICsrKXsKICAgICAgICAgICB0ZW1wQnQgPSBlbmModGVtcEJ0LHNlY29uZEtleUJ0W3ldKTsKICAgICAgICAgfQogICAgICAgICBmb3IoeiA9IDA7eiA8IHRoaXJkTGVuZ3RoIDt6ICsrKXsKICAgICAgICAgICB0ZW1wQnQgPSBlbmModGVtcEJ0LHRoaXJkS2V5QnRbel0pOwogICAgICAgICB9CiAgICAgICAgIGVuY0J5dGUgPSB0ZW1wQnQ7CiAgICAgICB9ZWxzZXsKICAgICAgICAgaWYoZmlyc3RLZXkgIT0gbnVsbCAmJiBmaXJzdEtleSAhPSIiICYmIHNlY29uZEtleSAhPSBudWxsICYmIHNlY29uZEtleSAhPSAiIil7CiAgICAgICAgICAgdmFyIHRlbXBCdDsKICAgICAgICAgICB2YXIgeCx5OwogICAgICAgICAgIHRlbXBCdCA9IHRlbXBCeXRlOwogICAgICAgICAgIGZvcih4ID0gMDt4IDwgZmlyc3RMZW5ndGggO3ggKyspewogICAgICAgICAgICAgdGVtcEJ0ID0gZW5jKHRlbXBCdCxmaXJzdEtleUJ0W3hdKTsKICAgICAgICAgICB9CiAgICAgICAgICAgZm9yKHkgPSAwO3kgPCBzZWNvbmRMZW5ndGggO3kgKyspewogICAgICAgICAgICAgdGVtcEJ0ID0gZW5jKHRlbXBCdCxzZWNvbmRLZXlCdFt5XSk7CiAgICAgICAgICAgfQogICAgICAgICAgIGVuY0J5dGUgPSB0ZW1wQnQ7CiAgICAgICAgIH1lbHNlewogICAgICAgICAgIGlmKGZpcnN0S2V5ICE9IG51bGwgJiYgZmlyc3RLZXkgIT0iIil7ICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgdmFyIHRlbXBCdDsKICAgICAgICAgICAgIHZhciB4OwogICAgICAgICAgICAgdGVtcEJ0ID0gdGVtcEJ5dGU7CiAgICAgICAgICAgICBmb3IoeCA9IDA7eCA8IGZpcnN0TGVuZ3RoIDt4ICsrKXsgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgIHRlbXBCdCA9IGVuYyh0ZW1wQnQsZmlyc3RLZXlCdFt4XSk7CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICBlbmNCeXRlID0gdGVtcEJ0OyAgICAgICAgICAgICAgCiAgICAgICAgICAgfQogICAgICAgICB9CiAgICAgICB9CiAgICAgICBlbmNEYXRhICs9IGJ0NjRUb0hleChlbmNCeXRlKTsKICAgICB9ICAgICAgCiAgICAgaWYocmVtYWluZGVyID4gMCl7CiAgICAgICB2YXIgcmVtYWluZGVyRGF0YSA9IGRhdGEuc3Vic3RyaW5nKGl0ZXJhdG9yKjQrMCxsZW5nKTsKICAgICAgIHZhciB0ZW1wQnl0ZSA9IHN0clRvQnQocmVtYWluZGVyRGF0YSk7CiAgICAgICB2YXIgZW5jQnl0ZSA7CiAgICAgICBpZihmaXJzdEtleSAhPSBudWxsICYmIGZpcnN0S2V5ICE9IiIgJiYgc2Vjb25kS2V5ICE9IG51bGwgJiYgc2Vjb25kS2V5ICE9ICIiICYmIHRoaXJkS2V5ICE9IG51bGwgJiYgdGhpcmRLZXkgIT0gIiIpewogICAgICAgICB2YXIgdGVtcEJ0OwogICAgICAgICB2YXIgeCx5LHo7CiAgICAgICAgIHRlbXBCdCA9IHRlbXBCeXRlOwogICAgICAgICBmb3IoeCA9IDA7eCA8IGZpcnN0TGVuZ3RoIDt4ICsrKXsKICAgICAgICAgICB0ZW1wQnQgPSBlbmModGVtcEJ0LGZpcnN0S2V5QnRbeF0pOwogICAgICAgICB9CiAgICAgICAgIGZvcih5ID0gMDt5IDwgc2Vjb25kTGVuZ3RoIDt5ICsrKXsKICAgICAgICAgICB0ZW1wQnQgPSBlbmModGVtcEJ0LHNlY29uZEtleUJ0W3ldKTsKICAgICAgICAgfQogICAgICAgICBmb3IoeiA9IDA7eiA8IHRoaXJkTGVuZ3RoIDt6ICsrKXsKICAgICAgICAgICB0ZW1wQnQgPSBlbmModGVtcEJ0LHRoaXJkS2V5QnRbel0pOwogICAgICAgICB9CiAgICAgICAgIGVuY0J5dGUgPSB0ZW1wQnQ7CiAgICAgICB9ZWxzZXsKICAgICAgICAgaWYoZmlyc3RLZXkgIT0gbnVsbCAmJiBmaXJzdEtleSAhPSIiICYmIHNlY29uZEtleSAhPSBudWxsICYmIHNlY29uZEtleSAhPSAiIil7CiAgICAgICAgICAgdmFyIHRlbXBCdDsKICAgICAgICAgICB2YXIgeCx5OwogICAgICAgICAgIHRlbXBCdCA9IHRlbXBCeXRlOwogICAgICAgICAgIGZvcih4ID0gMDt4IDwgZmlyc3RMZW5ndGggO3ggKyspewogICAgICAgICAgICAgdGVtcEJ0ID0gZW5jKHRlbXBCdCxmaXJzdEtleUJ0W3hdKTsKICAgICAgICAgICB9CiAgICAgICAgICAgZm9yKHkgPSAwO3kgPCBzZWNvbmRMZW5ndGggO3kgKyspewogICAgICAgICAgICAgdGVtcEJ0ID0gZW5jKHRlbXBCdCxzZWNvbmRLZXlCdFt5XSk7CiAgICAgICAgICAgfQogICAgICAgICAgIGVuY0J5dGUgPSB0ZW1wQnQ7CiAgICAgICAgIH1lbHNlewogICAgICAgICAgIGlmKGZpcnN0S2V5ICE9IG51bGwgJiYgZmlyc3RLZXkgIT0iIil7ICAgICAgICAgICAgCiAgICAgICAgICAgICB2YXIgdGVtcEJ0OwogICAgICAgICAgICAgdmFyIHg7CiAgICAgICAgICAgICB0ZW1wQnQgPSB0ZW1wQnl0ZTsKICAgICAgICAgICAgIGZvcih4ID0gMDt4IDwgZmlyc3RMZW5ndGggO3ggKyspewogICAgICAgICAgICAgICB0ZW1wQnQgPSBlbmModGVtcEJ0LGZpcnN0S2V5QnRbeF0pOwogICAgICAgICAgICAgfQogICAgICAgICAgICAgZW5jQnl0ZSA9IHRlbXBCdDsKICAgICAgICAgICB9CiAgICAgICAgIH0KICAgICAgIH0KICAgICAgIGVuY0RhdGEgKz0gYnQ2NFRvSGV4KGVuY0J5dGUpOwogICAgIH0gICAgICAgICAgICAgICAgCiAgIH0KIH0KIHJldHVybiBlbmNEYXRhOwp9CgovKgoqIGNoYW5nIHRoZSBzdHJpbmcgaW50byB0aGUgYml0IGFycmF5CiogCiogcmV0dXJuIGJpdCBhcnJheShpdCdzIGxlbmd0aCAlIDY0ID0gMCkKKi8KZnVuY3Rpb24gZ2V0S2V5Qnl0ZXMoa2V5KXsKIHZhciBrZXlCeXRlcyA9IG5ldyBBcnJheSgpOwogdmFyIGxlbmcgPSBrZXkubGVuZ3RoOwogdmFyIGl0ZXJhdG9yID0gcGFyc2VJbnQobGVuZy80KTsKIHZhciByZW1haW5kZXIgPSBsZW5nJTQ7CiB2YXIgaSA9IDA7CiBmb3IoaSA9IDA7aSA8IGl0ZXJhdG9yOyBpICsrKXsKICAga2V5Qnl0ZXNbaV0gPSBzdHJUb0J0KGtleS5zdWJzdHJpbmcoaSo0KzAsaSo0KzQpKTsKIH0KIGlmKHJlbWFpbmRlciA+IDApewogICBrZXlCeXRlc1tpXSA9IHN0clRvQnQoa2V5LnN1YnN0cmluZyhpKjQrMCxsZW5nKSk7CiB9ICAgIAogcmV0dXJuIGtleUJ5dGVzOwp9CgovKgoqIGNoYW5nIHRoZSBzdHJpbmcoaXQncyBsZW5ndGggPD0gNCkgaW50byB0aGUgYml0IGFycmF5CiogCiogcmV0dXJuIGJpdCBhcnJheShpdCdzIGxlbmd0aCA9IDY0KQoqLwpmdW5jdGlvbiBzdHJUb0J0KHN0cil7ICAKIHZhciBsZW5nID0gc3RyLmxlbmd0aDsKIHZhciBidCA9IG5ldyBBcnJheSg2NCk7CiBpZihsZW5nIDwgNCl7CiAgIHZhciBpPTAsaj0wLHA9MCxxPTA7CiAgIGZvcihpID0gMDtpPGxlbmc7aSsrKXsKICAgICB2YXIgayA9IHN0ci5jaGFyQ29kZUF0KGkpOwogICAgIGZvcihqPTA7ajwxNjtqKyspeyAgICAgIAogICAgICAgdmFyIHBvdz0xLG09MDsKICAgICAgIGZvcihtPTE1O20+ajttLS0pewogICAgICAgICBwb3cgKj0gMjsKICAgICAgIH0gICAgICAgIAogICAgICAgYnRbMTYqaStqXT1wYXJzZUludChrL3BvdyklMjsKICAgICB9CiAgIH0KICAgZm9yKHAgPSBsZW5nO3A8NDtwKyspewogICAgIHZhciBrID0gMDsKICAgICBmb3IocT0wO3E8MTY7cSsrKXsgICAgICAKICAgICAgIHZhciBwb3c9MSxtPTA7CiAgICAgICBmb3IobT0xNTttPnE7bS0tKXsKICAgICAgICAgcG93ICo9IDI7CiAgICAgICB9ICAgICAgICAKICAgICAgIGJ0WzE2KnArcV09cGFyc2VJbnQoay9wb3cpJTI7CiAgICAgfQogICB9ICAKIH1lbHNlewogICBmb3IoaSA9IDA7aTw0O2krKyl7CiAgICAgdmFyIGsgPSBzdHIuY2hhckNvZGVBdChpKTsKICAgICBmb3Ioaj0wO2o8MTY7aisrKXsgICAgICAKICAgICAgIHZhciBwb3c9MTsKICAgICAgIGZvcihtPTE1O20+ajttLS0pewogICAgICAgICBwb3cgKj0gMjsKICAgICAgIH0gICAgICAgIAogICAgICAgYnRbMTYqaStqXT1wYXJzZUludChrL3BvdyklMjsKICAgICB9CiAgIH0gIAogfQogcmV0dXJuIGJ0Owp9CgovKgoqIGNoYW5nIHRoZSBiaXQoaXQncyBsZW5ndGggPSA0KSBpbnRvIHRoZSBoZXgKKiAKKiByZXR1cm4gaGV4CiovCmZ1bmN0aW9uIGJ0NFRvSGV4KGJpbmFyeSkgewogdmFyIGhleDsKIHN3aXRjaCAoYmluYXJ5KSB7CiAgIGNhc2UgIjAwMDAiIDogaGV4ID0gIjAiOyBicmVhazsKICAgY2FzZSAiMDAwMSIgOiBoZXggPSAiMSI7IGJyZWFrOwogICBjYXNlICIwMDEwIiA6IGhleCA9ICIyIjsgYnJlYWs7CiAgIGNhc2UgIjAwMTEiIDogaGV4ID0gIjMiOyBicmVhazsKICAgY2FzZSAiMDEwMCIgOiBoZXggPSAiNCI7IGJyZWFrOwogICBjYXNlICIwMTAxIiA6IGhleCA9ICI1IjsgYnJlYWs7CiAgIGNhc2UgIjAxMTAiIDogaGV4ID0gIjYiOyBicmVhazsKICAgY2FzZSAiMDExMSIgOiBoZXggPSAiNyI7IGJyZWFrOwogICBjYXNlICIxMDAwIiA6IGhleCA9ICI4IjsgYnJlYWs7CiAgIGNhc2UgIjEwMDEiIDogaGV4ID0gIjkiOyBicmVhazsKICAgY2FzZSAiMTAxMCIgOiBoZXggPSAiQSI7IGJyZWFrOwogICBjYXNlICIxMDExIiA6IGhleCA9ICJCIjsgYnJlYWs7CiAgIGNhc2UgIjExMDAiIDogaGV4ID0gIkMiOyBicmVhazsKICAgY2FzZSAiMTEwMSIgOiBoZXggPSAiRCI7IGJyZWFrOwogICBjYXNlICIxMTEwIiA6IGhleCA9ICJFIjsgYnJlYWs7CiAgIGNhc2UgIjExMTEiIDogaGV4ID0gIkYiOyBicmVhazsKIH0KIHJldHVybiBoZXg7Cn0KCi8qCiogY2hhbmcgdGhlIGhleCBpbnRvIHRoZSBiaXQoaXQncyBsZW5ndGggPSA0KQoqIAoqIHJldHVybiB0aGUgYml0KGl0J3MgbGVuZ3RoID0gNCkKKi8KZnVuY3Rpb24gaGV4VG9CdDQoaGV4KSB7CiB2YXIgYmluYXJ5Owogc3dpdGNoIChoZXgpIHsKICAgY2FzZSAiMCIgOiBiaW5hcnkgPSAiMDAwMCI7IGJyZWFrOwogICBjYXNlICIxIiA6IGJpbmFyeSA9ICIwMDAxIjsgYnJlYWs7CiAgIGNhc2UgIjIiIDogYmluYXJ5ID0gIjAwMTAiOyBicmVhazsKICAgY2FzZSAiMyIgOiBiaW5hcnkgPSAiMDAxMSI7IGJyZWFrOwogICBjYXNlICI0IiA6IGJpbmFyeSA9ICIwMTAwIjsgYnJlYWs7CiAgIGNhc2UgIjUiIDogYmluYXJ5ID0gIjAxMDEiOyBicmVhazsKICAgY2FzZSAiNiIgOiBiaW5hcnkgPSAiMDExMCI7IGJyZWFrOwogICBjYXNlICI3IiA6IGJpbmFyeSA9ICIwMTExIjsgYnJlYWs7CiAgIGNhc2UgIjgiIDogYmluYXJ5ID0gIjEwMDAiOyBicmVhazsKICAgY2FzZSAiOSIgOiBiaW5hcnkgPSAiMTAwMSI7IGJyZWFrOwogICBjYXNlICJBIiA6IGJpbmFyeSA9ICIxMDEwIjsgYnJlYWs7CiAgIGNhc2UgIkIiIDogYmluYXJ5ID0gIjEwMTEiOyBicmVhazsKICAgY2FzZSAiQyIgOiBiaW5hcnkgPSAiMTEwMCI7IGJyZWFrOwogICBjYXNlICJEIiA6IGJpbmFyeSA9ICIxMTAxIjsgYnJlYWs7CiAgIGNhc2UgIkUiIDogYmluYXJ5ID0gIjExMTAiOyBicmVhazsKICAgY2FzZSAiRiIgOiBiaW5hcnkgPSAiMTExMSI7IGJyZWFrOwogfQogcmV0dXJuIGJpbmFyeTsKfQoKLyoKKiBjaGFuZyB0aGUgYml0KGl0J3MgbGVuZ3RoID0gNjQpIGludG8gdGhlIHN0cmluZwoqIAoqIHJldHVybiBzdHJpbmcKKi8KZnVuY3Rpb24gYnl0ZVRvU3RyaW5nKGJ5dGVEYXRhKXsKIHZhciBzdHI9IiI7CiBmb3IoaSA9IDA7aTw0O2krKyl7CiAgIHZhciBjb3VudD0wOwogICBmb3Ioaj0wO2o8MTY7aisrKXsgICAgICAgIAogICAgIHZhciBwb3c9MTsKICAgICBmb3IobT0xNTttPmo7bS0tKXsKICAgICAgIHBvdyo9MjsKICAgICB9ICAgICAgICAgICAgICAKICAgICBjb3VudCs9Ynl0ZURhdGFbMTYqaStqXSpwb3c7CiAgIH0gICAgICAgIAogICBpZihjb3VudCAhPSAwKXsKICAgICBzdHIrPVN0cmluZy5mcm9tQ2hhckNvZGUoY291bnQpOwogICB9CiB9CiByZXR1cm4gc3RyOwp9CgpmdW5jdGlvbiBidDY0VG9IZXgoYnl0ZURhdGEpewogdmFyIGhleCA9ICIiOwogZm9yKGkgPSAwO2k8MTY7aSsrKXsKICAgdmFyIGJ0ID0gIiI7CiAgIGZvcihqPTA7ajw0O2orKyl7ICAgIAogICAgIGJ0ICs9IGJ5dGVEYXRhW2kqNCtqXTsKICAgfSAgICAKICAgaGV4Kz1idDRUb0hleChidCk7CiB9CiByZXR1cm4gaGV4Owp9CgpmdW5jdGlvbiBoZXhUb0J0NjQoaGV4KXsKIHZhciBiaW5hcnkgPSAiIjsKIGZvcihpID0gMDtpPDE2O2krKyl7CiAgIGJpbmFyeSs9aGV4VG9CdDQoaGV4LnN1YnN0cmluZyhpLGkrMSkpOwogfQogcmV0dXJuIGJpbmFyeTsKfQoKLyoKKiB0aGUgNjQgYml0IGRlcyBjb3JlIGFyaXRobWV0aWMKKi8KCmZ1bmN0aW9uIGVuYyhkYXRhQnl0ZSxrZXlCeXRlKXsgIAogdmFyIGtleXMgPSBnZW5lcmF0ZUtleXMoa2V5Qnl0ZSk7ICAgIAogdmFyIGlwQnl0ZSAgID0gaW5pdFBlcm11dGUoZGF0YUJ5dGUpOyAgCiB2YXIgaXBMZWZ0ICAgPSBuZXcgQXJyYXkoMzIpOwogdmFyIGlwUmlnaHQgID0gbmV3IEFycmF5KDMyKTsKIHZhciB0ZW1wTGVmdCA9IG5ldyBBcnJheSgzMik7CiB2YXIgaSA9IDAsaiA9IDAsayA9IDAsbSA9IDAsIG4gPSAwOwogZm9yKGsgPSAwO2sgPCAzMjtrICsrKXsKICAgaXBMZWZ0W2tdID0gaXBCeXRlW2tdOwogICBpcFJpZ2h0W2tdID0gaXBCeXRlWzMyK2tdOwogfSAgICAKIGZvcihpID0gMDtpIDwgMTY7aSArKyl7CiAgIGZvcihqID0gMDtqIDwgMzI7aiArKyl7CiAgICAgdGVtcExlZnRbal0gPSBpcExlZnRbal07CiAgICAgaXBMZWZ0W2pdID0gaXBSaWdodFtqXTsgICAgICAKICAgfSAgCiAgIHZhciBrZXkgPSBuZXcgQXJyYXkoNDgpOwogICBmb3IobSA9IDA7bSA8IDQ4O20gKyspewogICAgIGtleVttXSA9IGtleXNbaV1bbV07CiAgIH0KICAgdmFyICB0ZW1wUmlnaHQgPSB4b3IocFBlcm11dGUoc0JveFBlcm11dGUoeG9yKGV4cGFuZFBlcm11dGUoaXBSaWdodCksa2V5KSkpLCB0ZW1wTGVmdCk7ICAgICAgCiAgIGZvcihuID0gMDtuIDwgMzI7biArKyl7CiAgICAgaXBSaWdodFtuXSA9IHRlbXBSaWdodFtuXTsKICAgfSAgCiAgIAogfSAgCiAKIAogdmFyIGZpbmFsRGF0YSA9bmV3IEFycmF5KDY0KTsKIGZvcihpID0gMDtpIDwgMzI7aSArKyl7CiAgIGZpbmFsRGF0YVtpXSA9IGlwUmlnaHRbaV07CiAgIGZpbmFsRGF0YVszMitpXSA9IGlwTGVmdFtpXTsKIH0KIHJldHVybiBmaW5hbGx5UGVybXV0ZShmaW5hbERhdGEpOyAgCn0KCmZ1bmN0aW9uIGRlYyhkYXRhQnl0ZSxrZXlCeXRlKXsgIAogdmFyIGtleXMgPSBnZW5lcmF0ZUtleXMoa2V5Qnl0ZSk7ICAgIAogdmFyIGlwQnl0ZSAgID0gaW5pdFBlcm11dGUoZGF0YUJ5dGUpOyAgCiB2YXIgaXBMZWZ0ICAgPSBuZXcgQXJyYXkoMzIpOwogdmFyIGlwUmlnaHQgID0gbmV3IEFycmF5KDMyKTsKIHZhciB0ZW1wTGVmdCA9IG5ldyBBcnJheSgzMik7CiB2YXIgaSA9IDAsaiA9IDAsayA9IDAsbSA9IDAsIG4gPSAwOwogZm9yKGsgPSAwO2sgPCAzMjtrICsrKXsKICAgaXBMZWZ0W2tdID0gaXBCeXRlW2tdOwogICBpcFJpZ2h0W2tdID0gaXBCeXRlWzMyK2tdOwogfSAgCiBmb3IoaSA9IDE1O2kgPj0gMDtpIC0tKXsKICAgZm9yKGogPSAwO2ogPCAzMjtqICsrKXsKICAgICB0ZW1wTGVmdFtqXSA9IGlwTGVmdFtqXTsKICAgICBpcExlZnRbal0gPSBpcFJpZ2h0W2pdOyAgICAgIAogICB9ICAKICAgdmFyIGtleSA9IG5ldyBBcnJheSg0OCk7CiAgIGZvcihtID0gMDttIDwgNDg7bSArKyl7CiAgICAga2V5W21dID0ga2V5c1tpXVttXTsKICAgfQogICAKICAgdmFyICB0ZW1wUmlnaHQgPSB4b3IocFBlcm11dGUoc0JveFBlcm11dGUoeG9yKGV4cGFuZFBlcm11dGUoaXBSaWdodCksa2V5KSkpLCB0ZW1wTGVmdCk7ICAgICAgCiAgIGZvcihuID0gMDtuIDwgMzI7biArKyl7CiAgICAgaXBSaWdodFtuXSA9IHRlbXBSaWdodFtuXTsKICAgfSAgCiB9ICAKIAogCiB2YXIgZmluYWxEYXRhID1uZXcgQXJyYXkoNjQpOwogZm9yKGkgPSAwO2kgPCAzMjtpICsrKXsKICAgZmluYWxEYXRhW2ldID0gaXBSaWdodFtpXTsKICAgZmluYWxEYXRhWzMyK2ldID0gaXBMZWZ0W2ldOwogfQogcmV0dXJuIGZpbmFsbHlQZXJtdXRlKGZpbmFsRGF0YSk7ICAKfQoKZnVuY3Rpb24gaW5pdFBlcm11dGUob3JpZ2luYWxEYXRhKXsKIHZhciBpcEJ5dGUgPSBuZXcgQXJyYXkoNjQpOwogZm9yIChpID0gMCwgbSA9IDEsIG4gPSAwOyBpIDwgNDsgaSsrLCBtICs9IDIsIG4gKz0gMikgewogICBmb3IgKGogPSA3LCBrID0gMDsgaiA+PSAwOyBqLS0sIGsrKykgewogICAgIGlwQnl0ZVtpICogOCArIGtdID0gb3JpZ2luYWxEYXRhW2ogKiA4ICsgbV07CiAgICAgaXBCeXRlW2kgKiA4ICsgayArIDMyXSA9IG9yaWdpbmFsRGF0YVtqICogOCArIG5dOwogICB9CiB9ICAgIAogcmV0dXJuIGlwQnl0ZTsKfQoKZnVuY3Rpb24gZXhwYW5kUGVybXV0ZShyaWdodERhdGEpeyAgCiB2YXIgZXBCeXRlID0gbmV3IEFycmF5KDQ4KTsKIGZvciAoaSA9IDA7IGkgPCA4OyBpKyspIHsKICAgaWYgKGkgPT0gMCkgewogICAgIGVwQnl0ZVtpICogNiArIDBdID0gcmlnaHREYXRhWzMxXTsKICAgfSBlbHNlIHsKICAgICBlcEJ5dGVbaSAqIDYgKyAwXSA9IHJpZ2h0RGF0YVtpICogNCAtIDFdOwogICB9CiAgIGVwQnl0ZVtpICogNiArIDFdID0gcmlnaHREYXRhW2kgKiA0ICsgMF07CiAgIGVwQnl0ZVtpICogNiArIDJdID0gcmlnaHREYXRhW2kgKiA0ICsgMV07CiAgIGVwQnl0ZVtpICogNiArIDNdID0gcmlnaHREYXRhW2kgKiA0ICsgMl07CiAgIGVwQnl0ZVtpICogNiArIDRdID0gcmlnaHREYXRhW2kgKiA0ICsgM107CiAgIGlmIChpID09IDcpIHsKICAgICBlcEJ5dGVbaSAqIDYgKyA1XSA9IHJpZ2h0RGF0YVswXTsKICAgfSBlbHNlIHsKICAgICBlcEJ5dGVbaSAqIDYgKyA1XSA9IHJpZ2h0RGF0YVtpICogNCArIDRdOwogICB9CiB9ICAgICAgCiByZXR1cm4gZXBCeXRlOwp9CgpmdW5jdGlvbiB4b3IoYnl0ZU9uZSxieXRlVHdvKXsgIAogdmFyIHhvckJ5dGUgPSBuZXcgQXJyYXkoYnl0ZU9uZS5sZW5ndGgpOwogZm9yKGkgPSAwO2kgPCBieXRlT25lLmxlbmd0aDsgaSArKyl7ICAgICAgCiAgIHhvckJ5dGVbaV0gPSBieXRlT25lW2ldIF4gYnl0ZVR3b1tpXTsKIH0gIAogcmV0dXJuIHhvckJ5dGU7Cn0KCmZ1bmN0aW9uIHNCb3hQZXJtdXRlKGV4cGFuZEJ5dGUpewogCiAgIHZhciBzQm94Qnl0ZSA9IG5ldyBBcnJheSgzMik7CiAgIHZhciBiaW5hcnkgPSAiIjsKICAgdmFyIHMxID0gWwogICAgICAgWzE0LCA0LCAxMywgMSwgMiwgMTUsIDExLCA4LCAzLCAxMCwgNiwgMTIsIDUsIDksIDAsIDddLAogICAgICAgWzAsIDE1LCA3LCA0LCAxNCwgMiwgMTMsIDEsIDEwLCA2LCAxMiwgMTEsIDksIDUsIDMsIDhdLAogICAgICAgWzQsIDEsIDE0LCA4LCAxMywgNiwgMiwgMTEsIDE1LCAxMiwgOSwgNywgMywgMTAsIDUsIDBdLAogICAgICAgWzE1LCAxMiwgOCwgMiwgNCwgOSwgMSwgNywgNSwgMTEsIDMsIDE0LCAxMCwgMCwgNiwgMTMgXV07CgogICAgICAgLyogVGFibGUgLSBzMiAqLwogICB2YXIgczIgPSBbCiAgICAgICBbMTUsIDEsIDgsIDE0LCA2LCAxMSwgMywgNCwgOSwgNywgMiwgMTMsIDEyLCAwLCA1LCAxMF0sCiAgICAgICBbMywgMTMsIDQsIDcsIDE1LCAyLCA4LCAxNCwgMTIsIDAsIDEsIDEwLCA2LCA5LCAxMSwgNV0sCiAgICAgICBbMCwgMTQsIDcsIDExLCAxMCwgNCwgMTMsIDEsIDUsIDgsIDEyLCA2LCA5LCAzLCAyLCAxNV0sCiAgICAgICBbMTMsIDgsIDEwLCAxLCAzLCAxNSwgNCwgMiwgMTEsIDYsIDcsIDEyLCAwLCA1LCAxNCwgOSBdXTsKCiAgICAgICAvKiBUYWJsZSAtIHMzICovCiAgIHZhciBzMz0gWwogICAgICAgWzEwLCAwLCA5LCAxNCwgNiwgMywgMTUsIDUsIDEsIDEzLCAxMiwgNywgMTEsIDQsIDIsIDhdLAogICAgICAgWzEzLCA3LCAwLCA5LCAzLCA0LCA2LCAxMCwgMiwgOCwgNSwgMTQsIDEyLCAxMSwgMTUsIDFdLAogICAgICAgWzEzLCA2LCA0LCA5LCA4LCAxNSwgMywgMCwgMTEsIDEsIDIsIDEyLCA1LCAxMCwgMTQsIDddLAogICAgICAgWzEsIDEwLCAxMywgMCwgNiwgOSwgOCwgNywgNCwgMTUsIDE0LCAzLCAxMSwgNSwgMiwgMTIgXV07CiAgICAgICAvKiBUYWJsZSAtIHM0ICovCiAgIHZhciBzNCA9IFsKICAgICAgIFs3LCAxMywgMTQsIDMsIDAsIDYsIDksIDEwLCAxLCAyLCA4LCA1LCAxMSwgMTIsIDQsIDE1XSwKICAgICAgIFsxMywgOCwgMTEsIDUsIDYsIDE1LCAwLCAzLCA0LCA3LCAyLCAxMiwgMSwgMTAsIDE0LCA5XSwKICAgICAgIFsxMCwgNiwgOSwgMCwgMTIsIDExLCA3LCAxMywgMTUsIDEsIDMsIDE0LCA1LCAyLCA4LCA0XSwKICAgICAgIFszLCAxNSwgMCwgNiwgMTAsIDEsIDEzLCA4LCA5LCA0LCA1LCAxMSwgMTIsIDcsIDIsIDE0IF1dOwoKICAgICAgIC8qIFRhYmxlIC0gczUgKi8KICAgdmFyIHM1ID0gWwogICAgICAgWzIsIDEyLCA0LCAxLCA3LCAxMCwgMTEsIDYsIDgsIDUsIDMsIDE1LCAxMywgMCwgMTQsIDldLAogICAgICAgWzE0LCAxMSwgMiwgMTIsIDQsIDcsIDEzLCAxLCA1LCAwLCAxNSwgMTAsIDMsIDksIDgsIDZdLAogICAgICAgWzQsIDIsIDEsIDExLCAxMCwgMTMsIDcsIDgsIDE1LCA5LCAxMiwgNSwgNiwgMywgMCwgMTRdLAogICAgICAgWzExLCA4LCAxMiwgNywgMSwgMTQsIDIsIDEzLCA2LCAxNSwgMCwgOSwgMTAsIDQsIDUsIDMgXV07CgogICAgICAgLyogVGFibGUgLSBzNiAqLwogICB2YXIgczYgPSBbCiAgICAgICBbMTIsIDEsIDEwLCAxNSwgOSwgMiwgNiwgOCwgMCwgMTMsIDMsIDQsIDE0LCA3LCA1LCAxMV0sCiAgICAgICBbMTAsIDE1LCA0LCAyLCA3LCAxMiwgOSwgNSwgNiwgMSwgMTMsIDE0LCAwLCAxMSwgMywgOF0sCiAgICAgICBbOSwgMTQsIDE1LCA1LCAyLCA4LCAxMiwgMywgNywgMCwgNCwgMTAsIDEsIDEzLCAxMSwgNl0sCiAgICAgICBbNCwgMywgMiwgMTIsIDksIDUsIDE1LCAxMCwgMTEsIDE0LCAxLCA3LCA2LCAwLCA4LCAxMyBdXTsKCiAgICAgICAvKiBUYWJsZSAtIHM3ICovCiAgIHZhciBzNyA9IFsKICAgICAgIFs0LCAxMSwgMiwgMTQsIDE1LCAwLCA4LCAxMywgMywgMTIsIDksIDcsIDUsIDEwLCA2LCAxXSwKICAgICAgIFsxMywgMCwgMTEsIDcsIDQsIDksIDEsIDEwLCAxNCwgMywgNSwgMTIsIDIsIDE1LCA4LCA2XSwKICAgICAgIFsxLCA0LCAxMSwgMTMsIDEyLCAzLCA3LCAxNCwgMTAsIDE1LCA2LCA4LCAwLCA1LCA5LCAyXSwKICAgICAgIFs2LCAxMSwgMTMsIDgsIDEsIDQsIDEwLCA3LCA5LCA1LCAwLCAxNSwgMTQsIDIsIDMsIDEyXV07CgogICAgICAgLyogVGFibGUgLSBzOCAqLwogICB2YXIgczggPSBbCiAgICAgICBbMTMsIDIsIDgsIDQsIDYsIDE1LCAxMSwgMSwgMTAsIDksIDMsIDE0LCA1LCAwLCAxMiwgN10sCiAgICAgICBbMSwgMTUsIDEzLCA4LCAxMCwgMywgNywgNCwgMTIsIDUsIDYsIDExLCAwLCAxNCwgOSwgMl0sCiAgICAgICBbNywgMTEsIDQsIDEsIDksIDEyLCAxNCwgMiwgMCwgNiwgMTAsIDEzLCAxNSwgMywgNSwgOF0sCiAgICAgICBbMiwgMSwgMTQsIDcsIDQsIDEwLCA4LCAxMywgMTUsIDEyLCA5LCAwLCAzLCA1LCA2LCAxMV1dOwogICAKICAgZm9yKG09MDttPDg7bSsrKXsKICAgdmFyIGk9MCxqPTA7CiAgIGkgPSBleHBhbmRCeXRlW20qNiswXSoyK2V4cGFuZEJ5dGVbbSo2KzVdOwogICBqID0gZXhwYW5kQnl0ZVttICogNiArIDFdICogMiAqIDIgKiAyIAogICAgICsgZXhwYW5kQnl0ZVttICogNiArIDJdICogMiogMiAKICAgICArIGV4cGFuZEJ5dGVbbSAqIDYgKyAzXSAqIDIgCiAgICAgKyBleHBhbmRCeXRlW20gKiA2ICsgNF07CiAgIHN3aXRjaCAobSkgewogICAgIGNhc2UgMCA6CiAgICAgICBiaW5hcnkgPSBnZXRCb3hCaW5hcnkoczFbaV1bal0pOwogICAgICAgYnJlYWs7CiAgICAgY2FzZSAxIDoKICAgICAgIGJpbmFyeSA9IGdldEJveEJpbmFyeShzMltpXVtqXSk7CiAgICAgICBicmVhazsKICAgICBjYXNlIDIgOgogICAgICAgYmluYXJ5ID0gZ2V0Qm94QmluYXJ5KHMzW2ldW2pdKTsKICAgICAgIGJyZWFrOwogICAgIGNhc2UgMyA6CiAgICAgICBiaW5hcnkgPSBnZXRCb3hCaW5hcnkoczRbaV1bal0pOwogICAgICAgYnJlYWs7CiAgICAgY2FzZSA0IDoKICAgICAgIGJpbmFyeSA9IGdldEJveEJpbmFyeShzNVtpXVtqXSk7CiAgICAgICBicmVhazsKICAgICBjYXNlIDUgOgogICAgICAgYmluYXJ5ID0gZ2V0Qm94QmluYXJ5KHM2W2ldW2pdKTsKICAgICAgIGJyZWFrOwogICAgIGNhc2UgNiA6CiAgICAgICBiaW5hcnkgPSBnZXRCb3hCaW5hcnkoczdbaV1bal0pOwogICAgICAgYnJlYWs7CiAgICAgY2FzZSA3IDoKICAgICAgIGJpbmFyeSA9IGdldEJveEJpbmFyeShzOFtpXVtqXSk7CiAgICAgICBicmVhazsKICAgfSAgICAgIAogICBzQm94Qnl0ZVttKjQrMF0gPSBwYXJzZUludChiaW5hcnkuc3Vic3RyaW5nKDAsMSkpOwogICBzQm94Qnl0ZVttKjQrMV0gPSBwYXJzZUludChiaW5hcnkuc3Vic3RyaW5nKDEsMikpOwogICBzQm94Qnl0ZVttKjQrMl0gPSBwYXJzZUludChiaW5hcnkuc3Vic3RyaW5nKDIsMykpOwogICBzQm94Qnl0ZVttKjQrM10gPSBwYXJzZUludChiaW5hcnkuc3Vic3RyaW5nKDMsNCkpOwogfQogcmV0dXJuIHNCb3hCeXRlOwp9CgpmdW5jdGlvbiBwUGVybXV0ZShzQm94Qnl0ZSl7CiB2YXIgcEJveFBlcm11dGUgPSBuZXcgQXJyYXkoMzIpOwogcEJveFBlcm11dGVbIDBdID0gc0JveEJ5dGVbMTVdOyAKIHBCb3hQZXJtdXRlWyAxXSA9IHNCb3hCeXRlWyA2XTsgCiBwQm94UGVybXV0ZVsgMl0gPSBzQm94Qnl0ZVsxOV07IAogcEJveFBlcm11dGVbIDNdID0gc0JveEJ5dGVbMjBdOyAKIHBCb3hQZXJtdXRlWyA0XSA9IHNCb3hCeXRlWzI4XTsgCiBwQm94UGVybXV0ZVsgNV0gPSBzQm94Qnl0ZVsxMV07IAogcEJveFBlcm11dGVbIDZdID0gc0JveEJ5dGVbMjddOyAKIHBCb3hQZXJtdXRlWyA3XSA9IHNCb3hCeXRlWzE2XTsgCiBwQm94UGVybXV0ZVsgOF0gPSBzQm94Qnl0ZVsgMF07IAogcEJveFBlcm11dGVbIDldID0gc0JveEJ5dGVbMTRdOyAKIHBCb3hQZXJtdXRlWzEwXSA9IHNCb3hCeXRlWzIyXTsgCiBwQm94UGVybXV0ZVsxMV0gPSBzQm94Qnl0ZVsyNV07IAogcEJveFBlcm11dGVbMTJdID0gc0JveEJ5dGVbIDRdOyAKIHBCb3hQZXJtdXRlWzEzXSA9IHNCb3hCeXRlWzE3XTsgCiBwQm94UGVybXV0ZVsxNF0gPSBzQm94Qnl0ZVszMF07IAogcEJveFBlcm11dGVbMTVdID0gc0JveEJ5dGVbIDldOyAKIHBCb3hQZXJtdXRlWzE2XSA9IHNCb3hCeXRlWyAxXTsgCiBwQm94UGVybXV0ZVsxN10gPSBzQm94Qnl0ZVsgN107IAogcEJveFBlcm11dGVbMThdID0gc0JveEJ5dGVbMjNdOyAKIHBCb3hQZXJtdXRlWzE5XSA9IHNCb3hCeXRlWzEzXTsgCiBwQm94UGVybXV0ZVsyMF0gPSBzQm94Qnl0ZVszMV07IAogcEJveFBlcm11dGVbMjFdID0gc0JveEJ5dGVbMjZdOyAKIHBCb3hQZXJtdXRlWzIyXSA9IHNCb3hCeXRlWyAyXTsgCiBwQm94UGVybXV0ZVsyM10gPSBzQm94Qnl0ZVsgOF07IAogcEJveFBlcm11dGVbMjRdID0gc0JveEJ5dGVbMThdOyAKIHBCb3hQZXJtdXRlWzI1XSA9IHNCb3hCeXRlWzEyXTsgCiBwQm94UGVybXV0ZVsyNl0gPSBzQm94Qnl0ZVsyOV07IAogcEJveFBlcm11dGVbMjddID0gc0JveEJ5dGVbIDVdOyAKIHBCb3hQZXJtdXRlWzI4XSA9IHNCb3hCeXRlWzIxXTsgCiBwQm94UGVybXV0ZVsyOV0gPSBzQm94Qnl0ZVsxMF07IAogcEJveFBlcm11dGVbMzBdID0gc0JveEJ5dGVbIDNdOyAKIHBCb3hQZXJtdXRlWzMxXSA9IHNCb3hCeXRlWzI0XTsgICAgCiByZXR1cm4gcEJveFBlcm11dGU7Cn0KCmZ1bmN0aW9uIGZpbmFsbHlQZXJtdXRlKGVuZEJ5dGUpeyAgICAKIHZhciBmcEJ5dGUgPSBuZXcgQXJyYXkoNjQpOyAgCiBmcEJ5dGVbIDBdID0gZW5kQnl0ZVszOV07IAogZnBCeXRlWyAxXSA9IGVuZEJ5dGVbIDddOyAKIGZwQnl0ZVsgMl0gPSBlbmRCeXRlWzQ3XTsgCiBmcEJ5dGVbIDNdID0gZW5kQnl0ZVsxNV07IAogZnBCeXRlWyA0XSA9IGVuZEJ5dGVbNTVdOyAKIGZwQnl0ZVsgNV0gPSBlbmRCeXRlWzIzXTsgCiBmcEJ5dGVbIDZdID0gZW5kQnl0ZVs2M107IAogZnBCeXRlWyA3XSA9IGVuZEJ5dGVbMzFdOyAKIGZwQnl0ZVsgOF0gPSBlbmRCeXRlWzM4XTsgCiBmcEJ5dGVbIDldID0gZW5kQnl0ZVsgNl07IAogZnBCeXRlWzEwXSA9IGVuZEJ5dGVbNDZdOyAKIGZwQnl0ZVsxMV0gPSBlbmRCeXRlWzE0XTsgCiBmcEJ5dGVbMTJdID0gZW5kQnl0ZVs1NF07IAogZnBCeXRlWzEzXSA9IGVuZEJ5dGVbMjJdOyAKIGZwQnl0ZVsxNF0gPSBlbmRCeXRlWzYyXTsgCiBmcEJ5dGVbMTVdID0gZW5kQnl0ZVszMF07IAogZnBCeXRlWzE2XSA9IGVuZEJ5dGVbMzddOyAKIGZwQnl0ZVsxN10gPSBlbmRCeXRlWyA1XTsgCiBmcEJ5dGVbMThdID0gZW5kQnl0ZVs0NV07IAogZnBCeXRlWzE5XSA9IGVuZEJ5dGVbMTNdOyAKIGZwQnl0ZVsyMF0gPSBlbmRCeXRlWzUzXTsgCiBmcEJ5dGVbMjFdID0gZW5kQnl0ZVsyMV07IAogZnBCeXRlWzIyXSA9IGVuZEJ5dGVbNjFdOyAKIGZwQnl0ZVsyM10gPSBlbmRCeXRlWzI5XTsgCiBmcEJ5dGVbMjRdID0gZW5kQnl0ZVszNl07IAogZnBCeXRlWzI1XSA9IGVuZEJ5dGVbIDRdOyAKIGZwQnl0ZVsyNl0gPSBlbmRCeXRlWzQ0XTsgCiBmcEJ5dGVbMjddID0gZW5kQnl0ZVsxMl07IAogZnBCeXRlWzI4XSA9IGVuZEJ5dGVbNTJdOyAKIGZwQnl0ZVsyOV0gPSBlbmRCeXRlWzIwXTsgCiBmcEJ5dGVbMzBdID0gZW5kQnl0ZVs2MF07IAogZnBCeXRlWzMxXSA9IGVuZEJ5dGVbMjhdOyAKIGZwQnl0ZVszMl0gPSBlbmRCeXRlWzM1XTsgCiBmcEJ5dGVbMzNdID0gZW5kQnl0ZVsgM107IAogZnBCeXRlWzM0XSA9IGVuZEJ5dGVbNDNdOyAKIGZwQnl0ZVszNV0gPSBlbmRCeXRlWzExXTsgCiBmcEJ5dGVbMzZdID0gZW5kQnl0ZVs1MV07IAogZnBCeXRlWzM3XSA9IGVuZEJ5dGVbMTldOyAKIGZwQnl0ZVszOF0gPSBlbmRCeXRlWzU5XTsgCiBmcEJ5dGVbMzldID0gZW5kQnl0ZVsyN107IAogZnBCeXRlWzQwXSA9IGVuZEJ5dGVbMzRdOyAKIGZwQnl0ZVs0MV0gPSBlbmRCeXRlWyAyXTsgCiBmcEJ5dGVbNDJdID0gZW5kQnl0ZVs0Ml07IAogZnBCeXRlWzQzXSA9IGVuZEJ5dGVbMTBdOyAKIGZwQnl0ZVs0NF0gPSBlbmRCeXRlWzUwXTsgCiBmcEJ5dGVbNDVdID0gZW5kQnl0ZVsxOF07IAogZnBCeXRlWzQ2XSA9IGVuZEJ5dGVbNThdOyAKIGZwQnl0ZVs0N10gPSBlbmRCeXRlWzI2XTsgCiBmcEJ5dGVbNDhdID0gZW5kQnl0ZVszM107IAogZnBCeXRlWzQ5XSA9IGVuZEJ5dGVbIDFdOyAKIGZwQnl0ZVs1MF0gPSBlbmRCeXRlWzQxXTsgCiBmcEJ5dGVbNTFdID0gZW5kQnl0ZVsgOV07IAogZnBCeXRlWzUyXSA9IGVuZEJ5dGVbNDldOyAKIGZwQnl0ZVs1M10gPSBlbmRCeXRlWzE3XTsgCiBmcEJ5dGVbNTRdID0gZW5kQnl0ZVs1N107IAogZnBCeXRlWzU1XSA9IGVuZEJ5dGVbMjVdOyAKIGZwQnl0ZVs1Nl0gPSBlbmRCeXRlWzMyXTsgCiBmcEJ5dGVbNTddID0gZW5kQnl0ZVsgMF07IAogZnBCeXRlWzU4XSA9IGVuZEJ5dGVbNDBdOyAKIGZwQnl0ZVs1OV0gPSBlbmRCeXRlWyA4XTsgCiBmcEJ5dGVbNjBdID0gZW5kQnl0ZVs0OF07IAogZnBCeXRlWzYxXSA9IGVuZEJ5dGVbMTZdOyAKIGZwQnl0ZVs2Ml0gPSBlbmRCeXRlWzU2XTsgCiBmcEJ5dGVbNjNdID0gZW5kQnl0ZVsyNF07CiByZXR1cm4gZnBCeXRlOwp9CgpmdW5jdGlvbiBnZXRCb3hCaW5hcnkoaSkgewogdmFyIGJpbmFyeSA9ICIiOwogc3dpdGNoIChpKSB7CiAgIGNhc2UgMCA6YmluYXJ5ID0gIjAwMDAiO2JyZWFrOwogICBjYXNlIDEgOmJpbmFyeSA9ICIwMDAxIjticmVhazsKICAgY2FzZSAyIDpiaW5hcnkgPSAiMDAxMCI7YnJlYWs7CiAgIGNhc2UgMyA6YmluYXJ5ID0gIjAwMTEiO2JyZWFrOwogICBjYXNlIDQgOmJpbmFyeSA9ICIwMTAwIjticmVhazsKICAgY2FzZSA1IDpiaW5hcnkgPSAiMDEwMSI7YnJlYWs7CiAgIGNhc2UgNiA6YmluYXJ5ID0gIjAxMTAiO2JyZWFrOwogICBjYXNlIDcgOmJpbmFyeSA9ICIwMTExIjticmVhazsKICAgY2FzZSA4IDpiaW5hcnkgPSAiMTAwMCI7YnJlYWs7CiAgIGNhc2UgOSA6YmluYXJ5ID0gIjEwMDEiO2JyZWFrOwogICBjYXNlIDEwIDpiaW5hcnkgPSAiMTAxMCI7YnJlYWs7CiAgIGNhc2UgMTEgOmJpbmFyeSA9ICIxMDExIjticmVhazsKICAgY2FzZSAxMiA6YmluYXJ5ID0gIjExMDAiO2JyZWFrOwogICBjYXNlIDEzIDpiaW5hcnkgPSAiMTEwMSI7YnJlYWs7CiAgIGNhc2UgMTQgOmJpbmFyeSA9ICIxMTEwIjticmVhazsKICAgY2FzZSAxNSA6YmluYXJ5ID0gIjExMTEiO2JyZWFrOwogfQogcmV0dXJuIGJpbmFyeTsKfQovKgoqIGdlbmVyYXRlIDE2IGtleXMgZm9yIHhvcgoqCiovCmZ1bmN0aW9uIGdlbmVyYXRlS2V5cyhrZXlCeXRlKXsgICAgCiB2YXIga2V5ICAgPSBuZXcgQXJyYXkoNTYpOwogdmFyIGtleXMgPSBuZXcgQXJyYXkoKTsgIAogCiBrZXlzWyAwXSA9IG5ldyBBcnJheSgpOwoga2V5c1sgMV0gPSBuZXcgQXJyYXkoKTsKIGtleXNbIDJdID0gbmV3IEFycmF5KCk7CiBrZXlzWyAzXSA9IG5ldyBBcnJheSgpOwoga2V5c1sgNF0gPSBuZXcgQXJyYXkoKTsKIGtleXNbIDVdID0gbmV3IEFycmF5KCk7CiBrZXlzWyA2XSA9IG5ldyBBcnJheSgpOwoga2V5c1sgN10gPSBuZXcgQXJyYXkoKTsKIGtleXNbIDhdID0gbmV3IEFycmF5KCk7CiBrZXlzWyA5XSA9IG5ldyBBcnJheSgpOwoga2V5c1sxMF0gPSBuZXcgQXJyYXkoKTsKIGtleXNbMTFdID0gbmV3IEFycmF5KCk7CiBrZXlzWzEyXSA9IG5ldyBBcnJheSgpOwoga2V5c1sxM10gPSBuZXcgQXJyYXkoKTsKIGtleXNbMTRdID0gbmV3IEFycmF5KCk7CiBrZXlzWzE1XSA9IG5ldyBBcnJheSgpOyAgCiB2YXIgbG9vcCA9IFsxLDEsMiwyLDIsMiwyLDIsMSwyLDIsMiwyLDIsMiwxXTsKCiBmb3IoaT0wO2k8NztpKyspewogICBmb3Ioaj0wLGs9NztqPDg7aisrLGstLSl7CiAgICAga2V5W2kqOCtqXT1rZXlCeXRlWzgqaytpXTsKICAgfQogfSAgICAKIAogdmFyIGkgPSAwOwogZm9yKGkgPSAwO2kgPCAxNjtpICsrKXsKICAgdmFyIHRlbXBMZWZ0PTA7CiAgIHZhciB0ZW1wUmlnaHQ9MDsKICAgZm9yKGogPSAwOyBqIDwgbG9vcFtpXTtqICsrKXsgICAgICAgICAgCiAgICAgdGVtcExlZnQgPSBrZXlbMF07CiAgICAgdGVtcFJpZ2h0ID0ga2V5WzI4XTsKICAgICBmb3IoayA9IDA7ayA8IDI3IDtrICsrKXsKICAgICAgIGtleVtrXSA9IGtleVtrKzFdOwogICAgICAga2V5WzI4K2tdID0ga2V5WzI5K2tdOwogICAgIH0gIAogICAgIGtleVsyN109dGVtcExlZnQ7CiAgICAga2V5WzU1XT10ZW1wUmlnaHQ7CiAgIH0KICAgdmFyIHRlbXBLZXkgPSBuZXcgQXJyYXkoNDgpOwogICB0ZW1wS2V5WyAwXSA9IGtleVsxM107CiAgIHRlbXBLZXlbIDFdID0ga2V5WzE2XTsKICAgdGVtcEtleVsgMl0gPSBrZXlbMTBdOwogICB0ZW1wS2V5WyAzXSA9IGtleVsyM107CiAgIHRlbXBLZXlbIDRdID0ga2V5WyAwXTsKICAgdGVtcEtleVsgNV0gPSBrZXlbIDRdOwogICB0ZW1wS2V5WyA2XSA9IGtleVsgMl07CiAgIHRlbXBLZXlbIDddID0ga2V5WzI3XTsKICAgdGVtcEtleVsgOF0gPSBrZXlbMTRdOwogICB0ZW1wS2V5WyA5XSA9IGtleVsgNV07CiAgIHRlbXBLZXlbMTBdID0ga2V5WzIwXTsKICAgdGVtcEtleVsxMV0gPSBrZXlbIDldOwogICB0ZW1wS2V5WzEyXSA9IGtleVsyMl07CiAgIHRlbXBLZXlbMTNdID0ga2V5WzE4XTsKICAgdGVtcEtleVsxNF0gPSBrZXlbMTFdOwogICB0ZW1wS2V5WzE1XSA9IGtleVsgM107CiAgIHRlbXBLZXlbMTZdID0ga2V5WzI1XTsKICAgdGVtcEtleVsxN10gPSBrZXlbIDddOwogICB0ZW1wS2V5WzE4XSA9IGtleVsxNV07CiAgIHRlbXBLZXlbMTldID0ga2V5WyA2XTsKICAgdGVtcEtleVsyMF0gPSBrZXlbMjZdOwogICB0ZW1wS2V5WzIxXSA9IGtleVsxOV07CiAgIHRlbXBLZXlbMjJdID0ga2V5WzEyXTsKICAgdGVtcEtleVsyM10gPSBrZXlbIDFdOwogICB0ZW1wS2V5WzI0XSA9IGtleVs0MF07CiAgIHRlbXBLZXlbMjVdID0ga2V5WzUxXTsKICAgdGVtcEtleVsyNl0gPSBrZXlbMzBdOwogICB0ZW1wS2V5WzI3XSA9IGtleVszNl07CiAgIHRlbXBLZXlbMjhdID0ga2V5WzQ2XTsKICAgdGVtcEtleVsyOV0gPSBrZXlbNTRdOwogICB0ZW1wS2V5WzMwXSA9IGtleVsyOV07CiAgIHRlbXBLZXlbMzFdID0ga2V5WzM5XTsKICAgdGVtcEtleVszMl0gPSBrZXlbNTBdOwogICB0ZW1wS2V5WzMzXSA9IGtleVs0NF07CiAgIHRlbXBLZXlbMzRdID0ga2V5WzMyXTsKICAgdGVtcEtleVszNV0gPSBrZXlbNDddOwogICB0ZW1wS2V5WzM2XSA9IGtleVs0M107CiAgIHRlbXBLZXlbMzddID0ga2V5WzQ4XTsKICAgdGVtcEtleVszOF0gPSBrZXlbMzhdOwogICB0ZW1wS2V5WzM5XSA9IGtleVs1NV07CiAgIHRlbXBLZXlbNDBdID0ga2V5WzMzXTsKICAgdGVtcEtleVs0MV0gPSBrZXlbNTJdOwogICB0ZW1wS2V5WzQyXSA9IGtleVs0NV07CiAgIHRlbXBLZXlbNDNdID0ga2V5WzQxXTsKICAgdGVtcEtleVs0NF0gPSBrZXlbNDldOwogICB0ZW1wS2V5WzQ1XSA9IGtleVszNV07CiAgIHRlbXBLZXlbNDZdID0ga2V5WzI4XTsKICAgdGVtcEtleVs0N10gPSBrZXlbMzFdOwogICBzd2l0Y2goaSl7CiAgICAgY2FzZSAwOiBmb3IobT0wO20gPCA0OCA7bSsrKXsga2V5c1sgMF1bbV0gPSB0ZW1wS2V5W21dOyB9IGJyZWFrOwogICAgIGNhc2UgMTogZm9yKG09MDttIDwgNDggO20rKyl7IGtleXNbIDFdW21dID0gdGVtcEtleVttXTsgfSBicmVhazsKICAgICBjYXNlIDI6IGZvcihtPTA7bSA8IDQ4IDttKyspeyBrZXlzWyAyXVttXSA9IHRlbXBLZXlbbV07IH0gYnJlYWs7CiAgICAgY2FzZSAzOiBmb3IobT0wO20gPCA0OCA7bSsrKXsga2V5c1sgM11bbV0gPSB0ZW1wS2V5W21dOyB9IGJyZWFrOwogICAgIGNhc2UgNDogZm9yKG09MDttIDwgNDggO20rKyl7IGtleXNbIDRdW21dID0gdGVtcEtleVttXTsgfSBicmVhazsKICAgICBjYXNlIDU6IGZvcihtPTA7bSA8IDQ4IDttKyspeyBrZXlzWyA1XVttXSA9IHRlbXBLZXlbbV07IH0gYnJlYWs7CiAgICAgY2FzZSA2OiBmb3IobT0wO20gPCA0OCA7bSsrKXsga2V5c1sgNl1bbV0gPSB0ZW1wS2V5W21dOyB9IGJyZWFrOwogICAgIGNhc2UgNzogZm9yKG09MDttIDwgNDggO20rKyl7IGtleXNbIDddW21dID0gdGVtcEtleVttXTsgfSBicmVhazsKICAgICBjYXNlIDg6IGZvcihtPTA7bSA8IDQ4IDttKyspeyBrZXlzWyA4XVttXSA9IHRlbXBLZXlbbV07IH0gYnJlYWs7CiAgICAgY2FzZSA5OiBmb3IobT0wO20gPCA0OCA7bSsrKXsga2V5c1sgOV1bbV0gPSB0ZW1wS2V5W21dOyB9IGJyZWFrOwogICAgIGNhc2UgMTA6IGZvcihtPTA7bSA8IDQ4IDttKyspeyBrZXlzWzEwXVttXSA9IHRlbXBLZXlbbV07IH0gYnJlYWs7CiAgICAgY2FzZSAxMTogZm9yKG09MDttIDwgNDggO20rKyl7IGtleXNbMTFdW21dID0gdGVtcEtleVttXTsgfSBicmVhazsKICAgICBjYXNlIDEyOiBmb3IobT0wO20gPCA0OCA7bSsrKXsga2V5c1sxMl1bbV0gPSB0ZW1wS2V5W21dOyB9IGJyZWFrOwogICAgIGNhc2UgMTM6IGZvcihtPTA7bSA8IDQ4IDttKyspeyBrZXlzWzEzXVttXSA9IHRlbXBLZXlbbV07IH0gYnJlYWs7CiAgICAgY2FzZSAxNDogZm9yKG09MDttIDwgNDggO20rKyl7IGtleXNbMTRdW21dID0gdGVtcEtleVttXTsgfSBicmVhazsKICAgICBjYXNlIDE1OiBmb3IobT0wO20gPCA0OCA7bSsrKXsga2V5c1sxNV1bbV0gPSB0ZW1wS2V5W21dOyB9IGJyZWFrOwogICB9CiB9CiByZXR1cm4ga2V5czsgIAp9Ci8vZW5kLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ==";
    private static final String javaScriptForUnifcode
                                                      = "LyoqCiogREVT5Yqg5a+GL+ino+WvhgoqIEBDb3B5cmlnaHQgQ29weXJpZ2h0IChjKSAyMDA2CiogQGF1dGhvciBHdWFwbwoqIEBzZWUgREVTQ29yZQoqLwoKLyoKKiBlbmNyeXB0IHRoZSBzdHJpbmcgdG8gc3RyaW5nIG1hZGUgdXAgb2YgaGV4CiogcmV0dXJuIHRoZSBlbmNyeXB0ZWQgc3RyaW5nCiovCmZ1bmN0aW9uIHVpZkVuY29kZShkYXRhKXsKIGlmKGRhdGEgPT0gdW5kZWZpbmVkIHx8ICIiID09IGRhdGEudHJpbSgpKXsKCXJldHVybiAiIjsKIH0KIHZhciBmaXJzdEtleT0iWWswIjsKIHZhciBzZWNvbmRLZXk9IlplMCI7CiB2YXIgdGhpcmRLZXk9Ild5SDkiOwogdmFyIGxlbmcgPSBkYXRhLmxlbmd0aDsKIHZhciBlbmNEYXRhID0gIiI7CiB2YXIgZmlyc3RLZXlCdCxzZWNvbmRLZXlCdCx0aGlyZEtleUJ0LGZpcnN0TGVuZ3RoLHNlY29uZExlbmd0aCx0aGlyZExlbmd0aDsKIGlmKGZpcnN0S2V5ICE9IG51bGwgJiYgZmlyc3RLZXkgIT0gIiIpeyAgICAKICAgZmlyc3RLZXlCdCA9IGdldEtleUJ5dGVzKGZpcnN0S2V5KTsKICAgZmlyc3RMZW5ndGggPSBmaXJzdEtleUJ0Lmxlbmd0aDsKIH0KIGlmKHNlY29uZEtleSAhPSBudWxsICYmIHNlY29uZEtleSAhPSAiIil7CiAgIHNlY29uZEtleUJ0ID0gZ2V0S2V5Qnl0ZXMoc2Vjb25kS2V5KTsKICAgc2Vjb25kTGVuZ3RoID0gc2Vjb25kS2V5QnQubGVuZ3RoOwogfQogaWYodGhpcmRLZXkgIT0gbnVsbCAmJiB0aGlyZEtleSAhPSAiIil7CiAgIHRoaXJkS2V5QnQgPSBnZXRLZXlCeXRlcyh0aGlyZEtleSk7CiAgIHRoaXJkTGVuZ3RoID0gdGhpcmRLZXlCdC5sZW5ndGg7CiB9ICAKIAogaWYobGVuZyA+IDApewogICBpZihsZW5nIDwgNCl7CiAgICAgdmFyIGJ0ID0gc3RyVG9CdChkYXRhKTsgICAgICAKICAgICB2YXIgZW5jQnl0ZSA7CiAgICAgaWYoZmlyc3RLZXkgIT0gbnVsbCAmJiBmaXJzdEtleSAhPSIiICYmIHNlY29uZEtleSAhPSBudWxsICYmIHNlY29uZEtleSAhPSAiIiAmJiB0aGlyZEtleSAhPSBudWxsICYmIHRoaXJkS2V5ICE9ICIiKXsKICAgICAgIHZhciB0ZW1wQnQ7CiAgICAgICB2YXIgeCx5LHo7CiAgICAgICB0ZW1wQnQgPSBidDsgICAgICAgIAogICAgICAgZm9yKHggPSAwO3ggPCBmaXJzdExlbmd0aCA7eCArKyl7CiAgICAgICAgIHRlbXBCdCA9IGVuYyh0ZW1wQnQsZmlyc3RLZXlCdFt4XSk7CiAgICAgICB9CiAgICAgICBmb3IoeSA9IDA7eSA8IHNlY29uZExlbmd0aCA7eSArKyl7CiAgICAgICAgIHRlbXBCdCA9IGVuYyh0ZW1wQnQsc2Vjb25kS2V5QnRbeV0pOwogICAgICAgfQogICAgICAgZm9yKHogPSAwO3ogPCB0aGlyZExlbmd0aCA7eiArKyl7CiAgICAgICAgIHRlbXBCdCA9IGVuYyh0ZW1wQnQsdGhpcmRLZXlCdFt6XSk7CiAgICAgICB9ICAgICAgICAKICAgICAgIGVuY0J5dGUgPSB0ZW1wQnQ7ICAgICAgICAKICAgICB9ZWxzZXsKICAgICAgIGlmKGZpcnN0S2V5ICE9IG51bGwgJiYgZmlyc3RLZXkgIT0iIiAmJiBzZWNvbmRLZXkgIT0gbnVsbCAmJiBzZWNvbmRLZXkgIT0gIiIpewogICAgICAgICB2YXIgdGVtcEJ0OwogICAgICAgICB2YXIgeCx5OwogICAgICAgICB0ZW1wQnQgPSBidDsKICAgICAgICAgZm9yKHggPSAwO3ggPCBmaXJzdExlbmd0aCA7eCArKyl7CiAgICAgICAgICAgdGVtcEJ0ID0gZW5jKHRlbXBCdCxmaXJzdEtleUJ0W3hdKTsKICAgICAgICAgfQogICAgICAgICBmb3IoeSA9IDA7eSA8IHNlY29uZExlbmd0aCA7eSArKyl7CiAgICAgICAgICAgdGVtcEJ0ID0gZW5jKHRlbXBCdCxzZWNvbmRLZXlCdFt5XSk7CiAgICAgICAgIH0KICAgICAgICAgZW5jQnl0ZSA9IHRlbXBCdDsKICAgICAgIH1lbHNlewogICAgICAgICBpZihmaXJzdEtleSAhPSBudWxsICYmIGZpcnN0S2V5ICE9IiIpeyAgICAgICAgICAgIAogICAgICAgICAgIHZhciB0ZW1wQnQ7CiAgICAgICAgICAgdmFyIHggPSAwOwogICAgICAgICAgIHRlbXBCdCA9IGJ0OyAgICAgICAgICAgIAogICAgICAgICAgIGZvcih4ID0gMDt4IDwgZmlyc3RMZW5ndGggO3ggKyspewogICAgICAgICAgICAgdGVtcEJ0ID0gZW5jKHRlbXBCdCxmaXJzdEtleUJ0W3hdKTsKICAgICAgICAgICB9CiAgICAgICAgICAgZW5jQnl0ZSA9IHRlbXBCdDsKICAgICAgICAgfQogICAgICAgfSAgICAgICAgCiAgICAgfQogICAgIGVuY0RhdGEgPSBidDY0VG9IZXgoZW5jQnl0ZSk7CiAgIH1lbHNlewogICAgIHZhciBpdGVyYXRvciA9IHBhcnNlSW50KGxlbmcvNCk7CiAgICAgdmFyIHJlbWFpbmRlciA9IGxlbmclNDsKICAgICB2YXIgaT0wOyAgICAgIAogICAgIGZvcihpID0gMDtpIDwgaXRlcmF0b3I7aSsrKXsKICAgICAgIHZhciB0ZW1wRGF0YSA9IGRhdGEuc3Vic3RyaW5nKGkqNCswLGkqNCs0KTsKICAgICAgIHZhciB0ZW1wQnl0ZSA9IHN0clRvQnQodGVtcERhdGEpOwogICAgICAgdmFyIGVuY0J5dGUgOwogICAgICAgaWYoZmlyc3RLZXkgIT0gbnVsbCAmJiBmaXJzdEtleSAhPSIiICYmIHNlY29uZEtleSAhPSBudWxsICYmIHNlY29uZEtleSAhPSAiIiAmJiB0aGlyZEtleSAhPSBudWxsICYmIHRoaXJkS2V5ICE9ICIiKXsKICAgICAgICAgdmFyIHRlbXBCdDsKICAgICAgICAgdmFyIHgseSx6OwogICAgICAgICB0ZW1wQnQgPSB0ZW1wQnl0ZTsKICAgICAgICAgZm9yKHggPSAwO3ggPCBmaXJzdExlbmd0aCA7eCArKyl7CiAgICAgICAgICAgdGVtcEJ0ID0gZW5jKHRlbXBCdCxmaXJzdEtleUJ0W3hdKTsKICAgICAgICAgfQogICAgICAgICBmb3IoeSA9IDA7eSA8IHNlY29uZExlbmd0aCA7eSArKyl7CiAgICAgICAgICAgdGVtcEJ0ID0gZW5jKHRlbXBCdCxzZWNvbmRLZXlCdFt5XSk7CiAgICAgICAgIH0KICAgICAgICAgZm9yKHogPSAwO3ogPCB0aGlyZExlbmd0aCA7eiArKyl7CiAgICAgICAgICAgdGVtcEJ0ID0gZW5jKHRlbXBCdCx0aGlyZEtleUJ0W3pdKTsKICAgICAgICAgfQogICAgICAgICBlbmNCeXRlID0gdGVtcEJ0OwogICAgICAgfWVsc2V7CiAgICAgICAgIGlmKGZpcnN0S2V5ICE9IG51bGwgJiYgZmlyc3RLZXkgIT0iIiAmJiBzZWNvbmRLZXkgIT0gbnVsbCAmJiBzZWNvbmRLZXkgIT0gIiIpewogICAgICAgICAgIHZhciB0ZW1wQnQ7CiAgICAgICAgICAgdmFyIHgseTsKICAgICAgICAgICB0ZW1wQnQgPSB0ZW1wQnl0ZTsKICAgICAgICAgICBmb3IoeCA9IDA7eCA8IGZpcnN0TGVuZ3RoIDt4ICsrKXsKICAgICAgICAgICAgIHRlbXBCdCA9IGVuYyh0ZW1wQnQsZmlyc3RLZXlCdFt4XSk7CiAgICAgICAgICAgfQogICAgICAgICAgIGZvcih5ID0gMDt5IDwgc2Vjb25kTGVuZ3RoIDt5ICsrKXsKICAgICAgICAgICAgIHRlbXBCdCA9IGVuYyh0ZW1wQnQsc2Vjb25kS2V5QnRbeV0pOwogICAgICAgICAgIH0KICAgICAgICAgICBlbmNCeXRlID0gdGVtcEJ0OwogICAgICAgICB9ZWxzZXsKICAgICAgICAgICBpZihmaXJzdEtleSAhPSBudWxsICYmIGZpcnN0S2V5ICE9IiIpeyAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIHZhciB0ZW1wQnQ7CiAgICAgICAgICAgICB2YXIgeDsKICAgICAgICAgICAgIHRlbXBCdCA9IHRlbXBCeXRlOwogICAgICAgICAgICAgZm9yKHggPSAwO3ggPCBmaXJzdExlbmd0aCA7eCArKyl7ICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICB0ZW1wQnQgPSBlbmModGVtcEJ0LGZpcnN0S2V5QnRbeF0pOwogICAgICAgICAgICAgfQogICAgICAgICAgICAgZW5jQnl0ZSA9IHRlbXBCdDsgICAgICAgICAgICAgIAogICAgICAgICAgIH0KICAgICAgICAgfQogICAgICAgfQogICAgICAgZW5jRGF0YSArPSBidDY0VG9IZXgoZW5jQnl0ZSk7CiAgICAgfSAgICAgIAogICAgIGlmKHJlbWFpbmRlciA+IDApewogICAgICAgdmFyIHJlbWFpbmRlckRhdGEgPSBkYXRhLnN1YnN0cmluZyhpdGVyYXRvcio0KzAsbGVuZyk7CiAgICAgICB2YXIgdGVtcEJ5dGUgPSBzdHJUb0J0KHJlbWFpbmRlckRhdGEpOwogICAgICAgdmFyIGVuY0J5dGUgOwogICAgICAgaWYoZmlyc3RLZXkgIT0gbnVsbCAmJiBmaXJzdEtleSAhPSIiICYmIHNlY29uZEtleSAhPSBudWxsICYmIHNlY29uZEtleSAhPSAiIiAmJiB0aGlyZEtleSAhPSBudWxsICYmIHRoaXJkS2V5ICE9ICIiKXsKICAgICAgICAgdmFyIHRlbXBCdDsKICAgICAgICAgdmFyIHgseSx6OwogICAgICAgICB0ZW1wQnQgPSB0ZW1wQnl0ZTsKICAgICAgICAgZm9yKHggPSAwO3ggPCBmaXJzdExlbmd0aCA7eCArKyl7CiAgICAgICAgICAgdGVtcEJ0ID0gZW5jKHRlbXBCdCxmaXJzdEtleUJ0W3hdKTsKICAgICAgICAgfQogICAgICAgICBmb3IoeSA9IDA7eSA8IHNlY29uZExlbmd0aCA7eSArKyl7CiAgICAgICAgICAgdGVtcEJ0ID0gZW5jKHRlbXBCdCxzZWNvbmRLZXlCdFt5XSk7CiAgICAgICAgIH0KICAgICAgICAgZm9yKHogPSAwO3ogPCB0aGlyZExlbmd0aCA7eiArKyl7CiAgICAgICAgICAgdGVtcEJ0ID0gZW5jKHRlbXBCdCx0aGlyZEtleUJ0W3pdKTsKICAgICAgICAgfQogICAgICAgICBlbmNCeXRlID0gdGVtcEJ0OwogICAgICAgfWVsc2V7CiAgICAgICAgIGlmKGZpcnN0S2V5ICE9IG51bGwgJiYgZmlyc3RLZXkgIT0iIiAmJiBzZWNvbmRLZXkgIT0gbnVsbCAmJiBzZWNvbmRLZXkgIT0gIiIpewogICAgICAgICAgIHZhciB0ZW1wQnQ7CiAgICAgICAgICAgdmFyIHgseTsKICAgICAgICAgICB0ZW1wQnQgPSB0ZW1wQnl0ZTsKICAgICAgICAgICBmb3IoeCA9IDA7eCA8IGZpcnN0TGVuZ3RoIDt4ICsrKXsKICAgICAgICAgICAgIHRlbXBCdCA9IGVuYyh0ZW1wQnQsZmlyc3RLZXlCdFt4XSk7CiAgICAgICAgICAgfQogICAgICAgICAgIGZvcih5ID0gMDt5IDwgc2Vjb25kTGVuZ3RoIDt5ICsrKXsKICAgICAgICAgICAgIHRlbXBCdCA9IGVuYyh0ZW1wQnQsc2Vjb25kS2V5QnRbeV0pOwogICAgICAgICAgIH0KICAgICAgICAgICBlbmNCeXRlID0gdGVtcEJ0OwogICAgICAgICB9ZWxzZXsKICAgICAgICAgICBpZihmaXJzdEtleSAhPSBudWxsICYmIGZpcnN0S2V5ICE9IiIpeyAgICAgICAgICAgIAogICAgICAgICAgICAgdmFyIHRlbXBCdDsKICAgICAgICAgICAgIHZhciB4OwogICAgICAgICAgICAgdGVtcEJ0ID0gdGVtcEJ5dGU7CiAgICAgICAgICAgICBmb3IoeCA9IDA7eCA8IGZpcnN0TGVuZ3RoIDt4ICsrKXsKICAgICAgICAgICAgICAgdGVtcEJ0ID0gZW5jKHRlbXBCdCxmaXJzdEtleUJ0W3hdKTsKICAgICAgICAgICAgIH0KICAgICAgICAgICAgIGVuY0J5dGUgPSB0ZW1wQnQ7CiAgICAgICAgICAgfQogICAgICAgICB9CiAgICAgICB9CiAgICAgICBlbmNEYXRhICs9IGJ0NjRUb0hleChlbmNCeXRlKTsKICAgICB9ICAgICAgICAgICAgICAgIAogICB9CiB9CiByZXR1cm4gZW5jRGF0YTsKfQoKLyoKKiBkZWNyeXB0IHRoZSBlbmNyeXB0ZWQgc3RyaW5nIHRvIHRoZSBvcmlnaW5hbCBzdHJpbmcgCioKKiByZXR1cm4gIHRoZSBvcmlnaW5hbCBzdHJpbmcgIAoqLwpmdW5jdGlvbiB1aWZEZWNvZGUoZGF0YSl7CiBpZihkYXRhID09IHVuZGVmaW5lZCB8fCAiIiA9PSBkYXRhLnRyaW0oKSl7CglyZXR1cm4gIiI7CiB9CiB2YXIgZmlyc3RLZXk9IllrMCI7CiB2YXIgc2Vjb25kS2V5PSJaZTAiOwogdmFyIHRoaXJkS2V5PSJXeUg5IjsgCiB2YXIgbGVuZyA9IGRhdGEubGVuZ3RoOwogdmFyIGRlY1N0ciA9ICIiOwogdmFyIGZpcnN0S2V5QnQsc2Vjb25kS2V5QnQsdGhpcmRLZXlCdCxmaXJzdExlbmd0aCxzZWNvbmRMZW5ndGgsdGhpcmRMZW5ndGg7CiBpZihmaXJzdEtleSAhPSBudWxsICYmIGZpcnN0S2V5ICE9ICIiKXsgICAgCiAgIGZpcnN0S2V5QnQgPSBnZXRLZXlCeXRlcyhmaXJzdEtleSk7CiAgIGZpcnN0TGVuZ3RoID0gZmlyc3RLZXlCdC5sZW5ndGg7CiB9CiBpZihzZWNvbmRLZXkgIT0gbnVsbCAmJiBzZWNvbmRLZXkgIT0gIiIpewogICBzZWNvbmRLZXlCdCA9IGdldEtleUJ5dGVzKHNlY29uZEtleSk7CiAgIHNlY29uZExlbmd0aCA9IHNlY29uZEtleUJ0Lmxlbmd0aDsKIH0KIGlmKHRoaXJkS2V5ICE9IG51bGwgJiYgdGhpcmRLZXkgIT0gIiIpewogICB0aGlyZEtleUJ0ID0gZ2V0S2V5Qnl0ZXModGhpcmRLZXkpOwogICB0aGlyZExlbmd0aCA9IHRoaXJkS2V5QnQubGVuZ3RoOwogfQogCiB2YXIgaXRlcmF0b3IgPSBwYXJzZUludChsZW5nLzE2KTsKIHZhciBpPTA7ICAKIGZvcihpID0gMDtpIDwgaXRlcmF0b3I7aSsrKXsKICAgdmFyIHRlbXBEYXRhID0gZGF0YS5zdWJzdHJpbmcoaSoxNiswLGkqMTYrMTYpOyAgICAKICAgdmFyIHN0ckJ5dGUgPSBoZXhUb0J0NjQodGVtcERhdGEpOyAgICAKICAgdmFyIGludEJ5dGUgPSBuZXcgQXJyYXkoNjQpOwogICB2YXIgaiA9IDA7CiAgIGZvcihqID0gMDtqIDwgNjQ7IGorKyl7CiAgICAgaW50Qnl0ZVtqXSA9IHBhcnNlSW50KHN0ckJ5dGUuc3Vic3RyaW5nKGosaisxKSk7CiAgIH0gICAgCiAgIHZhciBkZWNCeXRlOwogICBpZihmaXJzdEtleSAhPSBudWxsICYmIGZpcnN0S2V5ICE9IiIgJiYgc2Vjb25kS2V5ICE9IG51bGwgJiYgc2Vjb25kS2V5ICE9ICIiICYmIHRoaXJkS2V5ICE9IG51bGwgJiYgdGhpcmRLZXkgIT0gIiIpewogICAgIHZhciB0ZW1wQnQ7CiAgICAgdmFyIHgseSx6OwogICAgIHRlbXBCdCA9IGludEJ5dGU7CiAgICAgZm9yKHggPSB0aGlyZExlbmd0aCAtIDE7eCA+PSAwO3ggLS0pewogICAgICAgdGVtcEJ0ID0gZGVjKHRlbXBCdCx0aGlyZEtleUJ0W3hdKTsKICAgICB9CiAgICAgZm9yKHkgPSBzZWNvbmRMZW5ndGggLSAxO3kgPj0gMDt5IC0tKXsKICAgICAgIHRlbXBCdCA9IGRlYyh0ZW1wQnQsc2Vjb25kS2V5QnRbeV0pOwogICAgIH0KICAgICBmb3IoeiA9IGZpcnN0TGVuZ3RoIC0gMTt6ID49IDAgO3ogLS0pewogICAgICAgdGVtcEJ0ID0gZGVjKHRlbXBCdCxmaXJzdEtleUJ0W3pdKTsKICAgICB9CiAgICAgZGVjQnl0ZSA9IHRlbXBCdDsKICAgfWVsc2V7CiAgICAgaWYoZmlyc3RLZXkgIT0gbnVsbCAmJiBmaXJzdEtleSAhPSIiICYmIHNlY29uZEtleSAhPSBudWxsICYmIHNlY29uZEtleSAhPSAiIil7CiAgICAgICB2YXIgdGVtcEJ0OwogICAgICAgdmFyIHgseSx6OwogICAgICAgdGVtcEJ0ID0gaW50Qnl0ZTsKICAgICAgIGZvcih4ID0gc2Vjb25kTGVuZ3RoIC0gMTt4ID49IDAgO3ggLS0pewogICAgICAgICB0ZW1wQnQgPSBkZWModGVtcEJ0LHNlY29uZEtleUJ0W3hdKTsKICAgICAgIH0KICAgICAgIGZvcih5ID0gZmlyc3RMZW5ndGggLSAxO3kgPj0gMCA7eSAtLSl7CiAgICAgICAgIHRlbXBCdCA9IGRlYyh0ZW1wQnQsZmlyc3RLZXlCdFt5XSk7CiAgICAgICB9CiAgICAgICBkZWNCeXRlID0gdGVtcEJ0OwogICAgIH1lbHNlewogICAgICAgaWYoZmlyc3RLZXkgIT0gbnVsbCAmJiBmaXJzdEtleSAhPSIiKXsKICAgICAgICAgdmFyIHRlbXBCdDsKICAgICAgICAgdmFyIHgseSx6OwogICAgICAgICB0ZW1wQnQgPSBpbnRCeXRlOwogICAgICAgICBmb3IoeCA9IGZpcnN0TGVuZ3RoIC0gMTt4ID49IDAgO3ggLS0pewogICAgICAgICAgIHRlbXBCdCA9IGRlYyh0ZW1wQnQsZmlyc3RLZXlCdFt4XSk7CiAgICAgICAgIH0KICAgICAgICAgZGVjQnl0ZSA9IHRlbXBCdDsKICAgICAgIH0KICAgICB9CiAgIH0KICAgZGVjU3RyICs9IGJ5dGVUb1N0cmluZyhkZWNCeXRlKTsKIH0gICAgICAKIHJldHVybiBkZWNTdHI7Cn0KLyoKKiBjaGFuZyB0aGUgc3RyaW5nIGludG8gdGhlIGJpdCBhcnJheQoqIAoqIHJldHVybiBiaXQgYXJyYXkoaXQncyBsZW5ndGggJSA2NCA9IDApCiovCmZ1bmN0aW9uIGdldEtleUJ5dGVzKGtleSl7CiB2YXIga2V5Qnl0ZXMgPSBuZXcgQXJyYXkoKTsKIHZhciBsZW5nID0ga2V5Lmxlbmd0aDsKIHZhciBpdGVyYXRvciA9IHBhcnNlSW50KGxlbmcvNCk7CiB2YXIgcmVtYWluZGVyID0gbGVuZyU0OwogdmFyIGkgPSAwOwogZm9yKGkgPSAwO2kgPCBpdGVyYXRvcjsgaSArKyl7CiAgIGtleUJ5dGVzW2ldID0gc3RyVG9CdChrZXkuc3Vic3RyaW5nKGkqNCswLGkqNCs0KSk7CiB9CiBpZihyZW1haW5kZXIgPiAwKXsKICAga2V5Qnl0ZXNbaV0gPSBzdHJUb0J0KGtleS5zdWJzdHJpbmcoaSo0KzAsbGVuZykpOwogfSAgICAKIHJldHVybiBrZXlCeXRlczsKfQoKLyoKKiBjaGFuZyB0aGUgc3RyaW5nKGl0J3MgbGVuZ3RoIDw9IDQpIGludG8gdGhlIGJpdCBhcnJheQoqIAoqIHJldHVybiBiaXQgYXJyYXkoaXQncyBsZW5ndGggPSA2NCkKKi8KZnVuY3Rpb24gc3RyVG9CdChzdHIpeyAgCiB2YXIgbGVuZyA9IHN0ci5sZW5ndGg7CiB2YXIgYnQgPSBuZXcgQXJyYXkoNjQpOwogaWYobGVuZyA8IDQpewogICB2YXIgaT0wLGo9MCxwPTAscT0wOwogICBmb3IoaSA9IDA7aTxsZW5nO2krKyl7CiAgICAgdmFyIGsgPSBzdHIuY2hhckNvZGVBdChpKTsKICAgICBmb3Ioaj0wO2o8MTY7aisrKXsgICAgICAKICAgICAgIHZhciBwb3c9MSxtPTA7CiAgICAgICBmb3IobT0xNTttPmo7bS0tKXsKICAgICAgICAgcG93ICo9IDI7CiAgICAgICB9ICAgICAgICAKICAgICAgIGJ0WzE2Kmkral09cGFyc2VJbnQoay9wb3cpJTI7CiAgICAgfQogICB9CiAgIGZvcihwID0gbGVuZztwPDQ7cCsrKXsKICAgICB2YXIgayA9IDA7CiAgICAgZm9yKHE9MDtxPDE2O3ErKyl7ICAgICAgCiAgICAgICB2YXIgcG93PTEsbT0wOwogICAgICAgZm9yKG09MTU7bT5xO20tLSl7CiAgICAgICAgIHBvdyAqPSAyOwogICAgICAgfSAgICAgICAgCiAgICAgICBidFsxNipwK3FdPXBhcnNlSW50KGsvcG93KSUyOwogICAgIH0KICAgfSAgCiB9ZWxzZXsKICAgZm9yKGkgPSAwO2k8NDtpKyspewogICAgIHZhciBrID0gc3RyLmNoYXJDb2RlQXQoaSk7CiAgICAgZm9yKGo9MDtqPDE2O2orKyl7ICAgICAgCiAgICAgICB2YXIgcG93PTE7CiAgICAgICBmb3IobT0xNTttPmo7bS0tKXsKICAgICAgICAgcG93ICo9IDI7CiAgICAgICB9ICAgICAgICAKICAgICAgIGJ0WzE2Kmkral09cGFyc2VJbnQoay9wb3cpJTI7CiAgICAgfQogICB9ICAKIH0KIHJldHVybiBidDsKfQoKLyoKKiBjaGFuZyB0aGUgYml0KGl0J3MgbGVuZ3RoID0gNCkgaW50byB0aGUgaGV4CiogCiogcmV0dXJuIGhleAoqLwpmdW5jdGlvbiBidDRUb0hleChiaW5hcnkpIHsKIHZhciBoZXg7CiBzd2l0Y2ggKGJpbmFyeSkgewogICBjYXNlICIwMDAwIiA6IGhleCA9ICIwIjsgYnJlYWs7CiAgIGNhc2UgIjAwMDEiIDogaGV4ID0gIjEiOyBicmVhazsKICAgY2FzZSAiMDAxMCIgOiBoZXggPSAiMiI7IGJyZWFrOwogICBjYXNlICIwMDExIiA6IGhleCA9ICIzIjsgYnJlYWs7CiAgIGNhc2UgIjAxMDAiIDogaGV4ID0gIjQiOyBicmVhazsKICAgY2FzZSAiMDEwMSIgOiBoZXggPSAiNSI7IGJyZWFrOwogICBjYXNlICIwMTEwIiA6IGhleCA9ICI2IjsgYnJlYWs7CiAgIGNhc2UgIjAxMTEiIDogaGV4ID0gIjciOyBicmVhazsKICAgY2FzZSAiMTAwMCIgOiBoZXggPSAiOCI7IGJyZWFrOwogICBjYXNlICIxMDAxIiA6IGhleCA9ICI5IjsgYnJlYWs7CiAgIGNhc2UgIjEwMTAiIDogaGV4ID0gIkEiOyBicmVhazsKICAgY2FzZSAiMTAxMSIgOiBoZXggPSAiQiI7IGJyZWFrOwogICBjYXNlICIxMTAwIiA6IGhleCA9ICJDIjsgYnJlYWs7CiAgIGNhc2UgIjExMDEiIDogaGV4ID0gIkQiOyBicmVhazsKICAgY2FzZSAiMTExMCIgOiBoZXggPSAiRSI7IGJyZWFrOwogICBjYXNlICIxMTExIiA6IGhleCA9ICJGIjsgYnJlYWs7CiB9CiByZXR1cm4gaGV4Owp9CgovKgoqIGNoYW5nIHRoZSBoZXggaW50byB0aGUgYml0KGl0J3MgbGVuZ3RoID0gNCkKKiAKKiByZXR1cm4gdGhlIGJpdChpdCdzIGxlbmd0aCA9IDQpCiovCmZ1bmN0aW9uIGhleFRvQnQ0KGhleCkgewogdmFyIGJpbmFyeTsKIHN3aXRjaCAoaGV4KSB7CiAgIGNhc2UgIjAiIDogYmluYXJ5ID0gIjAwMDAiOyBicmVhazsKICAgY2FzZSAiMSIgOiBiaW5hcnkgPSAiMDAwMSI7IGJyZWFrOwogICBjYXNlICIyIiA6IGJpbmFyeSA9ICIwMDEwIjsgYnJlYWs7CiAgIGNhc2UgIjMiIDogYmluYXJ5ID0gIjAwMTEiOyBicmVhazsKICAgY2FzZSAiNCIgOiBiaW5hcnkgPSAiMDEwMCI7IGJyZWFrOwogICBjYXNlICI1IiA6IGJpbmFyeSA9ICIwMTAxIjsgYnJlYWs7CiAgIGNhc2UgIjYiIDogYmluYXJ5ID0gIjAxMTAiOyBicmVhazsKICAgY2FzZSAiNyIgOiBiaW5hcnkgPSAiMDExMSI7IGJyZWFrOwogICBjYXNlICI4IiA6IGJpbmFyeSA9ICIxMDAwIjsgYnJlYWs7CiAgIGNhc2UgIjkiIDogYmluYXJ5ID0gIjEwMDEiOyBicmVhazsKICAgY2FzZSAiQSIgOiBiaW5hcnkgPSAiMTAxMCI7IGJyZWFrOwogICBjYXNlICJCIiA6IGJpbmFyeSA9ICIxMDExIjsgYnJlYWs7CiAgIGNhc2UgIkMiIDogYmluYXJ5ID0gIjExMDAiOyBicmVhazsKICAgY2FzZSAiRCIgOiBiaW5hcnkgPSAiMTEwMSI7IGJyZWFrOwogICBjYXNlICJFIiA6IGJpbmFyeSA9ICIxMTEwIjsgYnJlYWs7CiAgIGNhc2UgIkYiIDogYmluYXJ5ID0gIjExMTEiOyBicmVhazsKIH0KIHJldHVybiBiaW5hcnk7Cn0KCi8qCiogY2hhbmcgdGhlIGJpdChpdCdzIGxlbmd0aCA9IDY0KSBpbnRvIHRoZSBzdHJpbmcKKiAKKiByZXR1cm4gc3RyaW5nCiovCmZ1bmN0aW9uIGJ5dGVUb1N0cmluZyhieXRlRGF0YSl7CiB2YXIgc3RyPSIiOwogZm9yKGkgPSAwO2k8NDtpKyspewogICB2YXIgY291bnQ9MDsKICAgZm9yKGo9MDtqPDE2O2orKyl7ICAgICAgICAKICAgICB2YXIgcG93PTE7CiAgICAgZm9yKG09MTU7bT5qO20tLSl7CiAgICAgICBwb3cqPTI7CiAgICAgfSAgICAgICAgICAgICAgCiAgICAgY291bnQrPWJ5dGVEYXRhWzE2Kmkral0qcG93OwogICB9ICAgICAgICAKICAgaWYoY291bnQgIT0gMCl7CiAgICAgc3RyKz1TdHJpbmcuZnJvbUNoYXJDb2RlKGNvdW50KTsKICAgfQogfQogcmV0dXJuIHN0cjsKfQoKZnVuY3Rpb24gYnQ2NFRvSGV4KGJ5dGVEYXRhKXsKIHZhciBoZXggPSAiIjsKIGZvcihpID0gMDtpPDE2O2krKyl7CiAgIHZhciBidCA9ICIiOwogICBmb3Ioaj0wO2o8NDtqKyspeyAgICAKICAgICBidCArPSBieXRlRGF0YVtpKjQral07CiAgIH0gICAgCiAgIGhleCs9YnQ0VG9IZXgoYnQpOwogfQogcmV0dXJuIGhleDsKfQoKZnVuY3Rpb24gaGV4VG9CdDY0KGhleCl7CiB2YXIgYmluYXJ5ID0gIiI7CiBmb3IoaSA9IDA7aTwxNjtpKyspewogICBiaW5hcnkrPWhleFRvQnQ0KGhleC5zdWJzdHJpbmcoaSxpKzEpKTsKIH0KIHJldHVybiBiaW5hcnk7Cn0KCi8qCiogdGhlIDY0IGJpdCBkZXMgY29yZSBhcml0aG1ldGljCiovCgpmdW5jdGlvbiBlbmMoZGF0YUJ5dGUsa2V5Qnl0ZSl7ICAKIHZhciBrZXlzID0gZ2VuZXJhdGVLZXlzKGtleUJ5dGUpOyAgICAKIHZhciBpcEJ5dGUgICA9IGluaXRQZXJtdXRlKGRhdGFCeXRlKTsgIAogdmFyIGlwTGVmdCAgID0gbmV3IEFycmF5KDMyKTsKIHZhciBpcFJpZ2h0ICA9IG5ldyBBcnJheSgzMik7CiB2YXIgdGVtcExlZnQgPSBuZXcgQXJyYXkoMzIpOwogdmFyIGkgPSAwLGogPSAwLGsgPSAwLG0gPSAwLCBuID0gMDsKIGZvcihrID0gMDtrIDwgMzI7ayArKyl7CiAgIGlwTGVmdFtrXSA9IGlwQnl0ZVtrXTsKICAgaXBSaWdodFtrXSA9IGlwQnl0ZVszMitrXTsKIH0gICAgCiBmb3IoaSA9IDA7aSA8IDE2O2kgKyspewogICBmb3IoaiA9IDA7aiA8IDMyO2ogKyspewogICAgIHRlbXBMZWZ0W2pdID0gaXBMZWZ0W2pdOwogICAgIGlwTGVmdFtqXSA9IGlwUmlnaHRbal07ICAgICAgCiAgIH0gIAogICB2YXIga2V5ID0gbmV3IEFycmF5KDQ4KTsKICAgZm9yKG0gPSAwO20gPCA0ODttICsrKXsKICAgICBrZXlbbV0gPSBrZXlzW2ldW21dOwogICB9CiAgIHZhciAgdGVtcFJpZ2h0ID0geG9yKHBQZXJtdXRlKHNCb3hQZXJtdXRlKHhvcihleHBhbmRQZXJtdXRlKGlwUmlnaHQpLGtleSkpKSwgdGVtcExlZnQpOyAgICAgIAogICBmb3IobiA9IDA7biA8IDMyO24gKyspewogICAgIGlwUmlnaHRbbl0gPSB0ZW1wUmlnaHRbbl07CiAgIH0gIAogICAKIH0gIAogCiAKIHZhciBmaW5hbERhdGEgPW5ldyBBcnJheSg2NCk7CiBmb3IoaSA9IDA7aSA8IDMyO2kgKyspewogICBmaW5hbERhdGFbaV0gPSBpcFJpZ2h0W2ldOwogICBmaW5hbERhdGFbMzIraV0gPSBpcExlZnRbaV07CiB9CiByZXR1cm4gZmluYWxseVBlcm11dGUoZmluYWxEYXRhKTsgIAp9CgpmdW5jdGlvbiBkZWMoZGF0YUJ5dGUsa2V5Qnl0ZSl7ICAKIHZhciBrZXlzID0gZ2VuZXJhdGVLZXlzKGtleUJ5dGUpOyAgICAKIHZhciBpcEJ5dGUgICA9IGluaXRQZXJtdXRlKGRhdGFCeXRlKTsgIAogdmFyIGlwTGVmdCAgID0gbmV3IEFycmF5KDMyKTsKIHZhciBpcFJpZ2h0ICA9IG5ldyBBcnJheSgzMik7CiB2YXIgdGVtcExlZnQgPSBuZXcgQXJyYXkoMzIpOwogdmFyIGkgPSAwLGogPSAwLGsgPSAwLG0gPSAwLCBuID0gMDsKIGZvcihrID0gMDtrIDwgMzI7ayArKyl7CiAgIGlwTGVmdFtrXSA9IGlwQnl0ZVtrXTsKICAgaXBSaWdodFtrXSA9IGlwQnl0ZVszMitrXTsKIH0gIAogZm9yKGkgPSAxNTtpID49IDA7aSAtLSl7CiAgIGZvcihqID0gMDtqIDwgMzI7aiArKyl7CiAgICAgdGVtcExlZnRbal0gPSBpcExlZnRbal07CiAgICAgaXBMZWZ0W2pdID0gaXBSaWdodFtqXTsgICAgICAKICAgfSAgCiAgIHZhciBrZXkgPSBuZXcgQXJyYXkoNDgpOwogICBmb3IobSA9IDA7bSA8IDQ4O20gKyspewogICAgIGtleVttXSA9IGtleXNbaV1bbV07CiAgIH0KICAgCiAgIHZhciAgdGVtcFJpZ2h0ID0geG9yKHBQZXJtdXRlKHNCb3hQZXJtdXRlKHhvcihleHBhbmRQZXJtdXRlKGlwUmlnaHQpLGtleSkpKSwgdGVtcExlZnQpOyAgICAgIAogICBmb3IobiA9IDA7biA8IDMyO24gKyspewogICAgIGlwUmlnaHRbbl0gPSB0ZW1wUmlnaHRbbl07CiAgIH0gIAogfSAgCiAKIAogdmFyIGZpbmFsRGF0YSA9bmV3IEFycmF5KDY0KTsKIGZvcihpID0gMDtpIDwgMzI7aSArKyl7CiAgIGZpbmFsRGF0YVtpXSA9IGlwUmlnaHRbaV07CiAgIGZpbmFsRGF0YVszMitpXSA9IGlwTGVmdFtpXTsKIH0KIHJldHVybiBmaW5hbGx5UGVybXV0ZShmaW5hbERhdGEpOyAgCn0KCmZ1bmN0aW9uIGluaXRQZXJtdXRlKG9yaWdpbmFsRGF0YSl7CiB2YXIgaXBCeXRlID0gbmV3IEFycmF5KDY0KTsKIGZvciAoaSA9IDAsIG0gPSAxLCBuID0gMDsgaSA8IDQ7IGkrKywgbSArPSAyLCBuICs9IDIpIHsKICAgZm9yIChqID0gNywgayA9IDA7IGogPj0gMDsgai0tLCBrKyspIHsKICAgICBpcEJ5dGVbaSAqIDggKyBrXSA9IG9yaWdpbmFsRGF0YVtqICogOCArIG1dOwogICAgIGlwQnl0ZVtpICogOCArIGsgKyAzMl0gPSBvcmlnaW5hbERhdGFbaiAqIDggKyBuXTsKICAgfQogfSAgICAKIHJldHVybiBpcEJ5dGU7Cn0KCmZ1bmN0aW9uIGV4cGFuZFBlcm11dGUocmlnaHREYXRhKXsgIAogdmFyIGVwQnl0ZSA9IG5ldyBBcnJheSg0OCk7CiBmb3IgKGkgPSAwOyBpIDwgODsgaSsrKSB7CiAgIGlmIChpID09IDApIHsKICAgICBlcEJ5dGVbaSAqIDYgKyAwXSA9IHJpZ2h0RGF0YVszMV07CiAgIH0gZWxzZSB7CiAgICAgZXBCeXRlW2kgKiA2ICsgMF0gPSByaWdodERhdGFbaSAqIDQgLSAxXTsKICAgfQogICBlcEJ5dGVbaSAqIDYgKyAxXSA9IHJpZ2h0RGF0YVtpICogNCArIDBdOwogICBlcEJ5dGVbaSAqIDYgKyAyXSA9IHJpZ2h0RGF0YVtpICogNCArIDFdOwogICBlcEJ5dGVbaSAqIDYgKyAzXSA9IHJpZ2h0RGF0YVtpICogNCArIDJdOwogICBlcEJ5dGVbaSAqIDYgKyA0XSA9IHJpZ2h0RGF0YVtpICogNCArIDNdOwogICBpZiAoaSA9PSA3KSB7CiAgICAgZXBCeXRlW2kgKiA2ICsgNV0gPSByaWdodERhdGFbMF07CiAgIH0gZWxzZSB7CiAgICAgZXBCeXRlW2kgKiA2ICsgNV0gPSByaWdodERhdGFbaSAqIDQgKyA0XTsKICAgfQogfSAgICAgIAogcmV0dXJuIGVwQnl0ZTsKfQoKZnVuY3Rpb24geG9yKGJ5dGVPbmUsYnl0ZVR3byl7ICAKIHZhciB4b3JCeXRlID0gbmV3IEFycmF5KGJ5dGVPbmUubGVuZ3RoKTsKIGZvcihpID0gMDtpIDwgYnl0ZU9uZS5sZW5ndGg7IGkgKyspeyAgICAgIAogICB4b3JCeXRlW2ldID0gYnl0ZU9uZVtpXSBeIGJ5dGVUd29baV07CiB9ICAKIHJldHVybiB4b3JCeXRlOwp9CgpmdW5jdGlvbiBzQm94UGVybXV0ZShleHBhbmRCeXRlKXsKIAogICB2YXIgc0JveEJ5dGUgPSBuZXcgQXJyYXkoMzIpOwogICB2YXIgYmluYXJ5ID0gIiI7CiAgIHZhciBzMSA9IFsKICAgICAgIFsxNCwgNCwgMTMsIDEsIDIsIDE1LCAxMSwgOCwgMywgMTAsIDYsIDEyLCA1LCA5LCAwLCA3XSwKICAgICAgIFswLCAxNSwgNywgNCwgMTQsIDIsIDEzLCAxLCAxMCwgNiwgMTIsIDExLCA5LCA1LCAzLCA4XSwKICAgICAgIFs0LCAxLCAxNCwgOCwgMTMsIDYsIDIsIDExLCAxNSwgMTIsIDksIDcsIDMsIDEwLCA1LCAwXSwKICAgICAgIFsxNSwgMTIsIDgsIDIsIDQsIDksIDEsIDcsIDUsIDExLCAzLCAxNCwgMTAsIDAsIDYsIDEzIF1dOwoKICAgICAgIC8qIFRhYmxlIC0gczIgKi8KICAgdmFyIHMyID0gWwogICAgICAgWzE1LCAxLCA4LCAxNCwgNiwgMTEsIDMsIDQsIDksIDcsIDIsIDEzLCAxMiwgMCwgNSwgMTBdLAogICAgICAgWzMsIDEzLCA0LCA3LCAxNSwgMiwgOCwgMTQsIDEyLCAwLCAxLCAxMCwgNiwgOSwgMTEsIDVdLAogICAgICAgWzAsIDE0LCA3LCAxMSwgMTAsIDQsIDEzLCAxLCA1LCA4LCAxMiwgNiwgOSwgMywgMiwgMTVdLAogICAgICAgWzEzLCA4LCAxMCwgMSwgMywgMTUsIDQsIDIsIDExLCA2LCA3LCAxMiwgMCwgNSwgMTQsIDkgXV07CgogICAgICAgLyogVGFibGUgLSBzMyAqLwogICB2YXIgczM9IFsKICAgICAgIFsxMCwgMCwgOSwgMTQsIDYsIDMsIDE1LCA1LCAxLCAxMywgMTIsIDcsIDExLCA0LCAyLCA4XSwKICAgICAgIFsxMywgNywgMCwgOSwgMywgNCwgNiwgMTAsIDIsIDgsIDUsIDE0LCAxMiwgMTEsIDE1LCAxXSwKICAgICAgIFsxMywgNiwgNCwgOSwgOCwgMTUsIDMsIDAsIDExLCAxLCAyLCAxMiwgNSwgMTAsIDE0LCA3XSwKICAgICAgIFsxLCAxMCwgMTMsIDAsIDYsIDksIDgsIDcsIDQsIDE1LCAxNCwgMywgMTEsIDUsIDIsIDEyIF1dOwogICAgICAgLyogVGFibGUgLSBzNCAqLwogICB2YXIgczQgPSBbCiAgICAgICBbNywgMTMsIDE0LCAzLCAwLCA2LCA5LCAxMCwgMSwgMiwgOCwgNSwgMTEsIDEyLCA0LCAxNV0sCiAgICAgICBbMTMsIDgsIDExLCA1LCA2LCAxNSwgMCwgMywgNCwgNywgMiwgMTIsIDEsIDEwLCAxNCwgOV0sCiAgICAgICBbMTAsIDYsIDksIDAsIDEyLCAxMSwgNywgMTMsIDE1LCAxLCAzLCAxNCwgNSwgMiwgOCwgNF0sCiAgICAgICBbMywgMTUsIDAsIDYsIDEwLCAxLCAxMywgOCwgOSwgNCwgNSwgMTEsIDEyLCA3LCAyLCAxNCBdXTsKCiAgICAgICAvKiBUYWJsZSAtIHM1ICovCiAgIHZhciBzNSA9IFsKICAgICAgIFsyLCAxMiwgNCwgMSwgNywgMTAsIDExLCA2LCA4LCA1LCAzLCAxNSwgMTMsIDAsIDE0LCA5XSwKICAgICAgIFsxNCwgMTEsIDIsIDEyLCA0LCA3LCAxMywgMSwgNSwgMCwgMTUsIDEwLCAzLCA5LCA4LCA2XSwKICAgICAgIFs0LCAyLCAxLCAxMSwgMTAsIDEzLCA3LCA4LCAxNSwgOSwgMTIsIDUsIDYsIDMsIDAsIDE0XSwKICAgICAgIFsxMSwgOCwgMTIsIDcsIDEsIDE0LCAyLCAxMywgNiwgMTUsIDAsIDksIDEwLCA0LCA1LCAzIF1dOwoKICAgICAgIC8qIFRhYmxlIC0gczYgKi8KICAgdmFyIHM2ID0gWwogICAgICAgWzEyLCAxLCAxMCwgMTUsIDksIDIsIDYsIDgsIDAsIDEzLCAzLCA0LCAxNCwgNywgNSwgMTFdLAogICAgICAgWzEwLCAxNSwgNCwgMiwgNywgMTIsIDksIDUsIDYsIDEsIDEzLCAxNCwgMCwgMTEsIDMsIDhdLAogICAgICAgWzksIDE0LCAxNSwgNSwgMiwgOCwgMTIsIDMsIDcsIDAsIDQsIDEwLCAxLCAxMywgMTEsIDZdLAogICAgICAgWzQsIDMsIDIsIDEyLCA5LCA1LCAxNSwgMTAsIDExLCAxNCwgMSwgNywgNiwgMCwgOCwgMTMgXV07CgogICAgICAgLyogVGFibGUgLSBzNyAqLwogICB2YXIgczcgPSBbCiAgICAgICBbNCwgMTEsIDIsIDE0LCAxNSwgMCwgOCwgMTMsIDMsIDEyLCA5LCA3LCA1LCAxMCwgNiwgMV0sCiAgICAgICBbMTMsIDAsIDExLCA3LCA0LCA5LCAxLCAxMCwgMTQsIDMsIDUsIDEyLCAyLCAxNSwgOCwgNl0sCiAgICAgICBbMSwgNCwgMTEsIDEzLCAxMiwgMywgNywgMTQsIDEwLCAxNSwgNiwgOCwgMCwgNSwgOSwgMl0sCiAgICAgICBbNiwgMTEsIDEzLCA4LCAxLCA0LCAxMCwgNywgOSwgNSwgMCwgMTUsIDE0LCAyLCAzLCAxMl1dOwoKICAgICAgIC8qIFRhYmxlIC0gczggKi8KICAgdmFyIHM4ID0gWwogICAgICAgWzEzLCAyLCA4LCA0LCA2LCAxNSwgMTEsIDEsIDEwLCA5LCAzLCAxNCwgNSwgMCwgMTIsIDddLAogICAgICAgWzEsIDE1LCAxMywgOCwgMTAsIDMsIDcsIDQsIDEyLCA1LCA2LCAxMSwgMCwgMTQsIDksIDJdLAogICAgICAgWzcsIDExLCA0LCAxLCA5LCAxMiwgMTQsIDIsIDAsIDYsIDEwLCAxMywgMTUsIDMsIDUsIDhdLAogICAgICAgWzIsIDEsIDE0LCA3LCA0LCAxMCwgOCwgMTMsIDE1LCAxMiwgOSwgMCwgMywgNSwgNiwgMTFdXTsKICAgCiAgIGZvcihtPTA7bTw4O20rKyl7CiAgIHZhciBpPTAsaj0wOwogICBpID0gZXhwYW5kQnl0ZVttKjYrMF0qMitleHBhbmRCeXRlW20qNis1XTsKICAgaiA9IGV4cGFuZEJ5dGVbbSAqIDYgKyAxXSAqIDIgKiAyICogMiAKICAgICArIGV4cGFuZEJ5dGVbbSAqIDYgKyAyXSAqIDIqIDIgCiAgICAgKyBleHBhbmRCeXRlW20gKiA2ICsgM10gKiAyIAogICAgICsgZXhwYW5kQnl0ZVttICogNiArIDRdOwogICBzd2l0Y2ggKG0pIHsKICAgICBjYXNlIDAgOgogICAgICAgYmluYXJ5ID0gZ2V0Qm94QmluYXJ5KHMxW2ldW2pdKTsKICAgICAgIGJyZWFrOwogICAgIGNhc2UgMSA6CiAgICAgICBiaW5hcnkgPSBnZXRCb3hCaW5hcnkoczJbaV1bal0pOwogICAgICAgYnJlYWs7CiAgICAgY2FzZSAyIDoKICAgICAgIGJpbmFyeSA9IGdldEJveEJpbmFyeShzM1tpXVtqXSk7CiAgICAgICBicmVhazsKICAgICBjYXNlIDMgOgogICAgICAgYmluYXJ5ID0gZ2V0Qm94QmluYXJ5KHM0W2ldW2pdKTsKICAgICAgIGJyZWFrOwogICAgIGNhc2UgNCA6CiAgICAgICBiaW5hcnkgPSBnZXRCb3hCaW5hcnkoczVbaV1bal0pOwogICAgICAgYnJlYWs7CiAgICAgY2FzZSA1IDoKICAgICAgIGJpbmFyeSA9IGdldEJveEJpbmFyeShzNltpXVtqXSk7CiAgICAgICBicmVhazsKICAgICBjYXNlIDYgOgogICAgICAgYmluYXJ5ID0gZ2V0Qm94QmluYXJ5KHM3W2ldW2pdKTsKICAgICAgIGJyZWFrOwogICAgIGNhc2UgNyA6CiAgICAgICBiaW5hcnkgPSBnZXRCb3hCaW5hcnkoczhbaV1bal0pOwogICAgICAgYnJlYWs7CiAgIH0gICAgICAKICAgc0JveEJ5dGVbbSo0KzBdID0gcGFyc2VJbnQoYmluYXJ5LnN1YnN0cmluZygwLDEpKTsKICAgc0JveEJ5dGVbbSo0KzFdID0gcGFyc2VJbnQoYmluYXJ5LnN1YnN0cmluZygxLDIpKTsKICAgc0JveEJ5dGVbbSo0KzJdID0gcGFyc2VJbnQoYmluYXJ5LnN1YnN0cmluZygyLDMpKTsKICAgc0JveEJ5dGVbbSo0KzNdID0gcGFyc2VJbnQoYmluYXJ5LnN1YnN0cmluZygzLDQpKTsKIH0KIHJldHVybiBzQm94Qnl0ZTsKfQoKZnVuY3Rpb24gcFBlcm11dGUoc0JveEJ5dGUpewogdmFyIHBCb3hQZXJtdXRlID0gbmV3IEFycmF5KDMyKTsKIHBCb3hQZXJtdXRlWyAwXSA9IHNCb3hCeXRlWzE1XTsgCiBwQm94UGVybXV0ZVsgMV0gPSBzQm94Qnl0ZVsgNl07IAogcEJveFBlcm11dGVbIDJdID0gc0JveEJ5dGVbMTldOyAKIHBCb3hQZXJtdXRlWyAzXSA9IHNCb3hCeXRlWzIwXTsgCiBwQm94UGVybXV0ZVsgNF0gPSBzQm94Qnl0ZVsyOF07IAogcEJveFBlcm11dGVbIDVdID0gc0JveEJ5dGVbMTFdOyAKIHBCb3hQZXJtdXRlWyA2XSA9IHNCb3hCeXRlWzI3XTsgCiBwQm94UGVybXV0ZVsgN10gPSBzQm94Qnl0ZVsxNl07IAogcEJveFBlcm11dGVbIDhdID0gc0JveEJ5dGVbIDBdOyAKIHBCb3hQZXJtdXRlWyA5XSA9IHNCb3hCeXRlWzE0XTsgCiBwQm94UGVybXV0ZVsxMF0gPSBzQm94Qnl0ZVsyMl07IAogcEJveFBlcm11dGVbMTFdID0gc0JveEJ5dGVbMjVdOyAKIHBCb3hQZXJtdXRlWzEyXSA9IHNCb3hCeXRlWyA0XTsgCiBwQm94UGVybXV0ZVsxM10gPSBzQm94Qnl0ZVsxN107IAogcEJveFBlcm11dGVbMTRdID0gc0JveEJ5dGVbMzBdOyAKIHBCb3hQZXJtdXRlWzE1XSA9IHNCb3hCeXRlWyA5XTsgCiBwQm94UGVybXV0ZVsxNl0gPSBzQm94Qnl0ZVsgMV07IAogcEJveFBlcm11dGVbMTddID0gc0JveEJ5dGVbIDddOyAKIHBCb3hQZXJtdXRlWzE4XSA9IHNCb3hCeXRlWzIzXTsgCiBwQm94UGVybXV0ZVsxOV0gPSBzQm94Qnl0ZVsxM107IAogcEJveFBlcm11dGVbMjBdID0gc0JveEJ5dGVbMzFdOyAKIHBCb3hQZXJtdXRlWzIxXSA9IHNCb3hCeXRlWzI2XTsgCiBwQm94UGVybXV0ZVsyMl0gPSBzQm94Qnl0ZVsgMl07IAogcEJveFBlcm11dGVbMjNdID0gc0JveEJ5dGVbIDhdOyAKIHBCb3hQZXJtdXRlWzI0XSA9IHNCb3hCeXRlWzE4XTsgCiBwQm94UGVybXV0ZVsyNV0gPSBzQm94Qnl0ZVsxMl07IAogcEJveFBlcm11dGVbMjZdID0gc0JveEJ5dGVbMjldOyAKIHBCb3hQZXJtdXRlWzI3XSA9IHNCb3hCeXRlWyA1XTsgCiBwQm94UGVybXV0ZVsyOF0gPSBzQm94Qnl0ZVsyMV07IAogcEJveFBlcm11dGVbMjldID0gc0JveEJ5dGVbMTBdOyAKIHBCb3hQZXJtdXRlWzMwXSA9IHNCb3hCeXRlWyAzXTsgCiBwQm94UGVybXV0ZVszMV0gPSBzQm94Qnl0ZVsyNF07ICAgIAogcmV0dXJuIHBCb3hQZXJtdXRlOwp9CgpmdW5jdGlvbiBmaW5hbGx5UGVybXV0ZShlbmRCeXRlKXsgICAgCiB2YXIgZnBCeXRlID0gbmV3IEFycmF5KDY0KTsgIAogZnBCeXRlWyAwXSA9IGVuZEJ5dGVbMzldOyAKIGZwQnl0ZVsgMV0gPSBlbmRCeXRlWyA3XTsgCiBmcEJ5dGVbIDJdID0gZW5kQnl0ZVs0N107IAogZnBCeXRlWyAzXSA9IGVuZEJ5dGVbMTVdOyAKIGZwQnl0ZVsgNF0gPSBlbmRCeXRlWzU1XTsgCiBmcEJ5dGVbIDVdID0gZW5kQnl0ZVsyM107IAogZnBCeXRlWyA2XSA9IGVuZEJ5dGVbNjNdOyAKIGZwQnl0ZVsgN10gPSBlbmRCeXRlWzMxXTsgCiBmcEJ5dGVbIDhdID0gZW5kQnl0ZVszOF07IAogZnBCeXRlWyA5XSA9IGVuZEJ5dGVbIDZdOyAKIGZwQnl0ZVsxMF0gPSBlbmRCeXRlWzQ2XTsgCiBmcEJ5dGVbMTFdID0gZW5kQnl0ZVsxNF07IAogZnBCeXRlWzEyXSA9IGVuZEJ5dGVbNTRdOyAKIGZwQnl0ZVsxM10gPSBlbmRCeXRlWzIyXTsgCiBmcEJ5dGVbMTRdID0gZW5kQnl0ZVs2Ml07IAogZnBCeXRlWzE1XSA9IGVuZEJ5dGVbMzBdOyAKIGZwQnl0ZVsxNl0gPSBlbmRCeXRlWzM3XTsgCiBmcEJ5dGVbMTddID0gZW5kQnl0ZVsgNV07IAogZnBCeXRlWzE4XSA9IGVuZEJ5dGVbNDVdOyAKIGZwQnl0ZVsxOV0gPSBlbmRCeXRlWzEzXTsgCiBmcEJ5dGVbMjBdID0gZW5kQnl0ZVs1M107IAogZnBCeXRlWzIxXSA9IGVuZEJ5dGVbMjFdOyAKIGZwQnl0ZVsyMl0gPSBlbmRCeXRlWzYxXTsgCiBmcEJ5dGVbMjNdID0gZW5kQnl0ZVsyOV07IAogZnBCeXRlWzI0XSA9IGVuZEJ5dGVbMzZdOyAKIGZwQnl0ZVsyNV0gPSBlbmRCeXRlWyA0XTsgCiBmcEJ5dGVbMjZdID0gZW5kQnl0ZVs0NF07IAogZnBCeXRlWzI3XSA9IGVuZEJ5dGVbMTJdOyAKIGZwQnl0ZVsyOF0gPSBlbmRCeXRlWzUyXTsgCiBmcEJ5dGVbMjldID0gZW5kQnl0ZVsyMF07IAogZnBCeXRlWzMwXSA9IGVuZEJ5dGVbNjBdOyAKIGZwQnl0ZVszMV0gPSBlbmRCeXRlWzI4XTsgCiBmcEJ5dGVbMzJdID0gZW5kQnl0ZVszNV07IAogZnBCeXRlWzMzXSA9IGVuZEJ5dGVbIDNdOyAKIGZwQnl0ZVszNF0gPSBlbmRCeXRlWzQzXTsgCiBmcEJ5dGVbMzVdID0gZW5kQnl0ZVsxMV07IAogZnBCeXRlWzM2XSA9IGVuZEJ5dGVbNTFdOyAKIGZwQnl0ZVszN10gPSBlbmRCeXRlWzE5XTsgCiBmcEJ5dGVbMzhdID0gZW5kQnl0ZVs1OV07IAogZnBCeXRlWzM5XSA9IGVuZEJ5dGVbMjddOyAKIGZwQnl0ZVs0MF0gPSBlbmRCeXRlWzM0XTsgCiBmcEJ5dGVbNDFdID0gZW5kQnl0ZVsgMl07IAogZnBCeXRlWzQyXSA9IGVuZEJ5dGVbNDJdOyAKIGZwQnl0ZVs0M10gPSBlbmRCeXRlWzEwXTsgCiBmcEJ5dGVbNDRdID0gZW5kQnl0ZVs1MF07IAogZnBCeXRlWzQ1XSA9IGVuZEJ5dGVbMThdOyAKIGZwQnl0ZVs0Nl0gPSBlbmRCeXRlWzU4XTsgCiBmcEJ5dGVbNDddID0gZW5kQnl0ZVsyNl07IAogZnBCeXRlWzQ4XSA9IGVuZEJ5dGVbMzNdOyAKIGZwQnl0ZVs0OV0gPSBlbmRCeXRlWyAxXTsgCiBmcEJ5dGVbNTBdID0gZW5kQnl0ZVs0MV07IAogZnBCeXRlWzUxXSA9IGVuZEJ5dGVbIDldOyAKIGZwQnl0ZVs1Ml0gPSBlbmRCeXRlWzQ5XTsgCiBmcEJ5dGVbNTNdID0gZW5kQnl0ZVsxN107IAogZnBCeXRlWzU0XSA9IGVuZEJ5dGVbNTddOyAKIGZwQnl0ZVs1NV0gPSBlbmRCeXRlWzI1XTsgCiBmcEJ5dGVbNTZdID0gZW5kQnl0ZVszMl07IAogZnBCeXRlWzU3XSA9IGVuZEJ5dGVbIDBdOyAKIGZwQnl0ZVs1OF0gPSBlbmRCeXRlWzQwXTsgCiBmcEJ5dGVbNTldID0gZW5kQnl0ZVsgOF07IAogZnBCeXRlWzYwXSA9IGVuZEJ5dGVbNDhdOyAKIGZwQnl0ZVs2MV0gPSBlbmRCeXRlWzE2XTsgCiBmcEJ5dGVbNjJdID0gZW5kQnl0ZVs1Nl07IAogZnBCeXRlWzYzXSA9IGVuZEJ5dGVbMjRdOwogcmV0dXJuIGZwQnl0ZTsKfQoKZnVuY3Rpb24gZ2V0Qm94QmluYXJ5KGkpIHsKIHZhciBiaW5hcnkgPSAiIjsKIHN3aXRjaCAoaSkgewogICBjYXNlIDAgOmJpbmFyeSA9ICIwMDAwIjticmVhazsKICAgY2FzZSAxIDpiaW5hcnkgPSAiMDAwMSI7YnJlYWs7CiAgIGNhc2UgMiA6YmluYXJ5ID0gIjAwMTAiO2JyZWFrOwogICBjYXNlIDMgOmJpbmFyeSA9ICIwMDExIjticmVhazsKICAgY2FzZSA0IDpiaW5hcnkgPSAiMDEwMCI7YnJlYWs7CiAgIGNhc2UgNSA6YmluYXJ5ID0gIjAxMDEiO2JyZWFrOwogICBjYXNlIDYgOmJpbmFyeSA9ICIwMTEwIjticmVhazsKICAgY2FzZSA3IDpiaW5hcnkgPSAiMDExMSI7YnJlYWs7CiAgIGNhc2UgOCA6YmluYXJ5ID0gIjEwMDAiO2JyZWFrOwogICBjYXNlIDkgOmJpbmFyeSA9ICIxMDAxIjticmVhazsKICAgY2FzZSAxMCA6YmluYXJ5ID0gIjEwMTAiO2JyZWFrOwogICBjYXNlIDExIDpiaW5hcnkgPSAiMTAxMSI7YnJlYWs7CiAgIGNhc2UgMTIgOmJpbmFyeSA9ICIxMTAwIjticmVhazsKICAgY2FzZSAxMyA6YmluYXJ5ID0gIjExMDEiO2JyZWFrOwogICBjYXNlIDE0IDpiaW5hcnkgPSAiMTExMCI7YnJlYWs7CiAgIGNhc2UgMTUgOmJpbmFyeSA9ICIxMTExIjticmVhazsKIH0KIHJldHVybiBiaW5hcnk7Cn0KLyoKKiBnZW5lcmF0ZSAxNiBrZXlzIGZvciB4b3IKKgoqLwpmdW5jdGlvbiBnZW5lcmF0ZUtleXMoa2V5Qnl0ZSl7ICAgIAogdmFyIGtleSAgID0gbmV3IEFycmF5KDU2KTsKIHZhciBrZXlzID0gbmV3IEFycmF5KCk7ICAKIAoga2V5c1sgMF0gPSBuZXcgQXJyYXkoKTsKIGtleXNbIDFdID0gbmV3IEFycmF5KCk7CiBrZXlzWyAyXSA9IG5ldyBBcnJheSgpOwoga2V5c1sgM10gPSBuZXcgQXJyYXkoKTsKIGtleXNbIDRdID0gbmV3IEFycmF5KCk7CiBrZXlzWyA1XSA9IG5ldyBBcnJheSgpOwoga2V5c1sgNl0gPSBuZXcgQXJyYXkoKTsKIGtleXNbIDddID0gbmV3IEFycmF5KCk7CiBrZXlzWyA4XSA9IG5ldyBBcnJheSgpOwoga2V5c1sgOV0gPSBuZXcgQXJyYXkoKTsKIGtleXNbMTBdID0gbmV3IEFycmF5KCk7CiBrZXlzWzExXSA9IG5ldyBBcnJheSgpOwoga2V5c1sxMl0gPSBuZXcgQXJyYXkoKTsKIGtleXNbMTNdID0gbmV3IEFycmF5KCk7CiBrZXlzWzE0XSA9IG5ldyBBcnJheSgpOwoga2V5c1sxNV0gPSBuZXcgQXJyYXkoKTsgIAogdmFyIGxvb3AgPSBbMSwxLDIsMiwyLDIsMiwyLDEsMiwyLDIsMiwyLDIsMV07CgogZm9yKGk9MDtpPDc7aSsrKXsKICAgZm9yKGo9MCxrPTc7ajw4O2orKyxrLS0pewogICAgIGtleVtpKjgral09a2V5Qnl0ZVs4KmsraV07CiAgIH0KIH0gICAgCiAKIHZhciBpID0gMDsKIGZvcihpID0gMDtpIDwgMTY7aSArKyl7CiAgIHZhciB0ZW1wTGVmdD0wOwogICB2YXIgdGVtcFJpZ2h0PTA7CiAgIGZvcihqID0gMDsgaiA8IGxvb3BbaV07aiArKyl7ICAgICAgICAgIAogICAgIHRlbXBMZWZ0ID0ga2V5WzBdOwogICAgIHRlbXBSaWdodCA9IGtleVsyOF07CiAgICAgZm9yKGsgPSAwO2sgPCAyNyA7ayArKyl7CiAgICAgICBrZXlba10gPSBrZXlbaysxXTsKICAgICAgIGtleVsyOCtrXSA9IGtleVsyOStrXTsKICAgICB9ICAKICAgICBrZXlbMjddPXRlbXBMZWZ0OwogICAgIGtleVs1NV09dGVtcFJpZ2h0OwogICB9CiAgIHZhciB0ZW1wS2V5ID0gbmV3IEFycmF5KDQ4KTsKICAgdGVtcEtleVsgMF0gPSBrZXlbMTNdOwogICB0ZW1wS2V5WyAxXSA9IGtleVsxNl07CiAgIHRlbXBLZXlbIDJdID0ga2V5WzEwXTsKICAgdGVtcEtleVsgM10gPSBrZXlbMjNdOwogICB0ZW1wS2V5WyA0XSA9IGtleVsgMF07CiAgIHRlbXBLZXlbIDVdID0ga2V5WyA0XTsKICAgdGVtcEtleVsgNl0gPSBrZXlbIDJdOwogICB0ZW1wS2V5WyA3XSA9IGtleVsyN107CiAgIHRlbXBLZXlbIDhdID0ga2V5WzE0XTsKICAgdGVtcEtleVsgOV0gPSBrZXlbIDVdOwogICB0ZW1wS2V5WzEwXSA9IGtleVsyMF07CiAgIHRlbXBLZXlbMTFdID0ga2V5WyA5XTsKICAgdGVtcEtleVsxMl0gPSBrZXlbMjJdOwogICB0ZW1wS2V5WzEzXSA9IGtleVsxOF07CiAgIHRlbXBLZXlbMTRdID0ga2V5WzExXTsKICAgdGVtcEtleVsxNV0gPSBrZXlbIDNdOwogICB0ZW1wS2V5WzE2XSA9IGtleVsyNV07CiAgIHRlbXBLZXlbMTddID0ga2V5WyA3XTsKICAgdGVtcEtleVsxOF0gPSBrZXlbMTVdOwogICB0ZW1wS2V5WzE5XSA9IGtleVsgNl07CiAgIHRlbXBLZXlbMjBdID0ga2V5WzI2XTsKICAgdGVtcEtleVsyMV0gPSBrZXlbMTldOwogICB0ZW1wS2V5WzIyXSA9IGtleVsxMl07CiAgIHRlbXBLZXlbMjNdID0ga2V5WyAxXTsKICAgdGVtcEtleVsyNF0gPSBrZXlbNDBdOwogICB0ZW1wS2V5WzI1XSA9IGtleVs1MV07CiAgIHRlbXBLZXlbMjZdID0ga2V5WzMwXTsKICAgdGVtcEtleVsyN10gPSBrZXlbMzZdOwogICB0ZW1wS2V5WzI4XSA9IGtleVs0Nl07CiAgIHRlbXBLZXlbMjldID0ga2V5WzU0XTsKICAgdGVtcEtleVszMF0gPSBrZXlbMjldOwogICB0ZW1wS2V5WzMxXSA9IGtleVszOV07CiAgIHRlbXBLZXlbMzJdID0ga2V5WzUwXTsKICAgdGVtcEtleVszM10gPSBrZXlbNDRdOwogICB0ZW1wS2V5WzM0XSA9IGtleVszMl07CiAgIHRlbXBLZXlbMzVdID0ga2V5WzQ3XTsKICAgdGVtcEtleVszNl0gPSBrZXlbNDNdOwogICB0ZW1wS2V5WzM3XSA9IGtleVs0OF07CiAgIHRlbXBLZXlbMzhdID0ga2V5WzM4XTsKICAgdGVtcEtleVszOV0gPSBrZXlbNTVdOwogICB0ZW1wS2V5WzQwXSA9IGtleVszM107CiAgIHRlbXBLZXlbNDFdID0ga2V5WzUyXTsKICAgdGVtcEtleVs0Ml0gPSBrZXlbNDVdOwogICB0ZW1wS2V5WzQzXSA9IGtleVs0MV07CiAgIHRlbXBLZXlbNDRdID0ga2V5WzQ5XTsKICAgdGVtcEtleVs0NV0gPSBrZXlbMzVdOwogICB0ZW1wS2V5WzQ2XSA9IGtleVsyOF07CiAgIHRlbXBLZXlbNDddID0ga2V5WzMxXTsKICAgc3dpdGNoKGkpewogICAgIGNhc2UgMDogZm9yKG09MDttIDwgNDggO20rKyl7IGtleXNbIDBdW21dID0gdGVtcEtleVttXTsgfSBicmVhazsKICAgICBjYXNlIDE6IGZvcihtPTA7bSA8IDQ4IDttKyspeyBrZXlzWyAxXVttXSA9IHRlbXBLZXlbbV07IH0gYnJlYWs7CiAgICAgY2FzZSAyOiBmb3IobT0wO20gPCA0OCA7bSsrKXsga2V5c1sgMl1bbV0gPSB0ZW1wS2V5W21dOyB9IGJyZWFrOwogICAgIGNhc2UgMzogZm9yKG09MDttIDwgNDggO20rKyl7IGtleXNbIDNdW21dID0gdGVtcEtleVttXTsgfSBicmVhazsKICAgICBjYXNlIDQ6IGZvcihtPTA7bSA8IDQ4IDttKyspeyBrZXlzWyA0XVttXSA9IHRlbXBLZXlbbV07IH0gYnJlYWs7CiAgICAgY2FzZSA1OiBmb3IobT0wO20gPCA0OCA7bSsrKXsga2V5c1sgNV1bbV0gPSB0ZW1wS2V5W21dOyB9IGJyZWFrOwogICAgIGNhc2UgNjogZm9yKG09MDttIDwgNDggO20rKyl7IGtleXNbIDZdW21dID0gdGVtcEtleVttXTsgfSBicmVhazsKICAgICBjYXNlIDc6IGZvcihtPTA7bSA8IDQ4IDttKyspeyBrZXlzWyA3XVttXSA9IHRlbXBLZXlbbV07IH0gYnJlYWs7CiAgICAgY2FzZSA4OiBmb3IobT0wO20gPCA0OCA7bSsrKXsga2V5c1sgOF1bbV0gPSB0ZW1wS2V5W21dOyB9IGJyZWFrOwogICAgIGNhc2UgOTogZm9yKG09MDttIDwgNDggO20rKyl7IGtleXNbIDldW21dID0gdGVtcEtleVttXTsgfSBicmVhazsKICAgICBjYXNlIDEwOiBmb3IobT0wO20gPCA0OCA7bSsrKXsga2V5c1sxMF1bbV0gPSB0ZW1wS2V5W21dOyB9IGJyZWFrOwogICAgIGNhc2UgMTE6IGZvcihtPTA7bSA8IDQ4IDttKyspeyBrZXlzWzExXVttXSA9IHRlbXBLZXlbbV07IH0gYnJlYWs7CiAgICAgY2FzZSAxMjogZm9yKG09MDttIDwgNDggO20rKyl7IGtleXNbMTJdW21dID0gdGVtcEtleVttXTsgfSBicmVhazsKICAgICBjYXNlIDEzOiBmb3IobT0wO20gPCA0OCA7bSsrKXsga2V5c1sxM11bbV0gPSB0ZW1wS2V5W21dOyB9IGJyZWFrOwogICAgIGNhc2UgMTQ6IGZvcihtPTA7bSA8IDQ4IDttKyspeyBrZXlzWzE0XVttXSA9IHRlbXBLZXlbbV07IH0gYnJlYWs7CiAgICAgY2FzZSAxNTogZm9yKG09MDttIDwgNDggO20rKyl7IGtleXNbMTVdW21dID0gdGVtcEtleVttXTsgfSBicmVhazsKICAgfQogfQogcmV0dXJuIGtleXM7ICAKfQovL2VuZC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLyoKZnVuY3Rpb24gdGVzdCgpIHsKIAogdmFyIG1zZyA9ICJhYmNkZWZnaCI7CiB2YXIgYnQgPSBzdHJUb0J0KG1zZyk7CiAKIHZhciBrZXkgPSAiMTIzNDU2NzgiOwogdmFyIGtleUIgPSBzdHJUb0J0KGtleSk7CiAgIAogdmFyIGVuY0J5dGUgPSBlbmMoYnQsa2V5Qik7CiAgICAgCiB2YXIgZW5jaGV4ICA9IGJ0NjRUb0hleChlbmNCeXRlKTsgIAogZW5kYXRhLnZhbHVlPWVuY2hleDsKIAogdmFyIGVuY1N0ciA9IGhleFRvQnQ2NChlbmNoZXgpOwogYWxlcnQoImVuY1N0cj0iK2VuY1N0cik7CiB2YXIgZUJ5dGUgPSBuZXcgQXJyYXkoKTsKIGZvcihtPTA7bTxlbmNTdHIubGVuZ3RoO20rKyl7CiAgIGVCeXRlW21dID0gcGFyc2VJbnQoZW5jU3RyLnN1YnN0cmluZyhtLG0rMSkpOwogfQogdmFyIGRlY2J5dGU9IGRlYyhlQnl0ZSxrZXlCKQogdmFyIGRlY21zZz0gYnl0ZVRvU3RyaW5nKGRlY2J5dGUpOwogYWxlcnQoImRlY2J5dGU9IitkZWNieXRlKTsKIGFsZXJ0KCJkZWNtc2c9IitkZWNtc2cpOyAgCn0qLwo=";

    @Override
    public HttpResult<Map<String, Object>> init(OperatorParam param) {
        HttpResult<Map<String, Object>> result = new HttpResult<>();
        Response response = null;
        try {
            String referer = "http://service.ah.10086.cn/index.html?t=";
            String templateUrl = "https://ah.ac.10086.cn/login";
            response = TaskHttpClient.create(param, RequestType.GET, "an_hui_10086_web_001").setFullUrl(templateUrl).setReferer(referer).invoke();
            String pageContent = response.getPageContent();

            templateUrl = PatternUtils.group(pageContent, "replace\\('([^']+)'\\);", 1);
            response = TaskHttpClient.create(param, RequestType.GET, "an_hui_10086_web_002").setFullUrl(templateUrl).invoke();
            pageContent = response.getPageContent();

            String backUrl = "http://service.ah.10086.cn/LoginSso";
            String backurlflag = "https://ah.ac.10086.cn/4login/backPage.jsp";
            String errorurl = "https://ah.ac.10086.cn/4login/errorPage.jsp";
            String relayStateId = "type=A;backurl=http://service.ah.10086.cn/LoginSso;nl=3;loginFrom=http://service.ah.10086.cn/LoginSso";

            List<String> backUrlList = XPathUtil.getXpath("//input[@name='backurl']/@value", pageContent);
            if (!CollectionUtils.isEmpty(backUrlList)) {
                backUrl = backUrlList.get(0);
            }
            List<String> backUrlFlagList = XPathUtil.getXpath("//input[@name='backurlflag']/@value", pageContent);
            if (!CollectionUtils.isEmpty(backUrlFlagList)) {
                backurlflag = backUrlFlagList.get(0);
            }
            List<String> errorUrlList = XPathUtil.getXpath("//input[@name='errorurl']/@value", pageContent);
            if (!CollectionUtils.isEmpty(errorUrlList)) {
                errorurl = errorUrlList.get(0);
            }
            String spid = PatternUtils.group(pageContent, "name=\"spid\" value=\"([^\"]+)\"", 1);
            List<String> relayStateIdList = XPathUtil.getXpath("//input[@name='RelayState']/@value", pageContent);
            if (!CollectionUtils.isEmpty(relayStateIdList)) {
                relayStateId = relayStateIdList.get(0);
            }

            TaskUtils.addTaskShare(param.getTaskId(), "backUrl", backUrl);
            TaskUtils.addTaskShare(param.getTaskId(), "backurlflag", backurlflag);
            TaskUtils.addTaskShare(param.getTaskId(), "errorurl", errorurl);
            TaskUtils.addTaskShare(param.getTaskId(), "spid", spid);
            TaskUtils.addTaskShare(param.getTaskId(), "relayStateId", relayStateId);

            return result.success();
        } catch (Exception e) {
            logger.error("登录-->初始化失败,param={},response={}", param, response, e);
            return result.failure(ErrorCode.TASK_INIT_ERROR);
        }
    }

    @Override
    public HttpResult<String> refeshPicCode(OperatorParam param) {
        switch (param.getFormType()) {
            case FormType.LOGIN:
                return refeshPicCodeForLogin(param);
            default:
                return new HttpResult<String>().failure(ErrorCode.NOT_SUPORT_METHOD);
        }
    }

    @Override
    public HttpResult<Map<String, Object>> refeshSmsCode(OperatorParam param) {
        switch (param.getFormType()) {
            case FormType.VALIDATE_BILL_DETAIL:
                return refeshSmsCodeForBillDetail(param);
            default:
                return new HttpResult<Map<String, Object>>().failure(ErrorCode.NOT_SUPORT_METHOD);
        }
    }

    @Override
    public HttpResult<Map<String, Object>> submit(OperatorParam param) {
        switch (param.getFormType()) {
            case FormType.LOGIN:
                return submitForLogin(param);
            case FormType.VALIDATE_BILL_DETAIL:
                return submitForBillDetail(param);
            default:
                return new HttpResult<Map<String, Object>>().failure(ErrorCode.NOT_SUPORT_METHOD);
        }
    }

    @Override
    public HttpResult<Map<String, Object>> validatePicCode(OperatorParam param) {
        switch (param.getFormType()) {
            case FormType.LOGIN:
                return validatePicCodeForLogin(param);
            default:
                return new HttpResult<Map<String, Object>>().failure(ErrorCode.NOT_SUPORT_METHOD);
        }
    }

    @Override
    public HttpResult<Object> defineProcess(OperatorParam param) {
        switch (param.getFormType()) {
            case "UIFENCODE":
                return processForUifEncode(param);
            default:
                return new HttpResult<Object>().failure(ErrorCode.NOT_SUPORT_METHOD);
        }
    }

    private HttpResult<String> refeshPicCodeForLogin(OperatorParam param) {
        HttpResult<String> result = new HttpResult<>();
        Response response = null;
        try {
            String templateUrl = "https://ah.ac.10086.cn/common/image.jsp?l={}";
            response = TaskHttpClient.create(param.getTaskId(), param.getWebsiteName(), RequestType.GET, "an_hui_10086_web_003")
                    .setFullUrl(templateUrl, Math.random()).invoke();
            String base64 = PatternUtils.group(response.getPageContent(), "data:image\\/JPEG;base64,([^']+)'\\);", 1);
            logger.info("登录-->图片验证码-->刷新成功,param={}", param);
            return result.success(base64);
        } catch (Exception e) {
            logger.error("登录-->图片验证码-->刷新失败,param={},response={}", param, response, e);
            return result.failure(ErrorCode.REFESH_PIC_CODE_ERROR);
        }
    }

    private HttpResult<Map<String, Object>> validatePicCodeForLogin(OperatorParam param) {
        CheckUtils.checkNotBlank(param.getPicCode(), ErrorCode.EMPTY_PIC_CODE);
        HttpResult<Map<String, Object>> result = new HttpResult<>();
        Response response = null;
        try {
            String templateUrl = "https://ah.ac.10086.cn/validImageCode?r_0.8558314577439337&imageCode={}";
            response = TaskHttpClient.create(param.getTaskId(), param.getWebsiteName(), RequestType.GET, "an_hui_10086_web_004")
                    .setFullUrl(templateUrl, param.getPicCode()).invoke();
            if (StringUtils.contains(response.getPageContent(), "1")) {
                logger.info("登录-->图片验证码-->校验成功,param={}", param);
                return result.success();
            } else {
                logger.error("登录-->图片验证码-->校验失败,param={},pageContent={}", param, response.getPageContent());
                return result.failure(ErrorCode.VALIDATE_PIC_CODE_UNEXPECTED_RESULT);
            }
        } catch (Exception e) {
            logger.error("登录-->图片验证码-->校验失败,param={},response={}", param, response, e);
            return result.failure(ErrorCode.VALIDATE_PIC_CODE_ERROR);
        }
    }

    public HttpResult<Map<String, Object>> submitForLogin(OperatorParam param) {
        CheckUtils.checkNotBlank(param.getPassword(), ErrorCode.EMPTY_PASSWORD);
        CheckUtils.checkNotBlank(param.getPicCode(), ErrorCode.EMPTY_PIC_CODE);
        HttpResult<Map<String, Object>> result = validatePicCode(param);
        if (!result.getStatus()) {
            return result;
        }
        Response response = null;
        try {
            String backUrl = TaskUtils.getTaskShare(param.getTaskId(), "backUrl");
            String backurlflag = TaskUtils.getTaskShare(param.getTaskId(), "backurlflag");
            String errorurl = TaskUtils.getTaskShare(param.getTaskId(), "errorurl");
            String spid = TaskUtils.getTaskShare(param.getTaskId(), "spid");
            String relayStateId = TaskUtils.getTaskShare(param.getTaskId(), "relayStateId");

            String templateUrl = "https://ah.ac.10086.cn/Login";
            String templateData = "type=B&formertype=B&backurl={}&backurlflag={}&errorurl={}&spid={}&RelayState={}&mobileNum={}&login_type_ah" +
                    "=&login_pwd_type=2&loginBackurl=&timestamp={}&validCode_state=true&loginType=0&servicePassword={}&servicePassword_1" +
                    "=&smsValidCode=&validCode={}";

            InputStream inputStream = this.getClass().getClassLoader().getResourceAsStream("an_hui_10086_web/des.js");
            Invocable invocable = ScriptEngineUtil.createInvocableFromBase64(javaScript);
            String encryptPassword = invocable.invokeFunction("enString", param.getPassword().toString()).toString();

            String data = TemplateUtils.format(templateData, URLEncoder.encode(backUrl, "UTF-8"), URLEncoder.encode(backurlflag, "UTF-8"),
                    URLEncoder.encode(errorurl, "UTF-8"), spid, URLEncoder.encode(relayStateId, "UTF-8"), param.getMobile(),
                    System.currentTimeMillis(), encryptPassword, param.getPicCode());
            response = TaskHttpClient.create(param, RequestType.POST, "an_hui_10086_web_005").setFullUrl(templateUrl).setRequestBody(data).invoke();
            templateUrl = PatternUtils.group(response.getPageContent(), "replace\\('([^']+)'\\);", 1);
            if (StringUtils.isBlank(templateUrl)) {
                logger.error("登陆失败,param={},response={}", param, response);
                return result.failure(ErrorCode.LOGIN_ERROR);
            }
            response = TaskHttpClient.create(param, RequestType.GET, "an_hui_10086_web_006").setFullUrl(templateUrl).invoke();
            if (StringUtils.isBlank(response.getPageContent())) {
                logger.error("登陆失败,param={},response={}", param, response);
                return result.failure(ErrorCode.LOGIN_ERROR);
            }
            String sAMLart = StringUtils.EMPTY;
            List<String> sAMLartList = XPathUtil.getXpath("//input[@name='SAMLart']/@value", response.getPageContent());
            if (!CollectionUtils.isEmpty(sAMLartList)) {
                sAMLart = sAMLartList.get(0);
            }
            templateUrl = "http://service.ah.10086.cn/LoginSso";
            templateData = "SAMLart={}&RelayState=";
            data = TemplateUtils.format(templateData, sAMLart);
            response = TaskHttpClient.create(param, RequestType.POST, "an_hui_10086_web_007").setFullUrl(templateUrl).setRequestBody(data).invoke();

            templateUrl = PatternUtils.group(response.getPageContent(), "window.top.location.href=\"([^\"]+)\"", 1);
            response = TaskHttpClient.create(param, RequestType.GET, "an_hui_10086_web_008").setFullUrl(templateUrl).invoke();

            String referer = "http://service.ah.10086.cn/index.html";
            templateUrl = "http://service.ah.10086.cn/common/pageInfoInit?kind=&f=&url=%2Findex.html&_=";
            response = TaskHttpClient.create(param, RequestType.GET, "an_hui_10086_web_009").setFullUrl(templateUrl).setReferer(referer)
                    .setRequestContentType(ContentType.APPLICATION_JSON).addHeader("X-Requested-With", "XMLHttpRequest")
                    .addHeader("Accept", "application/json, text/javascript, */*; q=0.01").invoke();

            if (StringUtils.contains(response.getPageContent(), param.getMobile().toString())) {
                logger.info("登陆成功,param={}", param);
                return result.success();
            } else {
                logger.error("登陆失败,param={},response={}", param, response);
                return result.failure(ErrorCode.LOGIN_UNEXPECTED_RESULT);
            }

        } catch (Exception e) {
            logger.error("登陆失败,param={},response={}", param, response, e);
            return result.failure(ErrorCode.LOGIN_ERROR);
        }
    }

    private HttpResult<Map<String, Object>> refeshSmsCodeForBillDetail(OperatorParam param) {
        HttpResult<Map<String, Object>> result = new HttpResult<>();
        Response response = null;
        try {
            String referer = "http://service.ah.10086.cn/pub-page/qry/qryDetail/billDetailIndex.html?kind=200011522&f=200011538&area=cd";
            String templateUrl = "http://service.ah.10086.cn/pub/sendSmPass?opCode=5868&phone_No=&_={}";
            response = TaskHttpClient.create(param, RequestType.GET, "an_hui_10086_web_010").setFullUrl(templateUrl, System.currentTimeMillis())
                    .setReferer(referer).setRequestContentType(ContentType.APPLICATION_JSON).addHeader("X-Requested-With", "XMLHttpRequest")
                    .addHeader("Accept", "application/json, text/javascript, */*; q=0.01").invoke();
            String pageContent = response.getPageContent();
            if (StringUtils.contains(pageContent, "retMsg\":\"OK")) {
                logger.info("详单-->短信验证码-->刷新成功,param={}", param);
                return result.success();
            } else {
                logger.error("详单-->短信验证码-->刷新失败,param={},pateContent={}", param, response.getPageContent());
                return result.failure(ErrorCode.REFESH_SMS_UNEXPECTED_RESULT);
            }
        } catch (Exception e) {
            logger.error("详单-->短信验证码-->刷新失败,param={},response={}", param, response, e);
            return result.failure(ErrorCode.REFESH_SMS_ERROR);
        }
    }

    public HttpResult<Map<String, Object>> submitForBillDetail(OperatorParam param) {
        HttpResult<Map<String, Object>> result = new HttpResult<>();
        BigDecimal db = new BigDecimal(Math.random() * (1 - 0) + 0);
        Response response = null;
        try {
            String referer = "http://service.ah.10086.cn/pub-page/qry/qryDetail/billDetailIndex.html?kind=200011522&f=200011538&area=cd";
            String templateUrl = "http://service.ah.10086.cn/pub/chkSmPass?smPass={}&phone_No=&_={}";
            response = TaskHttpClient.create(param, RequestType.GET, "he_bei_10086_web_014")
                    .setFullUrl(templateUrl, param.getSmsCode(), System.currentTimeMillis()).setReferer(referer)
                    .setRequestContentType(ContentType.APPLICATION_JSON).addHeader("X-Requested-With", "XMLHttpRequest").setReferer(referer).invoke();
            String pageContent = response.getPageContent();
            if (StringUtils.contains(pageContent, "retMsg\":\"OK")) {
                logger.info("详单-->校验成功,param={}", param);
                return result.success();
            } else {
                logger.error("详单-->校验失败,param={},pateContent={}", param, pageContent);
                return result.failure(ErrorCode.REFESH_SMS_UNEXPECTED_RESULT);
            }
        } catch (Exception e) {
            logger.error("详单-->校验失败,param={},response={}", param, response, e);
            return result.failure(ErrorCode.VALIDATE_ERROR);
        }
    }

    public HttpResult<Object> processForUifEncode(OperatorParam param) {
        HttpResult<Object> result = new HttpResult<>();
        try {
            JSONObject jsonObject = JSON.parseObject(param.getArgs()[0]);
            String baseInfo = jsonObject.getString("page_content");
            JSONObject json = JSON.parseObject(baseInfo);
            Map baseinfoMap = new LinkedHashMap();

            String phone_no = (String) JSONPath.eval(json, "$.object.phone_no");
            String open_time = (String) JSONPath.eval(json, "$.object.open_time");
            String run_name = (String) JSONPath.eval(json, "$.object.run_name");
            String cust_name = (String) JSONPath.eval(json, "$.object.cust_name");
            String star_level = (String) JSONPath.eval(json, "$.object.star_level");

            InputStream inputStream = this.getClass().getClassLoader().getResourceAsStream("an_hui_10086_web/desforunifdecode.js");
            Invocable invocable = ScriptEngineUtil.createInvocableFromBase64(javaScriptForUnifcode);

            phone_no = invocable.invokeFunction("uifDecode", phone_no).toString();
            open_time = invocable.invokeFunction("uifDecode", open_time).toString();
            run_name = invocable.invokeFunction("uifDecode", run_name).toString();
            cust_name = invocable.invokeFunction("uifDecode", cust_name).toString();
            star_level = invocable.invokeFunction("uifDecode", star_level).toString();

            baseinfoMap.put("phone_no", phone_no);
            baseinfoMap.put("open_time", open_time);
            baseinfoMap.put("run_name", run_name);
            baseinfoMap.put("cust_name", cust_name);
            baseinfoMap.put("star_level", star_level);

            return result.success(baseinfoMap);
        } catch (Exception e) {
            logger.error("通话记录页访问失败,param={}", param, e);
            return result.failure(ErrorCode.UNKNOWN_REASON);
        }
    }
}
