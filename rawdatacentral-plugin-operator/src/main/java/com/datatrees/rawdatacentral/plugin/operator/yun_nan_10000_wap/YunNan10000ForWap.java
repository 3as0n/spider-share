package com.datatrees.rawdatacentral.plugin.operator.yun_nan_10000_wap;

import javax.script.Invocable;
import java.io.InputStream;
import java.util.Map;

import com.datatrees.crawler.core.processor.common.ProcessorContextUtil;
import com.datatrees.crawler.core.processor.plugin.PluginConstants;
import com.datatrees.crawler.core.processor.plugin.PluginFactory;
import com.datatrees.crawler.plugin.login.ErrorMessage;
import com.datatrees.rawdatacentral.common.http.TaskHttpClient;
import com.datatrees.rawdatacentral.common.utils.CheckUtils;
import com.datatrees.rawdatacentral.common.utils.JsoupXpathUtils;
import com.datatrees.rawdatacentral.common.utils.ScriptEngineUtil;
import com.datatrees.rawdatacentral.domain.constant.FormType;
import com.datatrees.rawdatacentral.domain.enums.ErrorCode;
import com.datatrees.rawdatacentral.domain.enums.RequestType;
import com.datatrees.rawdatacentral.domain.operator.OperatorParam;
import com.datatrees.rawdatacentral.domain.result.HttpResult;
import com.datatrees.rawdatacentral.domain.vo.Response;
import com.datatrees.rawdatacentral.service.OperatorPluginService;
import org.apache.commons.lang3.StringUtils;
import org.apache.http.entity.ContentType;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

/**
 * 云南电信--wap版
 * 登陆地址:http://wapyn.189.cn/initLogin.do
 * 登录(服务密码登陆):手机号,密码,图片验证码(必填)
 * Created by zhouxinghai on 2017/7/17.
 */
public class YunNan10000ForWap implements OperatorPluginService {

    private static final Logger logger     = LoggerFactory.getLogger(YunNan10000ForWap.class);
    private static final String javaScript = "Ci8qKgoqIERFU+WKoOWvhi/op6Plr4YKKiBAQ29weXJpZ2h0IENvcHlyaWdodCAoYykgMjAwNgoqIEBhdXRob3IgR3VhcG8KKiBAc2VlIERFU0NvcmUKKi8KCi8qCiogZW5jcnlwdCB0aGUgc3RyaW5nIHRvIHN0cmluZyBtYWRlIHVwIG9mIGhleAoqIHJldHVybiB0aGUgZW5jcnlwdGVkIHN0cmluZwoqLwpmdW5jdGlvbiBzdHJFbmMoZGF0YSxmaXJzdEtleSxzZWNvbmRLZXksdGhpcmRLZXkpewoKIHZhciBsZW5nID0gZGF0YS5sZW5ndGg7CiB2YXIgZW5jRGF0YSA9ICIiOwogdmFyIGZpcnN0S2V5QnQsc2Vjb25kS2V5QnQsdGhpcmRLZXlCdCxmaXJzdExlbmd0aCxzZWNvbmRMZW5ndGgsdGhpcmRMZW5ndGg7CiBpZihmaXJzdEtleSAhPSBudWxsICYmIGZpcnN0S2V5ICE9ICIiKXsgICAgCiAgIGZpcnN0S2V5QnQgPSBnZXRLZXlCeXRlcyhmaXJzdEtleSk7CiAgIGZpcnN0TGVuZ3RoID0gZmlyc3RLZXlCdC5sZW5ndGg7CiB9CiBpZihzZWNvbmRLZXkgIT0gbnVsbCAmJiBzZWNvbmRLZXkgIT0gIiIpewogICBzZWNvbmRLZXlCdCA9IGdldEtleUJ5dGVzKHNlY29uZEtleSk7CiAgIHNlY29uZExlbmd0aCA9IHNlY29uZEtleUJ0Lmxlbmd0aDsKIH0KIGlmKHRoaXJkS2V5ICE9IG51bGwgJiYgdGhpcmRLZXkgIT0gIiIpewogICB0aGlyZEtleUJ0ID0gZ2V0S2V5Qnl0ZXModGhpcmRLZXkpOwogICB0aGlyZExlbmd0aCA9IHRoaXJkS2V5QnQubGVuZ3RoOwogfSAgCiAKIGlmKGxlbmcgPiAwKXsKICAgaWYobGVuZyA8IDQpewogICAgIHZhciBidCA9IHN0clRvQnQoZGF0YSk7ICAgICAgCiAgICAgdmFyIGVuY0J5dGUgOwogICAgIGlmKGZpcnN0S2V5ICE9IG51bGwgJiYgZmlyc3RLZXkgIT0iIiAmJiBzZWNvbmRLZXkgIT0gbnVsbCAmJiBzZWNvbmRLZXkgIT0gIiIgJiYgdGhpcmRLZXkgIT0gbnVsbCAmJiB0aGlyZEtleSAhPSAiIil7CiAgICAgICB2YXIgdGVtcEJ0OwogICAgICAgdmFyIHgseSx6OwogICAgICAgdGVtcEJ0ID0gYnQ7ICAgICAgICAKICAgICAgIGZvcih4ID0gMDt4IDwgZmlyc3RMZW5ndGggO3ggKyspewogICAgICAgICB0ZW1wQnQgPSBlbmModGVtcEJ0LGZpcnN0S2V5QnRbeF0pOwogICAgICAgfQogICAgICAgZm9yKHkgPSAwO3kgPCBzZWNvbmRMZW5ndGggO3kgKyspewogICAgICAgICB0ZW1wQnQgPSBlbmModGVtcEJ0LHNlY29uZEtleUJ0W3ldKTsKICAgICAgIH0KICAgICAgIGZvcih6ID0gMDt6IDwgdGhpcmRMZW5ndGggO3ogKyspewogICAgICAgICB0ZW1wQnQgPSBlbmModGVtcEJ0LHRoaXJkS2V5QnRbel0pOwogICAgICAgfSAgICAgICAgCiAgICAgICBlbmNCeXRlID0gdGVtcEJ0OyAgICAgICAgCiAgICAgfWVsc2V7CiAgICAgICBpZihmaXJzdEtleSAhPSBudWxsICYmIGZpcnN0S2V5ICE9IiIgJiYgc2Vjb25kS2V5ICE9IG51bGwgJiYgc2Vjb25kS2V5ICE9ICIiKXsKICAgICAgICAgdmFyIHRlbXBCdDsKICAgICAgICAgdmFyIHgseTsKICAgICAgICAgdGVtcEJ0ID0gYnQ7CiAgICAgICAgIGZvcih4ID0gMDt4IDwgZmlyc3RMZW5ndGggO3ggKyspewogICAgICAgICAgIHRlbXBCdCA9IGVuYyh0ZW1wQnQsZmlyc3RLZXlCdFt4XSk7CiAgICAgICAgIH0KICAgICAgICAgZm9yKHkgPSAwO3kgPCBzZWNvbmRMZW5ndGggO3kgKyspewogICAgICAgICAgIHRlbXBCdCA9IGVuYyh0ZW1wQnQsc2Vjb25kS2V5QnRbeV0pOwogICAgICAgICB9CiAgICAgICAgIGVuY0J5dGUgPSB0ZW1wQnQ7CiAgICAgICB9ZWxzZXsKICAgICAgICAgaWYoZmlyc3RLZXkgIT0gbnVsbCAmJiBmaXJzdEtleSAhPSIiKXsgICAgICAgICAgICAKICAgICAgICAgICB2YXIgdGVtcEJ0OwogICAgICAgICAgIHZhciB4ID0gMDsKICAgICAgICAgICB0ZW1wQnQgPSBidDsgICAgICAgICAgICAKICAgICAgICAgICBmb3IoeCA9IDA7eCA8IGZpcnN0TGVuZ3RoIDt4ICsrKXsKICAgICAgICAgICAgIHRlbXBCdCA9IGVuYyh0ZW1wQnQsZmlyc3RLZXlCdFt4XSk7CiAgICAgICAgICAgfQogICAgICAgICAgIGVuY0J5dGUgPSB0ZW1wQnQ7CiAgICAgICAgIH0KICAgICAgIH0gICAgICAgIAogICAgIH0KICAgICBlbmNEYXRhID0gYnQ2NFRvSGV4KGVuY0J5dGUpOwogICB9ZWxzZXsKICAgICB2YXIgaXRlcmF0b3IgPSBwYXJzZUludChsZW5nLzQpOwogICAgIHZhciByZW1haW5kZXIgPSBsZW5nJTQ7CiAgICAgdmFyIGk9MDsgICAgICAKICAgICBmb3IoaSA9IDA7aSA8IGl0ZXJhdG9yO2krKyl7CiAgICAgICB2YXIgdGVtcERhdGEgPSBkYXRhLnN1YnN0cmluZyhpKjQrMCxpKjQrNCk7CiAgICAgICB2YXIgdGVtcEJ5dGUgPSBzdHJUb0J0KHRlbXBEYXRhKTsKICAgICAgIHZhciBlbmNCeXRlIDsKICAgICAgIGlmKGZpcnN0S2V5ICE9IG51bGwgJiYgZmlyc3RLZXkgIT0iIiAmJiBzZWNvbmRLZXkgIT0gbnVsbCAmJiBzZWNvbmRLZXkgIT0gIiIgJiYgdGhpcmRLZXkgIT0gbnVsbCAmJiB0aGlyZEtleSAhPSAiIil7CiAgICAgICAgIHZhciB0ZW1wQnQ7CiAgICAgICAgIHZhciB4LHksejsKICAgICAgICAgdGVtcEJ0ID0gdGVtcEJ5dGU7CiAgICAgICAgIGZvcih4ID0gMDt4IDwgZmlyc3RMZW5ndGggO3ggKyspewogICAgICAgICAgIHRlbXBCdCA9IGVuYyh0ZW1wQnQsZmlyc3RLZXlCdFt4XSk7CiAgICAgICAgIH0KICAgICAgICAgZm9yKHkgPSAwO3kgPCBzZWNvbmRMZW5ndGggO3kgKyspewogICAgICAgICAgIHRlbXBCdCA9IGVuYyh0ZW1wQnQsc2Vjb25kS2V5QnRbeV0pOwogICAgICAgICB9CiAgICAgICAgIGZvcih6ID0gMDt6IDwgdGhpcmRMZW5ndGggO3ogKyspewogICAgICAgICAgIHRlbXBCdCA9IGVuYyh0ZW1wQnQsdGhpcmRLZXlCdFt6XSk7CiAgICAgICAgIH0KICAgICAgICAgZW5jQnl0ZSA9IHRlbXBCdDsKICAgICAgIH1lbHNlewogICAgICAgICBpZihmaXJzdEtleSAhPSBudWxsICYmIGZpcnN0S2V5ICE9IiIgJiYgc2Vjb25kS2V5ICE9IG51bGwgJiYgc2Vjb25kS2V5ICE9ICIiKXsKICAgICAgICAgICB2YXIgdGVtcEJ0OwogICAgICAgICAgIHZhciB4LHk7CiAgICAgICAgICAgdGVtcEJ0ID0gdGVtcEJ5dGU7CiAgICAgICAgICAgZm9yKHggPSAwO3ggPCBmaXJzdExlbmd0aCA7eCArKyl7CiAgICAgICAgICAgICB0ZW1wQnQgPSBlbmModGVtcEJ0LGZpcnN0S2V5QnRbeF0pOwogICAgICAgICAgIH0KICAgICAgICAgICBmb3IoeSA9IDA7eSA8IHNlY29uZExlbmd0aCA7eSArKyl7CiAgICAgICAgICAgICB0ZW1wQnQgPSBlbmModGVtcEJ0LHNlY29uZEtleUJ0W3ldKTsKICAgICAgICAgICB9CiAgICAgICAgICAgZW5jQnl0ZSA9IHRlbXBCdDsKICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgaWYoZmlyc3RLZXkgIT0gbnVsbCAmJiBmaXJzdEtleSAhPSIiKXsgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICB2YXIgdGVtcEJ0OwogICAgICAgICAgICAgdmFyIHg7CiAgICAgICAgICAgICB0ZW1wQnQgPSB0ZW1wQnl0ZTsKICAgICAgICAgICAgIGZvcih4ID0gMDt4IDwgZmlyc3RMZW5ndGggO3ggKyspeyAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgdGVtcEJ0ID0gZW5jKHRlbXBCdCxmaXJzdEtleUJ0W3hdKTsKICAgICAgICAgICAgIH0KICAgICAgICAgICAgIGVuY0J5dGUgPSB0ZW1wQnQ7ICAgICAgICAgICAgICAKICAgICAgICAgICB9CiAgICAgICAgIH0KICAgICAgIH0KICAgICAgIGVuY0RhdGEgKz0gYnQ2NFRvSGV4KGVuY0J5dGUpOwogICAgIH0gICAgICAKICAgICBpZihyZW1haW5kZXIgPiAwKXsKICAgICAgIHZhciByZW1haW5kZXJEYXRhID0gZGF0YS5zdWJzdHJpbmcoaXRlcmF0b3IqNCswLGxlbmcpOwogICAgICAgdmFyIHRlbXBCeXRlID0gc3RyVG9CdChyZW1haW5kZXJEYXRhKTsKICAgICAgIHZhciBlbmNCeXRlIDsKICAgICAgIGlmKGZpcnN0S2V5ICE9IG51bGwgJiYgZmlyc3RLZXkgIT0iIiAmJiBzZWNvbmRLZXkgIT0gbnVsbCAmJiBzZWNvbmRLZXkgIT0gIiIgJiYgdGhpcmRLZXkgIT0gbnVsbCAmJiB0aGlyZEtleSAhPSAiIil7CiAgICAgICAgIHZhciB0ZW1wQnQ7CiAgICAgICAgIHZhciB4LHksejsKICAgICAgICAgdGVtcEJ0ID0gdGVtcEJ5dGU7CiAgICAgICAgIGZvcih4ID0gMDt4IDwgZmlyc3RMZW5ndGggO3ggKyspewogICAgICAgICAgIHRlbXBCdCA9IGVuYyh0ZW1wQnQsZmlyc3RLZXlCdFt4XSk7CiAgICAgICAgIH0KICAgICAgICAgZm9yKHkgPSAwO3kgPCBzZWNvbmRMZW5ndGggO3kgKyspewogICAgICAgICAgIHRlbXBCdCA9IGVuYyh0ZW1wQnQsc2Vjb25kS2V5QnRbeV0pOwogICAgICAgICB9CiAgICAgICAgIGZvcih6ID0gMDt6IDwgdGhpcmRMZW5ndGggO3ogKyspewogICAgICAgICAgIHRlbXBCdCA9IGVuYyh0ZW1wQnQsdGhpcmRLZXlCdFt6XSk7CiAgICAgICAgIH0KICAgICAgICAgZW5jQnl0ZSA9IHRlbXBCdDsKICAgICAgIH1lbHNlewogICAgICAgICBpZihmaXJzdEtleSAhPSBudWxsICYmIGZpcnN0S2V5ICE9IiIgJiYgc2Vjb25kS2V5ICE9IG51bGwgJiYgc2Vjb25kS2V5ICE9ICIiKXsKICAgICAgICAgICB2YXIgdGVtcEJ0OwogICAgICAgICAgIHZhciB4LHk7CiAgICAgICAgICAgdGVtcEJ0ID0gdGVtcEJ5dGU7CiAgICAgICAgICAgZm9yKHggPSAwO3ggPCBmaXJzdExlbmd0aCA7eCArKyl7CiAgICAgICAgICAgICB0ZW1wQnQgPSBlbmModGVtcEJ0LGZpcnN0S2V5QnRbeF0pOwogICAgICAgICAgIH0KICAgICAgICAgICBmb3IoeSA9IDA7eSA8IHNlY29uZExlbmd0aCA7eSArKyl7CiAgICAgICAgICAgICB0ZW1wQnQgPSBlbmModGVtcEJ0LHNlY29uZEtleUJ0W3ldKTsKICAgICAgICAgICB9CiAgICAgICAgICAgZW5jQnl0ZSA9IHRlbXBCdDsKICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgaWYoZmlyc3RLZXkgIT0gbnVsbCAmJiBmaXJzdEtleSAhPSIiKXsgICAgICAgICAgICAKICAgICAgICAgICAgIHZhciB0ZW1wQnQ7CiAgICAgICAgICAgICB2YXIgeDsKICAgICAgICAgICAgIHRlbXBCdCA9IHRlbXBCeXRlOwogICAgICAgICAgICAgZm9yKHggPSAwO3ggPCBmaXJzdExlbmd0aCA7eCArKyl7CiAgICAgICAgICAgICAgIHRlbXBCdCA9IGVuYyh0ZW1wQnQsZmlyc3RLZXlCdFt4XSk7CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICBlbmNCeXRlID0gdGVtcEJ0OwogICAgICAgICAgIH0KICAgICAgICAgfQogICAgICAgfQogICAgICAgZW5jRGF0YSArPSBidDY0VG9IZXgoZW5jQnl0ZSk7CiAgICAgfSAgICAgICAgICAgICAgICAKICAgfQogfQogcmV0dXJuIGVuY0RhdGE7Cn0KCi8qCiogZGVjcnlwdCB0aGUgZW5jcnlwdGVkIHN0cmluZyB0byB0aGUgb3JpZ2luYWwgc3RyaW5nIAoqCiogcmV0dXJuICB0aGUgb3JpZ2luYWwgc3RyaW5nICAKKi8KZnVuY3Rpb24gc3RyRGVjKGRhdGEsZmlyc3RLZXksc2Vjb25kS2V5LHRoaXJkS2V5KXsKIHZhciBsZW5nID0gZGF0YS5sZW5ndGg7CiB2YXIgZGVjU3RyID0gIiI7CiB2YXIgZmlyc3RLZXlCdCxzZWNvbmRLZXlCdCx0aGlyZEtleUJ0LGZpcnN0TGVuZ3RoLHNlY29uZExlbmd0aCx0aGlyZExlbmd0aDsKIGlmKGZpcnN0S2V5ICE9IG51bGwgJiYgZmlyc3RLZXkgIT0gIiIpeyAgICAKICAgZmlyc3RLZXlCdCA9IGdldEtleUJ5dGVzKGZpcnN0S2V5KTsKICAgZmlyc3RMZW5ndGggPSBmaXJzdEtleUJ0Lmxlbmd0aDsKIH0KIGlmKHNlY29uZEtleSAhPSBudWxsICYmIHNlY29uZEtleSAhPSAiIil7CiAgIHNlY29uZEtleUJ0ID0gZ2V0S2V5Qnl0ZXMoc2Vjb25kS2V5KTsKICAgc2Vjb25kTGVuZ3RoID0gc2Vjb25kS2V5QnQubGVuZ3RoOwogfQogaWYodGhpcmRLZXkgIT0gbnVsbCAmJiB0aGlyZEtleSAhPSAiIil7CiAgIHRoaXJkS2V5QnQgPSBnZXRLZXlCeXRlcyh0aGlyZEtleSk7CiAgIHRoaXJkTGVuZ3RoID0gdGhpcmRLZXlCdC5sZW5ndGg7CiB9CiAKIHZhciBpdGVyYXRvciA9IHBhcnNlSW50KGxlbmcvMTYpOwogdmFyIGk9MDsgIAogZm9yKGkgPSAwO2kgPCBpdGVyYXRvcjtpKyspewogICB2YXIgdGVtcERhdGEgPSBkYXRhLnN1YnN0cmluZyhpKjE2KzAsaSoxNisxNik7ICAgIAogICB2YXIgc3RyQnl0ZSA9IGhleFRvQnQ2NCh0ZW1wRGF0YSk7ICAgIAogICB2YXIgaW50Qnl0ZSA9IG5ldyBBcnJheSg2NCk7CiAgIHZhciBqID0gMDsKICAgZm9yKGogPSAwO2ogPCA2NDsgaisrKXsKICAgICBpbnRCeXRlW2pdID0gcGFyc2VJbnQoc3RyQnl0ZS5zdWJzdHJpbmcoaixqKzEpKTsKICAgfSAgICAKICAgdmFyIGRlY0J5dGU7CiAgIGlmKGZpcnN0S2V5ICE9IG51bGwgJiYgZmlyc3RLZXkgIT0iIiAmJiBzZWNvbmRLZXkgIT0gbnVsbCAmJiBzZWNvbmRLZXkgIT0gIiIgJiYgdGhpcmRLZXkgIT0gbnVsbCAmJiB0aGlyZEtleSAhPSAiIil7CiAgICAgdmFyIHRlbXBCdDsKICAgICB2YXIgeCx5LHo7CiAgICAgdGVtcEJ0ID0gaW50Qnl0ZTsKICAgICBmb3IoeCA9IHRoaXJkTGVuZ3RoIC0gMTt4ID49IDA7eCAtLSl7CiAgICAgICB0ZW1wQnQgPSBkZWModGVtcEJ0LHRoaXJkS2V5QnRbeF0pOwogICAgIH0KICAgICBmb3IoeSA9IHNlY29uZExlbmd0aCAtIDE7eSA+PSAwO3kgLS0pewogICAgICAgdGVtcEJ0ID0gZGVjKHRlbXBCdCxzZWNvbmRLZXlCdFt5XSk7CiAgICAgfQogICAgIGZvcih6ID0gZmlyc3RMZW5ndGggLSAxO3ogPj0gMCA7eiAtLSl7CiAgICAgICB0ZW1wQnQgPSBkZWModGVtcEJ0LGZpcnN0S2V5QnRbel0pOwogICAgIH0KICAgICBkZWNCeXRlID0gdGVtcEJ0OwogICB9ZWxzZXsKICAgICBpZihmaXJzdEtleSAhPSBudWxsICYmIGZpcnN0S2V5ICE9IiIgJiYgc2Vjb25kS2V5ICE9IG51bGwgJiYgc2Vjb25kS2V5ICE9ICIiKXsKICAgICAgIHZhciB0ZW1wQnQ7CiAgICAgICB2YXIgeCx5LHo7CiAgICAgICB0ZW1wQnQgPSBpbnRCeXRlOwogICAgICAgZm9yKHggPSBzZWNvbmRMZW5ndGggLSAxO3ggPj0gMCA7eCAtLSl7CiAgICAgICAgIHRlbXBCdCA9IGRlYyh0ZW1wQnQsc2Vjb25kS2V5QnRbeF0pOwogICAgICAgfQogICAgICAgZm9yKHkgPSBmaXJzdExlbmd0aCAtIDE7eSA+PSAwIDt5IC0tKXsKICAgICAgICAgdGVtcEJ0ID0gZGVjKHRlbXBCdCxmaXJzdEtleUJ0W3ldKTsKICAgICAgIH0KICAgICAgIGRlY0J5dGUgPSB0ZW1wQnQ7CiAgICAgfWVsc2V7CiAgICAgICBpZihmaXJzdEtleSAhPSBudWxsICYmIGZpcnN0S2V5ICE9IiIpewogICAgICAgICB2YXIgdGVtcEJ0OwogICAgICAgICB2YXIgeCx5LHo7CiAgICAgICAgIHRlbXBCdCA9IGludEJ5dGU7CiAgICAgICAgIGZvcih4ID0gZmlyc3RMZW5ndGggLSAxO3ggPj0gMCA7eCAtLSl7CiAgICAgICAgICAgdGVtcEJ0ID0gZGVjKHRlbXBCdCxmaXJzdEtleUJ0W3hdKTsKICAgICAgICAgfQogICAgICAgICBkZWNCeXRlID0gdGVtcEJ0OwogICAgICAgfQogICAgIH0KICAgfQogICBkZWNTdHIgKz0gYnl0ZVRvU3RyaW5nKGRlY0J5dGUpOwogfSAgICAgIAogcmV0dXJuIGRlY1N0cjsKfQovKgoqIGNoYW5nIHRoZSBzdHJpbmcgaW50byB0aGUgYml0IGFycmF5CiogCiogcmV0dXJuIGJpdCBhcnJheShpdCdzIGxlbmd0aCAlIDY0ID0gMCkKKi8KZnVuY3Rpb24gZ2V0S2V5Qnl0ZXMoa2V5KXsKIHZhciBrZXlCeXRlcyA9IG5ldyBBcnJheSgpOwogdmFyIGxlbmcgPSBrZXkubGVuZ3RoOwogdmFyIGl0ZXJhdG9yID0gcGFyc2VJbnQobGVuZy80KTsKIHZhciByZW1haW5kZXIgPSBsZW5nJTQ7CiB2YXIgaSA9IDA7CiBmb3IoaSA9IDA7aSA8IGl0ZXJhdG9yOyBpICsrKXsKICAga2V5Qnl0ZXNbaV0gPSBzdHJUb0J0KGtleS5zdWJzdHJpbmcoaSo0KzAsaSo0KzQpKTsKIH0KIGlmKHJlbWFpbmRlciA+IDApewogICBrZXlCeXRlc1tpXSA9IHN0clRvQnQoa2V5LnN1YnN0cmluZyhpKjQrMCxsZW5nKSk7CiB9ICAgIAogcmV0dXJuIGtleUJ5dGVzOwp9CgovKgoqIGNoYW5nIHRoZSBzdHJpbmcoaXQncyBsZW5ndGggPD0gNCkgaW50byB0aGUgYml0IGFycmF5CiogCiogcmV0dXJuIGJpdCBhcnJheShpdCdzIGxlbmd0aCA9IDY0KQoqLwpmdW5jdGlvbiBzdHJUb0J0KHN0cil7ICAKIHZhciBsZW5nID0gc3RyLmxlbmd0aDsKIHZhciBidCA9IG5ldyBBcnJheSg2NCk7CiBpZihsZW5nIDwgNCl7CiAgIHZhciBpPTAsaj0wLHA9MCxxPTA7CiAgIGZvcihpID0gMDtpPGxlbmc7aSsrKXsKICAgICB2YXIgayA9IHN0ci5jaGFyQ29kZUF0KGkpOwogICAgIGZvcihqPTA7ajwxNjtqKyspeyAgICAgIAogICAgICAgdmFyIHBvdz0xLG09MDsKICAgICAgIGZvcihtPTE1O20+ajttLS0pewogICAgICAgICBwb3cgKj0gMjsKICAgICAgIH0gICAgICAgIAogICAgICAgYnRbMTYqaStqXT1wYXJzZUludChrL3BvdyklMjsKICAgICB9CiAgIH0KICAgZm9yKHAgPSBsZW5nO3A8NDtwKyspewogICAgIHZhciBrID0gMDsKICAgICBmb3IocT0wO3E8MTY7cSsrKXsgICAgICAKICAgICAgIHZhciBwb3c9MSxtPTA7CiAgICAgICBmb3IobT0xNTttPnE7bS0tKXsKICAgICAgICAgcG93ICo9IDI7CiAgICAgICB9ICAgICAgICAKICAgICAgIGJ0WzE2KnArcV09cGFyc2VJbnQoay9wb3cpJTI7CiAgICAgfQogICB9ICAKIH1lbHNlewogICBmb3IoaSA9IDA7aTw0O2krKyl7CiAgICAgdmFyIGsgPSBzdHIuY2hhckNvZGVBdChpKTsKICAgICBmb3Ioaj0wO2o8MTY7aisrKXsgICAgICAKICAgICAgIHZhciBwb3c9MTsKICAgICAgIGZvcihtPTE1O20+ajttLS0pewogICAgICAgICBwb3cgKj0gMjsKICAgICAgIH0gICAgICAgIAogICAgICAgYnRbMTYqaStqXT1wYXJzZUludChrL3BvdyklMjsKICAgICB9CiAgIH0gIAogfQogcmV0dXJuIGJ0Owp9CgovKgoqIGNoYW5nIHRoZSBiaXQoaXQncyBsZW5ndGggPSA0KSBpbnRvIHRoZSBoZXgKKiAKKiByZXR1cm4gaGV4CiovCmZ1bmN0aW9uIGJ0NFRvSGV4KGJpbmFyeSkgewogdmFyIGhleDsKIHN3aXRjaCAoYmluYXJ5KSB7CiAgIGNhc2UgIjAwMDAiIDogaGV4ID0gIjAiOyBicmVhazsKICAgY2FzZSAiMDAwMSIgOiBoZXggPSAiMSI7IGJyZWFrOwogICBjYXNlICIwMDEwIiA6IGhleCA9ICIyIjsgYnJlYWs7CiAgIGNhc2UgIjAwMTEiIDogaGV4ID0gIjMiOyBicmVhazsKICAgY2FzZSAiMDEwMCIgOiBoZXggPSAiNCI7IGJyZWFrOwogICBjYXNlICIwMTAxIiA6IGhleCA9ICI1IjsgYnJlYWs7CiAgIGNhc2UgIjAxMTAiIDogaGV4ID0gIjYiOyBicmVhazsKICAgY2FzZSAiMDExMSIgOiBoZXggPSAiNyI7IGJyZWFrOwogICBjYXNlICIxMDAwIiA6IGhleCA9ICI4IjsgYnJlYWs7CiAgIGNhc2UgIjEwMDEiIDogaGV4ID0gIjkiOyBicmVhazsKICAgY2FzZSAiMTAxMCIgOiBoZXggPSAiQSI7IGJyZWFrOwogICBjYXNlICIxMDExIiA6IGhleCA9ICJCIjsgYnJlYWs7CiAgIGNhc2UgIjExMDAiIDogaGV4ID0gIkMiOyBicmVhazsKICAgY2FzZSAiMTEwMSIgOiBoZXggPSAiRCI7IGJyZWFrOwogICBjYXNlICIxMTEwIiA6IGhleCA9ICJFIjsgYnJlYWs7CiAgIGNhc2UgIjExMTEiIDogaGV4ID0gIkYiOyBicmVhazsKIH0KIHJldHVybiBoZXg7Cn0KCi8qCiogY2hhbmcgdGhlIGhleCBpbnRvIHRoZSBiaXQoaXQncyBsZW5ndGggPSA0KQoqIAoqIHJldHVybiB0aGUgYml0KGl0J3MgbGVuZ3RoID0gNCkKKi8KZnVuY3Rpb24gaGV4VG9CdDQoaGV4KSB7CiB2YXIgYmluYXJ5Owogc3dpdGNoIChoZXgpIHsKICAgY2FzZSAiMCIgOiBiaW5hcnkgPSAiMDAwMCI7IGJyZWFrOwogICBjYXNlICIxIiA6IGJpbmFyeSA9ICIwMDAxIjsgYnJlYWs7CiAgIGNhc2UgIjIiIDogYmluYXJ5ID0gIjAwMTAiOyBicmVhazsKICAgY2FzZSAiMyIgOiBiaW5hcnkgPSAiMDAxMSI7IGJyZWFrOwogICBjYXNlICI0IiA6IGJpbmFyeSA9ICIwMTAwIjsgYnJlYWs7CiAgIGNhc2UgIjUiIDogYmluYXJ5ID0gIjAxMDEiOyBicmVhazsKICAgY2FzZSAiNiIgOiBiaW5hcnkgPSAiMDExMCI7IGJyZWFrOwogICBjYXNlICI3IiA6IGJpbmFyeSA9ICIwMTExIjsgYnJlYWs7CiAgIGNhc2UgIjgiIDogYmluYXJ5ID0gIjEwMDAiOyBicmVhazsKICAgY2FzZSAiOSIgOiBiaW5hcnkgPSAiMTAwMSI7IGJyZWFrOwogICBjYXNlICJBIiA6IGJpbmFyeSA9ICIxMDEwIjsgYnJlYWs7CiAgIGNhc2UgIkIiIDogYmluYXJ5ID0gIjEwMTEiOyBicmVhazsKICAgY2FzZSAiQyIgOiBiaW5hcnkgPSAiMTEwMCI7IGJyZWFrOwogICBjYXNlICJEIiA6IGJpbmFyeSA9ICIxMTAxIjsgYnJlYWs7CiAgIGNhc2UgIkUiIDogYmluYXJ5ID0gIjExMTAiOyBicmVhazsKICAgY2FzZSAiRiIgOiBiaW5hcnkgPSAiMTExMSI7IGJyZWFrOwogfQogcmV0dXJuIGJpbmFyeTsKfQoKLyoKKiBjaGFuZyB0aGUgYml0KGl0J3MgbGVuZ3RoID0gNjQpIGludG8gdGhlIHN0cmluZwoqIAoqIHJldHVybiBzdHJpbmcKKi8KZnVuY3Rpb24gYnl0ZVRvU3RyaW5nKGJ5dGVEYXRhKXsKIHZhciBzdHI9IiI7CiBmb3IoaSA9IDA7aTw0O2krKyl7CiAgIHZhciBjb3VudD0wOwogICBmb3Ioaj0wO2o8MTY7aisrKXsgICAgICAgIAogICAgIHZhciBwb3c9MTsKICAgICBmb3IobT0xNTttPmo7bS0tKXsKICAgICAgIHBvdyo9MjsKICAgICB9ICAgICAgICAgICAgICAKICAgICBjb3VudCs9Ynl0ZURhdGFbMTYqaStqXSpwb3c7CiAgIH0gICAgICAgIAogICBpZihjb3VudCAhPSAwKXsKICAgICBzdHIrPVN0cmluZy5mcm9tQ2hhckNvZGUoY291bnQpOwogICB9CiB9CiByZXR1cm4gc3RyOwp9CgpmdW5jdGlvbiBidDY0VG9IZXgoYnl0ZURhdGEpewogdmFyIGhleCA9ICIiOwogZm9yKGkgPSAwO2k8MTY7aSsrKXsKICAgdmFyIGJ0ID0gIiI7CiAgIGZvcihqPTA7ajw0O2orKyl7ICAgIAogICAgIGJ0ICs9IGJ5dGVEYXRhW2kqNCtqXTsKICAgfSAgICAKICAgaGV4Kz1idDRUb0hleChidCk7CiB9CiByZXR1cm4gaGV4Owp9CgpmdW5jdGlvbiBoZXhUb0J0NjQoaGV4KXsKIHZhciBiaW5hcnkgPSAiIjsKIGZvcihpID0gMDtpPDE2O2krKyl7CiAgIGJpbmFyeSs9aGV4VG9CdDQoaGV4LnN1YnN0cmluZyhpLGkrMSkpOwogfQogcmV0dXJuIGJpbmFyeTsKfQoKLyoKKiB0aGUgNjQgYml0IGRlcyBjb3JlIGFyaXRobWV0aWMKKi8KCmZ1bmN0aW9uIGVuYyhkYXRhQnl0ZSxrZXlCeXRlKXsgIAogdmFyIGtleXMgPSBnZW5lcmF0ZUtleXMoa2V5Qnl0ZSk7ICAgIAogdmFyIGlwQnl0ZSAgID0gaW5pdFBlcm11dGUoZGF0YUJ5dGUpOyAgCiB2YXIgaXBMZWZ0ICAgPSBuZXcgQXJyYXkoMzIpOwogdmFyIGlwUmlnaHQgID0gbmV3IEFycmF5KDMyKTsKIHZhciB0ZW1wTGVmdCA9IG5ldyBBcnJheSgzMik7CiB2YXIgaSA9IDAsaiA9IDAsayA9IDAsbSA9IDAsIG4gPSAwOwogZm9yKGsgPSAwO2sgPCAzMjtrICsrKXsKICAgaXBMZWZ0W2tdID0gaXBCeXRlW2tdOwogICBpcFJpZ2h0W2tdID0gaXBCeXRlWzMyK2tdOwogfSAgICAKIGZvcihpID0gMDtpIDwgMTY7aSArKyl7CiAgIGZvcihqID0gMDtqIDwgMzI7aiArKyl7CiAgICAgdGVtcExlZnRbal0gPSBpcExlZnRbal07CiAgICAgaXBMZWZ0W2pdID0gaXBSaWdodFtqXTsgICAgICAKICAgfSAgCiAgIHZhciBrZXkgPSBuZXcgQXJyYXkoNDgpOwogICBmb3IobSA9IDA7bSA8IDQ4O20gKyspewogICAgIGtleVttXSA9IGtleXNbaV1bbV07CiAgIH0KICAgdmFyICB0ZW1wUmlnaHQgPSB4b3IocFBlcm11dGUoc0JveFBlcm11dGUoeG9yKGV4cGFuZFBlcm11dGUoaXBSaWdodCksa2V5KSkpLCB0ZW1wTGVmdCk7ICAgICAgCiAgIGZvcihuID0gMDtuIDwgMzI7biArKyl7CiAgICAgaXBSaWdodFtuXSA9IHRlbXBSaWdodFtuXTsKICAgfSAgCiAgIAogfSAgCiAKIAogdmFyIGZpbmFsRGF0YSA9bmV3IEFycmF5KDY0KTsKIGZvcihpID0gMDtpIDwgMzI7aSArKyl7CiAgIGZpbmFsRGF0YVtpXSA9IGlwUmlnaHRbaV07CiAgIGZpbmFsRGF0YVszMitpXSA9IGlwTGVmdFtpXTsKIH0KIHJldHVybiBmaW5hbGx5UGVybXV0ZShmaW5hbERhdGEpOyAgCn0KCmZ1bmN0aW9uIGRlYyhkYXRhQnl0ZSxrZXlCeXRlKXsgIAogdmFyIGtleXMgPSBnZW5lcmF0ZUtleXMoa2V5Qnl0ZSk7ICAgIAogdmFyIGlwQnl0ZSAgID0gaW5pdFBlcm11dGUoZGF0YUJ5dGUpOyAgCiB2YXIgaXBMZWZ0ICAgPSBuZXcgQXJyYXkoMzIpOwogdmFyIGlwUmlnaHQgID0gbmV3IEFycmF5KDMyKTsKIHZhciB0ZW1wTGVmdCA9IG5ldyBBcnJheSgzMik7CiB2YXIgaSA9IDAsaiA9IDAsayA9IDAsbSA9IDAsIG4gPSAwOwogZm9yKGsgPSAwO2sgPCAzMjtrICsrKXsKICAgaXBMZWZ0W2tdID0gaXBCeXRlW2tdOwogICBpcFJpZ2h0W2tdID0gaXBCeXRlWzMyK2tdOwogfSAgCiBmb3IoaSA9IDE1O2kgPj0gMDtpIC0tKXsKICAgZm9yKGogPSAwO2ogPCAzMjtqICsrKXsKICAgICB0ZW1wTGVmdFtqXSA9IGlwTGVmdFtqXTsKICAgICBpcExlZnRbal0gPSBpcFJpZ2h0W2pdOyAgICAgIAogICB9ICAKICAgdmFyIGtleSA9IG5ldyBBcnJheSg0OCk7CiAgIGZvcihtID0gMDttIDwgNDg7bSArKyl7CiAgICAga2V5W21dID0ga2V5c1tpXVttXTsKICAgfQogICAKICAgdmFyICB0ZW1wUmlnaHQgPSB4b3IocFBlcm11dGUoc0JveFBlcm11dGUoeG9yKGV4cGFuZFBlcm11dGUoaXBSaWdodCksa2V5KSkpLCB0ZW1wTGVmdCk7ICAgICAgCiAgIGZvcihuID0gMDtuIDwgMzI7biArKyl7CiAgICAgaXBSaWdodFtuXSA9IHRlbXBSaWdodFtuXTsKICAgfSAgCiB9ICAKIAogCiB2YXIgZmluYWxEYXRhID1uZXcgQXJyYXkoNjQpOwogZm9yKGkgPSAwO2kgPCAzMjtpICsrKXsKICAgZmluYWxEYXRhW2ldID0gaXBSaWdodFtpXTsKICAgZmluYWxEYXRhWzMyK2ldID0gaXBMZWZ0W2ldOwogfQogcmV0dXJuIGZpbmFsbHlQZXJtdXRlKGZpbmFsRGF0YSk7ICAKfQoKZnVuY3Rpb24gaW5pdFBlcm11dGUob3JpZ2luYWxEYXRhKXsKIHZhciBpcEJ5dGUgPSBuZXcgQXJyYXkoNjQpOwogZm9yIChpID0gMCwgbSA9IDEsIG4gPSAwOyBpIDwgNDsgaSsrLCBtICs9IDIsIG4gKz0gMikgewogICBmb3IgKGogPSA3LCBrID0gMDsgaiA+PSAwOyBqLS0sIGsrKykgewogICAgIGlwQnl0ZVtpICogOCArIGtdID0gb3JpZ2luYWxEYXRhW2ogKiA4ICsgbV07CiAgICAgaXBCeXRlW2kgKiA4ICsgayArIDMyXSA9IG9yaWdpbmFsRGF0YVtqICogOCArIG5dOwogICB9CiB9ICAgIAogcmV0dXJuIGlwQnl0ZTsKfQoKZnVuY3Rpb24gZXhwYW5kUGVybXV0ZShyaWdodERhdGEpeyAgCiB2YXIgZXBCeXRlID0gbmV3IEFycmF5KDQ4KTsKIGZvciAoaSA9IDA7IGkgPCA4OyBpKyspIHsKICAgaWYgKGkgPT0gMCkgewogICAgIGVwQnl0ZVtpICogNiArIDBdID0gcmlnaHREYXRhWzMxXTsKICAgfSBlbHNlIHsKICAgICBlcEJ5dGVbaSAqIDYgKyAwXSA9IHJpZ2h0RGF0YVtpICogNCAtIDFdOwogICB9CiAgIGVwQnl0ZVtpICogNiArIDFdID0gcmlnaHREYXRhW2kgKiA0ICsgMF07CiAgIGVwQnl0ZVtpICogNiArIDJdID0gcmlnaHREYXRhW2kgKiA0ICsgMV07CiAgIGVwQnl0ZVtpICogNiArIDNdID0gcmlnaHREYXRhW2kgKiA0ICsgMl07CiAgIGVwQnl0ZVtpICogNiArIDRdID0gcmlnaHREYXRhW2kgKiA0ICsgM107CiAgIGlmIChpID09IDcpIHsKICAgICBlcEJ5dGVbaSAqIDYgKyA1XSA9IHJpZ2h0RGF0YVswXTsKICAgfSBlbHNlIHsKICAgICBlcEJ5dGVbaSAqIDYgKyA1XSA9IHJpZ2h0RGF0YVtpICogNCArIDRdOwogICB9CiB9ICAgICAgCiByZXR1cm4gZXBCeXRlOwp9CgpmdW5jdGlvbiB4b3IoYnl0ZU9uZSxieXRlVHdvKXsgIAogdmFyIHhvckJ5dGUgPSBuZXcgQXJyYXkoYnl0ZU9uZS5sZW5ndGgpOwogZm9yKGkgPSAwO2kgPCBieXRlT25lLmxlbmd0aDsgaSArKyl7ICAgICAgCiAgIHhvckJ5dGVbaV0gPSBieXRlT25lW2ldIF4gYnl0ZVR3b1tpXTsKIH0gIAogcmV0dXJuIHhvckJ5dGU7Cn0KCmZ1bmN0aW9uIHNCb3hQZXJtdXRlKGV4cGFuZEJ5dGUpewogCiAgIHZhciBzQm94Qnl0ZSA9IG5ldyBBcnJheSgzMik7CiAgIHZhciBiaW5hcnkgPSAiIjsKICAgdmFyIHMxID0gWwogICAgICAgWzE0LCA0LCAxMywgMSwgMiwgMTUsIDExLCA4LCAzLCAxMCwgNiwgMTIsIDUsIDksIDAsIDddLAogICAgICAgWzAsIDE1LCA3LCA0LCAxNCwgMiwgMTMsIDEsIDEwLCA2LCAxMiwgMTEsIDksIDUsIDMsIDhdLAogICAgICAgWzQsIDEsIDE0LCA4LCAxMywgNiwgMiwgMTEsIDE1LCAxMiwgOSwgNywgMywgMTAsIDUsIDBdLAogICAgICAgWzE1LCAxMiwgOCwgMiwgNCwgOSwgMSwgNywgNSwgMTEsIDMsIDE0LCAxMCwgMCwgNiwgMTMgXV07CgogICAgICAgLyogVGFibGUgLSBzMiAqLwogICB2YXIgczIgPSBbCiAgICAgICBbMTUsIDEsIDgsIDE0LCA2LCAxMSwgMywgNCwgOSwgNywgMiwgMTMsIDEyLCAwLCA1LCAxMF0sCiAgICAgICBbMywgMTMsIDQsIDcsIDE1LCAyLCA4LCAxNCwgMTIsIDAsIDEsIDEwLCA2LCA5LCAxMSwgNV0sCiAgICAgICBbMCwgMTQsIDcsIDExLCAxMCwgNCwgMTMsIDEsIDUsIDgsIDEyLCA2LCA5LCAzLCAyLCAxNV0sCiAgICAgICBbMTMsIDgsIDEwLCAxLCAzLCAxNSwgNCwgMiwgMTEsIDYsIDcsIDEyLCAwLCA1LCAxNCwgOSBdXTsKCiAgICAgICAvKiBUYWJsZSAtIHMzICovCiAgIHZhciBzMz0gWwogICAgICAgWzEwLCAwLCA5LCAxNCwgNiwgMywgMTUsIDUsIDEsIDEzLCAxMiwgNywgMTEsIDQsIDIsIDhdLAogICAgICAgWzEzLCA3LCAwLCA5LCAzLCA0LCA2LCAxMCwgMiwgOCwgNSwgMTQsIDEyLCAxMSwgMTUsIDFdLAogICAgICAgWzEzLCA2LCA0LCA5LCA4LCAxNSwgMywgMCwgMTEsIDEsIDIsIDEyLCA1LCAxMCwgMTQsIDddLAogICAgICAgWzEsIDEwLCAxMywgMCwgNiwgOSwgOCwgNywgNCwgMTUsIDE0LCAzLCAxMSwgNSwgMiwgMTIgXV07CiAgICAgICAvKiBUYWJsZSAtIHM0ICovCiAgIHZhciBzNCA9IFsKICAgICAgIFs3LCAxMywgMTQsIDMsIDAsIDYsIDksIDEwLCAxLCAyLCA4LCA1LCAxMSwgMTIsIDQsIDE1XSwKICAgICAgIFsxMywgOCwgMTEsIDUsIDYsIDE1LCAwLCAzLCA0LCA3LCAyLCAxMiwgMSwgMTAsIDE0LCA5XSwKICAgICAgIFsxMCwgNiwgOSwgMCwgMTIsIDExLCA3LCAxMywgMTUsIDEsIDMsIDE0LCA1LCAyLCA4LCA0XSwKICAgICAgIFszLCAxNSwgMCwgNiwgMTAsIDEsIDEzLCA4LCA5LCA0LCA1LCAxMSwgMTIsIDcsIDIsIDE0IF1dOwoKICAgICAgIC8qIFRhYmxlIC0gczUgKi8KICAgdmFyIHM1ID0gWwogICAgICAgWzIsIDEyLCA0LCAxLCA3LCAxMCwgMTEsIDYsIDgsIDUsIDMsIDE1LCAxMywgMCwgMTQsIDldLAogICAgICAgWzE0LCAxMSwgMiwgMTIsIDQsIDcsIDEzLCAxLCA1LCAwLCAxNSwgMTAsIDMsIDksIDgsIDZdLAogICAgICAgWzQsIDIsIDEsIDExLCAxMCwgMTMsIDcsIDgsIDE1LCA5LCAxMiwgNSwgNiwgMywgMCwgMTRdLAogICAgICAgWzExLCA4LCAxMiwgNywgMSwgMTQsIDIsIDEzLCA2LCAxNSwgMCwgOSwgMTAsIDQsIDUsIDMgXV07CgogICAgICAgLyogVGFibGUgLSBzNiAqLwogICB2YXIgczYgPSBbCiAgICAgICBbMTIsIDEsIDEwLCAxNSwgOSwgMiwgNiwgOCwgMCwgMTMsIDMsIDQsIDE0LCA3LCA1LCAxMV0sCiAgICAgICBbMTAsIDE1LCA0LCAyLCA3LCAxMiwgOSwgNSwgNiwgMSwgMTMsIDE0LCAwLCAxMSwgMywgOF0sCiAgICAgICBbOSwgMTQsIDE1LCA1LCAyLCA4LCAxMiwgMywgNywgMCwgNCwgMTAsIDEsIDEzLCAxMSwgNl0sCiAgICAgICBbNCwgMywgMiwgMTIsIDksIDUsIDE1LCAxMCwgMTEsIDE0LCAxLCA3LCA2LCAwLCA4LCAxMyBdXTsKCiAgICAgICAvKiBUYWJsZSAtIHM3ICovCiAgIHZhciBzNyA9IFsKICAgICAgIFs0LCAxMSwgMiwgMTQsIDE1LCAwLCA4LCAxMywgMywgMTIsIDksIDcsIDUsIDEwLCA2LCAxXSwKICAgICAgIFsxMywgMCwgMTEsIDcsIDQsIDksIDEsIDEwLCAxNCwgMywgNSwgMTIsIDIsIDE1LCA4LCA2XSwKICAgICAgIFsxLCA0LCAxMSwgMTMsIDEyLCAzLCA3LCAxNCwgMTAsIDE1LCA2LCA4LCAwLCA1LCA5LCAyXSwKICAgICAgIFs2LCAxMSwgMTMsIDgsIDEsIDQsIDEwLCA3LCA5LCA1LCAwLCAxNSwgMTQsIDIsIDMsIDEyXV07CgogICAgICAgLyogVGFibGUgLSBzOCAqLwogICB2YXIgczggPSBbCiAgICAgICBbMTMsIDIsIDgsIDQsIDYsIDE1LCAxMSwgMSwgMTAsIDksIDMsIDE0LCA1LCAwLCAxMiwgN10sCiAgICAgICBbMSwgMTUsIDEzLCA4LCAxMCwgMywgNywgNCwgMTIsIDUsIDYsIDExLCAwLCAxNCwgOSwgMl0sCiAgICAgICBbNywgMTEsIDQsIDEsIDksIDEyLCAxNCwgMiwgMCwgNiwgMTAsIDEzLCAxNSwgMywgNSwgOF0sCiAgICAgICBbMiwgMSwgMTQsIDcsIDQsIDEwLCA4LCAxMywgMTUsIDEyLCA5LCAwLCAzLCA1LCA2LCAxMV1dOwogICAKICAgZm9yKG09MDttPDg7bSsrKXsKICAgdmFyIGk9MCxqPTA7CiAgIGkgPSBleHBhbmRCeXRlW20qNiswXSoyK2V4cGFuZEJ5dGVbbSo2KzVdOwogICBqID0gZXhwYW5kQnl0ZVttICogNiArIDFdICogMiAqIDIgKiAyIAogICAgICsgZXhwYW5kQnl0ZVttICogNiArIDJdICogMiogMiAKICAgICArIGV4cGFuZEJ5dGVbbSAqIDYgKyAzXSAqIDIgCiAgICAgKyBleHBhbmRCeXRlW20gKiA2ICsgNF07CiAgIHN3aXRjaCAobSkgewogICAgIGNhc2UgMCA6CiAgICAgICBiaW5hcnkgPSBnZXRCb3hCaW5hcnkoczFbaV1bal0pOwogICAgICAgYnJlYWs7CiAgICAgY2FzZSAxIDoKICAgICAgIGJpbmFyeSA9IGdldEJveEJpbmFyeShzMltpXVtqXSk7CiAgICAgICBicmVhazsKICAgICBjYXNlIDIgOgogICAgICAgYmluYXJ5ID0gZ2V0Qm94QmluYXJ5KHMzW2ldW2pdKTsKICAgICAgIGJyZWFrOwogICAgIGNhc2UgMyA6CiAgICAgICBiaW5hcnkgPSBnZXRCb3hCaW5hcnkoczRbaV1bal0pOwogICAgICAgYnJlYWs7CiAgICAgY2FzZSA0IDoKICAgICAgIGJpbmFyeSA9IGdldEJveEJpbmFyeShzNVtpXVtqXSk7CiAgICAgICBicmVhazsKICAgICBjYXNlIDUgOgogICAgICAgYmluYXJ5ID0gZ2V0Qm94QmluYXJ5KHM2W2ldW2pdKTsKICAgICAgIGJyZWFrOwogICAgIGNhc2UgNiA6CiAgICAgICBiaW5hcnkgPSBnZXRCb3hCaW5hcnkoczdbaV1bal0pOwogICAgICAgYnJlYWs7CiAgICAgY2FzZSA3IDoKICAgICAgIGJpbmFyeSA9IGdldEJveEJpbmFyeShzOFtpXVtqXSk7CiAgICAgICBicmVhazsKICAgfSAgICAgIAogICBzQm94Qnl0ZVttKjQrMF0gPSBwYXJzZUludChiaW5hcnkuc3Vic3RyaW5nKDAsMSkpOwogICBzQm94Qnl0ZVttKjQrMV0gPSBwYXJzZUludChiaW5hcnkuc3Vic3RyaW5nKDEsMikpOwogICBzQm94Qnl0ZVttKjQrMl0gPSBwYXJzZUludChiaW5hcnkuc3Vic3RyaW5nKDIsMykpOwogICBzQm94Qnl0ZVttKjQrM10gPSBwYXJzZUludChiaW5hcnkuc3Vic3RyaW5nKDMsNCkpOwogfQogcmV0dXJuIHNCb3hCeXRlOwp9CgpmdW5jdGlvbiBwUGVybXV0ZShzQm94Qnl0ZSl7CiB2YXIgcEJveFBlcm11dGUgPSBuZXcgQXJyYXkoMzIpOwogcEJveFBlcm11dGVbIDBdID0gc0JveEJ5dGVbMTVdOyAKIHBCb3hQZXJtdXRlWyAxXSA9IHNCb3hCeXRlWyA2XTsgCiBwQm94UGVybXV0ZVsgMl0gPSBzQm94Qnl0ZVsxOV07IAogcEJveFBlcm11dGVbIDNdID0gc0JveEJ5dGVbMjBdOyAKIHBCb3hQZXJtdXRlWyA0XSA9IHNCb3hCeXRlWzI4XTsgCiBwQm94UGVybXV0ZVsgNV0gPSBzQm94Qnl0ZVsxMV07IAogcEJveFBlcm11dGVbIDZdID0gc0JveEJ5dGVbMjddOyAKIHBCb3hQZXJtdXRlWyA3XSA9IHNCb3hCeXRlWzE2XTsgCiBwQm94UGVybXV0ZVsgOF0gPSBzQm94Qnl0ZVsgMF07IAogcEJveFBlcm11dGVbIDldID0gc0JveEJ5dGVbMTRdOyAKIHBCb3hQZXJtdXRlWzEwXSA9IHNCb3hCeXRlWzIyXTsgCiBwQm94UGVybXV0ZVsxMV0gPSBzQm94Qnl0ZVsyNV07IAogcEJveFBlcm11dGVbMTJdID0gc0JveEJ5dGVbIDRdOyAKIHBCb3hQZXJtdXRlWzEzXSA9IHNCb3hCeXRlWzE3XTsgCiBwQm94UGVybXV0ZVsxNF0gPSBzQm94Qnl0ZVszMF07IAogcEJveFBlcm11dGVbMTVdID0gc0JveEJ5dGVbIDldOyAKIHBCb3hQZXJtdXRlWzE2XSA9IHNCb3hCeXRlWyAxXTsgCiBwQm94UGVybXV0ZVsxN10gPSBzQm94Qnl0ZVsgN107IAogcEJveFBlcm11dGVbMThdID0gc0JveEJ5dGVbMjNdOyAKIHBCb3hQZXJtdXRlWzE5XSA9IHNCb3hCeXRlWzEzXTsgCiBwQm94UGVybXV0ZVsyMF0gPSBzQm94Qnl0ZVszMV07IAogcEJveFBlcm11dGVbMjFdID0gc0JveEJ5dGVbMjZdOyAKIHBCb3hQZXJtdXRlWzIyXSA9IHNCb3hCeXRlWyAyXTsgCiBwQm94UGVybXV0ZVsyM10gPSBzQm94Qnl0ZVsgOF07IAogcEJveFBlcm11dGVbMjRdID0gc0JveEJ5dGVbMThdOyAKIHBCb3hQZXJtdXRlWzI1XSA9IHNCb3hCeXRlWzEyXTsgCiBwQm94UGVybXV0ZVsyNl0gPSBzQm94Qnl0ZVsyOV07IAogcEJveFBlcm11dGVbMjddID0gc0JveEJ5dGVbIDVdOyAKIHBCb3hQZXJtdXRlWzI4XSA9IHNCb3hCeXRlWzIxXTsgCiBwQm94UGVybXV0ZVsyOV0gPSBzQm94Qnl0ZVsxMF07IAogcEJveFBlcm11dGVbMzBdID0gc0JveEJ5dGVbIDNdOyAKIHBCb3hQZXJtdXRlWzMxXSA9IHNCb3hCeXRlWzI0XTsgICAgCiByZXR1cm4gcEJveFBlcm11dGU7Cn0KCmZ1bmN0aW9uIGZpbmFsbHlQZXJtdXRlKGVuZEJ5dGUpeyAgICAKIHZhciBmcEJ5dGUgPSBuZXcgQXJyYXkoNjQpOyAgCiBmcEJ5dGVbIDBdID0gZW5kQnl0ZVszOV07IAogZnBCeXRlWyAxXSA9IGVuZEJ5dGVbIDddOyAKIGZwQnl0ZVsgMl0gPSBlbmRCeXRlWzQ3XTsgCiBmcEJ5dGVbIDNdID0gZW5kQnl0ZVsxNV07IAogZnBCeXRlWyA0XSA9IGVuZEJ5dGVbNTVdOyAKIGZwQnl0ZVsgNV0gPSBlbmRCeXRlWzIzXTsgCiBmcEJ5dGVbIDZdID0gZW5kQnl0ZVs2M107IAogZnBCeXRlWyA3XSA9IGVuZEJ5dGVbMzFdOyAKIGZwQnl0ZVsgOF0gPSBlbmRCeXRlWzM4XTsgCiBmcEJ5dGVbIDldID0gZW5kQnl0ZVsgNl07IAogZnBCeXRlWzEwXSA9IGVuZEJ5dGVbNDZdOyAKIGZwQnl0ZVsxMV0gPSBlbmRCeXRlWzE0XTsgCiBmcEJ5dGVbMTJdID0gZW5kQnl0ZVs1NF07IAogZnBCeXRlWzEzXSA9IGVuZEJ5dGVbMjJdOyAKIGZwQnl0ZVsxNF0gPSBlbmRCeXRlWzYyXTsgCiBmcEJ5dGVbMTVdID0gZW5kQnl0ZVszMF07IAogZnBCeXRlWzE2XSA9IGVuZEJ5dGVbMzddOyAKIGZwQnl0ZVsxN10gPSBlbmRCeXRlWyA1XTsgCiBmcEJ5dGVbMThdID0gZW5kQnl0ZVs0NV07IAogZnBCeXRlWzE5XSA9IGVuZEJ5dGVbMTNdOyAKIGZwQnl0ZVsyMF0gPSBlbmRCeXRlWzUzXTsgCiBmcEJ5dGVbMjFdID0gZW5kQnl0ZVsyMV07IAogZnBCeXRlWzIyXSA9IGVuZEJ5dGVbNjFdOyAKIGZwQnl0ZVsyM10gPSBlbmRCeXRlWzI5XTsgCiBmcEJ5dGVbMjRdID0gZW5kQnl0ZVszNl07IAogZnBCeXRlWzI1XSA9IGVuZEJ5dGVbIDRdOyAKIGZwQnl0ZVsyNl0gPSBlbmRCeXRlWzQ0XTsgCiBmcEJ5dGVbMjddID0gZW5kQnl0ZVsxMl07IAogZnBCeXRlWzI4XSA9IGVuZEJ5dGVbNTJdOyAKIGZwQnl0ZVsyOV0gPSBlbmRCeXRlWzIwXTsgCiBmcEJ5dGVbMzBdID0gZW5kQnl0ZVs2MF07IAogZnBCeXRlWzMxXSA9IGVuZEJ5dGVbMjhdOyAKIGZwQnl0ZVszMl0gPSBlbmRCeXRlWzM1XTsgCiBmcEJ5dGVbMzNdID0gZW5kQnl0ZVsgM107IAogZnBCeXRlWzM0XSA9IGVuZEJ5dGVbNDNdOyAKIGZwQnl0ZVszNV0gPSBlbmRCeXRlWzExXTsgCiBmcEJ5dGVbMzZdID0gZW5kQnl0ZVs1MV07IAogZnBCeXRlWzM3XSA9IGVuZEJ5dGVbMTldOyAKIGZwQnl0ZVszOF0gPSBlbmRCeXRlWzU5XTsgCiBmcEJ5dGVbMzldID0gZW5kQnl0ZVsyN107IAogZnBCeXRlWzQwXSA9IGVuZEJ5dGVbMzRdOyAKIGZwQnl0ZVs0MV0gPSBlbmRCeXRlWyAyXTsgCiBmcEJ5dGVbNDJdID0gZW5kQnl0ZVs0Ml07IAogZnBCeXRlWzQzXSA9IGVuZEJ5dGVbMTBdOyAKIGZwQnl0ZVs0NF0gPSBlbmRCeXRlWzUwXTsgCiBmcEJ5dGVbNDVdID0gZW5kQnl0ZVsxOF07IAogZnBCeXRlWzQ2XSA9IGVuZEJ5dGVbNThdOyAKIGZwQnl0ZVs0N10gPSBlbmRCeXRlWzI2XTsgCiBmcEJ5dGVbNDhdID0gZW5kQnl0ZVszM107IAogZnBCeXRlWzQ5XSA9IGVuZEJ5dGVbIDFdOyAKIGZwQnl0ZVs1MF0gPSBlbmRCeXRlWzQxXTsgCiBmcEJ5dGVbNTFdID0gZW5kQnl0ZVsgOV07IAogZnBCeXRlWzUyXSA9IGVuZEJ5dGVbNDldOyAKIGZwQnl0ZVs1M10gPSBlbmRCeXRlWzE3XTsgCiBmcEJ5dGVbNTRdID0gZW5kQnl0ZVs1N107IAogZnBCeXRlWzU1XSA9IGVuZEJ5dGVbMjVdOyAKIGZwQnl0ZVs1Nl0gPSBlbmRCeXRlWzMyXTsgCiBmcEJ5dGVbNTddID0gZW5kQnl0ZVsgMF07IAogZnBCeXRlWzU4XSA9IGVuZEJ5dGVbNDBdOyAKIGZwQnl0ZVs1OV0gPSBlbmRCeXRlWyA4XTsgCiBmcEJ5dGVbNjBdID0gZW5kQnl0ZVs0OF07IAogZnBCeXRlWzYxXSA9IGVuZEJ5dGVbMTZdOyAKIGZwQnl0ZVs2Ml0gPSBlbmRCeXRlWzU2XTsgCiBmcEJ5dGVbNjNdID0gZW5kQnl0ZVsyNF07CiByZXR1cm4gZnBCeXRlOwp9CgpmdW5jdGlvbiBnZXRCb3hCaW5hcnkoaSkgewogdmFyIGJpbmFyeSA9ICIiOwogc3dpdGNoIChpKSB7CiAgIGNhc2UgMCA6YmluYXJ5ID0gIjAwMDAiO2JyZWFrOwogICBjYXNlIDEgOmJpbmFyeSA9ICIwMDAxIjticmVhazsKICAgY2FzZSAyIDpiaW5hcnkgPSAiMDAxMCI7YnJlYWs7CiAgIGNhc2UgMyA6YmluYXJ5ID0gIjAwMTEiO2JyZWFrOwogICBjYXNlIDQgOmJpbmFyeSA9ICIwMTAwIjticmVhazsKICAgY2FzZSA1IDpiaW5hcnkgPSAiMDEwMSI7YnJlYWs7CiAgIGNhc2UgNiA6YmluYXJ5ID0gIjAxMTAiO2JyZWFrOwogICBjYXNlIDcgOmJpbmFyeSA9ICIwMTExIjticmVhazsKICAgY2FzZSA4IDpiaW5hcnkgPSAiMTAwMCI7YnJlYWs7CiAgIGNhc2UgOSA6YmluYXJ5ID0gIjEwMDEiO2JyZWFrOwogICBjYXNlIDEwIDpiaW5hcnkgPSAiMTAxMCI7YnJlYWs7CiAgIGNhc2UgMTEgOmJpbmFyeSA9ICIxMDExIjticmVhazsKICAgY2FzZSAxMiA6YmluYXJ5ID0gIjExMDAiO2JyZWFrOwogICBjYXNlIDEzIDpiaW5hcnkgPSAiMTEwMSI7YnJlYWs7CiAgIGNhc2UgMTQgOmJpbmFyeSA9ICIxMTEwIjticmVhazsKICAgY2FzZSAxNSA6YmluYXJ5ID0gIjExMTEiO2JyZWFrOwogfQogcmV0dXJuIGJpbmFyeTsKfQovKgoqIGdlbmVyYXRlIDE2IGtleXMgZm9yIHhvcgoqCiovCmZ1bmN0aW9uIGdlbmVyYXRlS2V5cyhrZXlCeXRlKXsgICAgCiB2YXIga2V5ICAgPSBuZXcgQXJyYXkoNTYpOwogdmFyIGtleXMgPSBuZXcgQXJyYXkoKTsgIAogCiBrZXlzWyAwXSA9IG5ldyBBcnJheSgpOwoga2V5c1sgMV0gPSBuZXcgQXJyYXkoKTsKIGtleXNbIDJdID0gbmV3IEFycmF5KCk7CiBrZXlzWyAzXSA9IG5ldyBBcnJheSgpOwoga2V5c1sgNF0gPSBuZXcgQXJyYXkoKTsKIGtleXNbIDVdID0gbmV3IEFycmF5KCk7CiBrZXlzWyA2XSA9IG5ldyBBcnJheSgpOwoga2V5c1sgN10gPSBuZXcgQXJyYXkoKTsKIGtleXNbIDhdID0gbmV3IEFycmF5KCk7CiBrZXlzWyA5XSA9IG5ldyBBcnJheSgpOwoga2V5c1sxMF0gPSBuZXcgQXJyYXkoKTsKIGtleXNbMTFdID0gbmV3IEFycmF5KCk7CiBrZXlzWzEyXSA9IG5ldyBBcnJheSgpOwoga2V5c1sxM10gPSBuZXcgQXJyYXkoKTsKIGtleXNbMTRdID0gbmV3IEFycmF5KCk7CiBrZXlzWzE1XSA9IG5ldyBBcnJheSgpOyAgCiB2YXIgbG9vcCA9IFsxLDEsMiwyLDIsMiwyLDIsMSwyLDIsMiwyLDIsMiwxXTsKCiBmb3IoaT0wO2k8NztpKyspewogICBmb3Ioaj0wLGs9NztqPDg7aisrLGstLSl7CiAgICAga2V5W2kqOCtqXT1rZXlCeXRlWzgqaytpXTsKICAgfQogfSAgICAKIAogdmFyIGkgPSAwOwogZm9yKGkgPSAwO2kgPCAxNjtpICsrKXsKICAgdmFyIHRlbXBMZWZ0PTA7CiAgIHZhciB0ZW1wUmlnaHQ9MDsKICAgZm9yKGogPSAwOyBqIDwgbG9vcFtpXTtqICsrKXsgICAgICAgICAgCiAgICAgdGVtcExlZnQgPSBrZXlbMF07CiAgICAgdGVtcFJpZ2h0ID0ga2V5WzI4XTsKICAgICBmb3IoayA9IDA7ayA8IDI3IDtrICsrKXsKICAgICAgIGtleVtrXSA9IGtleVtrKzFdOwogICAgICAga2V5WzI4K2tdID0ga2V5WzI5K2tdOwogICAgIH0gIAogICAgIGtleVsyN109dGVtcExlZnQ7CiAgICAga2V5WzU1XT10ZW1wUmlnaHQ7CiAgIH0KICAgdmFyIHRlbXBLZXkgPSBuZXcgQXJyYXkoNDgpOwogICB0ZW1wS2V5WyAwXSA9IGtleVsxM107CiAgIHRlbXBLZXlbIDFdID0ga2V5WzE2XTsKICAgdGVtcEtleVsgMl0gPSBrZXlbMTBdOwogICB0ZW1wS2V5WyAzXSA9IGtleVsyM107CiAgIHRlbXBLZXlbIDRdID0ga2V5WyAwXTsKICAgdGVtcEtleVsgNV0gPSBrZXlbIDRdOwogICB0ZW1wS2V5WyA2XSA9IGtleVsgMl07CiAgIHRlbXBLZXlbIDddID0ga2V5WzI3XTsKICAgdGVtcEtleVsgOF0gPSBrZXlbMTRdOwogICB0ZW1wS2V5WyA5XSA9IGtleVsgNV07CiAgIHRlbXBLZXlbMTBdID0ga2V5WzIwXTsKICAgdGVtcEtleVsxMV0gPSBrZXlbIDldOwogICB0ZW1wS2V5WzEyXSA9IGtleVsyMl07CiAgIHRlbXBLZXlbMTNdID0ga2V5WzE4XTsKICAgdGVtcEtleVsxNF0gPSBrZXlbMTFdOwogICB0ZW1wS2V5WzE1XSA9IGtleVsgM107CiAgIHRlbXBLZXlbMTZdID0ga2V5WzI1XTsKICAgdGVtcEtleVsxN10gPSBrZXlbIDddOwogICB0ZW1wS2V5WzE4XSA9IGtleVsxNV07CiAgIHRlbXBLZXlbMTldID0ga2V5WyA2XTsKICAgdGVtcEtleVsyMF0gPSBrZXlbMjZdOwogICB0ZW1wS2V5WzIxXSA9IGtleVsxOV07CiAgIHRlbXBLZXlbMjJdID0ga2V5WzEyXTsKICAgdGVtcEtleVsyM10gPSBrZXlbIDFdOwogICB0ZW1wS2V5WzI0XSA9IGtleVs0MF07CiAgIHRlbXBLZXlbMjVdID0ga2V5WzUxXTsKICAgdGVtcEtleVsyNl0gPSBrZXlbMzBdOwogICB0ZW1wS2V5WzI3XSA9IGtleVszNl07CiAgIHRlbXBLZXlbMjhdID0ga2V5WzQ2XTsKICAgdGVtcEtleVsyOV0gPSBrZXlbNTRdOwogICB0ZW1wS2V5WzMwXSA9IGtleVsyOV07CiAgIHRlbXBLZXlbMzFdID0ga2V5WzM5XTsKICAgdGVtcEtleVszMl0gPSBrZXlbNTBdOwogICB0ZW1wS2V5WzMzXSA9IGtleVs0NF07CiAgIHRlbXBLZXlbMzRdID0ga2V5WzMyXTsKICAgdGVtcEtleVszNV0gPSBrZXlbNDddOwogICB0ZW1wS2V5WzM2XSA9IGtleVs0M107CiAgIHRlbXBLZXlbMzddID0ga2V5WzQ4XTsKICAgdGVtcEtleVszOF0gPSBrZXlbMzhdOwogICB0ZW1wS2V5WzM5XSA9IGtleVs1NV07CiAgIHRlbXBLZXlbNDBdID0ga2V5WzMzXTsKICAgdGVtcEtleVs0MV0gPSBrZXlbNTJdOwogICB0ZW1wS2V5WzQyXSA9IGtleVs0NV07CiAgIHRlbXBLZXlbNDNdID0ga2V5WzQxXTsKICAgdGVtcEtleVs0NF0gPSBrZXlbNDldOwogICB0ZW1wS2V5WzQ1XSA9IGtleVszNV07CiAgIHRlbXBLZXlbNDZdID0ga2V5WzI4XTsKICAgdGVtcEtleVs0N10gPSBrZXlbMzFdOwogICBzd2l0Y2goaSl7CiAgICAgY2FzZSAwOiBmb3IobT0wO20gPCA0OCA7bSsrKXsga2V5c1sgMF1bbV0gPSB0ZW1wS2V5W21dOyB9IGJyZWFrOwogICAgIGNhc2UgMTogZm9yKG09MDttIDwgNDggO20rKyl7IGtleXNbIDFdW21dID0gdGVtcEtleVttXTsgfSBicmVhazsKICAgICBjYXNlIDI6IGZvcihtPTA7bSA8IDQ4IDttKyspeyBrZXlzWyAyXVttXSA9IHRlbXBLZXlbbV07IH0gYnJlYWs7CiAgICAgY2FzZSAzOiBmb3IobT0wO20gPCA0OCA7bSsrKXsga2V5c1sgM11bbV0gPSB0ZW1wS2V5W21dOyB9IGJyZWFrOwogICAgIGNhc2UgNDogZm9yKG09MDttIDwgNDggO20rKyl7IGtleXNbIDRdW21dID0gdGVtcEtleVttXTsgfSBicmVhazsKICAgICBjYXNlIDU6IGZvcihtPTA7bSA8IDQ4IDttKyspeyBrZXlzWyA1XVttXSA9IHRlbXBLZXlbbV07IH0gYnJlYWs7CiAgICAgY2FzZSA2OiBmb3IobT0wO20gPCA0OCA7bSsrKXsga2V5c1sgNl1bbV0gPSB0ZW1wS2V5W21dOyB9IGJyZWFrOwogICAgIGNhc2UgNzogZm9yKG09MDttIDwgNDggO20rKyl7IGtleXNbIDddW21dID0gdGVtcEtleVttXTsgfSBicmVhazsKICAgICBjYXNlIDg6IGZvcihtPTA7bSA8IDQ4IDttKyspeyBrZXlzWyA4XVttXSA9IHRlbXBLZXlbbV07IH0gYnJlYWs7CiAgICAgY2FzZSA5OiBmb3IobT0wO20gPCA0OCA7bSsrKXsga2V5c1sgOV1bbV0gPSB0ZW1wS2V5W21dOyB9IGJyZWFrOwogICAgIGNhc2UgMTA6IGZvcihtPTA7bSA8IDQ4IDttKyspeyBrZXlzWzEwXVttXSA9IHRlbXBLZXlbbV07IH0gYnJlYWs7CiAgICAgY2FzZSAxMTogZm9yKG09MDttIDwgNDggO20rKyl7IGtleXNbMTFdW21dID0gdGVtcEtleVttXTsgfSBicmVhazsKICAgICBjYXNlIDEyOiBmb3IobT0wO20gPCA0OCA7bSsrKXsga2V5c1sxMl1bbV0gPSB0ZW1wS2V5W21dOyB9IGJyZWFrOwogICAgIGNhc2UgMTM6IGZvcihtPTA7bSA8IDQ4IDttKyspeyBrZXlzWzEzXVttXSA9IHRlbXBLZXlbbV07IH0gYnJlYWs7CiAgICAgY2FzZSAxNDogZm9yKG09MDttIDwgNDggO20rKyl7IGtleXNbMTRdW21dID0gdGVtcEtleVttXTsgfSBicmVhazsKICAgICBjYXNlIDE1OiBmb3IobT0wO20gPCA0OCA7bSsrKXsga2V5c1sxNV1bbV0gPSB0ZW1wS2V5W21dOyB9IGJyZWFrOwogICB9CiB9CiByZXR1cm4ga2V5czsgIAp9Ci8vZW5kLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovKgpmdW5jdGlvbiB0ZXN0KCkgewogCiB2YXIgbXNnID0gImFiY2RlZmdoIjsKIHZhciBidCA9IHN0clRvQnQobXNnKTsKIAogdmFyIGtleSA9ICIxMjM0NTY3OCI7CiB2YXIga2V5QiA9IHN0clRvQnQoa2V5KTsKICAgCiB2YXIgZW5jQnl0ZSA9IGVuYyhidCxrZXlCKTsKICAgICAKIHZhciBlbmNoZXggID0gYnQ2NFRvSGV4KGVuY0J5dGUpOyAgCiBlbmRhdGEudmFsdWU9ZW5jaGV4OwogCiB2YXIgZW5jU3RyID0gaGV4VG9CdDY0KGVuY2hleCk7CiBhbGVydCgiZW5jU3RyPSIrZW5jU3RyKTsKIHZhciBlQnl0ZSA9IG5ldyBBcnJheSgpOwogZm9yKG09MDttPGVuY1N0ci5sZW5ndGg7bSsrKXsKICAgZUJ5dGVbbV0gPSBwYXJzZUludChlbmNTdHIuc3Vic3RyaW5nKG0sbSsxKSk7CiB9CiB2YXIgZGVjYnl0ZT0gZGVjKGVCeXRlLGtleUIpCiB2YXIgZGVjbXNnPSBieXRlVG9TdHJpbmcoZGVjYnl0ZSk7CiBhbGVydCgiZGVjYnl0ZT0iK2RlY2J5dGUpOwogYWxlcnQoImRlY21zZz0iK2RlY21zZyk7ICAKfSovCgog";

    @Override
    public HttpResult<Map<String, Object>> init(OperatorParam param) {
        HttpResult<Map<String, Object>> result = new HttpResult<>();
        try {
            //登陆页没有获取任何cookie,不用登陆
            return result.success();
        } catch (Exception e) {
            logger.error("登录-->初始化失败,param={}", param, e);
            return result.failure(ErrorCode.TASK_INIT_ERROR);
        }
    }

    @Override
    public HttpResult<String> refeshPicCode(OperatorParam param) {
        switch (param.getFormType()) {
            case FormType.LOGIN:
                return refeshPicCodeForLogin(param);
            default:
                return new HttpResult<String>().failure(ErrorCode.NOT_SUPORT_METHOD);
        }
    }

    @Override
    public HttpResult<Map<String, Object>> refeshSmsCode(OperatorParam param) {
        switch (param.getFormType()) {
            case FormType.LOGIN:
                return refeshSmsCodeForLogin(param);
            default:
                return new HttpResult<Map<String, Object>>().failure(ErrorCode.NOT_SUPORT_METHOD);
        }
    }

    @Override
    public HttpResult<Map<String, Object>> submit(OperatorParam param) {
        switch (param.getFormType()) {
            case FormType.LOGIN:
                return submitForLogin(param);
            default:
                return new HttpResult<Map<String, Object>>().failure(ErrorCode.NOT_SUPORT_METHOD);
        }
    }

    @Override
    public HttpResult<Map<String, Object>> validatePicCode(OperatorParam param) {
        return new HttpResult<Map<String, Object>>().failure(ErrorCode.NOT_SUPORT_METHOD);
    }

    @Override
    public HttpResult<Object> defineProcess(OperatorParam param) {
        logger.warn("defineProcess fail,params={}", param);
        return new HttpResult<Object>().failure(ErrorCode.NOT_SUPORT_METHOD);
    }

    private HttpResult<String> refeshPicCodeForLogin(OperatorParam param) {
        /**
         * 这里不一定有图片验证码,随机出现
         */
        HttpResult<String> result = new HttpResult<>();
        Response response = null;
        try {
            String url = "http://wapyn.189.cn/vcImage.do";
            response = TaskHttpClient.create(param.getTaskId(), param.getWebsiteName(), RequestType.GET, "yun_nan_10000_wap_001").setResponseContentType(ContentType.create("image/png")).setFullUrl(url).invoke();
            logger.info("登录-->图片验证码-->刷新成功,param={}", param);
            return result.success(response.getPageContentForBase64());
        } catch (Exception e) {
            logger.error("登录-->图片验证码-->刷新失败,param={},response={}", param, response, e);
            return result.failure(ErrorCode.REFESH_PIC_CODE_ERROR);
        }
    }

    private HttpResult<Map<String, Object>> refeshSmsCodeForLogin(OperatorParam param) {
        HttpResult<Map<String, Object>> result = new HttpResult<>();
        Response response = null;
        try {
            String templateUrl = "http://wapyn.189.cn/sendSms.do";
            String templateData = "accNbr=" + param.getMobile();
            String referer = "http://wapyn.189.cn/initLogin.do";
            response = TaskHttpClient.create(param, RequestType.POST, "yun_nan_10000_wap_002").setFullUrl(templateUrl).setRequestBody(templateData).setReferer(referer).invoke();
            String pageContent = response.getPageContent();
            if (StringUtils.isNotBlank(pageContent) && StringUtils.contains(pageContent, "\"respCode\":\"0\"")) {
                logger.info("登录-->短信验证码-->刷新成功,param={}", param);
                return result.success();
            }
            logger.error("登录-->短信验证码-->刷新失败,param={},pageContent={}", param, response.getPageContent());
            return result.failure(ErrorCode.REFESH_SMS_UNEXPECTED_RESULT);

        } catch (Exception e) {
            logger.error("登录-->短信验证码-->刷新失败,param={},response={}", param, response, e);
            return result.failure(ErrorCode.REFESH_SMS_ERROR);
        }

    }

    private HttpResult<Map<String, Object>> submitForLogin(OperatorParam param) {
        CheckUtils.checkNotBlank(param.getPassword(), ErrorCode.EMPTY_PASSWORD);
        CheckUtils.checkNotBlank(param.getPicCode(), ErrorCode.EMPTY_PIC_CODE);
        HttpResult<Map<String, Object>> result = new HttpResult<>();
        Response response = null;
        try {

            //http://wapyn.189.cn/loginValidate.do?enAccNbr=7BB8AB1C627DA1326101BCCEB7C8DA56B819B66058CCA6BD&enPassword=83A5AA2D78E94FBCF3862E863BDD78E5&loginPwdType=A&mode=&nodeId=72&valid=3107
            //InputStream inputStream = this.getClass().getClassLoader().getResourceAsStream("yun_nan_10000_wap/des.js");
            Invocable invocable = ScriptEngineUtil.createInvocableFromBase64(javaScript);
            String encodeMobile = invocable.invokeFunction("strEnc", param.getMobile().toString(), "wap_accnbr_2016", "", "").toString();
            Object encodePassword = invocable.invokeFunction("strEnc", param.getPassword(), "wap_password_2016", "", "");

            String templateUrl = "http://wapyn.189.cn/loginValidate.do";
            String templateData = "loginPwdType=B&nodeId=72&mode=other&enAccNbr=" + encodeMobile + "&enPassword=" + encodePassword + "&valid=" + param.getPicCode();
            String referer = "http://wapyn.189.cn/initLogin.do";
            response = TaskHttpClient.create(param, RequestType.POST, "yun_nan_10000_wap_003").setFullUrl(templateUrl).setRequestBody(templateData).setReferer(referer).invoke();
            String pageContent = response.getPageContent();

            templateUrl = "http://wapyn.189.cn/self/info/custInfo.do?nodeId=319";
            referer = "http://wapyn.189.cn/self/index.do";
            response = TaskHttpClient.create(param, RequestType.GET, "yun_nan_10000_wap_004").setFullUrl(templateUrl).setReferer(referer).invoke();
            pageContent = response.getPageContent();
            if (StringUtils.isNotBlank(pageContent) && pageContent.contains(String.valueOf(param.getMobile()))) {
                logger.info("登陆成功,param={}", param);
                return result.success();
            } else {
                logger.error("登陆失败,param={},errorMsg={}", param);
                return result.failure(ErrorCode.LOGIN_UNEXPECTED_RESULT);
            }

            //String errorMsg = JsoupXpathUtils.selectFirst(pageContent, "//div[@id='valcellphoneLoginFormMsgId']/text()");
            //if (StringUtils.isBlank(errorMsg)) {
            //    logger.info("登陆成功,param={}", param);
            //    return result.success();
            //}
            //if (StringUtils.contains(errorMsg, "验证码")) {
            //    logger.warn("登录失败-->图片验证码校验失败,param={},errorMsg={}", param, errorMsg);
            //    return result.failure(ErrorCode.VALIDATE_PIC_CODE_FAIL);
            //}
            //if (StringUtils.contains(errorMsg, "密码")) {
            //    logger.warn("登录失败-->密码错误,param={},errorMsg={}", param, errorMsg);
            //    return result.failure(ErrorCode.VALIDATE_PASSWORD_FAIL);
            //}
            //logger.error("登陆失败,param={},errorMsg={}", param, errorMsg);
            //return result.failure(ErrorCode.LOGIN_UNEXPECTED_RESULT);
        } catch (Exception e) {
            logger.error("登陆失败,param={},response={}", param, response, e);
            return result.failure(ErrorCode.LOGIN_ERROR);
        }
    }

}
