<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.datatrees.rawdatacentral.dao.WebsiteConfigDAO">

    <resultMap id="BaseResultMap" type="com.datatrees.rawdatacentral.domain.vo.WebsiteConfig">
        <id column="Id" jdbcType="INTEGER" property="websiteId"/>
        <result column="WebsiteType" jdbcType="BIT" property="websiteType"/>
        <result column="WebsiteName" jdbcType="VARCHAR" property="websiteName"/>
        <result column="isenabled" jdbcType="BIT" property="isenabled"/>
        <result column="LoginTip" jdbcType="VARCHAR" property="loginTip"/>
        <result column="VerifyTip" jdbcType="VARCHAR" property="verifyTip"/>
        <result column="ResetType" jdbcType="VARCHAR" property="resetType"/>
        <result column="SmsTemplate" jdbcType="VARCHAR" property="smsTemplate"/>
        <result column="SmsReceiver" jdbcType="VARCHAR" property="smsReceiver"/>
        <result column="ResetURL" jdbcType="VARCHAR" property="resetURL"/>
        <result column="ResetTip" jdbcType="VARCHAR" property="resetTip"/>
        <result column="CreatedAt" jdbcType="TIMESTAMP" property="createdAt"/>
        <result column="UpdatedAt" jdbcType="TIMESTAMP" property="updatedAt"/>
        <result column="Simulate" jdbcType="BIT" property="simulate"/>
        <result column="TemplateId" jdbcType="INTEGER" property="templateId"/>

        <result column="WebsiteConfId" jdbcType="INTEGER" property="websiteConfId"/>
        <result column="ExtractorConfig" jdbcType="VARCHAR" property="extractorConfig"/>

        <result column="conf" jdbcType="LONGVARCHAR" property="initSetting"/>
    </resultMap>

    <select id="getWebsiteConfig" resultMap="BaseResultMap">
        select w.*,c.SearchConfig,c.ExtractorConfig,c.Id as WebsiteConfId,t.conf from t_website w
        left join t_website_conf c on w.Id = c.WebsiteId
        left join t_website_template t on w.TemplateId = t.Id
        where w.isenabled = 1
        <if test="websiteId != null">
            and w.Id = #{websiteId}
        </if>
        <if test="websiteName != null">
            and w.WebsiteName = #{websiteName}
        </if>
    </select>

    <update id="updateWebsiteConf" >
        update t_website_conf set SearchConfig = #{searchConfig} ,ExtractorConfig = #{extractConfig} ,UpdatedAt = now() where WebsiteId = #{websiteId}
    </update>

</mapper>